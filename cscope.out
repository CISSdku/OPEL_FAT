cscope 15 $HOME/ë‹¤ìš´ë¡œë“œ/OPEL/filesystem/fat_test/OPEL_FAT               0000457556
	@cache.c

11 
	~<lšux/fs.h
>

12 
	~<lšux/¦ab.h
>

13 
	~<lšux/bufãr_h—d.h
>

14 
	~"çt.h
"

17 
	#FAT_MAX_CACHE
 8

	)

19 
	sçt_ÿche
 {

20 
li¡_h—d
 
	mÿche_li¡
;

21 
	mÄ_cÚtig
;

22 
	mfþu¡”
;

23 
	mdþu¡”
;

26 
	sçt_ÿche_id
 {

27 
	mid
;

28 
	mÄ_cÚtig
;

29 
	mfþu¡”
;

30 
	mdþu¡”
;

33 
šlše
 
	$çt_max_ÿche
(
šode
 *inode)

35  
FAT_MAX_CACHE
;

36 
	}
}

38 
kmem_ÿche
 *
	gçt_ÿche_ÿch•
;

40 
	$š™_Úû
(*
foo
)

42 
çt_ÿche
 *
ÿche
 = (çt_ÿch*)
foo
;

44 
	`INIT_LIST_HEAD
(&
ÿche
->
ÿche_li¡
);

45 
	}
}

47 
__š™
 
	$çt_ÿche_š™
()

49 
çt_ÿche_ÿch•
 = 
	`kmem_ÿche_ü—‹
("fat_cache",

50 (
çt_ÿche
),

51 0, 
SLAB_RECLAIM_ACCOUNT
|
SLAB_MEM_SPREAD
,

52 
š™_Úû
);

53 ià(
çt_ÿche_ÿch•
 =ð
NULL
)

54  -
ENOMEM
;

56 
	}
}

58 
	$çt_ÿche_de¡roy
()

60 
	`kmem_ÿche_de¡roy
(
çt_ÿche_ÿch•
);

61 
	}
}

63 
šlše
 
çt_ÿche
 *
	$çt_ÿche_®loc
(
šode
 *inode)

65  
	`kmem_ÿche_®loc
(
çt_ÿche_ÿch•
, 
GFP_NOFS
);

66 
	}
}

68 
šlše
 
	$çt_ÿche_ä“
(
çt_ÿche
 *
ÿche
)

70 
	`BUG_ON
(!
	`li¡_em±y
(&
ÿche
->
ÿche_li¡
));

71 
	`kmem_ÿche_ä“
(
çt_ÿche_ÿch•
, 
ÿche
);

72 
	}
}

74 
šlše
 
	$çt_ÿche_upd©e_Ìu
(
šode
 *inode,

75 
çt_ÿche
 *
ÿche
)

77 ià(
	`MSDOS_I
(
šode
)->
ÿche_Ìu
.
Ãxt
 !ð&
ÿche
->
ÿche_li¡
)

78 
	`li¡_move
(&
ÿche
->
ÿche_li¡
, &
	`MSDOS_I
(
šode
)->
ÿche_Ìu
);

79 
	}
}

81 
	$çt_ÿche_lookup
(
šode
 *šode, 
fþus
,

82 
çt_ÿche_id
 *
cid
,

83 *
ÿched_fþus
, *
ÿched_dþus
)

85 
çt_ÿche
 
noh™
 = { .
fþu¡”
 = 0, };

87 
çt_ÿche
 *
h™
 = &
noh™
, *
p
;

88 
off£t
 = -1;

90 
	`¥š_lock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

91 
	`li¡_fÜ_—ch_’Œy
(
p
, &
	`MSDOS_I
(
šode
)->
ÿche_Ìu
, 
ÿche_li¡
) {

93 ià(
p
->
fþu¡”
 <ð
fþus
 && 
h™
->fcluster <…->fcluster) {

94 
h™
 = 
p
;

95 ià((
h™
->
fþu¡”
 + h™->
Ä_cÚtig
è< 
fþus
) {

96 
off£t
 = 
h™
->
Ä_cÚtig
;

98 
off£t
 = 
fþus
 - 
h™
->
fþu¡”
;

103 ià(
h™
 !ð&
noh™
) {

104 
	`çt_ÿche_upd©e_Ìu
(
šode
, 
h™
);

106 
cid
->
id
 = 
	`MSDOS_I
(
šode
)->
ÿche_v®id_id
;

107 
cid
->
Ä_cÚtig
 = 
h™
->nr_contig;

108 
cid
->
fþu¡”
 = 
h™
->fcluster;

109 
cid
->
dþu¡”
 = 
h™
->dcluster;

110 *
ÿched_fþus
 = 
cid
->
fþu¡”
 + 
off£t
;

111 *
ÿched_dþus
 = 
cid
->
dþu¡”
 + 
off£t
;

113 
	`´štk
("çt_ÿche_looku°%d %d %d %d \n", 
cid
->
fþu¡”
, cid->
dþu¡”
, *
ÿched_fþus
, *
ÿched_dþus
 );

115 
	`¥š_uÆock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

117  
off£t
;

118 
	}
}

120 
çt_ÿche
 *
	$çt_ÿche_m”ge
(
šode
 *inode,

121 
çt_ÿche_id
 *
Ãw
)

123 
çt_ÿche
 *
p
;

125 
	`li¡_fÜ_—ch_’Œy
(
p
, &
	`MSDOS_I
(
šode
)->
ÿche_Ìu
, 
ÿche_li¡
) {

127 ià(
p
->
fþu¡”
 =ð
Ãw
->fcluster) {

128 
	`BUG_ON
(
p
->
dþu¡”
 !ð
Ãw
->dcluster);

129 ià(
Ãw
->
Ä_cÚtig
 > 
p
->nr_contig)

130 
p
->
Ä_cÚtig
 = 
Ãw
->nr_contig;

131  
p
;

134  
NULL
;

135 
	}
}

137 
	$çt_ÿche_add
(
šode
 *šode, 
çt_ÿche_id
 *
Ãw
)

139 
çt_ÿche
 *
ÿche
, *
tmp
;

141 ià(
Ãw
->
fþu¡”
 == -1)

144 
	`¥š_lock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

145 ià(
Ãw
->
id
 !ð
FAT_CACHE_VALID
 &&

146 
Ãw
->
id
 !ð
	`MSDOS_I
(
šode
)->
ÿche_v®id_id
)

147 
out
;

149 
ÿche
 = 
	`çt_ÿche_m”ge
(
šode
, 
Ãw
);

150 ià(
ÿche
 =ð
NULL
) {

151 ià(
	`MSDOS_I
(
šode
)->
Ä_ÿches
 < 
	`çt_max_ÿche
(inode)) {

152 
	`MSDOS_I
(
šode
)->
Ä_ÿches
++;

153 
	`¥š_uÆock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

155 
tmp
 = 
	`çt_ÿche_®loc
(
šode
);

156 ià(!
tmp
) {

157 
	`¥š_lock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

158 
	`MSDOS_I
(
šode
)->
Ä_ÿches
--;

159 
	`¥š_uÆock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

163 
	`¥š_lock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

164 
ÿche
 = 
	`çt_ÿche_m”ge
(
šode
, 
Ãw
);

165 ià(
ÿche
 !ð
NULL
) {

166 
	`MSDOS_I
(
šode
)->
Ä_ÿches
--;

167 
	`çt_ÿche_ä“
(
tmp
);

168 
out_upd©e_Ìu
;

170 
ÿche
 = 
tmp
;

172 
li¡_h—d
 *
p
 = 
	`MSDOS_I
(
šode
)->
ÿche_Ìu
.
´ev
;

173 
ÿche
 = 
	`li¡_’Œy
(
p
, 
çt_ÿche
, 
ÿche_li¡
);

175 
ÿche
->
fþu¡”
 = 
Ãw
->fcluster;

176 
ÿche
->
dþu¡”
 = 
Ãw
->dcluster;

177 
ÿche
->
Ä_cÚtig
 = 
Ãw
->nr_contig;

179 
out_upd©e_Ìu
:

180 
	`çt_ÿche_upd©e_Ìu
(
šode
, 
ÿche
);

181 
out
:

182 
	`¥š_uÆock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

183 
	}
}

189 
	$__çt_ÿche_šv®_šode
(
šode
 *inode)

191 
msdos_šode_šfo
 *
i
 = 
	`MSDOS_I
(
šode
);

192 
çt_ÿche
 *
ÿche
;

194 !
	`li¡_em±y
(&
i
->
ÿche_Ìu
)) {

195 
ÿche
 = 
	`li¡_’Œy
(
i
->
ÿche_Ìu
.
Ãxt
,

196 
çt_ÿche
, 
ÿche_li¡
);

197 
	`li¡_d–_š™
(&
ÿche
->
ÿche_li¡
);

198 
i
->
Ä_ÿches
--;

199 
	`çt_ÿche_ä“
(
ÿche
);

202 
i
->
ÿche_v®id_id
++;

203 ià(
i
->
ÿche_v®id_id
 =ð
FAT_CACHE_VALID
)

204 
i
->
ÿche_v®id_id
++;

205 
	}
}

207 
	$çt_ÿche_šv®_šode
(
šode
 *inode)

209 
	`¥š_lock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

210 
	`__çt_ÿche_šv®_šode
(
šode
);

211 
	`¥š_uÆock
(&
	`MSDOS_I
(
šode
)->
ÿche_Ìu_lock
);

212 
	}
}

214 
šlše
 
	$ÿche_cÚtiguous
(
çt_ÿche_id
 *
cid
, 
dþus
)

216 
cid
->
Ä_cÚtig
++;

217  ((
cid
->
dþu¡”
 + cid->
Ä_cÚtig
è=ð
dþus
);

218 
	}
}

220 
šlše
 
	$ÿche_š™
(
çt_ÿche_id
 *
cid
, 
fþus
, 
dþus
)

222 
cid
->
id
 = 
FAT_CACHE_VALID
;

223 
cid
->
fþu¡”
 = 
fþus
;

224 
cid
->
dþu¡”
 = 
dþus
;

225 
cid
->
Ä_cÚtig
 = 0;

226 
	}
}

228 
	$çt_g‘_þu¡”
(
šode
 *šode, 
þu¡”
, *
fþus
, *
dþus
)

230 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

231 cÚ¡ 
lim™
 = 
sb
->
s_maxby‹s
 >> 
	`MSDOS_SB
(sb)->
þu¡”_b™s
;

232 
çt_’Œy
 
ç‹Á
;

233 
çt_ÿche_id
 
cid
;

234 
Ä
;

236 
	`BUG_ON
(
	`MSDOS_I
(
šode
)->
i_¡¬t
 == 0);

238 *
fþus
 = 0;

239 *
dþus
 = 
	`MSDOS_I
(
šode
)->
i_¡¬t
;

240 ià(
þu¡”
 == 0)

245 ià(
	`çt_ÿche_lookup
(
šode
, 
þu¡”
, &
cid
, 
fþus
, 
dþus
) < 0) {

250 
	`ÿche_š™
(&
cid
, -1, -1);

254 
	`ç‹Á_š™
(&
ç‹Á
);

258 *
fþus
 < 
þu¡”
) {

260 ià(*
fþus
 > 
lim™
) {

261 
	`çt_fs_”rÜ_¿‹lim™
(
sb
,

263 " (i_po %Îd)", 
__func__
,

264 
	`MSDOS_I
(
šode
)->
i_pos
);

265 
Ä
 = -
EIO
;

266 
out
;

269 
Ä
 = 
	`çt_’t_»ad
(
šode
, &
ç‹Á
, *
dþus
);

271 ià(
Ä
 < 0)

272 
out
;

273 ià(
Ä
 =ð
FAT_ENT_FREE
) {

274 
	`çt_fs_”rÜ_¿‹lim™
(
sb
,

276 
__func__
,

277 
	`MSDOS_I
(
šode
)->
i_pos
);

278 
Ä
 = -
EIO
;

279 
out
;

280 } ià(
Ä
 =ð
FAT_ENT_EOF
) {

281 
	`çt_ÿche_add
(
šode
, &
cid
);

282 
out
;

284 (*
fþus
)++;

285 *
dþus
 = 
Ä
;

286 ià(!
	`ÿche_cÚtiguous
(&
cid
, *
dþus
))

287 
	`ÿche_š™
(&
cid
, *
fþus
, *
dþus
);

289 
Ä
 = 0;

290 
	`çt_ÿche_add
(
šode
, &
cid
);

291 
out
:

292 
	`ç‹Á_b»l£
(&
ç‹Á
);

293  
Ä
;

294 
	}
}

296 
	$çt_bm­_þu¡”
(
šode
 *šode, 
þu¡”
)

298 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

299 
»t
, 
fþus
, 
dþus
;

301 ià(
	`MSDOS_I
(
šode
)->
i_¡¬t
 == 0)

304 
»t
 = 
	`çt_g‘_þu¡”
(
šode
, 
þu¡”
, &
fþus
, &
dþus
);

305 ià(
»t
 < 0)

306  
»t
;

307 ià(
»t
 =ð
FAT_ENT_EOF
) {

308 
	`çt_fs_”rÜ
(
sb
, "%s:„equest beyond EOF (i_pos %lld)",

309 
__func__
, 
	`MSDOS_I
(
šode
)->
i_pos
);

310  -
EIO
;

312  
dþus
;

313 
	}
}

315 
	$çt_bm­
(
šode
 *šode, 
£ùÜ_t
 
£ùÜ
, seùÜ_ˆ*
phys
,

316 *
m­³d_blocks
, 
ü—‹
)

318 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

319 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

320 cÚ¡ 
blocksize
 = 
sb
->
s_blocksize
;

321 cÚ¡ 
blocksize_b™s
 = 
sb
->
s_blocksize_b™s
;

322 
£ùÜ_t
 
Ï¡_block
;

323 
þu¡”
, 
off£t
;

325 *
phys
 = 0;

326 *
m­³d_blocks
 = 0;

327 ià((
sbi
->
çt_b™s
 !ð32è&& (
šode
->
i_šo
 =ð
MSDOS_ROOT_INO
)) {

328 ià(
£ùÜ
 < (
sbi
->
dœ_’Œ›s
 >> sbi->
dœ_³r_block_b™s
)) {

329 *
phys
 = 
£ùÜ
 + 
sbi
->
dœ_¡¬t
;

330 *
m­³d_blocks
 = 1;

335 
Ï¡_block
 = (
	`i_size_»ad
(
šode
è+ (
blocksize
 - 1)è>> 
blocksize_b™s
;

336 ià(
£ùÜ
 >ð
Ï¡_block
) {

337 ià(!
ü—‹
)

344 
Ï¡_block
 = (
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 + (
blocksize
 - 1))

345 >> 
blocksize_b™s
;

346 ià(
£ùÜ
 >ð
Ï¡_block
)

350 
þu¡”
 = 
£ùÜ
 >> (
sbi
->
þu¡”_b™s
 - 
sb
->
s_blocksize_b™s
);

351 
off£t
 = 
£ùÜ
 & (
sbi
->
£c_³r_þus
 - 1);

352 
þu¡”
 = 
	`çt_bm­_þu¡”
(
šode
, cluster);

353 ià(
þu¡”
 < 0)

354  
þu¡”
;

355 ià(
þu¡”
) {

356 *
phys
 = 
	`çt_þus_to_blkÄ
(
sbi
, 
þu¡”
è+ 
off£t
;

357 *
m­³d_blocks
 = 
sbi
->
£c_³r_þus
 - 
off£t
;

358 ià(*
m­³d_blocks
 > 
Ï¡_block
 - 
£ùÜ
)

359 *
m­³d_blocks
 = 
Ï¡_block
 - 
£ùÜ
;

362 
	}
}

	@config.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/š™.h
>

3 
	~<lšux/time.h
>

4 
	~<lšux/¦ab.h
>

5 
	~<lšux/£q_fže.h
>

6 
	~<lšux/·gem­.h
>

7 
	~<lšux/m·ge.h
>

8 
	~<lšux/bufãr_h—d.h
>

9 
	~<lšux/expÜtfs.h
>

10 
	~<lšux/mouÁ.h
>

11 
	~<lšux/vfs.h
>

12 
	~<lšux/·r£r.h
>

13 
	~<lšux/uio.h
>

14 
	~<lšux/wr™eback.h
>

15 
	~<lšux/log2.h
>

16 
	~<lšux/hash.h
>

17 
	~<asm/uÇligÃd.h
>

18 
	~"çt.h
"

25 cÚ¡ *
	gcÚfig_d©a
 = "Blackbox Configuration\r\n\r\nPartitioning Size[Percentage]\r\n\tBX_NORMAL =20\r\n\tBX_NORMAL_EVENT =15\r\n\tBX_PARKING_EVENT =15\r\n\tBX_MANUAL =15\r\n\tBX_IMAGE =15\r\n\tBX_ETC =20\r\n\r\nPreallocation Setting[MB]\r\n\tBX_NORMAL =8\r\n\tBX_NORMAL_EVENT =8\r\n\tBX_PARKING_EVENT =8\r\n\tBX_MANUAL =8\r\n\t\0";

28 
	gmsdos_Çme
[ 
MSDOS_NAME
 ] = "BXFS_CON";

30 
	$»ad_cÚfig_d©a
(
su³r_block
 *
sb
, *
d©a
)

36 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

38 
num_of_´e
 = 4;

39 
num_of_·r
 = 6;

40 
num_of_tÙ®
 = 
num_of_´e
 + 
num_of_·r
;

43 
i
;

44 
block_size
 = 512;

45 
couÁ
 = 0;

47 
»ad_v®
[20] = {0, };

49 
i
=0; i<
block_size
; i++)

52 if(
d©a
[
i
] == '='){

53 if(
d©a
[
i
+3] >= '0' && data[i+3] <= '9'){

54 
»ad_v®
[
couÁ
] = ((()(
d©a
[
i
+1])-48) * 100) + ((()(data[i+2])-48) * 10) + ((()(data[i+3])-48)) ;

55 
i
+=3;

57 if(
d©a
[
i
+2] >= '0' && data[i+2] <= '9'){

58 
»ad_v®
[
couÁ
] = ((()(
d©a
[
i
+1])-48) * 10) + ((()(data[i+2])-48)) ;

59 
i
+=2;

61 if(
d©a
[
i
+1] >= '0' && data[i+1] <= '9'){

62 
»ad_v®
[
couÁ
] = ((()(
d©a
[
i
+1])-48)) ;

63 
i
++;

66 
	`´štk
("Invalid config file data! \n");

70 
couÁ
++;

72 if(
couÁ
 >ð
num_of_tÙ®
){

73 
	`´štk
("[cheon] Complete data…arsing \n");

80 if(
couÁ
 < 
num_of_tÙ®
){

81 
	`´štk
("Some config date‡re dropped! \n");

89 
sbi
->
bx_¬—_¿tio
[
BX_NORMAL
] = 
»ad_v®
[0];

90 
sbi
->
bx_¬—_¿tio
[
BX_NORMAL_EVENT
] = 
»ad_v®
[1];

91 
sbi
->
bx_¬—_¿tio
[
BX_PARKING_EVENT
] = 
»ad_v®
[2];

92 
sbi
->
bx_¬—_¿tio
[
BX_MANUAL
] = 
»ad_v®
[3];

93 
sbi
->
bx_¬—_¿tio
[
BX_IMAGE
] = 
»ad_v®
[4];

94 
sbi
->
bx_¬—_¿tio
[
BX_ETC
] = 
»ad_v®
[5];

97 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL
 ] = 
»ad_v®
[0];

98 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL_EVENT
 ] = 
»ad_v®
[1];

99 
sbi
->
bx_¬—_¿tio
[ 
BB_PARKING
 ] = 
»ad_v®
[2];

100 
sbi
->
bx_¬—_¿tio
[ 
BB_MANUAL
 ] = 
»ad_v®
[3];

101 
sbi
->
bx_¬—_¿tio
[ 
BB_IMAGE
 ] = 
»ad_v®
[4];

102 
sbi
->
bx_¬—_¿tio
[ 
BB_ETC
 ] = 
»ad_v®
[5];

105 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL
 ] );

106 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL_EVENT
 ] );

107 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_¬—_¿tio
[ 
BB_PARKING
 ] );

108 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_¬—_¿tio
[ 
BB_MANUAL
 ] );

109 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_¬—_¿tio
[ 
BB_IMAGE
 ] );

110 
	`´štk
("[cheÚ] %u \n\n", 
sbi
->
bx_¬—_¿tio
[ 
BB_ETC
 ] );

115 
sbi
->
bx_´e_size
[
BX_NORMAL
] = 
»ad_v®
[6];

116 
sbi
->
bx_´e_size
[
BX_NORMAL_EVENT
] = 
»ad_v®
[7];

117 
sbi
->
bx_´e_size
[
BX_PARKING_EVENT
] = 
»ad_v®
[8];

118 
sbi
->
bx_´e_size
[
BX_MANUAL
] = 
»ad_v®
[9];

121 
sbi
->
bx_´e_size
[ 
BB_NORMAL
 ] = 
»ad_v®
[6];

122 
sbi
->
bx_´e_size
[ 
BB_NORMAL_EVENT
 ] = 
»ad_v®
[7];

123 
sbi
->
bx_´e_size
[ 
BB_PARKING
 ] = 
»ad_v®
[8];

124 
sbi
->
bx_´e_size
[ 
BB_MANUAL
 ] = 
»ad_v®
[9];

126 
sbi
->
bx_´e_size
[ 
BB_ETC
 ] = sbi->bx_´e_size[ 
BB_IMAGE
 ] = sbi->bx_´e_size[ 
BB_MANUAL
 ];

128 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_´e_size
[ 
BB_NORMAL
 ] );

129 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_´e_size
[ 
BB_NORMAL_EVENT
 ] );

130 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_´e_size
[ 
BB_PARKING
 ] );

131 
	`´štk
("[cheÚ] %u \n", 
sbi
->
bx_´e_size
[ 
BB_MANUAL
 ] );

136 
	}
}

138 
	$_çt_chaš_add
(
šode
 *šode, 
Ãw_dþus
, 
Ä_þu¡”
)

141 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

142 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

143 
»t
, 
Ãw_fþus
, 
Ï¡
;

149 
Ï¡
 = 
Ãw_fþus
 = 0;

153 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
Ãw_dþus
;

154 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 
Ãw_dþus
;

162 
»t
 = 
	`çt_sync_šode
(
šode
);

163 ià(
»t
)

164  
»t
;

176 
šode
->
i_blocks
 = 
Ä_þu¡”
 << (
sbi
->
þu¡”_b™s
 - 9);

179 
	}
}

181 
	$bužd_cÚfig_fže
Ð
šode
 *
dœ
, 
d’Œy
 *d’Œy, 
mode
 )

183 
msdos_dœ_’Œy
 
de
;

184 
çt_¦Ù_šfo
 
sšfo
;

185 
çt_¦Ù_šfo
 *
_sšfo
 = &
sšfo
;

186 
šode
 *šodð
NULL
;

188 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

189 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

191 
þu¡”_num
 = 0;

192 
”r
;

193 
þu¡”
 = 
sbi
->
çt_¡¬t
;

198 ifÐ!
	`çt_sÿn
Ð
dœ
, 
msdos_Çme
, &
sšfo
 ) )

200 
	`´štk
("[cheon] build_config_file :ƒxisting file ");

201 
	`b»l£
Ð
sšfo
.
bh
 );

202 
”r
 = -
EINVAL
;

203 
out
;

208 
	`memýy
Ð
de
.
Çme
, 
msdos_Çme
, 
MSDOS_NAME
 );

210 
de
.
©Œ
 = 0 ? 
ATTR_DIR
 : 
ATTR_ARCH
;

211 
de
.
lÿ£
 = 0;

212 
de
.
cd©e
 = de.
ad©e
 = 0;

213 
de
.
ùime
 = 0;

214 
de
.
ùime_cs
 = 0;

215 
de
.
time
 = 0;

216 
de
.
d©e
 = 0;

217 
de
.
¡¬t
 = 
	`ýu_to_Ë16
(
þu¡”_num
);

218 
de
.
¡¬thi
 = 
	`ýu_to_Ë16
(
þu¡”_num
) >> 16;

219 
de
.
size
 = 512;

221 
”r
 = 
	`çt_add_’Œ›s
Ð
dœ
, &
de
, 1, 
_sšfo
 );

222 
šode
 = 
	`çt_bužd_šode
Ð
sb
, 
sšfo
.
de
, sšfo.
i_pos
 );

224 
	`b»l£
Ð
sšfo
.
bh
 );

226 ià(
	`IS_ERR
(
šode
)) {

227 
”r
 = 
	`PTR_ERR
(
šode
);

228 
	`´štk
("[cheon] Error‡bout inode...\n");

229 
out
;

231 
	`´štk
("[cheon] Complete Create Config File \n");

234 ifÐ!
	`çt_sÿn
Ð
roÙ
, 
msdos_Çme
, &
sšfo
 ) )

236 
	`b»l£
Ð
sšfo
.
bh
 );

237 
	`´štk
("[cheon] config file‡lreadyƒxist \n");

243 ià(!
”r
){

244 
	`´štk
("[cheÚ] s¹ f©_æush_šode : %u \n", 
þu¡”
);

245 
”r
 = 
	`çt_æush_šodes
(
sb
, 
dœ
, 
šode
);

248 
	`´štk
("[cheÚ] s¹ f©_®loc_þu¡” : %u \n", 
þu¡”
);

249 
	`çt_®loc_þu¡”
(
šode
, &
þu¡”
, 
BX_ETC
);

251 
	`´štk
("[cheÚ] g‘ %d clu¡” \n", 
þu¡”
);

252 
	`_çt_chaš_add
Ð
šode
, 
þu¡”
, 1 );

256 
	`´štk
("[gandan] Error or Skipping \n");

259 
	`´štk
("[gandan] Complete cluster‡llocation for config file \n");

261 
out
:

262  
”r
;

263 
	}
}

266 
šlše
 
£ùÜ_t
 
	$çt_þus_to_blkÄ
(
msdos_sb_šfo
 *
sbi
, 
þus
)

268  ((
£ùÜ_t
)
þus
 - 
FAT_START_ENT
è* 
sbi
->
£c_³r_þus
 + sbi->
d©a_¡¬t
;

269 
	}
}

272 
	$Ý–_vçt_fšd_fÜm
Ð
msdos_sb_šfo
 *
sbi
, 
šode
 *
dœ
, *
Çme
, 
£ùÜ_t
 *
blkÄ
 )

274 
çt_¦Ù_šfo
 
sšfo
;

275 
”r
 = 
	`çt_sÿn_Ý–
(
dœ
, 
Çme
, &
sšfo
);

276 ià(
”r
)

277  -
ENOENT
;

279 
	`´štk
("[cheon] detect \n");

281 
£ùÜ_t
 
þus
 = 
sšfo
.
de
->
¡¬t
;

283 
	`b»l£
(
sšfo
.
bh
);

284 
	`´štk
("[cheÚ] sšfo' ¡¬ˆšfØ: %u \n", 
þus
 );

289 
	`¡rýy
Ð
sšfo
.
bh
->
b_d©a
, "test" );

291 
	`£t_bufãr_u±od©e
Ð
sšfo
.
bh
 );

292 
	`m¬k_bufãr_dœty_šode
Ð
sšfo
.
bh
, 
dœ
 );

296 *
blkÄ
 = ( (
þus
 - 
FAT_START_ENT
è* 
sbi
->
£c_³r_þus
 ) + sbi->
d©a_¡¬t
;

298 
	}
}

303 
	$çt_cÚfig_š™
(
su³r_block
 *
sb
)

305 
çt_¦Ù_šfo
 
sšfo
;

306 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

307 
d’Œy
 *
roÙ_de
 = 
sb
->
s_roÙ
;

308 
šode
 *
roÙ
 = 
roÙ_de
->
d_šode
;

310 
bufãr_h—d
 *
bh
;

311 
block_pos
;

312 
”r
;

314 
£ùÜ_t
 
blkÄ
;

316 
	`´štk
("[cheon] Start fat_config_init \n");

319 ifÐ!
	`çt_sÿn_Ý–
Ð
roÙ
, 
msdos_Çme
, &
sšfo
 ) )

321 
	`´štk
("[cheon] config file‡lreadyƒxist \n");

322 
	`b»l£
Ð
sšfo
.
bh
 );

324 
exi¡
;

329 
	`´štk
("[cheon] Create config File \n");

330 
”r
 = 
	`bužd_cÚfig_fže
Ð
roÙ
, 
roÙ_de
, 0 );

334 ifÐ
	`Ý–_vçt_fšd_fÜm
Ð
sbi
, 
roÙ
, 
msdos_Çme
, &
blkÄ
 ) =ð-
ENOENT
 )

335 
	`´štk
("[cheon] opel_vfat_find_formƒrror \n");

343 
bh
 = 
	`sb_b»ad
Ð
sb
, 
blkÄ
 );

344 ifÐ!
bh
 )

346 
	`´štk
("[cheon] unableo„ead inode block \n");

347 
	`b»l£
(
bh
);

350 
	`¡rýy
Ð
bh
->
b_d©a
, 
cÚfig_d©a
 );

352 
	`m¬k_bufãr_dœty
(
bh
);

353 
”r
 = 
	`sync_dœty_bufãr
(
bh
);

354 
	`b»l£
(
bh
);

356 
	`´štk
("[cheon] Complete write data \n");

358 ià(
	`çt_sÿn
(
roÙ
, 
msdos_Çme
, &
sšfo
))

360 
	`´štk
("[cheon] <==Error==> Creation config file failed! \n");

367 
bh
 = 
	`sb_g‘blk
Ð
sb
, 
blkÄ
 );

368 ifÐ!
bh
 )

370 
	`´štk
("[cheon] sb_getblkƒrror \n");

372 
	`¡rýy
Ð
bh
->
b_d©a
, 
cÚfig_d©a
 );

382 
	`m¬k_bufãr_dœty
(
bh
);

383 
”r
 = 
	`sync_dœty_bufãr
(
bh
);

386 ià(
	`çt_sÿn
(
roÙ
, 
msdos_Çme
, &
sšfo
))

388 
	`´štk
("[gandan] <==Error==> Creation config file failed! \n");

392 
exi¡
:

400 ifÐ
	`Ý–_vçt_fšd_fÜm
Ð
sbi
, 
roÙ
, 
msdos_Çme
, &
blkÄ
 ) =ð-
ENOENT
 )

401 
	`´štk
("[cheon] opel_vfat_find_formƒrror \n");

404 
bh
 = 
	`sb_b»ad
Ð
sb
, 
blkÄ
 );

405 
	`»ad_cÚfig_d©a
Ð
sb
, 
bh
->
b_d©a
 );

406 
	`b»l£
Ð
bh
 );

408 
	`´štk
("[cheon] Start data„ead...complete\n");

411 
	}
}

412 
EXPORT_SYMBOL_GPL
Ð
çt_cÚfig_š™
 );

	@dir.c

16 
	~<lšux/moduË.h
>

17 
	~<lšux/¦ab.h
>

18 
	~<lšux/time.h
>

19 
	~<lšux/bufãr_h—d.h
>

20 
	~<lšux/com·t.h
>

21 
	~<lšux/uacûss.h
>

22 
	~<lšux/k”Ãl.h
>

23 
	~"çt.h
"

30 
	#FAT_MAX_SHORT_SIZE
 ((
MSDOS_NAME
 + 1è* 
NLS_MAX_CHARSET_SIZE
 + 1)

	)

35 
	#FAT_MAX_UNI_CHARS
 ((
MSDOS_SLOTS
 - 1è* 13 + 1)

	)

36 
	#FAT_MAX_UNI_SIZE
 (
FAT_MAX_UNI_CHARS
 * (
wch¬_t
))

	)

38 
šlše
 
	$çt_tÞow”
(
c
)

40  ((
c
 >= 'A') && (c <= 'Z')) ? c+32 : c;

41 
	}
}

43 
šlše
 
loff_t
 
	$çt_make_i_pos
(
su³r_block
 *
sb
,

44 
bufãr_h—d
 *
bh
,

45 
msdos_dœ_’Œy
 *
de
)

47  ((
loff_t
)
bh
->
b_blockÄ
 << 
	`MSDOS_SB
(
sb
)->
dœ_³r_block_b™s
)

48 | (
de
 - (
msdos_dœ_’Œy
 *)
bh
->
b_d©a
);

49 
	}
}

51 
šlše
 
	$çt_dœ_»adah—d
(
šode
 *
dœ
, 
£ùÜ_t
 
iblock
,

52 
£ùÜ_t
 
phys
)

54 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

55 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

56 
bufãr_h—d
 *
bh
;

57 
£c
;

60 ià((
iblock
 & (
sbi
->
£c_³r_þus
 - 1)) || sbi->sec_per_clus == 1)

63 ià((
sbi
->
çt_b™s
 !ð32è&& (
dœ
->
i_šo
 =ð
MSDOS_ROOT_INO
))

66 
bh
 = 
	`sb_fšd_g‘_block
(
sb
, 
phys
);

67 ià(
bh
 =ð
NULL
 || !
	`bufãr_u±od©e
(bh)) {

68 
£c
 = 0; seø< 
sbi
->
£c_³r_þus
; sec++)

69 
	`sb_b»adah—d
(
sb
, 
phys
 + 
£c
);

71 
	`b»l£
(
bh
);

72 
	}
}

84 
	$çt__g‘_’Œy
(
šode
 *
dœ
, 
loff_t
 *
pos
,

85 
bufãr_h—d
 **
bh
, 
msdos_dœ_’Œy
 **
de
)

87 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

88 
£ùÜ_t
 
phys
, 
iblock
;

89 
m­³d_blocks
;

90 
”r
, 
off£t
;

92 
Ãxt
:

93 ià(*
bh
)

94 
	`b»l£
(*
bh
);

96 *
bh
 = 
NULL
;

97 
iblock
 = *
pos
 >> 
sb
->
s_blocksize_b™s
;

98 
”r
 = 
	`çt_bm­
(
dœ
, 
iblock
, &
phys
, &
m­³d_blocks
, 0);

99 ià(
”r
 || !
phys
)

102 
	`çt_dœ_»adah—d
(
dœ
, 
iblock
, 
phys
);

104 *
bh
 = 
	`sb_b»ad
(
sb
, 
phys
);

105 ià(*
bh
 =ð
NULL
) {

106 
	`çt_msg_¿‹lim™
(
sb
, 
KERN_ERR
,

107 "DœeùÜy b»ad(block %Îuèçžed", (
Îu
)
phys
);

109 *
pos
 = (
iblock
 + 1è<< 
sb
->
s_blocksize_b™s
;

110 
Ãxt
;

113 
off£t
 = *
pos
 & (
sb
->
s_blocksize
 - 1);

114 *
pos
 +ð(
msdos_dœ_’Œy
);

115 *
de
 = (
msdos_dœ_’Œy
 *)((*
bh
)->
b_d©a
 + 
off£t
);

118 
	}
}

120 
šlše
 
	$çt_g‘_’Œy
(
šode
 *
dœ
, 
loff_t
 *
pos
,

121 
bufãr_h—d
 **
bh
,

122 
msdos_dœ_’Œy
 **
de
)

125 ià(*
bh
 && *
de
 &&

126 (*
de
 - (
msdos_dœ_’Œy
 *)(*
bh
)->
b_d©a
) <

127 
	`MSDOS_SB
(
dœ
->
i_sb
)->
dœ_³r_block
 - 1) {

128 *
pos
 +ð(
msdos_dœ_’Œy
);

129 (*
de
)++;

132  
	`çt__g‘_’Œy
(
dœ
, 
pos
, 
bh
, 
de
);

133 
	}
}

145 
	$uni16_to_x8
(
su³r_block
 *
sb
, *
ascii
,

146 cÚ¡ 
wch¬_t
 *
uni
, 
Ën
, 
Æs_bË
 *
Æs
)

148 
uni_xÏ‹
 = 
	`MSDOS_SB
(
sb
)->
ÝtiÚs
.
unicode_xÏ‹
;

149 cÚ¡ 
wch¬_t
 *

;

150 
wch¬_t
 
ec
;

151 *
Ý
;

152 
ch¬Ën
;

154 

 = 
uni
;

155 
Ý
 = 
ascii
;

157 *

 && ((
Ën
 - 
NLS_MAX_CHARSET_SIZE
) > 0)) {

158 
ec
 = *

++;

159 
ch¬Ën
 = 
Æs
->
	`uni2ch¬
(
ec
, 
Ý
, 
NLS_MAX_CHARSET_SIZE
);

160 ià(
ch¬Ën
 > 0) {

161 
Ý
 +ð
ch¬Ën
;

162 
Ën
 -ð
ch¬Ën
;

164 ià(
uni_xÏ‹
 == 1) {

165 *
Ý
++ = ':';

166 
Ý
 = 
	`hex_by‹_·ck
(Ý, 
ec
 >> 8);

167 
Ý
 = 
	`hex_by‹_·ck
(Ý, 
ec
);

168 
Ën
 -= 5;

170 *
Ý
++ = '?';

171 
Ën
--;

176 ià(
	`uÆik–y
(*

)) {

177 
	`çt_msg
(
sb
, 
KERN_WARNING
,

181 *
Ý
 = 0;

182  
Ý
 - 
ascii
;

183 
	}
}

185 
šlše
 
	$çt_uni_to_x8
(
su³r_block
 *
sb
, cÚ¡ 
wch¬_t
 *
uni
,

186 *
buf
, 
size
)

188 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

189 ià(
sbi
->
ÝtiÚs
.
utf8
)

190  
	`utf16s_to_utf8s
(
uni
, 
FAT_MAX_UNI_CHARS
,

191 
UTF16_HOST_ENDIAN
, 
buf
, 
size
);

193  
	`uni16_to_x8
(
sb
, 
buf
, 
uni
, 
size
, 
sbi
->
Æs_io
);

194 
	}
}

196 
šlše
 

197 
	$çt_shÜt2uni
(
Æs_bË
 *
t
, *
c
, 
þ’
, 
wch¬_t
 *
uni
)

199 
ch¬Ën
;

201 
ch¬Ën
 = 
t
->
	`ch¬2uni
(
c
, 
þ’
, 
uni
);

202 ià(
ch¬Ën
 < 0) {

203 *
uni
 = 0x003f;

204 
ch¬Ën
 = 1;

206  
ch¬Ën
;

207 
	}
}

209 
šlše
 

210 
	$çt_shÜt2low”_uni
(
Æs_bË
 *
t
, *
c
,

211 
þ’
, 
wch¬_t
 *
uni
)

213 
ch¬Ën
;

214 
wch¬_t
 
wc
;

216 
ch¬Ën
 = 
t
->
	`ch¬2uni
(
c
, 
þ’
, &
wc
);

217 ià(
ch¬Ën
 < 0) {

218 *
uni
 = 0x003f;

219 
ch¬Ën
 = 1;

220 } ià(
ch¬Ën
 <= 1) {

221 
nc
 = 
t
->
ch¬£t2low”
[*
c
];

223 ià(!
nc
)

224 
nc
 = *
c
;

226 
ch¬Ën
 = 
t
->
	`ch¬2uni
(&
nc
, 1, 
uni
);

227 ià(
ch¬Ën
 < 0) {

228 *
uni
 = 0x003f;

229 
ch¬Ën
 = 1;

232 *
uni
 = 
wc
;

234  
ch¬Ën
;

235 
	}
}

237 
šlše
 

238 
	$çt_shÜŠame2uni
(
Æs_bË
 *
Æs
, *
buf
, 
buf_size
,

239 
wch¬_t
 *
uni_buf
, 
Ýt
, 
low”
)

241 
Ën
 = 0;

243 ià(
Ýt
 & 
VFAT_SFN_DISPLAY_LOWER
)

244 
Ën
 = 
	`çt_shÜt2low”_uni
(
Æs
, 
buf
, 
buf_size
, 
uni_buf
);

245 ià(
Ýt
 & 
VFAT_SFN_DISPLAY_WIN95
)

246 
Ën
 = 
	`çt_shÜt2uni
(
Æs
, 
buf
, 
buf_size
, 
uni_buf
);

247 ià(
Ýt
 & 
VFAT_SFN_DISPLAY_WINNT
) {

248 ià(
low”
)

249 
Ën
 = 
	`çt_shÜt2low”_uni
(
Æs
, 
buf
, 
buf_size
, 
uni_buf
);

251 
Ën
 = 
	`çt_shÜt2uni
(
Æs
, 
buf
, 
buf_size
, 
uni_buf
);

253 
Ën
 = 
	`çt_shÜt2uni
(
Æs
, 
buf
, 
buf_size
, 
uni_buf
);

255  
Ën
;

256 
	}
}

258 
šlše
 
	$çt_Çme_m©ch
(
msdos_sb_šfo
 *
sbi
,

259 cÚ¡ *
a
, 
a_Ën
,

260 cÚ¡ *
b
, 
b_Ën
)

262 ià(
a_Ën
 !ð
b_Ën
)

265 ià(
sbi
->
ÝtiÚs
.
Çme_check
 != 's')

266  !
	`Æs_¡ºicmp
(
sbi
->
Æs_io
, 
a
, 
b
, 
a_Ën
);

268  !
	`memcmp
(
a
, 
b
, 
a_Ën
);

269 
	}
}

271 ’um { 
	mPARSE_INVALID
 = 1, 
	mPARSE_NOT_LONGNAME
, 
	mPARSE_EOF
, };

283 
	$çt_·r£_lÚg
(
šode
 *
dœ
, 
loff_t
 *
pos
,

284 
bufãr_h—d
 **
bh
, 
msdos_dœ_’Œy
 **
de
,

285 
wch¬_t
 **
unicode
, *
Ä_¦Ùs
)

287 
msdos_dœ_¦Ù
 *
ds
;

288 
id
, 
¦Ù
, 
¦Ùs
, 
®Ÿs_checksum
;

290 ià(!*
unicode
) {

291 *
unicode
 = 
	`__g‘Çme
();

292 ià(!*
unicode
) {

293 
	`b»l£
(*
bh
);

294  -
ENOMEM
;

297 
·r£_lÚg
:

298 
¦Ùs
 = 0;

299 
ds
 = (
msdos_dœ_¦Ù
 *)*
de
;

300 
id
 = 
ds
->id;

301 ià(!(
id
 & 0x40))

302  
PARSE_INVALID
;

303 
¦Ùs
 = 
id
 & ~0x40;

304 ià(
¦Ùs
 > 20 || !slots)

305  
PARSE_INVALID
;

306 *
Ä_¦Ùs
 = 
¦Ùs
;

307 
®Ÿs_checksum
 = 
ds
->alias_checksum;

309 
¦Ù
 = 
¦Ùs
;

311 
off£t
;

313 
¦Ù
--;

314 
off£t
 = 
¦Ù
 * 13;

315 
	`çt16_towch¬
(*
unicode
 + 
off£t
, 
ds
->
Çme0_4
, 5);

316 
	`çt16_towch¬
(*
unicode
 + 
off£t
 + 5, 
ds
->
Çme5_10
, 6);

317 
	`çt16_towch¬
(*
unicode
 + 
off£t
 + 11, 
ds
->
Çme11_12
, 2);

319 ià(
ds
->
id
 & 0x40)

320 (*
unicode
)[
off£t
 + 13] = 0;

321 ià(
	`çt_g‘_’Œy
(
dœ
, 
pos
, 
bh
, 
de
) < 0)

322  
PARSE_EOF
;

323 ià(
¦Ù
 == 0)

325 
ds
 = (
msdos_dœ_¦Ù
 *)*
de
;

326 ià(
ds
->
©Œ
 !ð
ATTR_EXT
)

327  
PARSE_NOT_LONGNAME
;

328 ià((
ds
->
id
 & ~0x40è!ð
¦Ù
)

329 
·r£_lÚg
;

330 ià(
ds
->
®Ÿs_checksum
 !=‡lias_checksum)

331 
·r£_lÚg
;

333 ià((*
de
)->
Çme
[0] =ð
DELETED_FLAG
)

335 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_parse_long / DELETED_FLAG \n ");

336  
PARSE_INVALID
;

338 ià((*
de
)->
©Œ
 =ð
ATTR_EXT
)

339 
·r£_lÚg
;

340 ià(
	`IS_FREE
((*
de
)->
Çme
è|| ((*de)->
©Œ
 & 
ATTR_VOLUME
))

341  
PARSE_INVALID
;

342 ià(
	`çt_checksum
((*
de
)->
Çme
è!ð
®Ÿs_checksum
)

343 *
Ä_¦Ùs
 = 0;

346 
	}
}

357 
	$çt_·r£_shÜt
(
su³r_block
 *
sb
,

358 cÚ¡ 
msdos_dœ_’Œy
 *
de
,

359 *
Çme
, 
dÙ_hidd’
)

361 cÚ¡ 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

362 
isvçt
 = 
sbi
->
ÝtiÚs
.isvfat;

363 
noÿ£
 = 
sbi
->
ÝtiÚs
.nocase;

364 
Ýt_shÜŠame
 = 
sbi
->
ÝtiÚs
.
shÜŠame
;

365 
Æs_bË
 *
Æs_disk
 = 
sbi
->nls_disk;

366 
wch¬_t
 
uni_Çme
[14];

367 
c
, 
wÜk
[
MSDOS_NAME
];

368 *
±Çme
 = 
Çme
;

369 
chi
, 
chl
, 
i
, 
j
, 
k
;

370 
dÙoff£t
 = 0;

371 
Çme_Ën
 = 0, 
uni_Ën
 = 0;

373 ià(!
isvçt
 && 
dÙ_hidd’
 && (
de
->
©Œ
 & 
ATTR_HIDDEN
)) {

374 *
±Çme
++ = '.';

375 
dÙoff£t
 = 1;

378 
	`memýy
(
wÜk
, 
de
->
Çme
, (work));

380 ià(
wÜk
[0] == 0x05)

381 
wÜk
[0] = 0xE5;

384 
i
 = 0, 
j
 = 0; i < 8;) {

385 
c
 = 
wÜk
[
i
];

386 ià(!
c
)

388 
chl
 = 
	`çt_shÜŠame2uni
(
Æs_disk
, &
wÜk
[
i
], 8 - i,

389 &
uni_Çme
[
j
++], 
Ýt_shÜŠame
,

390 
de
->
lÿ£
 & 
CASE_LOWER_BASE
);

391 ià(
chl
 <= 1) {

392 ià(!
isvçt
)

393 
±Çme
[
i
] = 
noÿ£
 ? 
c
 : 
	`çt_tÞow”
(c);

394 
i
++;

395 ià(
c
 != ' ') {

396 
Çme_Ën
 = 
i
;

397 
uni_Ën
 = 
j
;

400 
uni_Ën
 = 
j
;

401 ià(
isvçt
)

402 
i
 +ð
	`mš
(
chl
, 8-i);

404 
chi
 = 0; ch˜< 
chl
 && 
i
 < 8; chi++, i++)

405 
±Çme
[
i
] = 
wÜk
[i];

407 ià(
chl
)

408 
Çme_Ën
 = 
i
;

412 
i
 = 
Çme_Ën
;

413 
j
 = 
uni_Ën
;

414 
	`çt_shÜt2uni
(
Æs_disk
, ".", 1, &
uni_Çme
[
j
++]);

415 ià(!
isvçt
)

416 
±Çme
[
i
] = '.';

417 
i
++;

420 
k
 = 8; k < 
MSDOS_NAME
;) {

421 
c
 = 
wÜk
[
k
];

422 ià(!
c
)

424 
chl
 = 
	`çt_shÜŠame2uni
(
Æs_disk
, &
wÜk
[
k
], 
MSDOS_NAME
 - k,

425 &
uni_Çme
[
j
++], 
Ýt_shÜŠame
,

426 
de
->
lÿ£
 & 
CASE_LOWER_EXT
);

427 ià(
chl
 <= 1) {

428 
k
++;

429 ià(!
isvçt
)

430 
±Çme
[
i
] = 
noÿ£
 ? 
c
 : 
	`çt_tÞow”
(c);

431 
i
++;

432 ià(
c
 != ' ') {

433 
Çme_Ën
 = 
i
;

434 
uni_Ën
 = 
j
;

437 
uni_Ën
 = 
j
;

438 ià(
isvçt
) {

439 
off£t
 = 
	`mš
(
chl
, 
MSDOS_NAME
-
k
);

440 
k
 +ð
off£t
;

441 
i
 +ð
off£t
;

443 
chi
 = 0; ch˜< 
chl
 && 
k
 < 
MSDOS_NAME
;

444 
chi
++, 
i
++, 
k
++) {

445 
±Çme
[
i
] = 
wÜk
[
k
];

448 ià(
chl
)

449 
Çme_Ën
 = 
i
;

453 ià(
Çme_Ën
 > 0) {

454 
Çme_Ën
 +ð
dÙoff£t
;

456 ià(
sbi
->
ÝtiÚs
.
isvçt
) {

457 
uni_Çme
[
uni_Ën
] = 0x0000;

458 
Çme_Ën
 = 
	`çt_uni_to_x8
(
sb
, 
uni_Çme
, 
Çme
,

459 
FAT_MAX_SHORT_SIZE
);

463  
Çme_Ën
;

464 
	}
}

469 
	$çt_£¬ch_lÚg
(
šode
 *šode, cÚ¡ *
Çme
,

470 
Çme_Ën
, 
çt_¦Ù_šfo
 *
sšfo
)

472 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

473 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

474 
bufãr_h—d
 *
bh
 = 
NULL
;

475 
msdos_dœ_’Œy
 *
de
;

476 
Ä_¦Ùs
;

477 
wch¬_t
 *
unicode
 = 
NULL
;

478 
buâame
[
FAT_MAX_SHORT_SIZE
];

479 
loff_t
 
ýos
 = 0;

480 
”r
, 
Ën
;

482 
”r
 = -
ENOENT
;

484 ià(
	`çt_g‘_’Œy
(
šode
, &
ýos
, &
bh
, &
de
) == -1)

485 
’d_of_dœ
;

486 
·r£_»cÜd
:

487 
Ä_¦Ùs
 = 0;

488 ià(
de
->
Çme
[0] =ð
DELETED_FLAG
)

493 ià(
de
->
©Œ
 !ð
ATTR_EXT
 && (de->©Œ & 
ATTR_VOLUME
))

495 ià(
de
->
©Œ
 !ð
ATTR_EXT
 && 
	`IS_FREE
(de->
Çme
))

497 ià(
de
->
©Œ
 =ð
ATTR_EXT
) {

498 
¡©us
 = 
	`çt_·r£_lÚg
(
šode
, &
ýos
, &
bh
, &
de
,

499 &
unicode
, &
Ä_¦Ùs
);

500 ià(
¡©us
 < 0) {

501 
”r
 = 
¡©us
;

502 
’d_of_dœ
;

503 } ià(
¡©us
 =ð
PARSE_INVALID
)

505 ià(
¡©us
 =ð
PARSE_NOT_LONGNAME
)

506 
·r£_»cÜd
;

507 ià(
¡©us
 =ð
PARSE_EOF
)

508 
’d_of_dœ
;

516 
Ën
 = 
	`çt_·r£_shÜt
(
sb
, 
de
, 
buâame
, 0);

517 ià(
Ën
 == 0)

521 ià(
	`çt_Çme_m©ch
(
sbi
, 
Çme
, 
Çme_Ën
, 
buâame
, 
Ën
))

522 
found
;

524 ià(
Ä_¦Ùs
) {

525 *
lÚgÇme
 = 
unicode
 + 
FAT_MAX_UNI_CHARS
;

526 
size
 = 
PATH_MAX
 - 
FAT_MAX_UNI_SIZE
;

529 
Ën
 = 
	`çt_uni_to_x8
(
sb
, 
unicode
, 
lÚgÇme
, 
size
);

530 ià(
	`çt_Çme_m©ch
(
sbi
, 
Çme
, 
Çme_Ën
, 
lÚgÇme
, 
Ën
))

531 
found
;

535 
found
:

536 
Ä_¦Ùs
++;

537 
sšfo
->
¦Ù_off
 = 
ýos
 - 
Ä_¦Ùs
 * (*
de
);

538 
sšfo
->
Ä_¦Ùs
 =‚r_slots;

539 
sšfo
->
de
 = de;

540 
sšfo
->
bh
 = bh;

541 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

542 
”r
 = 0;

543 
’d_of_dœ
:

544 ià(
unicode
)

545 
	`__puŠame
(
unicode
);

547  
”r
;

548 
	}
}

549 
EXPORT_SYMBOL_GPL
(
çt_£¬ch_lÚg
);

551 
	sçt_ioùl_fžldœ_ÿÎback
 {

552 
__u£r
 *
	mdœ’t
;

553 
	m»suÉ
;

555 cÚ¡ *
	mlÚgÇme
;

556 
	mlÚg_Ën
;

557 cÚ¡ *
	mshÜŠame
;

558 
	mshÜt_Ën
;

561 
	$__çt_»addœ
(
šode
 *šode, 
fže
 *
fžp
, *
dœ’t
,

562 
fžldœ_t
 
fžldœ
, 
shÜt_Úly
, 
bÙh
)

564 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

565 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

566 
bufãr_h—d
 *
bh
;

567 
msdos_dœ_’Œy
 *
de
;

568 
Ä_¦Ùs
;

569 
wch¬_t
 *
unicode
 = 
NULL
;

570 
buâame
[
FAT_MAX_SHORT_SIZE
];

571 
isvçt
 = 
sbi
->
ÝtiÚs
.isvfat;

572 cÚ¡ *
fžl_Çme
 = 
NULL
;

573 
šum
;

574 
Íos
, 
dummy
, *
fu¼fu
 = &lpos;

575 
loff_t
 
ýos
;

576 
shÜt_Ën
 = 0, 
fžl_Ën
 = 0;

577 
»t
 = 0;

579 
	`mu‹x_lock
(&
sbi
->
s_lock
);

581 
ýos
 = 
fžp
->
f_pos
;

583 ià(
šode
->
i_šo
 =ð
MSDOS_ROOT_INO
) {

584 
ýos
 < 2) {

585 ià(
	`fžldœ
(
dœ’t
, "..", 
ýos
+1, cpos,

586 
MSDOS_ROOT_INO
, 
DT_DIR
) < 0)

587 
out
;

588 
ýos
++;

589 
fžp
->
f_pos
++;

591 ià(
ýos
 == 2) {

592 
dummy
 = 2;

593 
fu¼fu
 = &
dummy
;

594 
ýos
 = 0;

597 ià(
ýos
 & ((
msdos_dœ_’Œy
) - 1)) {

598 
»t
 = -
ENOENT
;

599 
out
;

602 
bh
 = 
NULL
;

603 
g‘_Ãw
:

604 ià(
	`çt_g‘_’Œy
(
šode
, &
ýos
, &
bh
, &
de
) == -1)

605 
’d_of_dœ
;

606 
·r£_»cÜd
:

607 
Ä_¦Ùs
 = 0;

612 ià(
isvçt
 && !
shÜt_Úly
) {

613 ià(
de
->
Çme
[0] =ð
DELETED_FLAG
)

616 
»cÜd_’d
;

618 ià(
de
->
©Œ
 !ð
ATTR_EXT
 && (de->©Œ & 
ATTR_VOLUME
))

621 
»cÜd_’d
;

623 ià(
de
->
©Œ
 !ð
ATTR_EXT
 && 
	`IS_FREE
(de->
Çme
))

625 
»cÜd_’d
;

628 ià((
de
->
©Œ
 & 
ATTR_VOLUME
è|| 
	`IS_FREE
(de->
Çme
))

629 
»cÜd_’d
;

632 ià(
isvçt
 && 
de
->
©Œ
 =ð
ATTR_EXT
) {

633 
¡©us
 = 
	`çt_·r£_lÚg
(
šode
, &
ýos
, &
bh
, &
de
,

634 &
unicode
, &
Ä_¦Ùs
);

635 ià(
¡©us
 < 0) {

636 
fžp
->
f_pos
 = 
ýos
;

637 
»t
 = 
¡©us
;

638 
out
;

639 } ià(
¡©us
 =ð
PARSE_INVALID
)

640 
»cÜd_’d
;

641 ià(
¡©us
 =ð
PARSE_NOT_LONGNAME
)

642 
·r£_»cÜd
;

643 ià(
¡©us
 =ð
PARSE_EOF
)

644 
’d_of_dœ
;

646 ià(
Ä_¦Ùs
) {

647 *
lÚgÇme
 = 
unicode
 + 
FAT_MAX_UNI_CHARS
;

648 
size
 = 
PATH_MAX
 - 
FAT_MAX_UNI_SIZE
;

649 
Ën
 = 
	`çt_uni_to_x8
(
sb
, 
unicode
, 
lÚgÇme
, 
size
);

651 
fžl_Çme
 = 
lÚgÇme
;

652 
fžl_Ën
 = 
Ën
;

654 ià(!
bÙh
)

655 
¡¬t_fžldœ
;

659 
shÜt_Ën
 = 
	`çt_·r£_shÜt
(
sb
, 
de
, 
buâame
, 
sbi
->
ÝtiÚs
.
dÙsOK
);

660 ià(
shÜt_Ën
 == 0)

661 
»cÜd_’d
;

663 ià(
Ä_¦Ùs
) {

665 
çt_ioùl_fžldœ_ÿÎback
 *
p
 = 
dœ’t
;

667 
p
->
lÚgÇme
 = 
fžl_Çme
;

668 
p
->
lÚg_Ën
 = 
fžl_Ën
;

669 
p
->
shÜŠame
 = 
buâame
;

670 
p
->
shÜt_Ën
 = short_len;

671 
fžl_Çme
 = 
NULL
;

672 
fžl_Ën
 = 0;

674 
fžl_Çme
 = 
buâame
;

675 
fžl_Ën
 = 
shÜt_Ën
;

678 
¡¬t_fžldœ
:

679 
Íos
 = 
ýos
 - (
Ä_¦Ùs
 + 1è* (
msdos_dœ_’Œy
);

680 ià(!
	`memcmp
(
de
->
Çme
, 
MSDOS_DOT
, 
MSDOS_NAME
))

681 
šum
 = 
šode
->
i_šo
;

682 ià(!
	`memcmp
(
de
->
Çme
, 
MSDOS_DOTDOT
, 
MSDOS_NAME
)) {

683 
šum
 = 
	`·»Á_šo
(
fžp
->
f_·th
.
d’Œy
);

685 
loff_t
 
i_pos
 = 
	`çt_make_i_pos
(
sb
, 
bh
, 
de
);

686 
šode
 *
tmp
 = 
	`çt_ig‘
(
sb
, 
i_pos
);

687 ià(
tmp
) {

688 
šum
 = 
tmp
->
i_šo
;

689 
	`ut
(
tmp
);

691 
šum
 = 
	`iunique
(
sb
, 
MSDOS_ROOT_INO
);

694 ià(
	`fžldœ
(
dœ’t
, 
fžl_Çme
, 
fžl_Ën
, *
fu¼fu
, 
šum
,

695 (
de
->
©Œ
 & 
ATTR_DIR
è? 
DT_DIR
 : 
DT_REG
) < 0)

696 
fžl_çžed
;

698 
»cÜd_’d
:

699 
fu¼fu
 = &
Íos
;

700 
fžp
->
f_pos
 = 
ýos
;

701 
g‘_Ãw
;

702 
’d_of_dœ
:

703 
fžp
->
f_pos
 = 
ýos
;

704 
fžl_çžed
:

705 
	`b»l£
(
bh
);

706 ià(
unicode
)

707 
	`__puŠame
(
unicode
);

708 
out
:

709 
	`mu‹x_uÆock
(&
sbi
->
s_lock
);

710  
»t
;

711 
	}
}

713 
	$çt_»addœ
(
fže
 *
fžp
, *
dœ’t
, 
fžldœ_t
 
fžldœ
)

715 
šode
 *šodð
	`fže_šode
(
fžp
);

716  
	`__çt_»addœ
(
šode
, 
fžp
, 
dœ’t
, 
fžldœ
, 0, 0);

717 
	}
}

719 
	#FAT_IOCTL_FILLDIR_FUNC
(
func
, 
dœ’t_ty³
) \

720 
	`func
(*
__buf
, cÚ¡ *
Çme
, 
Çme_Ën
, \

721 
loff_t
 
off£t
, 
u64
 
šo
, 
d_ty³
) \

723 
çt_ioùl_fžldœ_ÿÎback
 *
buf
 = 
__buf
; \

724 
dœ’t_ty³
 
__u£r
 *
d1
 = 
buf
->
dœ’t
; \

725 
dœ’t_ty³
 
__u£r
 *
d2
 = 
d1
 + 1; \

727 ià(
buf
->
»suÉ
) \

728  -
EINVAL
; \

729 
buf
->
»suÉ
++; \

731 ià(
Çme
 !ð
NULL
) { \

733 ià(
Çme_Ën
 >ð(
d1
->
d_Çme
)) \

734 
Çme_Ën
 = (
d1
->
d_Çme
) - 1; \

736 ià(
	`put_u£r
(0, 
d2
->
d_Çme
) || \

737 
	`put_u£r
(0, &
d2
->
d_»þ’
) || \

738 
	`cÝy_to_u£r
(
d1
->
d_Çme
, 
Çme
, 
Çme_Ën
) || \

739 
	`put_u£r
(0, 
d1
->
d_Çme
 + 
Çme_Ën
) || \

740 
	`put_u£r
(
Çme_Ën
, &
d1
->
d_»þ’
)) \

741 
eçuÉ
; \

744 cÚ¡ *
lÚgÇme
 = 
buf
->longname; \

745 
lÚg_Ën
 = 
buf
->long_len; \

746 cÚ¡ *
shÜŠame
 = 
buf
->shortname; \

747 
shÜt_Ën
 = 
buf
->short_len; \

749 ià(
lÚg_Ën
 >ð(
d1
->
d_Çme
)) \

750 
lÚg_Ën
 = (
d1
->
d_Çme
) - 1; \

751 ià(
shÜt_Ën
 >ð(
d1
->
d_Çme
)) \

752 
shÜt_Ën
 = (
d1
->
d_Çme
) - 1; \

754 ià(
	`cÝy_to_u£r
(
d2
->
d_Çme
, 
lÚgÇme
, 
lÚg_Ën
) || \

755 
	`put_u£r
(0, 
d2
->
d_Çme
 + 
lÚg_Ën
) || \

756 
	`put_u£r
(
lÚg_Ën
, &
d2
->
d_»þ’
) || \

757 
	`put_u£r
(
šo
, &
d2
->
d_šo
) || \

758 
	`put_u£r
(
off£t
, &
d2
->
d_off
) || \

759 
	`cÝy_to_u£r
(
d1
->
d_Çme
, 
shÜŠame
, 
shÜt_Ën
) || \

760 
	`put_u£r
(0, 
d1
->
d_Çme
 + 
shÜt_Ën
) || \

761 
	`put_u£r
(
shÜt_Ën
, &
d1
->
d_»þ’
)) \

762 
eçuÉ
; \

765 
eçuÉ
: \

766 
buf
->
»suÉ
 = -
EFAULT
; \

767  -
EFAULT
; \

768 }

	)

770 
	$FAT_IOCTL_FILLDIR_FUNC
(
çt_ioùl_fžldœ
, 
__çt_dœ’t
)

772 
	$çt_ioùl_»addœ
(
šode
 *šode, 
fže
 *
fžp
,

773 
__u£r
 *
dœ’t
, 
fžldœ_t
 
fžldœ
,

774 
shÜt_Úly
, 
bÙh
)

776 
çt_ioùl_fžldœ_ÿÎback
 
buf
;

777 
»t
;

779 
buf
.
dœ’t
 = dirent;

780 
buf
.
»suÉ
 = 0;

781 
	`mu‹x_lock
(&
šode
->
i_mu‹x
);

782 
»t
 = -
ENOENT
;

783 ià(!
	`IS_DEADDIR
(
šode
)) {

784 
»t
 = 
	`__çt_»addœ
(
šode
, 
fžp
, &
buf
, 
fžldœ
,

785 
shÜt_Úly
, 
bÙh
);

787 
	`mu‹x_uÆock
(&
šode
->
i_mu‹x
);

788 ià(
»t
 >= 0)

789 
»t
 = 
buf
.
»suÉ
;

790  
»t
;

791 
	}
}

793 
	$çt_dœ_ioùl
(
fže
 *
fžp
, 
cmd
,

794 
¬g
)

796 
šode
 *šodð
	`fže_šode
(
fžp
);

797 
__çt_dœ’t
 
__u£r
 *
d1
 = (__çt_dœ’ˆ__u£¸*)
¬g
;

798 
shÜt_Úly
, 
bÙh
;

800 
cmd
) {

801 
VFAT_IOCTL_READDIR_SHORT
:

802 
shÜt_Úly
 = 1;

803 
bÙh
 = 0;

805 
VFAT_IOCTL_READDIR_BOTH
:

806 
shÜt_Úly
 = 0;

807 
bÙh
 = 1;

810  
	`çt_g’”ic_ioùl
(
fžp
, 
cmd
, 
¬g
);

813 ià(!
	`acûss_ok
(
VERIFY_WRITE
, 
d1
, (
__çt_dœ’t
[2])))

814  -
EFAULT
;

820 ià(
	`put_u£r
(0, &
d1
->
d_»þ’
))

821  -
EFAULT
;

823  
	`çt_ioùl_»addœ
(
šode
, 
fžp
, 
d1
, 
çt_ioùl_fžldœ
,

824 
shÜt_Úly
, 
bÙh
);

825 
	}
}

827 #ifdeà
CONFIG_COMPAT


828 
	#VFAT_IOCTL_READDIR_BOTH32
 
	`_IOR
('r', 1, 
com·t_dœ’t
[2])

	)

829 
	#VFAT_IOCTL_READDIR_SHORT32
 
	`_IOR
('r', 2, 
com·t_dœ’t
[2])

	)

831 
	$FAT_IOCTL_FILLDIR_FUNC
(
çt_com·t_ioùl_fžldœ
, 
com·t_dœ’t
)

833 
	$çt_com·t_dœ_ioùl
(
fže
 *
fžp
, 
cmd
,

834 
¬g
)

836 
šode
 *šodð
	`fže_šode
(
fžp
);

837 
com·t_dœ’t
 
__u£r
 *
d1
 = 
	`com·t_±r
(
¬g
);

838 
shÜt_Úly
, 
bÙh
;

840 
cmd
) {

841 
VFAT_IOCTL_READDIR_SHORT32
:

842 
shÜt_Úly
 = 1;

843 
bÙh
 = 0;

845 
VFAT_IOCTL_READDIR_BOTH32
:

846 
shÜt_Úly
 = 0;

847 
bÙh
 = 1;

850  
	`çt_g’”ic_ioùl
(
fžp
, 
cmd
, ()
¬g
);

853 ià(!
	`acûss_ok
(
VERIFY_WRITE
, 
d1
, (
com·t_dœ’t
[2])))

854  -
EFAULT
;

860 ià(
	`put_u£r
(0, &
d1
->
d_»þ’
))

861  -
EFAULT
;

863  
	`çt_ioùl_»addœ
(
šode
, 
fžp
, 
d1
, 
çt_com·t_ioùl_fžldœ
,

864 
shÜt_Úly
, 
bÙh
);

865 
	}
}

868 cÚ¡ 
fže_Ý”©iÚs
 
	gçt_dœ_Ý”©iÚs
 = {

869 .
Î£ek
 = 
g’”ic_fže_Î£ek
,

870 .
	g»ad
 = 
g’”ic_»ad_dœ
,

871 .
	g»addœ
 = 
çt_»addœ
,

872 .
	guÆocked_ioùl
 = 
çt_dœ_ioùl
,

873 #ifdeà
CONFIG_COMPAT


874 .
	gcom·t_ioùl
 = 
çt_com·t_dœ_ioùl
,

876 .
	gfsync
 = 
çt_fže_fsync
,

879 
	$çt_g‘_shÜt_’Œy
(
šode
 *
dœ
, 
loff_t
 *
pos
,

880 
bufãr_h—d
 **
bh
,

881 
msdos_dœ_’Œy
 **
de
)

883 
	`çt_g‘_’Œy
(
dœ
, 
pos
, 
bh
, 
de
) >= 0) {

885 ià(!
	`IS_FREE
((*
de
)->
Çme
è&& !((*de)->
©Œ
 & 
ATTR_VOLUME
))

888  -
ENOENT
;

889 
	}
}

900 
	$çt_g‘_dÙdÙ_’Œy
(
šode
 *
dœ
, 
bufãr_h—d
 **
bh
,

901 
msdos_dœ_’Œy
 **
de
)

903 
loff_t
 
off£t
 = 0;

905 *
de
 = 
NULL
;

906 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
off£t
, 
bh
, 
de
) >= 0) {

907 ià(!
	`¡ºcmp
((*
de
)->
Çme
, 
MSDOS_DOTDOT
, 
MSDOS_NAME
))

910  -
ENOENT
;

911 
	}
}

912 
EXPORT_SYMBOL_GPL
(
çt_g‘_dÙdÙ_’Œy
);

915 
	$çt_dœ_em±y
(
šode
 *
dœ
)

917 
bufãr_h—d
 *
bh
;

918 
msdos_dœ_’Œy
 *
de
;

919 
loff_t
 
ýos
;

920 
»suÉ
 = 0;

922 
bh
 = 
NULL
;

923 
ýos
 = 0;

924 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
ýos
, &
bh
, &
de
) >= 0) {

925 ià(
	`¡ºcmp
(
de
->
Çme
, 
MSDOS_DOT
 , 
MSDOS_NAME
) &&

926 
	`¡ºcmp
(
de
->
Çme
, 
MSDOS_DOTDOT
, 
MSDOS_NAME
)) {

927 
»suÉ
 = -
ENOTEMPTY
;

931 
	`b»l£
(
bh
);

932  
»suÉ
;

933 
	}
}

934 
EXPORT_SYMBOL_GPL
(
çt_dœ_em±y
);

940 
	$çt_subdœs
(
šode
 *
dœ
)

942 
bufãr_h—d
 *
bh
;

943 
msdos_dœ_’Œy
 *
de
;

944 
loff_t
 
ýos
;

945 
couÁ
 = 0;

947 
bh
 = 
NULL
;

948 
ýos
 = 0;

949 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
ýos
, &
bh
, &
de
) >= 0) {

950 ià(
de
->
©Œ
 & 
ATTR_DIR
)

951 
couÁ
++;

953 
	`b»l£
(
bh
);

954  
couÁ
;

955 
	}
}

961 
	$çt_sÿn
(
šode
 *
dœ
, cÚ¡ *
Çme
,

962 
çt_¦Ù_šfo
 *
sšfo
)

964 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

966 
sšfo
->
¦Ù_off
 = 0;

967 
sšfo
->
bh
 = 
NULL
;

968 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
sšfo
->
¦Ù_off
, &sšfo->
bh
,

969 &
sšfo
->
de
) >= 0) {

971 ià(!
	`¡ºcmp
(
sšfo
->
de
->
Çme
,‚ame, 
MSDOS_NAME
)) {

973 
sšfo
->
¦Ù_off
 -ð(*sšfo->
de
);

974 
sšfo
->
Ä_¦Ùs
 = 1;

975 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

980  -
ENOENT
;

981 
	}
}

982 
EXPORT_SYMBOL_GPL
(
çt_sÿn
);

984 
	$çt_sÿn_Ý–
(
šode
 *
dœ
, cÚ¡ *
Çme
,

985 
çt_¦Ù_šfo
 *
sšfo
)

987 
i
 = 0;

988 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

990 
sšfo
->
¦Ù_off
 = 0;

991 
sšfo
->
bh
 = 
NULL
;

993  
i
 = 0 ; i < 50 ; i++ )

995 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
sšfo
->
¦Ù_off
, &sšfo->
bh
, &sšfo->
de
);

1001 ifÐ
	`¡r¡r
Ð
sšfo
->
de
->
Çme
, "BXFS" ) !ð
NULL
 && strstr(‚ame, "BXFS" ) != NULL )

1004 
	`´štk
Ð
KERN_ALERT
 "sšfo->de->Çm: %s %s\n", 
sšfo
->
de
->
Çme
,‚ame );

1007 
sšfo
->
¦Ù_off
 -ð(*sšfo->
de
);

1008 
sšfo
->
Ä_¦Ùs
 = 1;

1009 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

1016 ià(!
	`¡ºcmp
(
sšfo
->
de
->
Çme
,‚ame, 
MSDOS_NAME
)) {

1018 
	`´štk
Ð
KERN_ALERT
 "============================\n");

1019 
	`´štk
Ð
KERN_ALERT
 "sšfo->de->Çm: %s %s\n", 
sšfo
->
de
->
Çme
,‚ame );

1022 
sšfo
->
¦Ù_off
 -ð(*sšfo->
de
);

1023 
sšfo
->
Ä_¦Ùs
 = 1;

1024 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

1029  -
ENOENT
;

1030 
	}
}

1031 
EXPORT_SYMBOL_GPL
(
çt_sÿn_Ý–
);

1043 
	$çt_sÿn_log¡¬t
(
šode
 *
dœ
, 
i_log¡¬t
,

1044 
çt_¦Ù_šfo
 *
sšfo
)

1046 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1048 
sšfo
->
¦Ù_off
 = 0;

1049 
sšfo
->
bh
 = 
NULL
;

1050 
	`çt_g‘_shÜt_’Œy
(
dœ
, &
sšfo
->
¦Ù_off
, &sšfo->
bh
,

1051 &
sšfo
->
de
) >= 0) {

1052 ià(
	`çt_g‘_¡¬t
(
	`MSDOS_SB
(
sb
), 
sšfo
->
de
è=ð
i_log¡¬t
) {

1053 
sšfo
->
¦Ù_off
 -ð(*sšfo->
de
);

1054 
sšfo
->
Ä_¦Ùs
 = 1;

1055 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

1059  -
ENOENT
;

1060 
	}
}

1062 
	$__çt_»move_’Œ›s
(
šode
 *
dœ
, 
loff_t
 
pos
, 
Ä_¦Ùs
)

1064 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1065 
bufãr_h—d
 *
bh
;

1066 
msdos_dœ_’Œy
 *
de
, *
’dp
;

1067 
”r
 = 0, 
Üig_¦Ùs
;

1069 
Ä_¦Ùs
) {

1070 
bh
 = 
NULL
;

1071 ià(
	`çt_g‘_’Œy
(
dœ
, &
pos
, &
bh
, &
de
) < 0) {

1072 
”r
 = -
EIO
;

1076 
Üig_¦Ùs
 = 
Ä_¦Ùs
;

1077 
’dp
 = (
msdos_dœ_’Œy
 *)(
bh
->
b_d©a
 + 
sb
->
s_blocksize
);

1078 
Ä_¦Ùs
 && 
de
 < 
’dp
) {

1082 
de
->
Çme
[0] = 
DELETED_FLAG
;

1083 
de
++;

1084 
Ä_¦Ùs
--;

1086 
	`m¬k_bufãr_dœty_šode
(
bh
, 
dœ
);

1087 ià(
	`IS_DIRSYNC
(
dœ
))

1088 
”r
 = 
	`sync_dœty_bufãr
(
bh
);

1089 
	`b»l£
(
bh
);

1090 ià(
”r
)

1094 
pos
 +ð((
Üig_¦Ùs
 - 
Ä_¦Ùs
è* (*
de
)) - (*de);

1097  
”r
;

1098 
	}
}

1100 
	$çt_»move_’Œ›s
(
šode
 *
dœ
, 
çt_¦Ù_šfo
 *
sšfo
)

1102 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1103 
msdos_dœ_’Œy
 *
de
;

1104 
bufãr_h—d
 *
bh
;

1105 
”r
 = 0, 
Ä_¦Ùs
;

1111 
Ä_¦Ùs
 = 
sšfo
->nr_slots;

1112 
de
 = 
sšfo
->de;

1113 
sšfo
->
de
 = 
NULL
;

1114 
bh
 = 
sšfo
->bh;

1115 
sšfo
->
bh
 = 
NULL
;

1116 
Ä_¦Ùs
 && 
de
 >ð(
msdos_dœ_’Œy
 *)
bh
->
b_d©a
) {

1118 
de
->
Çme
[0] = 
DELETED_FLAG
;

1119 
de
--;

1120 
Ä_¦Ùs
--;

1122 
	`m¬k_bufãr_dœty_šode
(
bh
, 
dœ
);

1123 ià(
	`IS_DIRSYNC
(
dœ
))

1124 
”r
 = 
	`sync_dœty_bufãr
(
bh
);

1125 
	`b»l£
(
bh
);

1126 ià(
”r
)

1127  
”r
;

1128 
dœ
->
i_v”siÚ
++;

1130 ià(
Ä_¦Ùs
) {

1136 
”r
 = 
	`__çt_»move_’Œ›s
(
dœ
, 
sšfo
->
¦Ù_off
, 
Ä_¦Ùs
);

1137 ià(
”r
) {

1138 
	`çt_msg
(
sb
, 
KERN_WARNING
,

1143 
dœ
->
i_mtime
 = dœ->
i_©ime
 = 
CURRENT_TIME_SEC
;

1152 ià(
	`IS_DIRSYNC
(
dœ
))

1153 ()
	`çt_sync_šode
(
dœ
);

1155 
	`m¬k_šode_dœty
(
dœ
);

1158 
	}
}

1159 
EXPORT_SYMBOL_GPL
(
çt_»move_’Œ›s
);

1161 
	$çt_z”Ûd_þu¡”
(
šode
 *
dœ
, 
£ùÜ_t
 
blkÄ
, 
Ä_u£d
,

1162 
bufãr_h—d
 **
bhs
, 
Ä_bhs
)

1164 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1165 
£ùÜ_t
 
Ï¡_blkÄ
 = 
blkÄ
 + 
	`MSDOS_SB
(
sb
)->
£c_³r_þus
;

1166 
”r
, 
i
, 
n
;

1169 
blkÄ
 +ð
Ä_u£d
;

1170 
n
 = 
Ä_u£d
;

1171 
blkÄ
 < 
Ï¡_blkÄ
) {

1172 
bhs
[
n
] = 
	`sb_g‘blk
(
sb
, 
blkÄ
);

1173 ià(!
bhs
[
n
]) {

1174 
”r
 = -
ENOMEM
;

1175 
”rÜ
;

1177 
	`mem£t
(
bhs
[
n
]->
b_d©a
, 0, 
sb
->
s_blocksize
);

1178 
	`£t_bufãr_u±od©e
(
bhs
[
n
]);

1179 
	`m¬k_bufãr_dœty_šode
(
bhs
[
n
], 
dœ
);

1181 
n
++;

1182 
blkÄ
++;

1183 ià(
n
 =ð
Ä_bhs
) {

1184 ià(
	`IS_DIRSYNC
(
dœ
)) {

1185 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
n
);

1186 ià(
”r
)

1187 
”rÜ
;

1189 
i
 = 0; i < 
n
; i++)

1190 
	`b»l£
(
bhs
[
i
]);

1191 
n
 = 0;

1194 ià(
	`IS_DIRSYNC
(
dœ
)) {

1195 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
n
);

1196 ià(
”r
)

1197 
”rÜ
;

1199 
i
 = 0; i < 
n
; i++)

1200 
	`b»l£
(
bhs
[
i
]);

1204 
”rÜ
:

1205 
i
 = 0; i < 
n
; i++)

1206 
	`bfÜg‘
(
bhs
[
i
]);

1207  
”r
;

1208 
	}
}

1210 
	$çt_®loc_Ãw_dœ
(
šode
 *
dœ
, 
time¥ec
 *
ts
)

1212 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1213 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1214 
bufãr_h—d
 *
bhs
[
MAX_BUF_PER_PAGE
];

1215 
msdos_dœ_’Œy
 *
de
;

1216 
£ùÜ_t
 
blkÄ
;

1217 
__Ë16
 
d©e
, 
time
;

1218 
u8
 
time_cs
;

1219 
”r
, 
þu¡”
;

1221 
”r
 = 
	`çt_®loc_þu¡”s
(
dœ
, &
þu¡”
, 1);

1222 ià(
”r
)

1223 
”rÜ
;

1225 
blkÄ
 = 
	`çt_þus_to_blkÄ
(
sbi
, 
þu¡”
);

1226 
bhs
[0] = 
	`sb_g‘blk
(
sb
, 
blkÄ
);

1227 ià(!
bhs
[0]) {

1228 
”r
 = -
ENOMEM
;

1229 
”rÜ_ä“
;

1232 
	`çt_time_unix2çt
(
sbi
, 
ts
, &
time
, &
d©e
, &
time_cs
);

1234 
de
 = (
msdos_dœ_’Œy
 *)
bhs
[0]->
b_d©a
;

1236 
	`memýy
(
de
[0].
Çme
, 
MSDOS_DOT
, 
MSDOS_NAME
);

1237 
	`memýy
(
de
[1].
Çme
, 
MSDOS_DOTDOT
, 
MSDOS_NAME
);

1238 
de
->
©Œ
 = de[1].©Œ = 
ATTR_DIR
;

1239 
de
[0].
lÿ£
 = de[1].lcase = 0;

1240 
de
[0].
time
 = de[1].time =ime;

1241 
de
[0].
d©e
 = de[1].date = date;

1242 ià(
sbi
->
ÝtiÚs
.
isvçt
) {

1244 
de
[0].
ùime
 = de[1].ùimð
time
;

1245 
de
[0].
ùime_cs
 = de[1].ùime_c ð
time_cs
;

1246 
de
[0].
ad©e
 = de[0].
cd©e
 = de[1].ad©ðde[1].cd©ð
d©e
;

1248 
de
[0].
ùime
 = de[1].ctime = 0;

1249 
de
[0].
ùime_cs
 = de[1].ctime_cs = 0;

1250 
de
[0].
ad©e
 = de[0].
cd©e
 = de[1].adate = de[1].cdate = 0;

1252 
	`çt_£t_¡¬t
(&
de
[0], 
þu¡”
);

1253 
	`çt_£t_¡¬t
(&
de
[1], 
	`MSDOS_I
(
dœ
)->
i_log¡¬t
);

1254 
de
[0].
size
 = de[1].size = 0;

1255 
	`mem£t
(
de
 + 2, 0, 
sb
->
s_blocksize
 - 2 * (*de));

1256 
	`£t_bufãr_u±od©e
(
bhs
[0]);

1257 
	`m¬k_bufãr_dœty_šode
(
bhs
[0], 
dœ
);

1259 
”r
 = 
	`çt_z”Ûd_þu¡”
(
dœ
, 
blkÄ
, 1, 
bhs
, 
MAX_BUF_PER_PAGE
);

1260 ià(
”r
)

1261 
”rÜ_ä“
;

1263  
þu¡”
;

1265 
”rÜ_ä“
:

1266 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_alloc_new_dir, fat_free_clusters \n");

1267 
	`çt_ä“_þu¡”s
(
dœ
, 
þu¡”
);

1268 
”rÜ
:

1269  
”r
;

1270 
	}
}

1271 
EXPORT_SYMBOL_GPL
(
çt_®loc_Ãw_dœ
);

1273 
	$çt_add_Ãw_’Œ›s
(
šode
 *
dœ
, *
¦Ùs
, 
Ä_¦Ùs
,

1274 *
Ä_þu¡”
, 
msdos_dœ_’Œy
 **
de
,

1275 
bufãr_h—d
 **
bh
, 
loff_t
 *
i_pos
)

1277 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1278 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1279 
bufãr_h—d
 *
bhs
[
MAX_BUF_PER_PAGE
];

1280 
£ùÜ_t
 
blkÄ
, 
¡¬t_blkÄ
, 
Ï¡_blkÄ
;

1281 
size
, 
cÝy
;

1282 
”r
, 
i
, 
n
, 
off£t
, 
þu¡”
[2];

1289 
size
 = 
Ä_¦Ùs
 * (
msdos_dœ_’Œy
);

1290 *
Ä_þu¡”
 = (
size
 + (
sbi
->
þu¡”_size
 - 1)è>> sbi->
þu¡”_b™s
;

1291 
	`BUG_ON
(*
Ä_þu¡”
 > 2);

1293 
”r
 = 
	`çt_®loc_þu¡”s
(
dœ
, 
þu¡”
, *
Ä_þu¡”
);

1294 ià(
”r
)

1295 
”rÜ
;

1302 
i
 = 
n
 = 
cÝy
 = 0;

1304 
¡¬t_blkÄ
 = 
blkÄ
 = 
	`çt_þus_to_blkÄ
(
sbi
, 
þu¡”
[
i
]);

1305 
Ï¡_blkÄ
 = 
¡¬t_blkÄ
 + 
sbi
->
£c_³r_þus
;

1306 
blkÄ
 < 
Ï¡_blkÄ
) {

1307 
bhs
[
n
] = 
	`sb_g‘blk
(
sb
, 
blkÄ
);

1308 ià(!
bhs
[
n
]) {

1309 
”r
 = -
ENOMEM
;

1310 
”rÜ_nomem
;

1314 
cÝy
 = 
	`mš
(
size
, 
sb
->
s_blocksize
);

1315 
	`memýy
(
bhs
[
n
]->
b_d©a
, 
¦Ùs
, 
cÝy
);

1316 
¦Ùs
 +ð
cÝy
;

1317 
size
 -ð
cÝy
;

1318 
	`£t_bufãr_u±od©e
(
bhs
[
n
]);

1319 
	`m¬k_bufãr_dœty_šode
(
bhs
[
n
], 
dœ
);

1320 ià(!
size
)

1322 
n
++;

1323 
blkÄ
++;

1325 } ++
i
 < *
Ä_þu¡”
);

1327 
	`mem£t
(
bhs
[
n
]->
b_d©a
 + 
cÝy
, 0, 
sb
->
s_blocksize
 - copy);

1328 
off£t
 = 
cÝy
 - (
msdos_dœ_’Œy
);

1329 
	`g‘_bh
(
bhs
[
n
]);

1330 *
bh
 = 
bhs
[
n
];

1331 *
de
 = (
msdos_dœ_’Œy
 *)((*
bh
)->
b_d©a
 + 
off£t
);

1332 *
i_pos
 = 
	`çt_make_i_pos
(
sb
, *
bh
, *
de
);

1335 
”r
 = 
	`çt_z”Ûd_þu¡”
(
dœ
, 
¡¬t_blkÄ
, ++
n
, 
bhs
, 
MAX_BUF_PER_PAGE
);

1336 ià(
”r
)

1337 
”rÜ_ä“
;

1339  
þu¡”
[0];

1341 
”rÜ_ä“
:

1342 
	`b»l£
(*
bh
);

1343 *
bh
 = 
NULL
;

1344 
n
 = 0;

1345 
”rÜ_nomem
:

1346 
i
 = 0; i < 
n
; i++)

1347 
	`bfÜg‘
(
bhs
[
i
]);

1349 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_add_new_entries, fat_free_clusters \n");

1350 
	`çt_ä“_þu¡”s
(
dœ
, 
þu¡”
[0]);

1351 
”rÜ
:

1352  
”r
;

1353 
	}
}

1355 
	$çt_add_’Œ›s
(
šode
 *
dœ
, *
¦Ùs
, 
Ä_¦Ùs
,

1356 
çt_¦Ù_šfo
 *
sšfo
)

1358 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

1359 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1360 
bufãr_h—d
 *
bh
, *
´ev
, *
bhs
[3];

1361 
msdos_dœ_’Œy
 *
	`unš™Ÿlized_v¬
(
de
);

1362 
”r
, 
ä“_¦Ùs
, 
i
, 
Ä_bhs
;

1363 
loff_t
 
pos
, 
i_pos
;

1365 
sšfo
->
Ä_¦Ùs
 =‚r_slots;

1368 
ä“_¦Ùs
 = 
Ä_bhs
 = 0;

1369 
bh
 = 
´ev
 = 
NULL
;

1370 
pos
 = 0;

1371 
”r
 = -
ENOSPC
;

1372 
	`çt_g‘_’Œy
(
dœ
, &
pos
, &
bh
, &
de
) > -1) {

1374 ià(
pos
 >ð
FAT_MAX_DIR_SIZE
)

1375 
”rÜ
;

1377 ià(
	`IS_FREE
(
de
->
Çme
)) {

1378 ià(
´ev
 !ð
bh
) {

1379 
	`g‘_bh
(
bh
);

1380 
bhs
[
Ä_bhs
] = 
´ev
 = 
bh
;

1381 
Ä_bhs
++;

1383 
ä“_¦Ùs
++;

1384 ià(
ä“_¦Ùs
 =ð
Ä_¦Ùs
)

1385 
found
;

1387 
i
 = 0; i < 
Ä_bhs
; i++)

1388 
	`b»l£
(
bhs
[
i
]);

1389 
´ev
 = 
NULL
;

1390 
ä“_¦Ùs
 = 
Ä_bhs
 = 0;

1393 ià(
dœ
->
i_šo
 =ð
MSDOS_ROOT_INO
) {

1394 ià(
sbi
->
çt_b™s
 != 32)

1395 
”rÜ
;

1396 } ià(
	`MSDOS_I
(
dœ
)->
i_¡¬t
 == 0) {

1397 
	`çt_msg
(
sb
, 
KERN_ERR
, "Corrupted directory (i_pos %lld)",

1398 
	`MSDOS_I
(
dœ
)->
i_pos
);

1399 
”r
 = -
EIO
;

1400 
”rÜ
;

1403 
found
:

1404 
”r
 = 0;

1405 
pos
 -ð
ä“_¦Ùs
 * (*
de
);

1406 
Ä_¦Ùs
 -ð
ä“_¦Ùs
;

1407 ià(
ä“_¦Ùs
) {

1413 
size
 = 
ä“_¦Ùs
 * (*
de
);

1414 
off£t
 = 
pos
 & (
sb
->
s_blocksize
 - 1);

1415 
lÚg_bhs
 = 
Ä_bhs
 - (
Ä_¦Ùs
 == 0);

1418 
i
 = 0; i < 
lÚg_bhs
; i++) {

1419 
cÝy
 = 
	`mš_t
(, 
sb
->
s_blocksize
 - 
off£t
, 
size
);

1420 
	`memýy
(
bhs
[
i
]->
b_d©a
 + 
off£t
, 
¦Ùs
, 
cÝy
);

1421 
	`m¬k_bufãr_dœty_šode
(
bhs
[
i
], 
dœ
);

1422 
off£t
 = 0;

1423 
¦Ùs
 +ð
cÝy
;

1424 
size
 -ð
cÝy
;

1426 ià(
lÚg_bhs
 && 
	`IS_DIRSYNC
(
dœ
))

1427 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
lÚg_bhs
);

1428 ià(!
”r
 && 
i
 < 
Ä_bhs
) {

1430 
cÝy
 = 
	`mš_t
(, 
sb
->
s_blocksize
 - 
off£t
, 
size
);

1431 
	`memýy
(
bhs
[
i
]->
b_d©a
 + 
off£t
, 
¦Ùs
, 
cÝy
);

1432 
	`m¬k_bufãr_dœty_šode
(
bhs
[
i
], 
dœ
);

1433 ià(
	`IS_DIRSYNC
(
dœ
))

1434 
”r
 = 
	`sync_dœty_bufãr
(
bhs
[
i
]);

1436 
i
 = 0; i < 
Ä_bhs
; i++)

1437 
	`b»l£
(
bhs
[
i
]);

1438 ià(
”r
)

1439 
”rÜ_»move
;

1442 ià(
Ä_¦Ùs
) {

1443 
þu¡”
, 
Ä_þu¡”
;

1450 
þu¡”
 = 
	`çt_add_Ãw_’Œ›s
(
dœ
, 
¦Ùs
, 
Ä_¦Ùs
, &
Ä_þu¡”
,

1451 &
de
, &
bh
, &
i_pos
);

1452 ià(
þu¡”
 < 0) {

1453 
”r
 = 
þu¡”
;

1454 
”rÜ_»move
;

1456 
”r
 = 
	`çt_chaš_add
(
dœ
, 
þu¡”
, 
Ä_þu¡”
);

1457 ià(
”r
) {

1459 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_add_entries, fat_free_clusters \n");

1461 
	`çt_ä“_þu¡”s
(
dœ
, 
þu¡”
);

1462 
”rÜ_»move
;

1464 ià(
dœ
->
i_size
 & (
sbi
->
þu¡”_size
 - 1)) {

1465 
	`çt_fs_”rÜ
(
sb
, "Odd directory size");

1466 
dœ
->
i_size
 = (dœ->i_siz+ 
sbi
->
þu¡”_size
 - 1)

1467 & ~((
loff_t
)
sbi
->
þu¡”_size
 - 1);

1469 
dœ
->
i_size
 +ð
Ä_þu¡”
 << 
sbi
->
þu¡”_b™s
;

1470 
	`MSDOS_I
(
dœ
)->
mmu_´iv©e
 +ð
Ä_þu¡”
 << 
sbi
->
þu¡”_b™s
;

1472 
sšfo
->
¦Ù_off
 = 
pos
;

1473 
sšfo
->
de
 = de;

1474 
sšfo
->
bh
 = bh;

1475 
sšfo
->
i_pos
 = 
	`çt_make_i_pos
(
sb
, sšfo->
bh
, sšfo->
de
);

1479 
”rÜ
:

1480 
	`b»l£
(
bh
);

1481 
i
 = 0; i < 
Ä_bhs
; i++)

1482 
	`b»l£
(
bhs
[
i
]);

1483  
”r
;

1485 
”rÜ_»move
:

1486 
	`b»l£
(
bh
);

1487 ià(
ä“_¦Ùs
)

1488 
	`__çt_»move_’Œ›s
(
dœ
, 
pos
, 
ä“_¦Ùs
);

1489  
”r
;

1490 
	}
}

1491 
EXPORT_SYMBOL_GPL
(
çt_add_’Œ›s
);

	@fat.h

1 #iâdeà
_FAT_H


2 
	#_FAT_H


	)

4 
	~<lšux/bufãr_h—d.h
>

5 
	~<lšux/¡ršg.h
>

6 
	~<lšux/Æs.h
>

7 
	~<lšux/fs.h
>

8 
	~<lšux/hash.h
>

9 
	~<lšux/mu‹x.h
>

10 
	~<lšux/¿‹lim™.h
>

11 
	~<lšux/msdos_fs.h
>

13 
	#FREE
 0x0

	)

14 
	#USED
 0x2

	)

15 
	#GARBAGE
 0x4

	)

16 
	#MIDEOF
 0x8

	)

18 
	#SD1_S_ID
 "sdc1"

	)

19 
	#SD2_S_ID
 "sbd"

	)

21 
	#TOTAL_AREA_CNT
 6

	)

22 
	#OFF
 0

	)

23 
	#ON
 1

	)

26 
	#NUM_1
 1

27 
	#NUM_2
 2

28 
	#NUM_3
 3

29 
	#NUM_4
 4

30 
	#NUM_5
 5

31 

	)

32 
	#NUM_6
 0

33 

	)

35 
	#DIR_1
 "nÜm®"

	)

36 
	#DIR_2
 "ev’t"

	)

37 
	#DIR_3
 "·rkšg"

	)

38 
	#DIR_4
 "mªu®"

	)

39 
	#DIR_5
 "cÚfig"

	)

43 
	#BB_NORMAL
 1

44 
	#BB_NORMAL_EVENT
 2

45 
	#BB_PARKING
 3

46 
	#BB_MANUAL
 4

47 
	#BB_IMAGE
 5

48 

	)

49 
	#BB_ETC
 0

50 

	)

53 
	#NORMAL_DIRECTORY
 "nÜm®"

	)

54 
	#NORMAL_EVENT_DIRECTORY
 "ev’t"

	)

55 
	#PARKING_DIRECTORY
 "·rkšg"

	)

56 
	#MANUAL_DIRECTORY
 "mªu®"

	)

57 
	#HANDWORK_DIRECTORY
 "cÚfig"

	)

59 
	#ETC_DIRECTORY
 "‘c"

	)

65 
	#SD_PAGE_SIZE
 4

	)

67 
	#CLUSTER_IN_PAGE
 (
SD_PAGE_SIZE
*256)

68 
	#CLUSTER_IN_BLOCK
 (128)

69 
	#BLOCK_IN_PAGE
 (
SD_PAGE_SIZE
 * 2)

72 

	)

74 
	#ûž
(
x
, 
y
è((xè+ (y - 1))/ (y)

	)

75 
	#æoÜ
(
x
, 
y
è(x)/(y)

	)

76 
	#FAT_ALLOC_CLUSTER
 0

	)

77 
	#FAT_FREE_CLUSTER
 1

	)

78 
	#BX_START
 0

	)

79 
	#BX_END
 1

	)

87 
	#BX_REUPDATE_META_DIFFER
 6

88 

	)

89 
	#NUM_EVNET
 5

90 

	)

91 
	#BX_NORMAL
 0

	)

92 
	#BX_NORMAL_EVENT
 1

	)

93 
	#BX_PARKING_EVENT
 2

	)

94 
	#BX_MANUAL
 3

	)

95 
	#BX_IMAGE
 4

	)

96 
	#BX_ETC
 9

	)

98 
	#NUM_EVNET_DIRECTORY
 6

99 

	)

101 
	#NORMAL_AREA_RATIO
 70

	)

102 
	#NORMAL_EVENT_AREA_RATIO
 20

	)

103 
	#PARKING_EVENT_AREA_RATIO
 10

	)

104 
	#MANUAL_AREA_RATIO
 1

	)

105 
	#IMAGE_AREA_RATIO
 1

	)

106 
	#ETC_AREA_RATIO
 7

	)

117 
	#VFAT_SFN_DISPLAY_LOWER
 0x0001

	)

118 
	#VFAT_SFN_DISPLAY_WIN95
 0x0002

	)

119 
	#VFAT_SFN_DISPLAY_WINNT
 0x0004

	)

120 
	#VFAT_SFN_CREATE_WIN95
 0x0100

	)

121 
	#VFAT_SFN_CREATE_WINNT
 0x0200

	)

123 
	#FAT_ERRORS_CONT
 1

	)

124 
	#FAT_ERRORS_PANIC
 2

	)

125 
	#FAT_ERRORS_RO
 3

	)

127 
	#FAT_NFS_STALE_RW
 1

	)

128 
	#FAT_NFS_NOSTALE_RO
 2

	)

130 
	sçt_mouÁ_ÝtiÚs
 {

131 
kuid_t
 
	mfs_uid
;

132 
kgid_t
 
	mfs_gid
;

133 
	mfs_fmask
;

134 
	mfs_dmask
;

135 
	mcod•age
;

136 
	mtime_off£t
;

137 *
	mioch¬£t
;

138 
	mshÜŠame
;

139 
	mÇme_check
;

140 
	m”rÜs
;

141 
	mnfs
;

142 
	m®low_utime
;

143 
	mqu›t
:1,

144 
	mshowexec
:1,

145 
	msys_immubË
:1,

146 
	mdÙsOK
:1,

147 
	misvçt
:1,

148 
	mutf8
:1,

149 
	municode_xÏ‹
:1,

150 
	mnumž
:1,

151 
	mæush
:1,

152 
	mnoÿ£
:1,

153 
	mu£ä“
:1,

154 
	mtz_£t
:1,

155 
	mrodœ
:1,

156 
	mdisÿrd
:1;

159 
	#FAT_HASH_BITS
 8

	)

160 
	#FAT_HASH_SIZE
 (1UL << 
FAT_HASH_BITS
)

	)

162 
	sPA_un™_t
{

163 
	m¡¬t
,

164 
	m’d
;

165 
	mæag
;

168 
	sPA
{

169 
PA_un™
 *
	m·_un™
;

170 
	m·_num
;

171 
	m·_þu¡”_num
;

172 
	mcur_·_út
;

175 #iâdeà
_FAT_


176 #iâdeà
__VARIABLE_EXT__


177 
	#__VARIABLE_EXT__
 

	)

180 #iâdeà
__VARIABLE_EXT__


181 
	#__VARIABLE_EXT__


	)

185 
__VARIABLE_EXT__
 
PA
 
¬—_PA
[ 
TOTAL_AREA_CNT
 ];

196 
	smsdos_sb_šfo
 {

197 
	m£c_³r_þus
;

198 
	mþu¡”_b™s
;

199 
	mþu¡”_size
;

200 
	mçts
, 
	mçt_b™s
;

201 
	mçt_¡¬t
;

202 
	mçt_Ëngth
;

203 
	mdœ_¡¬t
;

204 
	mdœ_’Œ›s
;

205 
	md©a_¡¬t
;

206 
	mmax_þu¡”
;

207 
	mroÙ_þu¡”
;

208 
	mfsšfo_£ùÜ
;

209 
mu‹x
 
	mçt_lock
;

210 
mu‹x
 
	mnfs_bužd_šode_lock
;

211 
mu‹x
 
	ms_lock
;

212 
	m´ev_ä“
;

213 
	mä“_þu¡”s
;

214 
	mä“_þus_v®id
;

215 
çt_mouÁ_ÝtiÚs
 
	mÝtiÚs
;

216 
Æs_bË
 *
	mÆs_disk
;

217 
Æs_bË
 *
	mÆs_io
;

218 cÚ¡ *
	mdœ_Ýs
;

219 
	mdœ_³r_block
;

220 
	mdœ_³r_block_b™s
;

222 
	mç‹Á_shiá
;

223 
ç‹Á_Ý”©iÚs
 *
	mç‹Á_Ýs
;

224 
šode
 *
	mçt_šode
;

225 
šode
 *
	mfsšfo_šode
;

227 
¿‹lim™_¡©e
 
	m¿‹lim™
;

229 
¥šlock_t
 
	mšode_hash_lock
;

230 
hli¡_h—d
 
	mšode_hashbË
[
FAT_HASH_SIZE
];

232 
¥šlock_t
 
	mdœ_hash_lock
;

233 
hli¡_h—d
 
	mdœ_hashbË
[
FAT_HASH_SIZE
];

235 
	mdœty
;

238 
	mbx_¡¬t_þu¡”
[8];

239 
	mbx_’d_þu¡”
[8];

240 
	mbx_ä“_þu¡”s
[8] ;

241 
	mbx_´ev_ä“
[8];

242 
	mbx_Ãxt_¡¬t
[8];

244 
	mbx_¬—_lim™
[8];

246 
	mbx_ä“_v®id
;

248 
	mbx_¬—_¿tio
[8];

249 
	mbx_´e_size
[8];

252 
	mi_šo
;

253 
	mtime
;

254 
	mcouÁ
;

258 
	mçt_Üigš®_æag
;

259 cÚ¡ * 
	mfže_Çme
;

261 
PA
 *
	m·»a_PA
[8];

264 
	#FAT_CACHE_VALID
 0

	)

269 
	smsdos_šode_šfo
 {

270 
¥šlock_t
 
	mÿche_Ìu_lock
;

271 
li¡_h—d
 
	mÿche_Ìu
;

272 
	mÄ_ÿches
;

274 
	mÿche_v®id_id
;

275 
	m´e_couÁ
;

278 
loff_t
 
	mmmu_´iv©e
;

280 
	mi_¡¬t
;

281 
	mi_log¡¬t
;

282 
	mi_©Œs
;

284 
	m´e_®loûd
;

286 
loff_t
 
	mi_pos
;

287 
hli¡_node
 
	mi_çt_hash
;

288 
hli¡_node
 
	mi_dœ_hash
;

289 
rw_£m­hÜe
 
	mŒunÿ‹_lock
;

290 
šode
 
	mvfs_šode
;

293 
	sçt_¦Ù_šfo
 {

294 
loff_t
 
	mi_pos
;

295 
loff_t
 
	m¦Ù_off
;

296 
	mÄ_¦Ùs
;

297 
msdos_dœ_’Œy
 *
	mde
;

298 
bufãr_h—d
 *
	mbh
;

301 
šlše
 
msdos_sb_šfo
 *
	$MSDOS_SB
(
su³r_block
 *
sb
)

303  
sb
->
s_fs_šfo
;

304 
	}
}

306 
šlše
 
msdos_šode_šfo
 *
	$MSDOS_I
(
šode
 *inode)

308  
	`cÚš”_of
(
šode
, 
msdos_šode_šfo
, 
vfs_šode
);

309 
	}
}

318 
šlše
 
	$çt_mode_ÿn_hÞd_ro
(
šode
 *inode)

320 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

321 
umode_t
 
mask
;

323 ià(
	`S_ISDIR
(
šode
->
i_mode
)) {

324 ià(!
sbi
->
ÝtiÚs
.
rodœ
)

326 
mask
 = ~
sbi
->
ÝtiÚs
.
fs_dmask
;

328 
mask
 = ~
sbi
->
ÝtiÚs
.
fs_fmask
;

330 ià(!(
mask
 & 
S_IWUGO
))

333 
	}
}

336 
šlše
 
umode_t
 
	$çt_make_mode
(
msdos_sb_šfo
 *
sbi
,

337 
u8
 
©Œs
, 
umode_t
 
mode
)

339 ià(
©Œs
 & 
ATTR_RO
 && !(×‰r & 
ATTR_DIR
è&& !
sbi
->
ÝtiÚs
.
rodœ
))

340 
mode
 &ð~
S_IWUGO
;

342 ià(
©Œs
 & 
ATTR_DIR
)

343  (
mode
 & ~
sbi
->
ÝtiÚs
.
fs_dmask
è| 
S_IFDIR
;

345  (
mode
 & ~
sbi
->
ÝtiÚs
.
fs_fmask
è| 
S_IFREG
;

346 
	}
}

349 
šlše
 
u8
 
	$çt_make_©Œs
(
šode
 *inode)

351 
u8
 
©Œs
 = 
	`MSDOS_I
(
šode
)->
i_©Œs
;

352 ià(
	`S_ISDIR
(
šode
->
i_mode
))

353 
©Œs
 |ð
ATTR_DIR
;

354 ià(
	`çt_mode_ÿn_hÞd_ro
(
šode
è&& !(šode->
i_mode
 & 
S_IWUGO
))

355 
©Œs
 |ð
ATTR_RO
;

356  
©Œs
;

357 
	}
}

359 
šlše
 
	$çt_§ve_©Œs
(
šode
 *šode, 
u8
 
©Œs
)

361 ià(
	`çt_mode_ÿn_hÞd_ro
(
šode
))

362 
	`MSDOS_I
(
šode
)->
i_©Œs
 = 
©Œs
 & 
ATTR_UNUSED
;

364 
	`MSDOS_I
(
šode
)->
i_©Œs
 = 
©Œs
 & (
ATTR_UNUSED
 | 
ATTR_RO
);

365 
	}
}

367 
šlše
 
	$çt_checksum
(cÚ¡ 
__u8
 *
Çme
)

369 
s
 = 
Çme
[0];

370 
s
 = (s<<7è+ (s>>1è+ 
Çme
[1]; s = (s<<7) + (s>>1) +‚ame[2];

371 
s
 = (s<<7è+ (s>>1è+ 
Çme
[3]; s = (s<<7) + (s>>1) +‚ame[4];

372 
s
 = (s<<7è+ (s>>1è+ 
Çme
[5]; s = (s<<7) + (s>>1) +‚ame[6];

373 
s
 = (s<<7è+ (s>>1è+ 
Çme
[7]; s = (s<<7) + (s>>1) +‚ame[8];

374 
s
 = (s<<7è+ (s>>1è+ 
Çme
[9]; s = (s<<7) + (s>>1) +‚ame[10];

375  
s
;

376 
	}
}

378 
šlše
 
£ùÜ_t
 
	$çt_þus_to_blkÄ
(
msdos_sb_šfo
 *
sbi
, 
þus
)

380  ((
£ùÜ_t
)
þus
 - 
FAT_START_ENT
è* 
sbi
->
£c_³r_þus


381 + 
sbi
->
d©a_¡¬t
;

382 
	}
}

384 
šlše
 
	$çt_g‘_blkÄ_off£t
(
msdos_sb_šfo
 *
sbi
,

385 
loff_t
 
i_pos
, 
£ùÜ_t
 *
blkÄ
, *
off£t
)

389 *
blkÄ
 = 
i_pos
 >> 
sbi
->
dœ_³r_block_b™s
;

390 *
off£t
 = 
i_pos
 & (
sbi
->
dœ_³r_block
 - 1);

393 
	}
}

395 
šlše
 
loff_t
 
	$çt_i_pos_»ad
(
msdos_sb_šfo
 *
sbi
,

396 
šode
 *inode)

398 
loff_t
 
i_pos
;

399 #ià
BITS_PER_LONG
 == 32

400 
	`¥š_lock
(&
sbi
->
šode_hash_lock
);

402 
i_pos
 = 
	`MSDOS_I
(
šode
)->i_pos;

403 #ià
BITS_PER_LONG
 == 32

404 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

406  
i_pos
;

407 
	}
}

409 
šlše
 
	$çt16_towch¬
(
wch¬_t
 *
d¡
, cÚ¡ 
__u8
 *
¤c
, 
size_t
 
Ën
)

411 #ifdeà
__BIG_ENDIAN


412 
Ën
--) {

413 *
d¡
++ = 
¤c
[0] | (src[1] << 8);

414 
¤c
 += 2;

417 
	`memýy
(
d¡
, 
¤c
, 
Ën
 * 2);

419 
	}
}

421 
šlše
 
	$çt_g‘_¡¬t
(cÚ¡ 
msdos_sb_šfo
 *
sbi
,

422 cÚ¡ 
msdos_dœ_’Œy
 *
de
)

424 
þu¡”
 = 
	`Ë16_to_ýu
(
de
->
¡¬t
);

425 ià(
sbi
->
çt_b™s
 == 32)

426 
þu¡”
 |ð(
	`Ë16_to_ýu
(
de
->
¡¬thi
) << 16);

427  
þu¡”
;

428 
	}
}

430 
šlše
 
	$çt_£t_¡¬t
(
msdos_dœ_’Œy
 *
de
, 
þu¡”
)

432 
de
->
¡¬t
 = 
	`ýu_to_Ë16
(
þu¡”
);

433 
de
->
¡¬thi
 = 
	`ýu_to_Ë16
(
þu¡”
 >> 16);

434 
	}
}

436 
šlše
 
	$çtwch¬_to16
(
__u8
 *
d¡
, cÚ¡ 
wch¬_t
 *
¤c
, 
size_t
 
Ën
)

438 #ifdeà
__BIG_ENDIAN


439 
Ën
--) {

440 
d¡
[0] = *
¤c
 & 0x00FF;

441 
d¡
[1] = (*
¤c
 & 0xFF00) >> 8;

442 
d¡
 += 2;

443 
¤c
++;

446 
	`memýy
(
d¡
, 
¤c
, 
Ën
 * 2);

448 
	}
}

451 
çt_ÿche_šv®_šode
(
šode
 *inode);

452 
çt_g‘_þu¡”
(
šode
 *šode, 
þu¡”
,

453 *
fþus
, *
dþus
);

454 
çt_bm­
(
šode
 *šode, 
£ùÜ_t
 
£ùÜ
, seùÜ_ˆ*
phys
,

455 *
m­³d_blocks
, 
ü—‹
);

458 cÚ¡ 
fže_Ý”©iÚs
 
çt_dœ_Ý”©iÚs
;

459 
çt_£¬ch_lÚg
(
šode
 *šode, cÚ¡ *
Çme
,

460 
Çme_Ën
, 
çt_¦Ù_šfo
 *
sšfo
);

461 
çt_dœ_em±y
(
šode
 *
dœ
);

462 
çt_subdœs
(
šode
 *
dœ
);

463 
çt_sÿn
(
šode
 *
dœ
, cÚ¡ *
Çme
,

464 
çt_¦Ù_šfo
 *
sšfo
);

465 
çt_sÿn_log¡¬t
(
šode
 *
dœ
, 
i_log¡¬t
,

466 
çt_¦Ù_šfo
 *
sšfo
);

467 
çt_g‘_dÙdÙ_’Œy
(
šode
 *
dœ
, 
bufãr_h—d
 **
bh
,

468 
msdos_dœ_’Œy
 **
de
);

469 
çt_®loc_Ãw_dœ
(
šode
 *
dœ
, 
time¥ec
 *
ts
);

470 
çt_add_’Œ›s
(
šode
 *
dœ
, *
¦Ùs
, 
Ä_¦Ùs
,

471 
çt_¦Ù_šfo
 *
sšfo
);

472 
çt_»move_’Œ›s
(
šode
 *
dœ
, 
çt_¦Ù_šfo
 *
sšfo
);

476 
çt_sÿn_Ý–
(
šode
 *
dœ
, cÚ¡ *
Çme
,

477 
çt_¦Ù_šfo
 *
sšfo
);

482 
	sçt_’Œy
 {

483 
	m’Œy
;

485 
u8
 *
	m’t12_p
[2];

486 
__Ë16
 *
	m’t16_p
;

487 
__Ë32
 *
	m’t32_p
;

488 } 
	mu
;

489 
	mÄ_bhs
;

490 
bufãr_h—d
 *
	mbhs
[2];

491 
šode
 *
	mçt_šode
;

494 
šlše
 
	$ç‹Á_š™
(
çt_’Œy
 *
ç‹Á
)

496 
ç‹Á
->
Ä_bhs
 = 0;

497 
ç‹Á
->
’Œy
 = 0;

498 
ç‹Á
->
u
.
’t32_p
 = 
NULL
;

499 
ç‹Á
->
bhs
[0] = f©’t->bhs[1] = 
NULL
;

500 
ç‹Á
->
çt_šode
 = 
NULL
;

501 
	}
}

503 
šlše
 
	$ç‹Á_£t_’Œy
(
çt_’Œy
 *
ç‹Á
, 
’Œy
)

505 
ç‹Á
->
’Œy
 =ƒntry;

506 
ç‹Á
->
u
.
’t32_p
 = 
NULL
;

507 
	}
}

509 
šlše
 
	$ç‹Á_b»l£
(
çt_’Œy
 *
ç‹Á
)

511 
i
;

512 
ç‹Á
->
u
.
’t32_p
 = 
NULL
;

513 
i
 = 0; i < 
ç‹Á
->
Ä_bhs
; i++)

514 
	`b»l£
(
ç‹Á
->
bhs
[
i
]);

515 
ç‹Á
->
Ä_bhs
 = 0;

516 
ç‹Á
->
bhs
[0] = f©’t->bhs[1] = 
NULL
;

517 
ç‹Á
->
çt_šode
 = 
NULL
;

518 
	}
}

520 
de_»upd©e
(
su³r_block
 *
sb
, 
šode
 *inode);

521 
þu¡”chaš_»upd©e
(
su³r_block
 *
sb
, 
šode
 *inode);

523 
v›w_ç‹Á_’Œy
( );

524 
g‘_¬—_numb”
Ð*
¬—
, 
šode
 *inode );

527 
çt_ju¡_š™_su³r
(
su³r_block
 *
sb
);

528 
çt_upd©e_su³r
(
su³r_block
 *
sb
);

529 
çt_cÚfig_š™
(
su³r_block
 *
sb
);

531 
show_the_¡©us_un™_æag
Ð
su³r_block
 *
sb
, 
¬—
 );

535 
çt_’t_acûss_š™
(
su³r_block
 *
sb
);

536 
çt_’t_»ad
(
šode
 *šode, 
çt_’Œy
 *
ç‹Á
,

537 
’Œy
);

538 
çt_’t_wr™e
(
šode
 *šode, 
çt_’Œy
 *
ç‹Á
,

539 
Ãw
, 
wa™
);

540 
çt_®loc_þu¡”s
(
šode
 *šode, *
þu¡”
,

541 
Ä_þu¡”
);

542 
çt_®loc_þu¡”
(
šode
 *šode, *
þu¡”
, 
mode
);

544 
çt_ä“_þu¡”s
(
šode
 *šode, 
þu¡”
);

545 
çt_couÁ_ä“_þu¡”s
(
su³r_block
 *
sb
);

547 
çt_couÁ_ä“_þu¡”s_fÜ_¬—
(
su³r_block
 *
sb
);

549 
decide_—ch_·_¡©us
Ð
su³r_block
 *
sb
, 
PA_un™_t
 *
pun™
, 
¬—
 );

552 
çt_g’”ic_ioùl
(
fže
 *
fžp
, 
cmd
,

553 
¬g
);

554 cÚ¡ 
fže_Ý”©iÚs
 
çt_fže_Ý”©iÚs
;

555 cÚ¡ 
šode_Ý”©iÚs
 
çt_fže_šode_Ý”©iÚs
;

556 
çt_£‰r
(
d’Œy
 *d’Œy, 
Ÿ‰r
 *
©Œ
);

557 
çt_Œunÿ‹_blocks
(
šode
 *šode, 
loff_t
 
off£t
);

558 
çt_g‘©Œ
(
vfsmouÁ
 *
mÁ
, 
d’Œy
 *dentry,

559 
k¡©
 *
¡©
);

560 
çt_fže_fsync
(
fže
 *fže, 
loff_t
 
¡¬t
,†off_ˆ
’d
,

561 
d©async
);

564 
çt_©ch
(
šode
 *šode, 
loff_t
 
i_pos
);

565 
çt_d‘ach
(
šode
 *inode);

566 
šode
 *
çt_ig‘
(
su³r_block
 *
sb
, 
loff_t
 
i_pos
);

567 
šode
 *
çt_bužd_šode
(
su³r_block
 *
sb
,

568 
msdos_dœ_’Œy
 *
de
, 
loff_t
 
i_pos
);

569 
çt_sync_šode
(
šode
 *inode);

570 
çt_fžl_su³r
(
su³r_block
 *
sb
, *
d©a
, 
sž’t
,

571 
isvçt
, (*
£tup
)(
su³r_block
 *));

572 
	`çt_fžl_šode
(
šode
 *šode, 
msdos_dœ_’Œy
 *
de
);

574 
	`çt_æush_šodes
(
su³r_block
 *
sb
, 
šode
 *
i1
,

575 
šode
 *
i2
);

576 
šlše
 
	$çt_dœ_hash
(
log¡¬t
)

578  
	`hash_32
(
log¡¬t
, 
FAT_HASH_BITS
);

579 
	}
}

582 
	$__´štf
(3, 4è
__cÞd


583 
	`__çt_fs_”rÜ
(
su³r_block
 *
sb
, 
»pÜt
, cÚ¡ *
fmt
, ...);

584 
	#çt_fs_”rÜ
(
sb
, 
fmt
, 
¬gs
...) \

585 
	`__çt_fs_”rÜ
(
sb
, 1, 
fmt
 , ## 
¬gs
)

	)

586 
	#çt_fs_”rÜ_¿‹lim™
(
sb
, 
fmt
, 
¬gs
...) \

587 
	`__çt_fs_”rÜ
(
sb
, 
	`__¿‹lim™
(&
	`MSDOS_SB
(sb)->
¿‹lim™
), 
fmt
 , ## 
¬gs
)

	)

588 
	$__´štf
(3, 4è
__cÞd


589 
	`çt_msg
(
su³r_block
 *
sb
, cÚ¡ *
Ëv–
, cÚ¡ *
fmt
, ...);

590 
	#çt_msg_¿‹lim™
(
sb
, 
Ëv–
, 
fmt
, 
¬gs
...) \

592 ià(
	`__¿‹lim™
(&
	`MSDOS_SB
(
sb
)->
¿‹lim™
)) \

593 
	`çt_msg
(
sb
, 
Ëv–
, 
fmt
, ## 
¬gs
); \

594 
	}
} 0)

	)

595 
çt_þu¡”s_æush
(
su³r_block
 *
sb
);

596 
çt_chaš_add
(
šode
 *šode, 
Ãw_dþus
, 
Ä_þu¡”
);

597 
çt_time_çt2unix
(
msdos_sb_šfo
 *
sbi
, 
time¥ec
 *
ts
,

598 
__Ë16
 
__time
, __Ë16 
__d©e
, 
u8
 
time_cs
);

599 
çt_time_unix2çt
(
msdos_sb_šfo
 *
sbi
, 
time¥ec
 *
ts
,

600 
__Ë16
 *
time
, __Ë16 *
d©e
, 
u8
 *
time_cs
);

601 
çt_sync_bhs
(
bufãr_h—d
 **
bhs
, 
Ä_bhs
);

603 
çt_ÿche_š™
();

604 
çt_ÿche_de¡roy
();

607 cÚ¡ 
expÜt_Ý”©iÚs
 
çt_expÜt_Ýs
;

608 cÚ¡ 
expÜt_Ý”©iÚs
 
çt_expÜt_Ýs_no¡®e
;

611 
	tÎu
;

615 
time_Üd”šg
( );

618 
Üd”
 = 0;

619 
u64
 
´evious_£c
 = 0;

621 ifÐ
´evious_£c
 =ð
g‘_£cÚds
() )

623 
Üd”
++;

627 
Üd”
 = 0;

630 
´evious_£c
 = 
g‘_£cÚds
();

632  
Üd”
;

636 
	#CURRENT_TIME_SEC_OPEL
 ( ( 
time¥ec
 ){ 
	`g‘_£cÚds
(), 
	`time_Üd”šg
(è} )

	)

	@fatent.c

6 
	~<lšux/moduË.h
>

7 
	~<lšux/fs.h
>

8 
	~<lšux/msdos_fs.h
>

9 
	~<lšux/blkdev.h
>

10 
	~"çt.h
"

17 
su³r_block
 *
	g‹mp_sb
;

19 
	sç‹Á_Ý”©iÚs
 {

20 (*
	m’t_blockÄ
)(
	msu³r_block
 *, , *, 
	m£ùÜ_t
 *);

21 (*
	m’t_£t_±r
)(
	mçt_’Œy
 *, );

22 (*
	m’t_b»ad
)(
	msu³r_block
 *, 
	mçt_’Œy
 *,

23 , 
	m£ùÜ_t
);

24 (*
	m’t_g‘
)(
	mçt_’Œy
 *);

25 (*
	m’t_put
)(
	mçt_’Œy
 *, );

26 (*
	m’t_Ãxt
)(
	mçt_’Œy
 *);

29 
DEFINE_SPINLOCK
(
çt12_’Œy_lock
);

31 
	$çt12_’t_blockÄ
(
su³r_block
 *
sb
, 
’Œy
,

32 *
off£t
, 
£ùÜ_t
 *
blockÄ
)

34 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

35 
by‹s
 = 
’Œy
 + (entry >> 1);

36 
	`WARN_ON
(
’Œy
 < 
FAT_START_ENT
 || 
sbi
->
max_þu¡”
 <=ƒntry);

37 *
off£t
 = 
by‹s
 & (
sb
->
s_blocksize
 - 1);

38 *
blockÄ
 = 
sbi
->
çt_¡¬t
 + (
by‹s
 >> 
sb
->
s_blocksize_b™s
);

39 
	}
}

41 
	$çt_’t_blockÄ
(
su³r_block
 *
sb
, 
’Œy
,

42 *
off£t
, 
£ùÜ_t
 *
blockÄ
)

44 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

45 
by‹s
 = (
’Œy
 << 
sbi
->
ç‹Á_shiá
);

46 
	`WARN_ON
(
’Œy
 < 
FAT_START_ENT
 || 
sbi
->
max_þu¡”
 <=ƒntry);

47 *
off£t
 = 
by‹s
 & (
sb
->
s_blocksize
 - 1);

48 *
blockÄ
 = 
sbi
->
çt_¡¬t
 + (
by‹s
 >> 
sb
->
s_blocksize_b™s
);

49 
	}
}

51 
	$çt12_’t_£t_±r
(
çt_’Œy
 *
ç‹Á
, 
off£t
)

53 
bufãr_h—d
 **
bhs
 = 
ç‹Á
->bhs;

54 ià(
ç‹Á
->
Ä_bhs
 == 1) {

55 
	`WARN_ON
(
off£t
 >ð(
bhs
[0]->
b_size
 - 1));

56 
ç‹Á
->
u
.
’t12_p
[0] = 
bhs
[0]->
b_d©a
 + 
off£t
;

57 
ç‹Á
->
u
.
’t12_p
[1] = 
bhs
[0]->
b_d©a
 + (
off£t
 + 1);

59 
	`WARN_ON
(
off£t
 !ð(
bhs
[0]->
b_size
 - 1));

60 
ç‹Á
->
u
.
’t12_p
[0] = 
bhs
[0]->
b_d©a
 + 
off£t
;

61 
ç‹Á
->
u
.
’t12_p
[1] = 
bhs
[1]->
b_d©a
;

63 
	}
}

65 
	$çt16_’t_£t_±r
(
çt_’Œy
 *
ç‹Á
, 
off£t
)

67 
	`WARN_ON
(
off£t
 & (2 - 1));

68 
ç‹Á
->
u
.
’t16_p
 = (
__Ë16
 *)(ç‹Á->
bhs
[0]->
b_d©a
 + 
off£t
);

69 
	}
}

71 
	$çt32_’t_£t_±r
(
çt_’Œy
 *
ç‹Á
, 
off£t
)

73 
	`WARN_ON
(
off£t
 & (4 - 1));

74 
ç‹Á
->
u
.
’t32_p
 = (
__Ë32
 *)(ç‹Á->
bhs
[0]->
b_d©a
 + 
off£t
);

75 
	}
}

77 
	$çt12_’t_b»ad
(
su³r_block
 *
sb
, 
çt_’Œy
 *
ç‹Á
,

78 
off£t
, 
£ùÜ_t
 
blockÄ
)

80 
bufãr_h—d
 **
bhs
 = 
ç‹Á
->bhs;

82 
	`WARN_ON
(
blockÄ
 < 
	`MSDOS_SB
(
sb
)->
çt_¡¬t
);

83 
ç‹Á
->
çt_šode
 = 
	`MSDOS_SB
(
sb
)->fat_inode;

85 
bhs
[0] = 
	`sb_b»ad
(
sb
, 
blockÄ
);

86 ià(!
bhs
[0])

87 
”r
;

89 ià((
off£t
 + 1è< 
sb
->
s_blocksize
)

90 
ç‹Á
->
Ä_bhs
 = 1;

93 
blockÄ
++;

94 
bhs
[1] = 
	`sb_b»ad
(
sb
, 
blockÄ
);

95 ià(!
bhs
[1])

96 
”r_b»l£
;

97 
ç‹Á
->
Ä_bhs
 = 2;

99 
	`çt12_’t_£t_±r
(
ç‹Á
, 
off£t
);

102 
”r_b»l£
:

103 
	`b»l£
(
bhs
[0]);

104 
”r
:

105 
	`çt_msg
(
sb
, 
KERN_ERR
, "FAT„—d fažed (blockÄ %Îu)", (
Îu
)
blockÄ
);

106  -
EIO
;

107 
	}
}

109 
	$çt_’t_b»ad
(
su³r_block
 *
sb
, 
çt_’Œy
 *
ç‹Á
,

110 
off£t
, 
£ùÜ_t
 
blockÄ
)

112 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
	`MSDOS_SB
(
sb
)->
ç‹Á_Ýs
;

114 
	`WARN_ON
(
blockÄ
 < 
	`MSDOS_SB
(
sb
)->
çt_¡¬t
);

115 
ç‹Á
->
çt_šode
 = 
	`MSDOS_SB
(
sb
)->fat_inode;

116 
ç‹Á
->
bhs
[0] = 
	`sb_b»ad
(
sb
, 
blockÄ
);

117 ià(!
ç‹Á
->
bhs
[0]) {

118 
	`çt_msg
(
sb
, 
KERN_ERR
, "FAT„ead failed (blocknr %llu)",

119 (
Îu
)
blockÄ
);

120  -
EIO
;

122 
ç‹Á
->
Ä_bhs
 = 1;

123 
Ýs
->
	`’t_£t_±r
(
ç‹Á
, 
off£t
);

125 
	}
}

127 
	$çt12_’t_g‘
(
çt_’Œy
 *
ç‹Á
)

129 
u8
 **
’t12_p
 = 
ç‹Á
->
u
.ent12_p;

130 
Ãxt
;

132 
	`¥š_lock
(&
çt12_’Œy_lock
);

133 ià(
ç‹Á
->
’Œy
 & 1)

134 
Ãxt
 = (*
’t12_p
[0] >> 4) | (*ent12_p[1] << 4);

136 
Ãxt
 = (*
’t12_p
[1] << 8) | *ent12_p[0];

137 
	`¥š_uÆock
(&
çt12_’Œy_lock
);

139 
Ãxt
 &= 0x0fff;

140 ià(
Ãxt
 >ð
BAD_FAT12
)

141 
Ãxt
 = 
FAT_ENT_EOF
;

142  
Ãxt
;

143 
	}
}

145 
	$çt16_’t_g‘
(
çt_’Œy
 *
ç‹Á
)

147 
Ãxt
 = 
	`Ë16_to_ýu
(*
ç‹Á
->
u
.
’t16_p
);

148 
	`WARN_ON
(()
ç‹Á
->
u
.
’t16_p
 & (2 - 1));

149 ià(
Ãxt
 >ð
BAD_FAT16
)

150 
Ãxt
 = 
FAT_ENT_EOF
;

151  
Ãxt
;

152 
	}
}

154 
	$çt32_’t_g‘
(
çt_’Œy
 *
ç‹Á
)

156 
Ãxt
 = 
	`Ë32_to_ýu
(*
ç‹Á
->
u
.
’t32_p
) & 0x0fffffff;

160 
	`WARN_ON
(()
ç‹Á
->
u
.
’t32_p
 & (4 - 1));

161 ià(
Ãxt
 >ð
BAD_FAT32
)

165 
Ãxt
 = 
FAT_ENT_EOF
;

167  
Ãxt
;

168 
	}
}

170 
	$çt12_’t_put
(
çt_’Œy
 *
ç‹Á
, 
Ãw
)

172 
u8
 **
’t12_p
 = 
ç‹Á
->
u
.ent12_p;

174 ià(
Ãw
 =ð
FAT_ENT_EOF
)

175 
Ãw
 = 
EOF_FAT12
;

177 
	`¥š_lock
(&
çt12_’Œy_lock
);

178 ià(
ç‹Á
->
’Œy
 & 1) {

179 *
’t12_p
[0] = (
Ãw
 << 4) | (*ent12_p[0] & 0x0f);

180 *
’t12_p
[1] = 
Ãw
 >> 4;

182 *
’t12_p
[0] = 
Ãw
 & 0xff;

183 *
’t12_p
[1] = (*’t12_p[1] & 0xf0è| (
Ãw
 >> 8);

185 
	`¥š_uÆock
(&
çt12_’Œy_lock
);

187 
	`m¬k_bufãr_dœty_šode
(
ç‹Á
->
bhs
[0], f©’t->
çt_šode
);

188 ià(
ç‹Á
->
Ä_bhs
 == 2)

189 
	`m¬k_bufãr_dœty_šode
(
ç‹Á
->
bhs
[1], f©’t->
çt_šode
);

190 
	}
}

192 
	$çt16_’t_put
(
çt_’Œy
 *
ç‹Á
, 
Ãw
)

194 ià(
Ãw
 =ð
FAT_ENT_EOF
)

195 
Ãw
 = 
EOF_FAT16
;

197 *
ç‹Á
->
u
.
’t16_p
 = 
	`ýu_to_Ë16
(
Ãw
);

198 
	`m¬k_bufãr_dœty_šode
(
ç‹Á
->
bhs
[0], f©’t->
çt_šode
);

199 
	}
}

201 
	$çt32_’t_put
(
çt_’Œy
 *
ç‹Á
, 
Ãw
)

204 ifÐ
Ãw
 =ð
FAT_ENT_EOF
 )

209 
	`WARN_ON
(
Ãw
 & 0xf0000000);

210 
Ãw
 |ð
	`Ë32_to_ýu
(*
ç‹Á
->
u
.
’t32_p
) & ~0x0fffffff;

211 *
ç‹Á
->
u
.
’t32_p
 = 
	`ýu_to_Ë32
(
Ãw
);

212 
	`m¬k_bufãr_dœty_šode
(
ç‹Á
->
bhs
[0], f©’t->
çt_šode
);

213 
	}
}

215 
	$çt12_’t_Ãxt
(
çt_’Œy
 *
ç‹Á
)

217 
u8
 **
’t12_p
 = 
ç‹Á
->
u
.ent12_p;

218 
bufãr_h—d
 **
bhs
 = 
ç‹Á
->bhs;

219 
u8
 *
Ãx
 = 
’t12_p
[1] + 1 + (
ç‹Á
->
’Œy
 & 1);

221 
ç‹Á
->
’Œy
++;

222 ià(
ç‹Á
->
Ä_bhs
 == 1) {

223 
	`WARN_ON
(
’t12_p
[0] > (
u8
 *)(
bhs
[0]->
b_d©a
 +

224 (
bhs
[0]->
b_size
 - 2)));

225 
	`WARN_ON
(
’t12_p
[1] > (
u8
 *)(
bhs
[0]->
b_d©a
 +

226 (
bhs
[0]->
b_size
 - 1)));

227 ià(
Ãx
 < (
u8
 *)(
bhs
[0]->
b_d©a
 + (bhs[0]->
b_size
 - 1))) {

228 
’t12_p
[0] = 
Ãx
 - 1;

229 
’t12_p
[1] = 
Ãx
;

233 
	`WARN_ON
(
’t12_p
[0] !ð(
u8
 *)(
bhs
[0]->
b_d©a
 +

234 (
bhs
[0]->
b_size
 - 1)));

235 
	`WARN_ON
(
’t12_p
[1] !ð(
u8
 *)
bhs
[1]->
b_d©a
);

236 
’t12_p
[0] = 
Ãx
 - 1;

237 
’t12_p
[1] = 
Ãx
;

238 
	`b»l£
(
bhs
[0]);

239 
bhs
[0] = bhs[1];

240 
ç‹Á
->
Ä_bhs
 = 1;

243 
’t12_p
[0] = 
NULL
;

244 
’t12_p
[1] = 
NULL
;

246 
	}
}

248 
	$çt16_’t_Ãxt
(
çt_’Œy
 *
ç‹Á
)

250 cÚ¡ 
bufãr_h—d
 *
bh
 = 
ç‹Á
->
bhs
[0];

251 
ç‹Á
->
’Œy
++;

252 ià(
ç‹Á
->
u
.
’t16_p
 < (
__Ë16
 *)(
bh
->
b_d©a
 + (bh->
b_size
 - 2))) {

253 
ç‹Á
->
u
.
’t16_p
++;

256 
ç‹Á
->
u
.
’t16_p
 = 
NULL
;

258 
	}
}

260 
	$çt32_’t_Ãxt
(
çt_’Œy
 *
ç‹Á
)

262 cÚ¡ 
bufãr_h—d
 *
bh
 = 
ç‹Á
->
bhs
[0];

263 
ç‹Á
->
’Œy
++;

264 ià(
ç‹Á
->
u
.
’t32_p
 < (
__Ë32
 *)(
bh
->
b_d©a
 + (bh->
b_size
 - 4))) {

265 
ç‹Á
->
u
.
’t32_p
++;

268 
ç‹Á
->
u
.
’t32_p
 = 
NULL
;

270 
	}
}

272 
ç‹Á_Ý”©iÚs
 
	gçt12_Ýs
 = {

273 .
’t_blockÄ
 = 
çt12_’t_blockÄ
,

274 .
	g’t_£t_±r
 = 
çt12_’t_£t_±r
,

275 .
	g’t_b»ad
 = 
çt12_’t_b»ad
,

276 .
	g’t_g‘
 = 
çt12_’t_g‘
,

277 .
	g’t_put
 = 
çt12_’t_put
,

278 .
	g’t_Ãxt
 = 
çt12_’t_Ãxt
,

281 
ç‹Á_Ý”©iÚs
 
	gçt16_Ýs
 = {

282 .
’t_blockÄ
 = 
çt_’t_blockÄ
,

283 .
	g’t_£t_±r
 = 
çt16_’t_£t_±r
,

284 .
	g’t_b»ad
 = 
çt_’t_b»ad
,

285 .
	g’t_g‘
 = 
çt16_’t_g‘
,

286 .
	g’t_put
 = 
çt16_’t_put
,

287 .
	g’t_Ãxt
 = 
çt16_’t_Ãxt
,

290 
ç‹Á_Ý”©iÚs
 
	gçt32_Ýs
 = {

291 .
’t_blockÄ
 = 
çt_’t_blockÄ
,

292 .
	g’t_£t_±r
 = 
çt32_’t_£t_±r
,

293 .
	g’t_b»ad
 = 
çt_’t_b»ad
,

294 .
	g’t_g‘
 = 
çt32_’t_g‘
,

295 .
	g’t_put
 = 
çt32_’t_put
,

296 .
	g’t_Ãxt
 = 
çt32_’t_Ãxt
,

299 
šlše
 
	$lock_çt
(
msdos_sb_šfo
 *
sbi
)

301 
	`mu‹x_lock
(&
sbi
->
çt_lock
);

302 
	}
}

304 
šlše
 
	$uÆock_çt
(
msdos_sb_šfo
 *
sbi
)

306 
	`mu‹x_uÆock
(&
sbi
->
çt_lock
);

307 
	}
}

309 
	$çt_’t_acûss_š™
(
su³r_block
 *
sb
)

311 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

313 
	`mu‹x_š™
(&
sbi
->
çt_lock
);

315 
sbi
->
çt_b™s
) {

317 
sbi
->
ç‹Á_shiá
 = 2;

318 
sbi
->
ç‹Á_Ýs
 = &
çt32_Ýs
;

321 
sbi
->
ç‹Á_shiá
 = 1;

322 
sbi
->
ç‹Á_Ýs
 = &
çt16_Ýs
;

325 
sbi
->
ç‹Á_shiá
 = -1;

326 
sbi
->
ç‹Á_Ýs
 = &
çt12_Ýs
;

329 
	}
}

331 
	$m¬k_fsšfo_dœty
(
su³r_block
 *
sb
)

333 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

335 ià(
sb
->
s_æags
 & 
MS_RDONLY
 || 
sbi
->
çt_b™s
 != 32)

338 
	`__m¬k_šode_dœty
(
sbi
->
fsšfo_šode
, 
I_DIRTY_SYNC
);

339 
	}
}

341 
šlše
 
	$çt_’t_upd©e_±r
(
su³r_block
 *
sb
,

342 
çt_’Œy
 *
ç‹Á
,

343 
off£t
, 
£ùÜ_t
 
blockÄ
)

345 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

346 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

347 
bufãr_h—d
 **
bhs
 = 
ç‹Á
->bhs;

350 ià(!
ç‹Á
->
Ä_bhs
 || 
bhs
[0]->
b_blockÄ
 !ð
blockÄ
)

352 ià(
sbi
->
çt_b™s
 == 12) {

353 ià((
off£t
 + 1è< 
sb
->
s_blocksize
) {

355 ià(
ç‹Á
->
Ä_bhs
 == 2) {

356 
	`b»l£
(
bhs
[1]);

357 
ç‹Á
->
Ä_bhs
 = 1;

361 ià(
ç‹Á
->
Ä_bhs
 != 2)

363 ià(
bhs
[1]->
b_blockÄ
 !ð(
blockÄ
 + 1))

367 
Ýs
->
	`’t_£t_±r
(
ç‹Á
, 
off£t
);

369 
	}
}

371 
	$çt_’t_»ad
(
šode
 *šode, 
çt_’Œy
 *
ç‹Á
, 
’Œy
)

373 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

374 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

375 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

376 
”r
, 
off£t
;

377 
£ùÜ_t
 
blockÄ
;

379 ià(
’Œy
 < 
FAT_START_ENT
 || 
sbi
->
max_þu¡”
 <=ƒntry) {

380 
	`ç‹Á_b»l£
(
ç‹Á
);

381 
	`çt_fs_”rÜ
(
sb
, "šv®id‡cûs tØFAT (’Œy 0x%08x)", 
’Œy
);

382  -
EIO
;

385 
	`ç‹Á_£t_’Œy
(
ç‹Á
, 
’Œy
);

386 
Ýs
->
	`’t_blockÄ
(
sb
, 
’Œy
, &
off£t
, &
blockÄ
);

388 ià(!
	`çt_’t_upd©e_±r
(
sb
, 
ç‹Á
, 
off£t
, 
blockÄ
)) {

389 
	`ç‹Á_b»l£
(
ç‹Á
);

390 
”r
 = 
Ýs
->
	`’t_b»ad
(
sb
, 
ç‹Á
, 
off£t
, 
blockÄ
);

391 ià(
”r
)

392  
”r
;

394  
Ýs
->
	`’t_g‘
(
ç‹Á
);

395 
	}
}

398 
	$çt_mœrÜ_bhs
(
su³r_block
 *
sb
, 
bufãr_h—d
 **
bhs
,

399 
Ä_bhs
)

401 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

402 
bufãr_h—d
 *
c_bh
;

403 
”r
, 
n
, 
cÝy
;

405 
”r
 = 0;

406 
cÝy
 = 1; cÝy < 
sbi
->
çts
; copy++) {

407 
£ùÜ_t
 
backup_çt
 = 
sbi
->
çt_Ëngth
 * 
cÝy
;

409 
n
 = 0;‚ < 
Ä_bhs
;‚++) {

410 
c_bh
 = 
	`sb_g‘blk
(
sb
, 
backup_çt
 + 
bhs
[
n
]->
b_blockÄ
);

411 ià(!
c_bh
) {

412 
”r
 = -
ENOMEM
;

413 
”rÜ
;

415 
	`memýy
(
c_bh
->
b_d©a
, 
bhs
[
n
]->b_d©a, 
sb
->
s_blocksize
);

416 
	`£t_bufãr_u±od©e
(
c_bh
);

417 
	`m¬k_bufãr_dœty_šode
(
c_bh
, 
sbi
->
çt_šode
);

418 ià(
sb
->
s_æags
 & 
MS_SYNCHRONOUS
)

419 
”r
 = 
	`sync_dœty_bufãr
(
c_bh
);

420 
	`b»l£
(
c_bh
);

421 ià(
”r
)

422 
”rÜ
;

425 
”rÜ
:

426  
”r
;

427 
	}
}

429 
	$çt_’t_wr™e
(
šode
 *šode, 
çt_’Œy
 *
ç‹Á
,

430 
Ãw
, 
wa™
)

432 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

433 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
	`MSDOS_SB
(
sb
)->
ç‹Á_Ýs
;

434 
”r
;

436 
Ýs
->
	`’t_put
(
ç‹Á
, 
Ãw
);

437 ià(
wa™
) {

438 
”r
 = 
	`çt_sync_bhs
(
ç‹Á
->
bhs
, f©’t->
Ä_bhs
);

439 ià(
”r
)

440  
”r
;

442  
	`çt_mœrÜ_bhs
(
sb
, 
ç‹Á
->
bhs
, f©’t->
Ä_bhs
);

443 
	}
}

445 
šlše
 
	$çt_’t_Ãxt
(
msdos_sb_šfo
 *
sbi
,

446 
çt_’Œy
 *
ç‹Á
)

448 ià(
sbi
->
ç‹Á_Ýs
->
	`’t_Ãxt
(
ç‹Á
)) {

449 ià(
ç‹Á
->
’Œy
 < 
sbi
->
max_þu¡”
)

453 
	}
}

455 
šlše
 
	$çt_’t_»ad_block
(
su³r_block
 *
sb
,

456 
çt_’Œy
 *
ç‹Á
)

458 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
	`MSDOS_SB
(
sb
)->
ç‹Á_Ýs
;

459 
£ùÜ_t
 
blockÄ
;

460 
off£t
;

462 
	`ç‹Á_b»l£
(
ç‹Á
);

463 
Ýs
->
	`’t_blockÄ
(
sb
, 
ç‹Á
->
’Œy
, &
off£t
, &
blockÄ
);

464  
Ýs
->
	`’t_b»ad
(
sb
, 
ç‹Á
, 
off£t
, 
blockÄ
);

465 
	}
}

467 
	$çt_cÞËù_bhs
(
bufãr_h—d
 **
bhs
, *
Ä_bhs
,

468 
çt_’Œy
 *
ç‹Á
)

470 
n
, 
i
;

472 
n
 = 0;‚ < 
ç‹Á
->
Ä_bhs
;‚++) {

473 
i
 = 0; i < *
Ä_bhs
; i++) {

474 ià(
ç‹Á
->
bhs
[
n
] =ðbhs[
i
])

477 ià(
i
 =ð*
Ä_bhs
) {

478 
	`g‘_bh
(
ç‹Á
->
bhs
[
n
]);

479 
bhs
[
i
] = 
ç‹Á
->bhs[
n
];

480 (*
Ä_bhs
)++;

483 
	}
}

485 
	$v›w_ç‹Á_’Œy
( )

487 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
‹mp_sb
 );

488 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

489 
çt_’Œy
 
ç‹Á
;

490 
couÁ
, 
”r
, 
i
;

491 
’Œy
 = 0;

493 
‹mp_’Œy
 = -1, 
key
=0;

494 
út
=0;

498 
	`´štk
Ð
KERN_ALERT
 "[cheon] view_fatent_entry()est \n");

499 
couÁ
 = 0;

501  
i
 = 1 ; i <= 4; i++ )

503 
	`ç‹Á_š™
Ð&
ç‹Á
 );

504 
	`ç‹Á_£t_’Œy
Ð&
ç‹Á
, 
sbi
->
bx_¡¬t_þu¡”
[ 
i
 ] );

506  
couÁ
 < (
sbi
->
bx_¡¬t_þu¡”
[
i
] - sbi->
bx_’d_þu¡”
[i] + 1 ) )

508 ifÐ
ç‹Á
.
’Œy
 >ð
sbi
->
max_þu¡”
 )

509 
ç‹Á
.
’Œy
 = 
FAT_START_ENT
;

511 
	`ç‹Á_£t_’Œy
Ð&
ç‹Á
, f©’t.
’Œy
 );

512 
”r
 = 
	`çt_’t_»ad_block
Ð
‹mp_sb
, &
ç‹Á
 );

513 ifÐ
”r
 )

514 
out
;

518 ifÐ
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) =ð
FAT_ENT_FREE
 )

520 ifÐ
key
 == 1 )

522 
	`´štk
("úˆ: %uƒÁry : %d \n", 
út
, 
ç‹Á
.
’Œy
 );

523 
út
 =0 ;

524 
key
 = 0;

531 
’Œy
 = 
ç‹Á
.entry;

533 ifÐ
’Œy
 !ð
FAT_ENT_EOF
 && 
‹mp_’Œy
 !ðFAT_ENT_EOF &&emp_’Œy !ð
FAT_ENT_FREE
 )

535 ifÐ
’Œy
 !ð
‹mp_’Œy
 + 1 )

537 
út
++;

538 
	`´štk
("%d %d \n", 
’Œy
, 
‹mp_’Œy
);

546 
‹mp_’Œy
 = 
’Œy
;

548 
key
 = 1;

552 
couÁ
++;

553 ifÐ
couÁ
 =ð
sbi
->
bx_’d_þu¡”
[
i
] ) ;

555  
	`çt_’t_Ãxt
Ð
sbi
, &
ç‹Á
 ) );

557 
out
:

558 
	`ç‹Á_b»l£
Ð&
ç‹Á
 );

562 
	}
}

563 
EXPORT_SYMBOL_GPL
Ð
v›w_ç‹Á_’Œy
 );

566 
	$v›w_ç‹Á_’Œy
( )

568 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
‹mp_sb
 );

569 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

570 
çt_’Œy
 
ç‹Á
;

571 
couÁ
, 
”r
, 
i
;

572 
’Œy
 = 0;

574 
sucûssive_d©a
 = 1;

575 
‹mp_’Œy
 = 0;

576 
æag
 = 0, 
¡¬t
 = 0, 
’d
 = 0;

578 
	`´štk
Ð
KERN_ALERT
 "[cheon] view_fatent_entry()est \n");

579 
couÁ
 = 
FAT_START_ENT
;

581  
i
 = 1 ; i <= 4; i++ )

583 
	`ç‹Á_š™
Ð&
ç‹Á
 );

584 
	`ç‹Á_£t_’Œy
Ð&
ç‹Á
, 
sbi
->
bx_¡¬t_þu¡”
[ 
i
 ] );

586  
couÁ
 < 
sbi
->
max_þu¡”
 )

588 ifÐ
ç‹Á
.
’Œy
 >ð
sbi
->
max_þu¡”
 )

589 
ç‹Á
.
’Œy
 = 
FAT_START_ENT
;

591 
	`ç‹Á_£t_’Œy
Ð&
ç‹Á
, f©’t.
’Œy
 );

592 
”r
 = 
	`çt_’t_»ad_block
Ð
‹mp_sb
, &
ç‹Á
 );

593 ifÐ
”r
 )

594 
out
;

598 ifÐ
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) =ð
FAT_ENT_FREE
 )

600 
’Œy
 = 
ç‹Á
.entry;

601 ifÐ
’Œy
 =ð
‹mp_’Œy
 + 1 )

603 
sucûssive_d©a
++;

605 ifÐ
æag
 =ð0 ) 
¡¬t
 = 
‹mp_’Œy
;

607 
’d
 = 
’Œy
;

609 
æag
 = 1;

611 
‹mp_’Œy
 = 
’Œy
;

616 ifÐ
æag
 == 1 )

618 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] [%d ~ %d ]\t: %lu \n",
¡¬t
, 
’d
, 
sucûssive_d©a
 * 4096 );

620 
sucûssive_d©a
 = 1;

621 
æag
 = 0;

624 ifÐ
ç‹Á
.
’Œy
 =ð
sbi
->
bx_’d_þu¡”
[ 
i
 ] )

626 ifÐ
æag
 == 1 )

628 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] [%d ~ %d ]\t: %lu \n",
¡¬t
, 
’d
, 
sucûssive_d©a
 * 4096 );

630 
sucûssive_d©a
 = 1;

631 
æag
 = 0;

633 
out
;

636  
	`çt_’t_Ãxt
Ð
sbi
, &
ç‹Á
 ) );

638 
out
:

639 
	`ç‹Á_b»l£
Ð&
ç‹Á
 );

643 
	}
}

644 
EXPORT_SYMBOL_GPL
Ð
v›w_ç‹Á_’Œy
 );

647 
	$çt_®loc_þu¡”
Ð
šode
 *šode, *
þu¡”
, 
mode
 )

649 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

650 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

651 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

652 
çt_’Œy
 
ç‹Á
, 
´ev_’t
;

653 
bufãr_h—d
 *
bhs
[
MAX_BUF_PER_PAGE
];

654 
i
, 
couÁ
, 
”r
, 
Ä_bhs
, 
idx_þus
;

656 if(
mode
 == -1){

658 
	`´štk
("[cheon] Not 'etc'ype file‚eed one cluster‡llocation ! \n");

664 
	`lock_çt
(
sbi
);

666 
”r
 = 
Ä_bhs
 = 
idx_þus
 = 0;

667 
couÁ
 = 
FAT_START_ENT
;

668 
	`ç‹Á_š™
(&
´ev_’t
);

669 
	`ç‹Á_š™
(&
ç‹Á
);

671 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 0);

673 
couÁ
 < 
sbi
->
max_þu¡”
) {

674 ià(
ç‹Á
.
’Œy
 >ð
sbi
->
max_þu¡”
)

675 
ç‹Á
.
’Œy
 = 
FAT_START_ENT
;

676 if(
ç‹Á
.
’Œy
 < 
FAT_START_ENT
)

677 
ç‹Á
.
’Œy
 = 
FAT_START_ENT
;

680 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, f©’t.
’Œy
);

681 
”r
 = 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

683 ià(
”r
)

684 
out
;

689 ià(
Ýs
->
	`’t_g‘
(&
ç‹Á
è=ð
FAT_ENT_FREE
) {

690 
’Œy
 = 
ç‹Á
.entry;

693 
Ýs
->
	`’t_put
(&
ç‹Á
, 
FAT_ENT_EOF
);

694 ià(
´ev_’t
.
Ä_bhs
)

695 
Ýs
->
	`’t_put
(&
´ev_’t
, 
’Œy
);

697 
	`çt_cÞËù_bhs
(
bhs
, &
Ä_bhs
, &
ç‹Á
);

699 
sbi
->
´ev_ä“
 = 
’Œy
;

703 ià(
sbi
->
ä“_þu¡”s
 != -1){

704 
sbi
->
ä“_þu¡”s
--;

709 
þu¡”
[
idx_þus
] = 
’Œy
;

710 
idx_þus
++;

712 
out
;

716 
couÁ
++;

717 ià(
couÁ
 =ð
sbi
->
max_þu¡”
)

719 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

723 
out
:

724 
	`uÆock_çt
(
sbi
);

725 
	`m¬k_fsšfo_dœty
Ð
sb
 );

726 
	`ç‹Á_b»l£
(&
ç‹Á
);

727 ià(!
”r
) {

728 ià(
	`šode_Ãeds_sync
(
šode
))

729 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
Ä_bhs
);

730 ià(!
”r
)

731 
”r
 = 
	`çt_mœrÜ_bhs
(
sb
, 
bhs
, 
Ä_bhs
);

733 
i
 = 0; i < 
Ä_bhs
; i++)

734 
	`b»l£
(
bhs
[
i
]);

736 ià(
”r
 && 
idx_þus
)

737 
	`çt_ä“_þu¡”s
(
šode
, 
þu¡”
[0]);

739  
”r
;

740 
	}
}

742 
	$çt_®loc_þu¡”s
(
šode
 *šode, *
þu¡”
, 
Ä_þu¡”
)

744 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

745 
‹mp_sb
 = 
sb
;

747 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

748 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

749 
çt_’Œy
 
ç‹Á
, 
´ev_’t
;

750 
bufãr_h—d
 *
bhs
[
MAX_BUF_PER_PAGE
];

751 
i
, 
couÁ
, 
”r
, 
Ä_bhs
, 
idx_þus
;

755 
¬—
 = 0;

756 
æags
;

758 
	`BUG_ON
(
Ä_þu¡”
 > (
MAX_BUF_PER_PAGE
 / 2));

774 #ifdeà
__ORIGINAL_FAT_TEST__


775 ifÐ
¬—
 =ð
BB_ETC
 )

776 
¬—
 = 
BB_ETC
;

778 
¬—
 = 
BB_NORMAL
;

781 
	`lock_çt
(
sbi
);

782 ià(
sbi
->
ä“_þu¡”s
 !ð-1 && sbi->
ä“_þus_v®id
 &&

783 
sbi
->
ä“_þu¡”s
 < 
Ä_þu¡”
) {

784 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] NØ¥aû stÜag/ cu¼’ˆä“ %u /‚r_þu¡” %d \n", 
sbi
->
ä“_þu¡”s
, 
Ä_þu¡”
 );

785 
	`uÆock_çt
(
sbi
);

786  -
ENOSPC
;

790 ifÐ
sbi
->
çt_Üigš®_æag
 =ð
OFF
 )

792 
	`g‘_¬—_numb”
Ð&
¬—
, 
šode
 );

796 ifÐ
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ] < 
Ä_þu¡”
 )

798 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] NØ¥aû stÜag/ bx cu¼’ˆä“ %u /‚r_þu¡” %d /‡»¨: %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ], 
Ä_þu¡”
,‡rea );

799 
	`uÆock_çt
(
sbi
);

800  -
ENOSPC
;

808 
”r
 = 
Ä_bhs
 = 
idx_þus
 = 0;

809 
couÁ
 = 
FAT_START_ENT
;

810 
	`ç‹Á_š™
(&
´ev_’t
);

811 
	`ç‹Á_š™
(&
ç‹Á
);

813 ifÐ
sbi
->
çt_Üigš®_æag
 =ð
ON
 )

814 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
sbi
->
´ev_ä“
 + 1);

816 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
sbi
->
bx_´ev_ä“
[
¬—
] + 0 );

818 
couÁ
 < 
sbi
->
max_þu¡”
) {

819 ià(
ç‹Á
.
’Œy
 >ð
sbi
->
max_þu¡”
)

820 
ç‹Á
.
’Œy
 = 
FAT_START_ENT
;

821 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, f©’t.
’Œy
);

822 
”r
 = 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

823 ià(
”r
)

824 
out
;

829 ifÐ
sbi
->
çt_Üigš®_æag
 =ð
ON
 )

831 ià(
Ýs
->
	`’t_g‘
(&
ç‹Á
è=ð
FAT_ENT_FREE
 )

833 
’Œy
 = 
ç‹Á
.entry;

836 
Ýs
->
	`’t_put
(&
ç‹Á
, 
FAT_ENT_EOF
);

837 ià(
´ev_’t
.
Ä_bhs
)

838 
Ýs
->
	`’t_put
(&
´ev_’t
, 
’Œy
);

841 
	`çt_cÞËù_bhs
(
bhs
, &
Ä_bhs
, &
ç‹Á
);

843 
sbi
->
´ev_ä“
 = 
’Œy
;

847 ià(
sbi
->
ä“_þu¡”s
 != -1)

849 
sbi
->
ä“_þu¡”s
--;

853 
þu¡”
[
idx_þus
] = 
’Œy
;

854 
idx_þus
++;

855 ià(
idx_þus
 =ð
Ä_þu¡”
)

856 
out
;

862 
´ev_’t
 = 
ç‹Á
;

868 ià(
Ýs
->
	`’t_g‘
(&
ç‹Á
è=ð
FAT_ENT_FREE
 && 
sbi
->
bx_¡¬t_þu¡”
[ 
¬—
 ] <ðç‹Á.
’Œy
 && sbi->
bx_’d_þu¡”
[‡rea ] >= fatent.entry )

870 
’Œy
 = 
ç‹Á
.entry;

875 
Ýs
->
	`’t_put
(&
ç‹Á
, 
FAT_ENT_EOF
);

876 ià(
´ev_’t
.
Ä_bhs
)

877 
Ýs
->
	`’t_put
(&
´ev_’t
, 
’Œy
);

880 
	`çt_cÞËù_bhs
(
bhs
, &
Ä_bhs
, &
ç‹Á
);

882 
sbi
->
´ev_ä“
 = 
’Œy
;

883 
sbi
->
bx_´ev_ä“
[ 
¬—
 ] = 
’Œy
;

886 ià(
sbi
->
ä“_þu¡”s
 != -1)

889 
sbi
->
ä“_þu¡”s
--;

890 
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ]--;

894 
þu¡”
[
idx_þus
] = 
’Œy
;

895 
idx_þus
++;

896 ià(
idx_þus
 =ð
Ä_þu¡”
)

897 
out
;

903 
´ev_’t
 = 
ç‹Á
;

906 
couÁ
++;

907 ià(
couÁ
 =ð
sbi
->
max_þu¡”
)

909 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

913 
sbi
->
ä“_þu¡”s
 = 0;

914 
sbi
->
ä“_þus_v®id
 = 1;

915 
”r
 = -
ENOSPC
;

917 
out
:

919 
	`uÆock_çt
(
sbi
);

920 
	`m¬k_fsšfo_dœty
(
sb
);

921 
	`ç‹Á_b»l£
(&
ç‹Á
);

922 ià(!
”r
) {

923 ià(
	`šode_Ãeds_sync
(
šode
))

924 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
Ä_bhs
);

925 ià(!
”r
)

926 
”r
 = 
	`çt_mœrÜ_bhs
(
sb
, 
bhs
, 
Ä_bhs
);

928 
i
 = 0; i < 
Ä_bhs
; i++)

931 
	`b»l£
(
bhs
[
i
]);

934 ià(
”r
 && 
idx_þus
)

936 
	`´štk
Ð
KERN_ALERT
 "[cheon] ==========fat_free_clustersest \n" );

937 
	`çt_ä“_þu¡”s
(
šode
, 
þu¡”
[0]);

942 #ifdeà
__DEBUG__


945  
”r
;

946 
	}
}

948 
	$show_the_¡©us_un™_æag
Ð
su³r_block
 *
sb
, 
¬—
 )

950 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

951 
PA
 *
·
 = 
sbi
->
·»a_PA
[ 
¬—
 ];

952 
PA_un™_t
 *
pun™
 = 
·
->
·_un™
;

954 
un™_num
 = 
·
->
·_num
;

955 
i
 = 0, 
j
 = 0;

957 
	`´štk
("[cheon] unit_flag \n");

959  
i
=0 ; i < 
un™_num
 ; i++ )

961 
	`´štk
("%d ", 
pun™
[ 
i
 ].
æag
 );

963 
j
++;

964 ifÐ
j
 /10 )

966 
	`´štk
("\n");

967 
j
=0;

970 
	`´štk
("\n");

973 
	}
}

974 
EXPORT_SYMBOL_GPL
Ð
show_the_¡©us_un™_æag
 );

978 
	$g‘_¬—_numb”_fÜ_ä“_func
Ð
su³r_block
 *
sb
, 
’Œy
 )

980 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

982 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_ETC
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_ETC ] )

984  
BB_ETC
;

985 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_NORMAL ] )

987  
BB_NORMAL
;

988 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_NORMAL_EVENT ] )

990  
BB_NORMAL_EVENT
;

991 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_PARKING ] )

993  
BB_PARKING
;

994 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_MANUAL ] )

996  
BB_MANUAL
;

997 ifÐ
sbi
->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ] <ð
’Œy
 &&ƒÁry <ðsbi->
bx_’d_þu¡”
[ BB_IMAGE ] )

999  
BB_IMAGE
;

1002 
	`´štk
Ð
KERN_ALERT
 "[cheon] ?????? get_area_number_for_free_funcƒrror \n" );

1003  
BB_ETC
;

1005 
	}
}

1006 
	$çt_ä“_þu¡”s
(
šode
 *šode, 
þu¡”
)

1008 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

1009 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1010 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

1011 
çt_’Œy
 
ç‹Á
;

1012 
bufãr_h—d
 *
bhs
[
MAX_BUF_PER_PAGE
];

1013 
d’Œy
 *d’Œy = 
NULL
;

1015 
PA_un™_t
 *
pun™
 = 
NULL
;

1016 
PA
 *
·
 = 
NULL
;

1018 
p_út
=0;

1020 
i
, 
”r
, 
Ä_bhs
;

1021 
fœ¡_þ
 = 
þu¡”
, 
dœty_fsšfo
 = 0;

1022 
´evious_þu¡”
, 
‹mp_þu¡”
= 0;

1025 
¬—
=0;

1028 
út
 = 0;

1032 
Ä_bhs
 = 0;

1033 
	`ç‹Á_š™
(&
ç‹Á
);

1034 
	`lock_çt
(
sbi
);

1038 
	`MSDOS_I
Ð
šode
 )->
´e_®loûd
 = 0;

1041 
þu¡”
 = 
	`çt_’t_»ad
(
šode
, &
ç‹Á
, cluster);

1042 ià(
þu¡”
 < 0) {

1043 
”r
 = 
þu¡”
;

1044 
”rÜ
;

1045 } ià(
þu¡”
 =ð
FAT_ENT_FREE
) {

1046 
	`çt_fs_”rÜ
(
sb
, "%s: deleting FATƒntry beyond EOF",

1047 
__func__
);

1048 
”r
 = -
EIO
;

1049 
”rÜ
;

1053 ifÐ
þu¡”
 !ð
FAT_ENT_EOF
 ){

1055 ifÐ
þu¡”
 !ð
‹mp_þu¡”
 + 1 )

1056 
út
++;

1058 
‹mp_þu¡”
 = 
þu¡”
;

1061 
út
 = cnt - 1;

1063 
‹mp_þu¡”
 = 0;

1064 
út
 = 0;

1068 ià(
sbi
->
ÝtiÚs
.
disÿrd
) {

1074 ià(
þu¡”
 !ð
ç‹Á
.
’Œy
 + 1) {

1075 
Ä_þus
 = 
ç‹Á
.
’Œy
 - 
fœ¡_þ
 + 1;

1077 
	`sb_issue_disÿrd
(
sb
,

1078 
	`çt_þus_to_blkÄ
(
sbi
, 
fœ¡_þ
),

1079 
Ä_þus
 * 
sbi
->
£c_³r_þus
,

1080 
GFP_NOFS
, 0);

1082 
fœ¡_þ
 = 
þu¡”
;

1086 
Ýs
->
	`’t_put
(&
ç‹Á
, 
FAT_ENT_FREE
);

1087 ià(
sbi
->
ä“_þu¡”s
 != -1) {

1088 
sbi
->
ä“_þu¡”s
++;

1090 ifÐ
sbi
->
çt_Üigš®_æag
 =ð
OFF
 )

1092 
¬—
 = 
	`g‘_¬—_numb”_fÜ_ä“_func
Ð
sb
, 
ç‹Á
.
’Œy
 );

1093 (
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ])++;

1095 ifÐ
¬—
 !ð
BB_ETC
 )

1098 
·
 = 
sbi
->
·»a_PA
[ 
¬—
 ];

1099 
pun™
 = 
·
->
·_un™
;

1102 
p_út
 = (
þu¡”
 - 
pun™
[ 0 ].
¡¬t
è/ 
·
->
·_þu¡”_num
;

1104 
pun™
[ 
p_út
 ].
æag
 = 
FREE
;

1107 
ä“d_út
++;

1108 ifÐ
þu¡”
 =ð
FAT_ENT_EOF
 ) {

1110 
ä“d_út
 = 0;

1113 
´evious_þu¡”
 = 
þu¡”
;

1116 
dœty_fsšfo
 = 1;

1119 ià(
Ä_bhs
 + 
ç‹Á
.Ä_bh > 
MAX_BUF_PER_PAGE
) {

1120 ià(
sb
->
s_æags
 & 
MS_SYNCHRONOUS
) {

1122 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
Ä_bhs
);

1123 ià(
”r
)

1125 
”rÜ
;

1128 
”r
 = 
	`çt_mœrÜ_bhs
(
sb
, 
bhs
, 
Ä_bhs
);

1129 ià(
”r
)

1131 
”rÜ
;

1133 
i
 = 0; i < 
Ä_bhs
; i++)

1134 
	`b»l£
(
bhs
[
i
]);

1135 
Ä_bhs
 = 0;

1137 
	`çt_cÞËù_bhs
(
bhs
, &
Ä_bhs
, &
ç‹Á
);

1138 } 
þu¡”
 !ð
FAT_ENT_EOF
);

1146 ià(
sb
->
s_æags
 & 
MS_SYNCHRONOUS
) {

1147 
”r
 = 
	`çt_sync_bhs
(
bhs
, 
Ä_bhs
);

1148 ià(
”r
)

1150 
”rÜ
;

1153 
”r
 = 
	`çt_mœrÜ_bhs
(
sb
, 
bhs
, 
Ä_bhs
);

1154 
”rÜ
:

1156 
	`ç‹Á_b»l£
(&
ç‹Á
);

1157 
i
 = 0; i < 
Ä_bhs
; i++)

1158 
	`b»l£
(
bhs
[
i
]);

1159 
	`uÆock_çt
(
sbi
);

1160 ià(
dœty_fsšfo
)

1161 
	`m¬k_fsšfo_dœty
(
sb
);

1163  
”r
;

1164 
	}
}

1165 
EXPORT_SYMBOL_GPL
(
çt_ä“_þu¡”s
);

1168 
	#FAT_READA_SIZE
 (128 * 1024)

	)

1170 
	$çt_’t_»ada
(
su³r_block
 *
sb
, 
çt_’Œy
 *
ç‹Á
,

1171 
»ada_blocks
)

1173 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
	`MSDOS_SB
(
sb
)->
ç‹Á_Ýs
;

1174 
£ùÜ_t
 
blockÄ
;

1175 
i
, 
off£t
;

1177 
Ýs
->
	`’t_blockÄ
(
sb
, 
ç‹Á
->
’Œy
, &
off£t
, &
blockÄ
);

1179 
i
 = 0; i < 
»ada_blocks
; i++)

1180 
	`sb_b»adah—d
(
sb
, 
blockÄ
 + 
i
);

1181 
	}
}

1183 
	$g‘_¬—_numb”
Ð*
¬—
, 
šode
 *inode )

1185 
d’Œy
 *d’Œy = 
NULL
;

1186 
d’Œy
 *
uµ”_d’Œy
 = 
NULL
;

1187 
‹mp_¬—
 = -1;

1191 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

1192 ifÐ
	`S_ISDIR
Ð
šode
->
i_mode
è|| 
d’Œy
->
d_·»Á
 =ð
NULL
)

1194 
‹mp_¬—
 = 
BB_ETC
;

1199 
uµ”_d’Œy
 = 
d’Œy
->
d_·»Á
;

1200  
uµ”_d’Œy
 !ð
NULL
 )

1202 ifÐ
uµ”_d’Œy
->
d_Çme
.
Çme
 =ð
NULL
 )

1209 if(
	`¡rcmp
(
uµ”_d’Œy
->
d_Çme
.
Çme
, 
DIR_1
 ) == 0 )

1210 
‹mp_¬—
 = 
NUM_1
;

1212 if(
	`¡rcmp
(
uµ”_d’Œy
->
d_Çme
.
Çme
, 
DIR_2
 ) == 0 )

1213 
‹mp_¬—
 = 
NUM_2
;

1215 if(
	`¡rcmp
(
uµ”_d’Œy
->
d_Çme
.
Çme
, 
DIR_3
 ) == 0 )

1216 
‹mp_¬—
 = 
NUM_3
;

1218 if(
	`¡rcmp
(
uµ”_d’Œy
->
d_Çme
.
Çme
, 
DIR_4
 ) == 0 )

1219 
‹mp_¬—
 = 
NUM_4
;

1221 if(
	`¡rcmp
(
uµ”_d’Œy
->
d_Çme
.
Çme
, 
DIR_5
 ) == 0 )

1222 
‹mp_¬—
 = 
NUM_5
;

1224 
‹mp_¬—
 = 
BB_ETC
;

1227 ifÐ
‹mp_¬—
 != -1 )

1229 ifÐ!
	`¡rcmp
("/", 
uµ”_d’Œy
->
d_Çme
.
Çme
 ) )

1232 
uµ”_d’Œy
 =uµ”_d’Œy->
d_·»Á
;

1237 ifÐ1 <ð
‹mp_¬—
 &&emp_area <= 4 )

1239 ifÐ
	`¡r¡r
Ð
d’Œy
->
d_Çme
.
Çme
, "mp4" ) =ð
NULL
 )

1241 *
¬—
 = 
BB_ETC
;

1247 ifÐ
‹mp_¬—
 == -1 )

1248 *
¬—
 = 
BB_ETC
;

1250 *
¬—
 =
‹mp_¬—
;

1252 
	}
}

1254 
	$çt_couÁ_ä“_þu¡”s_fÜ_¬—
(
su³r_block
 *
sb
)

1256 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1257 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

1258 
çt_’Œy
 
ç‹Á
;

1259 
»ada_blocks
, 
»ada_mask
, 
cur_block
;

1260 
ä“
;

1264 
»ada_blocks
 = 
FAT_READA_SIZE
 >> 
sb
->
s_blocksize_b™s
;

1265 
»ada_mask
 = 
»ada_blocks
 - 1;

1266 
cur_block
 = 0;

1268 
ä“
 = 0;

1269 
	`ç‹Á_š™
(&
ç‹Á
);

1270 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
FAT_START_ENT
);

1272 ifÐ
sbi
->
bx_ä“_v®id
 != -1 )

1273 
¬—_out
;

1277 
ç‹Á
.
’Œy
 < 
sbi
->
max_þu¡”
) {

1279 ià((
cur_block
 & 
»ada_mask
) == 0) {

1280 
»¡
 = 
sbi
->
çt_Ëngth
 - 
cur_block
;

1281 
	`çt_’t_»ada
(
sb
, &
ç‹Á
, 
	`mš
(
»ada_blocks
, 
»¡
));

1283 
cur_block
++;

1285 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

1288 ià(
Ýs
->
	`’t_g‘
(&
ç‹Á
è=ð
FAT_ENT_FREE
)

1290 
ä“
++;

1293 ifÐ
ç‹Á
.
’Œy
 < 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_ETC
 ] );

1295 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_ETC
 ] )

1296 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ])++;

1298 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL
 ] )

1300 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL
 ])++;

1304 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL_EVENT
 ] )

1305 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL_EVENT
 ])++;

1307 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_PARKING
 ] )

1308 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ])++;

1310 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_MANUAL
 ] )

1311 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_MANUAL
 ])++;

1313 ifÐ
ç‹Á
.
’Œy
 <ð
sbi
->
bx_’d_þu¡”
[ 
BB_IMAGE
 ] )

1314 (
sbi
->
bx_ä“_þu¡”s
[ 
BB_IMAGE
 ])++;

1322 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

1327 
sbi
->
bx_ä“_v®id
 = 1;

1329 
sbi
->
ä“_þu¡”s
 = 
ä“
;

1330 
sbi
->
ä“_þus_v®id
 = 1;

1331 
	`m¬k_fsšfo_dœty
(
sb
);

1332 
	`ç‹Á_b»l£
(&
ç‹Á
);

1334 
¬—_out
:

1336 
	}
}

1337 
EXPORT_SYMBOL_GPL
Ð
çt_couÁ_ä“_þu¡”s_fÜ_¬—
 );

1340 
	$__decide_—ch_·_¡©us
Ð
¡¬t
, 
mid
, 
’d
, 
·_út
, 
PA_un™_t
 *
pun™
, 
su³r_block
 *
sb
 )

1342 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1343 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

1344 
çt_’Œy
 
ç‹Á
;

1345 
»ada_blocks
, 
»ada_mask
, 
cur_block
;

1346 
”r
 = 0, 
ä“
;

1347 
þu¡”_cur
 = 0;

1348 
út
 = 0;

1352 ifÐ!Ð(
’d
 & 
mid
è^ 
FAT_ENT_EOF
è|| !ÐÓnd & 
¡¬t
) ^ FAT_ENT_EOF) )

1354 
	`´štk
("[cheon] MIDEOF \n");

1355 
pun™
[ 
·_út
 ].
æag
 = 
MIDEOF
;

1357 ifÐ
’d
 =ð
FAT_ENT_EOF
 && 
mid
 != FAT_ENT_EOF )

1359 ifÐ
¡¬t
 =ð
FAT_ENT_FREE
 )

1361 
	`´štk
("[cheon] GARBAGE \n");

1362 
pun™
[ 
·_út
 ].
æag
 = 
GARBAGE
;

1365 ifÐ
¡¬t
 !ð
FAT_ENT_FREE
 )

1368 
pun™
[ 
·_út
 ].
æag
 = 
USED
;

1375 
»ada_blocks
 = 
FAT_READA_SIZE
 >> 
sb
->
s_blocksize_b™s
;

1376 
»ada_mask
 = 
»ada_blocks
 - 1;

1377 
cur_block
 = 0;

1379 
ä“
 = 0;

1380 
	`ç‹Á_š™
(&
ç‹Á
);

1382 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
pun™
[ 
·_út
 ].
¡¬t
 );

1384 
ç‹Á
.
’Œy
 <ð
pun™
[ 
·_út
 ].
’d
 ) {

1387 ià((
cur_block
 & 
»ada_mask
) == 0) {

1388 
»¡
 = 
sbi
->
çt_Ëngth
 - 
cur_block
;

1389 
	`çt_’t_»ada
(
sb
, &
ç‹Á
, 
	`mš
(
»ada_blocks
, 
»¡
));

1391 
cur_block
++;

1393 
”r
 = 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

1394 ià(
”r
)

1395 
out
;

1399 ifÐ
pun™
[ 
·_út
 ].
æag
 =ð
MIDEOF
 )

1402 ifÐ
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) =ð
FAT_ENT_EOF
 && f©’t.
’Œy
 !ð
pun™
[
·_út
].
’d
 )

1404 
Ýs
->
	`’t_put
Ð&
ç‹Á
, f©’t.
’Œy
 + 1 );

1408 ifÐ
pun™
[ 
·_út
 ].
æag
 =ð
GARBAGE
 )

1412 ifÐ
pun™
[ 
·_út
 ].
¡¬t
 <ð
ç‹Á
.
’Œy
 && f©’t.’Œy <ðpun™[…a_úˆ].
’d
 )

1414 ifÐ
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) !ð
FAT_ENT_FREE
 )

1416 
Ýs
->
	`’t_put
Ð&
ç‹Á
, 
FAT_ENT_FREE
 );

1417 
	`´štk
("%u ", 
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) );

1426 
út
++;

1427 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

1437 
	`m¬k_fsšfo_dœty
(
sb
);

1438 
	`ç‹Á_b»l£
(&
ç‹Á
);

1439 
out
:

1441  
”r
;

1442 
	}
}

1444 
	$decide_—ch_·_¡©us
Ð
su³r_block
 *
sb
, 
PA_un™_t
 *
pun™
, 
¬—
 )

1446 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1447 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

1448 
çt_’Œy
 
ç‹Á
;

1449 
»ada_blocks
, 
»ada_mask
, 
cur_block
;

1450 
”r
 = 0, 
ä“
;

1451 
þu¡”_cur
 = 0;

1454 
tÙ®_·_út
=0, 
i
=0;

1455 
befÜe_þ
 = 
FAT_START_ENT
;

1456 
þu¡”_num
 = 
FAT_START_ENT
;

1457 
·_út
 = 0, 
num_´e_®loc
 = ( 
sbi
->
bx_´e_size
[ 
¬—
 ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

1458 
¡¬t
 = 0, 
mid
 = 0, 
’d
 = 0;

1460 
	`´štk
("decide_each_pa_status\n");

1465 
	`lock_çt
(
sbi
);

1469 
»ada_blocks
 = 
FAT_READA_SIZE
 >> 
sb
->
s_blocksize_b™s
;

1470 
»ada_mask
 = 
»ada_blocks
 - 1;

1471 
cur_block
 = 0;

1473 
ä“
 = 0;

1474 
	`ç‹Á_š™
(&
ç‹Á
);

1475 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
FAT_START_ENT
);

1478 
ç‹Á
.
’Œy
 < 
sbi
->
max_þu¡”
) {

1481 ià((
cur_block
 & 
»ada_mask
) == 0) {

1482 
»¡
 = 
sbi
->
çt_Ëngth
 - 
cur_block
;

1483 
	`çt_’t_»ada
(
sb
, &
ç‹Á
, 
	`mš
(
»ada_blocks
, 
»¡
));

1485 
cur_block
++;

1487 
”r
 = 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

1488 ià(
”r
)

1489 
out
;

1494 ifÐ
pun™
[ 
·_út
 ].
¡¬t
 <ð
ç‹Á
.
’Œy
 && f©’t.’Œy <ðpun™[…a_úˆ].
’d
 )

1496 ifÐ
ç‹Á
.
’Œy
 =ð
pun™
[ 
·_út
 ].
¡¬t
 )

1498 
¡¬t
 = 
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 );

1504 ifÐ
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 ) =ð
FAT_ENT_EOF
 )

1506 
	`´štk
("eoà’Œy : %d \n", 
ç‹Á
.
’Œy
 );

1508 ifÐ
ç‹Á
.
’Œy
 =ð
pun™
[ 
·_út
 ].
’d
 )

1509 
’d
 = 
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 );

1511 ifÐ
pun™
[ 
·_út
 ].
¡¬t
 < 
ç‹Á
.
’Œy
 && f©’t.’Œy <…un™[…a_úˆ].
’d
 )

1513 
mid
 = 
Ýs
->
	`’t_g‘
Ð&
ç‹Á
 );

1519 ifÐ
ç‹Á
.
’Œy
 =ð
pun™
[ 
·_út
 ].
’d
 )

1522 
	`__decide_—ch_·_¡©us
Ð
¡¬t
, 
mid
, 
’d
, 
·_út
, 
pun™
, 
sb
 );

1524 ifÐ
pun™
[ 
·_út
 ].
æag
 =ð
GARBAGE
 )…un™[…a_úˆ].æag = 
FREE
;

1525 ifÐ
pun™
[ 
·_út
 ].
æag
 =ð
MIDEOF
 )…un™[…a_úˆ].æag = 
USED
;

1528 
·_út
++;

1531 
¡¬t
 = 
mid
 = 
’d
 = 
FAT_ENT_FREE
;

1536 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

1542 
	`m¬k_fsšfo_dœty
(
sb
);

1543 
	`ç‹Á_b»l£
(&
ç‹Á
);

1544 
out
:

1545 
	`uÆock_çt
(
sbi
);

1546  
”r
;

1547 
	}
}

1548 
EXPORT_SYMBOL_GPL
Ð
decide_—ch_·_¡©us
 );

1550 
	$çt_couÁ_ä“_þu¡”s
(
su³r_block
 *
sb
)

1552 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1553 
ç‹Á_Ý”©iÚs
 *
Ýs
 = 
sbi
->
ç‹Á_Ýs
;

1554 
çt_’Œy
 
ç‹Á
;

1555 
»ada_blocks
, 
»ada_mask
, 
cur_block
;

1556 
”r
 = 0, 
ä“
;

1558 
	`lock_çt
(
sbi
);

1559 ià(
sbi
->
ä“_þu¡”s
 !ð-1 && sbi->
ä“_þus_v®id
)

1560 
out
;

1562 
»ada_blocks
 = 
FAT_READA_SIZE
 >> 
sb
->
s_blocksize_b™s
;

1563 
»ada_mask
 = 
»ada_blocks
 - 1;

1564 
cur_block
 = 0;

1566 
ä“
 = 0;

1567 
	`ç‹Á_š™
(&
ç‹Á
);

1568 
	`ç‹Á_£t_’Œy
(&
ç‹Á
, 
FAT_START_ENT
);

1569 
ç‹Á
.
’Œy
 < 
sbi
->
max_þu¡”
) {

1571 ià((
cur_block
 & 
»ada_mask
) == 0) {

1572 
»¡
 = 
sbi
->
çt_Ëngth
 - 
cur_block
;

1573 
	`çt_’t_»ada
(
sb
, &
ç‹Á
, 
	`mš
(
»ada_blocks
, 
»¡
));

1575 
cur_block
++;

1577 
”r
 = 
	`çt_’t_»ad_block
(
sb
, &
ç‹Á
);

1578 ià(
”r
)

1579 
out
;

1582 ià(
Ýs
->
	`’t_g‘
(&
ç‹Á
è=ð
FAT_ENT_FREE
)

1584 
	`´štk
Ð
KERN_ALERT
 "fat_count_free_clusters free++ \n" );

1585 
ä“
++;

1587 } 
	`çt_’t_Ãxt
(
sbi
, &
ç‹Á
));

1589 
sbi
->
ä“_þu¡”s
 = 
ä“
;

1590 
sbi
->
ä“_þus_v®id
 = 1;

1591 
	`m¬k_fsšfo_dœty
(
sb
);

1592 
	`ç‹Á_b»l£
(&
ç‹Á
);

1593 
out
:

1594 
	`uÆock_çt
(
sbi
);

1595  
”r
;

1596 
	}
}

	@file.c

11 
	~<lšux/ÿ·bž™y.h
>

12 
	~<lšux/moduË.h
>

13 
	~<lšux/com·t.h
>

14 
	~<lšux/mouÁ.h
>

15 
	~<lšux/time.h
>

16 
	~<lšux/bufãr_h—d.h
>

17 
	~<lšux/wr™eback.h
>

18 
	~<lšux/backšg-dev.h
>

19 
	~<lšux/blkdev.h
>

20 
	~<lšux/f¢Ùify.h
>

21 
	~<lšux/£cur™y.h
>

22 
	~"çt.h
"

24 
	$çt_ioùl_g‘_©Œibu‹s
(
šode
 *šode, 
u32
 
__u£r
 *
u£r_©Œ
)

26 
u32
 
©Œ
;

28 
	`mu‹x_lock
(&
šode
->
i_mu‹x
);

29 
©Œ
 = 
	`çt_make_©Œs
(
šode
);

30 
	`mu‹x_uÆock
(&
šode
->
i_mu‹x
);

32  
	`put_u£r
(
©Œ
, 
u£r_©Œ
);

33 
	}
}

35 
	$çt_ioùl_£t_©Œibu‹s
(
fže
 *fže, 
u32
 
__u£r
 *
u£r_©Œ
)

37 
šode
 *šodð
	`fže_šode
(
fže
);

38 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

39 
is_dœ
 = 
	`S_ISDIR
(
šode
->
i_mode
);

40 
u32
 
©Œ
, 
Þd©Œ
;

41 
Ÿ‰r
 
Ÿ
;

42 
”r
;

46 
”r
 = 
	`g‘_u£r
(
©Œ
, 
u£r_©Œ
);

47 ià(
”r
)

48 
out
;

50 
”r
 = 
	`mÁ_wªt_wr™e_fže
(
fže
);

51 ià(
”r
)

52 
out
;

53 
	`mu‹x_lock
(&
šode
->
i_mu‹x
);

61 
©Œ
 &ð0xfà& ~(
ATTR_VOLUME
 | 
ATTR_DIR
);

63 
©Œ
 |ð(
	`MSDOS_I
(
šode
)->
i_©Œs
 & 
ATTR_VOLUME
) |

64 (
is_dœ
 ? 
ATTR_DIR
 : 0);

65 
Þd©Œ
 = 
	`çt_make_©Œs
(
šode
);

68 
Ÿ
.
Ÿ_v®id
 = 
ATTR_MODE
 | 
ATTR_CTIME
;

69 
Ÿ
.
Ÿ_ùime
 = 
	`cu¼’t_fs_time
(
šode
->
i_sb
);

70 ià(
is_dœ
)

71 
Ÿ
.
Ÿ_mode
 = 
	`çt_make_mode
(
sbi
, 
©Œ
, 
S_IRWXUGO
);

73 
Ÿ
.
Ÿ_mode
 = 
	`çt_make_mode
(
sbi
, 
©Œ
,

74 
S_IRUGO
 | 
S_IWUGO
 | (
šode
->
i_mode
 & 
S_IXUGO
));

78 ià(
šode
->
i_šo
 =ð
MSDOS_ROOT_INO
 && 
©Œ
 !ð
ATTR_DIR
) {

79 
”r
 = -
EINVAL
;

80 
out_uÆock_šode
;

83 ià(
sbi
->
ÝtiÚs
.
sys_immubË
 &&

84 ((
©Œ
 | 
Þd©Œ
è& 
ATTR_SYS
) &&

85 !
	`ÿ·bË
(
CAP_LINUX_IMMUTABLE
)) {

86 
”r
 = -
EPERM
;

87 
out_uÆock_šode
;

95 
”r
 = 
	`£cur™y_šode_£‰r
(
fže
->
f_·th
.
d’Œy
, &
Ÿ
);

96 ià(
”r
)

97 
out_uÆock_šode
;

100 
”r
 = 
	`çt_£‰r
(
fže
->
f_·th
.
d’Œy
, &
Ÿ
);

101 ià(
”r
)

102 
out_uÆock_šode
;

104 
	`f¢Ùify_chªge
(
fže
->
f_·th
.
d’Œy
, 
Ÿ
.
Ÿ_v®id
);

105 ià(
sbi
->
ÝtiÚs
.
sys_immubË
) {

106 ià(
©Œ
 & 
ATTR_SYS
)

107 
šode
->
i_æags
 |ð
S_IMMUTABLE
;

109 
šode
->
i_æags
 &ð~
S_IMMUTABLE
;

112 
	`çt_§ve_©Œs
(
šode
, 
©Œ
);

113 
	`m¬k_šode_dœty
(
šode
);

114 
out_uÆock_šode
:

115 
	`mu‹x_uÆock
(&
šode
->
i_mu‹x
);

116 
	`mÁ_drÝ_wr™e_fže
(
fže
);

117 
out
:

118  
”r
;

119 
	}
}

121 
	$çt_g’”ic_ioùl
(
fže
 *
fžp
, 
cmd
, 
¬g
)

123 
šode
 *šodð
	`fže_šode
(
fžp
);

124 
u32
 
__u£r
 *
u£r_©Œ
 = (u32 __u£¸*)
¬g
;

126 
cmd
) {

127 
FAT_IOCTL_GET_ATTRIBUTES
:

128  
	`çt_ioùl_g‘_©Œibu‹s
(
šode
, 
u£r_©Œ
);

129 
FAT_IOCTL_SET_ATTRIBUTES
:

130  
	`çt_ioùl_£t_©Œibu‹s
(
fžp
, 
u£r_©Œ
);

132  -
ENOTTY
;

134 
	}
}

136 #ifdeà
CONFIG_COMPAT


137 
	$çt_g’”ic_com·t_ioùl
(
fže
 *
fžp
, 
cmd
,

138 
¬g
)

141  
	`çt_g’”ic_ioùl
(
fžp
, 
cmd
, ()
	`com·t_±r
(
¬g
));

142 
	}
}

145 
	$çt_fže_»Ëa£
(
šode
 *šode, 
fže
 *
fžp
)

148 #ifdeà
__DEBUG__


149 
	`´štk
("[cheon] ====fat_file_release==== \n");

152 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
šode
->
i_sb
 );

153 
¬—_num
;

154 
u£d_size
 = ( )Ð
šode
->
i_size
 );

155 
´e_®loc_size
;

159 
	`g‘_¬—_numb”
Ð&
¬—_num
, 
šode
 );

160 
´e_®loc_size
 = 
sbi
->
bx_´e_size
[ 
¬—_num
 ] * 1024 * 1024;

162 ifÐ
¬—_num
 =ð
BB_ETC
 || 
sbi
->
çt_Üigš®_æag
 =ð
ON
 );

164 ifÐ
´e_®loc_size
 < 
šode
->
i_size
 )

166 
	`´štk
("[cheon] Error, Bad…rediction case \n");

172 #ifdeà
__DEBUG__


180 #ifdeà
__DEBUG__


204 #ifdeà
__DEBUG__


213 ià((
fžp
->
f_mode
 & 
FMODE_WRITE
) &&

214 
	`MSDOS_SB
(
šode
->
i_sb
)->
ÝtiÚs
.
æush
) {

215 
	`çt_æush_šodes
(
šode
->
i_sb
, inode, 
NULL
);

216 
	`cÚge¡iÚ_wa™
(
BLK_RW_ASYNC
, 
HZ
/10);

219 
	}
}

221 
	$çt_fže_fsync
(
fže
 *
fžp
, 
loff_t
 
¡¬t
,†off_ˆ
’d
, 
d©async
)

223 
šode
 *šodð
fžp
->
f_m­pšg
->
ho¡
;

224 
»s
, 
”r
;

226 
»s
 = 
	`g’”ic_fže_fsync
(
fžp
, 
¡¬t
, 
’d
, 
d©async
);

227 
”r
 = 
	`sync_m­pšg_bufãrs
(
	`MSDOS_SB
(
šode
->
i_sb
)->
çt_šode
->
i_m­pšg
);

229  
»s
 ?„e : 
”r
;

230 
	}
}

233 cÚ¡ 
fže_Ý”©iÚs
 
	gçt_fže_Ý”©iÚs
 = {

234 .
Î£ek
 = 
g’”ic_fže_Î£ek
,

235 .
	g»ad
 = 
do_sync_»ad
,

236 .
	gwr™e
 = 
do_sync_wr™e
,

237 .
	gaio_»ad
 = 
g’”ic_fže_aio_»ad
,

238 .
	gaio_wr™e
 = 
g’”ic_fže_aio_wr™e
,

239 .
	gmm­
 = 
g’”ic_fže_mm­
,

240 .
	g»Ëa£
 = 
çt_fže_»Ëa£
,

241 .
	guÆocked_ioùl
 = 
çt_g’”ic_ioùl
,

242 #ifdeà
CONFIG_COMPAT


243 .
	gcom·t_ioùl
 = 
çt_g’”ic_com·t_ioùl
,

245 .
	gfsync
 = 
çt_fže_fsync
,

246 .
	g¥liû_»ad
 = 
g’”ic_fže_¥liû_»ad
,

249 
	$çt_cÚt_ex·nd
(
šode
 *šode, 
loff_t
 
size
)

251 
add»ss_¥aû
 *
m­pšg
 = 
šode
->
i_m­pšg
;

252 
loff_t
 
¡¬t
 = 
šode
->
i_size
, 
couÁ
 = 
size
 - inode->i_size;

253 
”r
;

255 
”r
 = 
	`g’”ic_cÚt_ex·nd_sim¶e
(
šode
, 
size
);

256 ià(
”r
)

257 
out
;

260 
šode
->
i_ùime
 = inode->
i_mtime
 = 
CURRENT_TIME_SEC
;

261 
	`m¬k_šode_dœty
(
šode
);

262 ià(
	`IS_SYNC
(
šode
)) {

263 
”r2
;

269 
”r
 = 
	`fžem­_fd©awr™e_¿nge
(
m­pšg
, 
¡¬t
,

270 
¡¬t
 + 
couÁ
 - 1);

271 
”r2
 = 
	`sync_m­pšg_bufãrs
(
m­pšg
);

272 ià(!
”r
)

273 
”r
 = 
”r2
;

274 
”r2
 = 
	`wr™e_šode_now
(
šode
, 1);

275 ià(!
”r
)

276 
”r
 = 
”r2
;

277 ià(!
”r
) {

278 
”r
 = 
	`fžem­_fd©awa™_¿nge
(
m­pšg
, 
¡¬t
,

279 
¡¬t
 + 
couÁ
 - 1);

282 
out
:

283  
”r
;

284 
	}
}

287 
	$çt_ä“
(
šode
 *šode, 
sk
)

289 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

290 
”r
, 
wa™
, 
ä“_¡¬t
, 
i_¡¬t
, 
i_log¡¬t
;

293 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

296 ià(
	`MSDOS_I
(
šode
)->
i_¡¬t
 == 0)

299 
	`çt_ÿche_šv®_šode
(
šode
);

301 
wa™
 = 
	`IS_DIRSYNC
(
šode
);

302 
i_¡¬t
 = 
ä“_¡¬t
 = 
	`MSDOS_I
(
šode
)->i_start;

303 
i_log¡¬t
 = 
	`MSDOS_I
(
šode
)->i_logstart;

306 ià(!
sk
) {

308 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 0;

309 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 0;

311 
	`MSDOS_I
(
šode
)->
i_©Œs
 |ð
ATTR_ARCH
;

313 
šode
->
i_ùime
 = inode->
i_mtime
 = 
CURRENT_TIME_SEC
;

314 ià(
wa™
) {

316 
”r
 = 
	`çt_sync_šode
(
šode
);

317 ià(
”r
) {

318 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = i_start;

319 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = i_logstart;

320  
”r
;

323 
	`m¬k_šode_dœty
(
šode
);

326 ià(
sk
) {

327 
çt_’Œy
 
ç‹Á
;

328 
»t
, 
fþus
, 
dþus
;

331 
»t
 = 
	`çt_g‘_þu¡”
(
šode
, 
sk
 - 1, &
fþus
, &
dþus
);

332 ià(
»t
 < 0)

333  
»t
;

334 ià(
»t
 =ð
FAT_ENT_EOF
)

337 
	`ç‹Á_š™
(&
ç‹Á
);

338 
»t
 = 
	`çt_’t_»ad
(
šode
, &
ç‹Á
, 
dþus
);

339 ià(
»t
 =ð
FAT_ENT_EOF
) {

340 
	`ç‹Á_b»l£
(&
ç‹Á
);

342 } ià(
»t
 =ð
FAT_ENT_FREE
) {

344 
	`çt_fs_”rÜ
(
sb
,

346 
__func__
, 
	`MSDOS_I
(
šode
)->
i_pos
);

347 
»t
 = -
EIO
;

348 } ià(
»t
 > 0) {

351 
”r
 = 
	`çt_’t_wr™e
(
šode
, &
ç‹Á
, 
FAT_ENT_EOF
, 
wa™
);

352 ià(
”r
)

353 
»t
 = 
”r
;

355 
	`ç‹Á_b»l£
(&
ç‹Á
);

356 ià(
»t
 < 0)

357  
»t
;

359 
ä“_¡¬t
 = 
»t
;

361 
šode
->
i_blocks
 = 
sk
 << (
	`MSDOS_SB
(
sb
)->
þu¡”_b™s
 - 9);

365  
	`çt_ä“_þu¡”s
(
šode
, 
ä“_¡¬t
);

366 
	}
}

368 
	$çt_Œunÿ‹_blocks
(
šode
 *šode, 
loff_t
 
off£t
)

370 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

371 cÚ¡ 
þu¡”_size
 = 
sbi
->cluster_size;

372 
Ä_þu¡”s
;

379 ià(
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 > 
off£t
)

380 
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 = 
off£t
;

382 
Ä_þu¡”s
 = (
off£t
 + (
þu¡”_size
 - 1)è>> 
sbi
->
þu¡”_b™s
;

384 
	`çt_ä“
(
šode
, 
Ä_þu¡”s
);

385 
	`çt_æush_šodes
(
šode
->
i_sb
, inode, 
NULL
);

386 
	}
}

388 
	$çt_g‘©Œ
(
vfsmouÁ
 *
mÁ
, 
d’Œy
 *d’Œy, 
k¡©
 *
¡©
)

390 
šode
 *šodð
d’Œy
->
d_šode
;

394 
	`g’”ic_fžÏ‰r
(
šode
, 
¡©
);

395 
¡©
->
blksize
 = 
	`MSDOS_SB
(
šode
->
i_sb
)->
þu¡”_size
;

397 ià(
	`MSDOS_SB
(
šode
->
i_sb
)->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
) {

399 
¡©
->
šo
 = 
	`çt_i_pos_»ad
(
	`MSDOS_SB
(
šode
->
i_sb
), inode);

402 
	}
}

403 
EXPORT_SYMBOL_GPL
(
çt_g‘©Œ
);

405 
	$çt_§n™ize_mode
(cÚ¡ 
msdos_sb_šfo
 *
sbi
,

406 
šode
 *šode, 
umode_t
 *
mode_±r
)

408 
umode_t
 
mask
, 
³rm
;

415 ià(
	`S_ISREG
(
šode
->
i_mode
))

416 
mask
 = 
sbi
->
ÝtiÚs
.
fs_fmask
;

418 
mask
 = 
sbi
->
ÝtiÚs
.
fs_dmask
;

420 
³rm
 = *
mode_±r
 & ~(
S_IFMT
 | 
mask
);

428 ià((
³rm
 & (
S_IRUGO
 | 
S_IXUGO
)è!ð(
šode
->
i_mode
 & (S_IRUGO|S_IXUGO)))

429  -
EPERM
;

430 ià(
	`çt_mode_ÿn_hÞd_ro
(
šode
)) {

431 ià((
³rm
 & 
S_IWUGO
è&& (Õ”m & S_IWUGOè!ð(S_IWUGO & ~
mask
)))

432  -
EPERM
;

434 ià((
³rm
 & 
S_IWUGO
è!ð(S_IWUGO & ~
mask
))

435  -
EPERM
;

438 *
mode_±r
 &ð
S_IFMT
 | 
³rm
;

441 
	}
}

443 
	$çt_®low_£t_time
(
msdos_sb_šfo
 *
sbi
, 
šode
 *inode)

445 
umode_t
 
®low_utime
 = 
sbi
->
ÝtiÚs
.allow_utime;

447 ià(!
	`uid_eq
(
	`cu¼’t_fsuid
(), 
šode
->
i_uid
)) {

448 ià(
	`š_group_p
(
šode
->
i_gid
))

449 
®low_utime
 >>= 3;

450 ià(
®low_utime
 & 
MAY_WRITE
)

456 
	}
}

458 
	#TIMES_SET_FLAGS
 (
ATTR_MTIME_SET
 | 
ATTR_ATIME_SET
 | 
ATTR_TIMES_SET
)

	)

460 
	#FAT_VALID_MODE
 (
S_IFREG
 | 
S_IFDIR
 | 
S_IRWXUGO
)

	)

462 
	$çt_£‰r
(
d’Œy
 *d’Œy, 
Ÿ‰r
 *
©Œ
)

464 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
d’Œy
->
d_sb
);

465 
šode
 *šodð
d’Œy
->
d_šode
;

466 
Ÿ_v®id
;

467 
”rÜ
;

472 
Ÿ_v®id
 = 
©Œ
->ia_valid;

473 ià(
Ÿ_v®id
 & 
TIMES_SET_FLAGS
) {

474 ià(
	`çt_®low_£t_time
(
sbi
, 
šode
))

475 
©Œ
->
Ÿ_v®id
 &ð~
TIMES_SET_FLAGS
;

478 
”rÜ
 = 
	`šode_chªge_ok
(
šode
, 
©Œ
);

479 
©Œ
->
Ÿ_v®id
 = ia_valid;

480 ià(
”rÜ
) {

481 ià(
sbi
->
ÝtiÚs
.
qu›t
)

482 
”rÜ
 = 0;

483 
out
;

492 ià(
©Œ
->
Ÿ_v®id
 & 
ATTR_SIZE
) {

493 
	`šode_dio_wa™
(
šode
);

495 ià(
©Œ
->
Ÿ_size
 > 
šode
->
i_size
) {

496 
”rÜ
 = 
	`çt_cÚt_ex·nd
(
šode
, 
©Œ
->
Ÿ_size
);

497 ià(
”rÜ
 || 
©Œ
->
Ÿ_v®id
 =ð
ATTR_SIZE
)

498 
out
;

499 
©Œ
->
Ÿ_v®id
 &ð~
ATTR_SIZE
;

503 ià(((
©Œ
->
Ÿ_v®id
 & 
ATTR_UID
) &&

504 (!
	`uid_eq
(
©Œ
->
Ÿ_uid
, 
sbi
->
ÝtiÚs
.
fs_uid
))) ||

505 ((
©Œ
->
Ÿ_v®id
 & 
ATTR_GID
) &&

506 (!
	`gid_eq
(
©Œ
->
Ÿ_gid
, 
sbi
->
ÝtiÚs
.
fs_gid
))) ||

507 ((
©Œ
->
Ÿ_v®id
 & 
ATTR_MODE
) &&

508 (
©Œ
->
Ÿ_mode
 & ~
FAT_VALID_MODE
)))

509 
”rÜ
 = -
EPERM
;

511 ià(
”rÜ
) {

512 ià(
sbi
->
ÝtiÚs
.
qu›t
)

513 
”rÜ
 = 0;

514 
out
;

521 ià(
©Œ
->
Ÿ_v®id
 & 
ATTR_MODE
) {

522 ià(
	`çt_§n™ize_mode
(
sbi
, 
šode
, &
©Œ
->
Ÿ_mode
) < 0)

523 
©Œ
->
Ÿ_v®id
 &ð~
ATTR_MODE
;

526 ià(
©Œ
->
Ÿ_v®id
 & 
ATTR_SIZE
) {

527 
	`down_wr™e
(&
	`MSDOS_I
(
šode
)->
Œunÿ‹_lock
);

528 
	`Œunÿ‹_£tsize
(
šode
, 
©Œ
->
Ÿ_size
);

529 
	`çt_Œunÿ‹_blocks
(
šode
, 
©Œ
->
Ÿ_size
);

530 
	`up_wr™e
(&
	`MSDOS_I
(
šode
)->
Œunÿ‹_lock
);

533 
	`£‰r_cÝy
(
šode
, 
©Œ
);

534 
	`m¬k_šode_dœty
(
šode
);

535 
out
:

536  
”rÜ
;

537 
	}
}

538 
EXPORT_SYMBOL_GPL
(
çt_£‰r
);

540 cÚ¡ 
šode_Ý”©iÚs
 
	gçt_fže_šode_Ý”©iÚs
 = {

541 .
£‰r
 = 
çt_£‰r
,

542 .
	gg‘©Œ
 = 
çt_g‘©Œ
,

	@inode.c

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/time.h
>

18 
	~<lšux/¦ab.h
>

19 
	~<lšux/£q_fže.h
>

20 
	~<lšux/·gem­.h
>

21 
	~<lšux/m·ge.h
>

22 
	~<lšux/bufãr_h—d.h
>

23 
	~<lšux/mouÁ.h
>

24 
	~<lšux/aio.h
>

25 
	~<lšux/vfs.h
>

26 
	~<lšux/·r£r.h
>

27 
	~<lšux/uio.h
>

28 
	~<lšux/wr™eback.h
>

29 
	~<lšux/log2.h
>

30 
	~<lšux/hash.h
>

31 
	~<lšux/blkdev.h
>

32 
	~<asm/uÇligÃd.h
>

33 
	~"çt.h
"

36 #iâdeà
CONFIG_FAT_DEFAULT_IOCHARSET


38 
	#CONFIG_FAT_DEFAULT_IOCHARSET
 ""

	)

44 
	#COUNT_AREA_0
 25600

	)

45 
	#COUNT_AREA_1
 25600

	)

46 
	#COUNT_AREA_2
 25600

	)

47 
	#COUNT_AREA_3
 25600

	)

48 
	#COUNT_AREA_4
 25600

	)

49 
	#COUNT_AREA_5
 25600

	)

51 
	gçt_deçuÉ_cod•age
 = 
CONFIG_FAT_DEFAULT_CODEPAGE
;

52 
	gçt_deçuÉ_ioch¬£t
[] = 
CONFIG_FAT_DEFAULT_IOCHARSET
;

54 
	#PRE_ALLOC_ON
 1

	)

55 
	gçt_block
 = -1;

57 
	$time_Üd”šg
( )

59 
Üd”
 = 0;

60 
u64
 
´evious_£c
 = 0;

63 ifÐ
´evious_£c
 =ð
	`g‘_£cÚds
() )

65 
Üd”
++;

69 
Üd”
 = 0;

73 
´evious_£c
 = 
	`g‘_£cÚds
();

75  
Üd”
;

76 
	}
}

77 
EXPORT_SYMBOL_GPL
Ð
time_Üd”šg
 );

79 
	$de_»upd©e
(
su³r_block
 *
sb
, 
šode
 *inode){

80 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

81 
i_pos
;

82 
bufãr_h—d
 *
bh
[32];

83 
msdos_dœ_’Œy
 *
¿w_’Œy
;

84 
š·ge_¡¬t
, 
š·ge_’d
, 
š·ge_cur
;

87 
	`´štk
("[cheon] Update DE \n");

88 
i_pos
 = 
	`MSDOS_I
(
šode
)->i_pos;

90 
š·ge_cur
 = 
i_pos
 >> 
sbi
->
dœ_³r_block_b™s
;

91 
š·ge_¡¬t
 = 
š·ge_cur
 - (š·ge_cu¸% 
BLOCK_IN_PAGE
);

92 
š·ge_’d
 = 
š·ge_¡¬t
 + 
BLOCK_IN_PAGE
 -1 ;

95 
	`´štk
("[cheÚ] DE infØ, I_po : %u \n", 
i_pos
);

96 
	`´štk
("[cheÚ] S¹ Cu¸End : %u / %u / %u \n", 
š·ge_¡¬t
, 
š·ge_cur
, 
š·ge_’d
);

98 
bh
[0] = 
	`sb_b»ad
(
sb
, 
š·ge_cur
);

99 
¿w_’Œy
 = &((
msdos_dœ_’Œy
 *è(
bh
[0]->
b_d©a
))

100 [
i_pos
 & (
sbi
->
dœ_³r_block
 - 1)];

101 
¿w_’Œy
->
size
 = 
	`ýu_to_Ë32
(
šode
->
i_size
);

111 
	`´štk
("[cheon] Edit size \n");

112 
	`m¬k_bufãr_dœty
(
bh
[0]);

113 
	`sync_dœty_bufãr
(
bh
[0]);

114 
	`b»l£
(
bh
[0]);

117 
i
=0; i< 
BLOCK_IN_PAGE
 ; i++)

118 
bh
[
i
] = 
	`sb_b»ad
(
sb
, 
š·ge_¡¬t
 + i);

120 
¿w_’Œy
 = &((
msdos_dœ_’Œy
 *è(
bh
[
š·ge_cur
-
š·ge_¡¬t
]->
b_d©a
))

121 [
i_pos
 & (
sbi
->
dœ_³r_block
 - 1)];

122 
¿w_’Œy
->
size
 = 
	`ýu_to_Ë32
(
šode
->
i_size
);

124 
	`´štk
("[cheon] Edit size \n");

126 
i
=0; i<
BLOCK_IN_PAGE
; i++){

127 
	`m¬k_bufãr_dœty
(
bh
[
i
]);

130 
	`çt_sync_bhs
(
bh
, 
BLOCK_IN_PAGE
);

133 
i
=0; i<
BLOCK_IN_PAGE
; i++){

134 
	`b»l£
(
bh
[
i
]);

138 
	`´štk
("[cheÚ] Upd©DE Com¶‘e,„—Èfžsiz%u\n", ()
šode
->
i_size
);

140 
	}
}

143 
	$þu¡”chaš_»upd©e
(
su³r_block
 *
sb
, 
šode
 *inode){

144 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

145 
d’Œy
 *
d’Œy_f
;

146 
¬—_num
;

147 
®loÿ‹d_size
;

148 
u£d_size
 = ()(
šode
->
i_size
);

149 
unu£d_size
;

151 
block_num
;

152 
Ãw_eof_þu¡”
;

154 
bufãr_h—d
 *
bh
[32];

155 
i
;

156 *
d©a
 = (*è
	`km®loc
(512, 
GFP_KERNEL
);

158 
¡¬t_block_pos
;

159 
upd©e_block_pos
;

160 
š·ge_¡¬t_block_pos
;

161 
š·ge_’d_block_pos
;

162 
eof_block_pos
;

163 
eof_š·ge_¡¬t_block_pos
;

164 
eof_š·ge_’d_block_pos
 ;

166 
Ãed_upd©e_þu¡”_numb”
;

167 
Üi_eof_þu¡”_numb”
;

169 
·ge_®igÃd_¡¬t
;

172 
d’Œy_f
 = 
	`li¡_’Œy
(
šode
->
i_d’Œy
.
fœ¡
, 
d’Œy
, 
d_u
.
d_®Ÿs
);

178 
	`g‘_¬—_numb”
(&
¬—_num
 , 
šode
);

179 
®loÿ‹d_size
 = 
sbi
->
bx_´e_size
[
¬—_num
] * 1024 * 1024;

180 
unu£d_size
 = 
®loÿ‹d_size
 - 
u£d_size
;

182 
·ge_®igÃd_¡¬t
 = 
sbi
->
çt_¡¬t
 - (sbi->çt_¡¬ˆ% 
BLOCK_IN_PAGE
);;

184 
	`´štk
("\n");

185 
	`´štk
("[cheon] -------------„eupdate check ----------- \n");

186 
	`´štk
("[cheÚ]…» : %u, u£d : %u \n", 
®loÿ‹d_size
, 
u£d_size
);

188 
Ãed_upd©e_þu¡”_numb”
 = 
	`æoÜ
(
u£d_size
, 
sbi
->
þu¡”_size
è+ (
	`MSDOS_I
(
šode
)->
i_log¡¬t
);

189 
Üi_eof_þu¡”_numb”
 = 
	`æoÜ
(
®loÿ‹d_size
, 
sbi
->
þu¡”_size
è+ (
	`MSDOS_I
(
šode
)->
i_log¡¬t
) -1;

191 
	`´štk
("[cheÚ]‚“d upd©ed_þu¡” / or˜eoànumb” : %u / %u \n", 
Ãed_upd©e_þu¡”_numb”
, 
Üi_eof_þu¡”_numb”
);

195 if(
Ãed_upd©e_þu¡”_numb”
 > 
sbi
->
bx_’d_þu¡”
[
¬—_num
])

196 
Ãed_upd©e_þu¡”_numb”
 =‚“d_upd©e_þu¡”_numb” - (
sbi
->
bx_’d_þu¡”
[
¬—_num
] - sbi->
bx_¡¬t_þu¡”
[area_num]) -1;

197 if(
Üi_eof_þu¡”_numb”
 > 
sbi
->
bx_’d_þu¡”
[
¬—_num
])

198 
Üi_eof_þu¡”_numb”
 = ori_eof_þu¡”_numb” - (
sbi
->
bx_’d_þu¡”
[
¬—_num
] - sbi->
bx_¡¬t_þu¡”
[area_num]) -1 ;

201 
	`´štk
("[cheÚ]‚“d upd©ed_þu¡” / or˜eoànumb” : %u / %u \n", 
Ãed_upd©e_þu¡”_numb”
, 
Üi_eof_þu¡”_numb”
);

208 
¡¬t_block_pos
 = ()
sbi
->
çt_¡¬t
 + 
	`æoÜ
(
	`MSDOS_I
(
šode
)->
i_log¡¬t
, 
CLUSTER_IN_BLOCK
);

209 
upd©e_block_pos
 = ()
sbi
->
çt_¡¬t
 + 
	`æoÜ
(
Ãed_upd©e_þu¡”_numb”
, 
CLUSTER_IN_BLOCK
);

210 
eof_block_pos
 = ()
sbi
->
çt_¡¬t
 + 
	`æoÜ
(
Üi_eof_þu¡”_numb”
, 
CLUSTER_IN_BLOCK
);

212 
š·ge_¡¬t_block_pos
 = ()
upd©e_block_pos
 - (upd©e_block_po % 
BLOCK_IN_PAGE
);

213 
š·ge_’d_block_pos
 = ()
š·ge_¡¬t_block_pos
 + 
BLOCK_IN_PAGE
 - 1;

215 
eof_š·ge_¡¬t_block_pos
 = ()
eof_block_pos
 - (eof_block_po % 
BLOCK_IN_PAGE
);

216 
eof_š·ge_’d_block_pos
 = ()
eof_š·ge_¡¬t_block_pos
 + 
BLOCK_IN_PAGE
 - 1;

219 
	`´štk
("[cheÚ] block s¹ : %d ,‡ligÃd s¹ : %u \n", 
sbi
->
çt_¡¬t
, 
·ge_®igÃd_¡¬t
);

220 
	`´štk
("[cheÚ] s¹ / upd©/ƒoàblock‚umb” : %u / %u / %u \n", 
¡¬t_block_pos
, 
upd©e_block_pos
, 
eof_block_pos
);

222 
	`´štk
("[cheÚ] iÅage_¡¬t_block_po / iÅage_’d_block_po : %u / %u \n", 
š·ge_¡¬t_block_pos
, 
š·ge_’d_block_pos
);

223 
	`´štk
("[cheÚ]ƒof_š·ge_¡¬t_block_po /ƒof_š·ge_’d_block_po : %u / %u \n", 
eof_š·ge_¡¬t_block_pos
, 
eof_š·ge_’d_block_pos
);

226 
	`´štk
("[cheÚ]…» siz:%u , R—Èsiz: %u \n", 
®loÿ‹d_size
, ()
šode
->
i_size
);

235 if(
š·ge_¡¬t_block_pos
 =ð
eof_š·ge_¡¬t_block_pos
){

236 
	`´štk
("[cheon] FAT update occur in same…age \n");

238 
i
=0; i<
BLOCK_IN_PAGE
; i++){

239 
bh
[
i
] = 
	`sb_b»ad
(
sb
, 
š·ge_¡¬t_block_pos
 + i);

243 
block_num
 = 
eof_block_pos
 - 
eof_š·ge_¡¬t_block_pos
;

244 
	`memýy
(
d©a
,
bh
[
block_num
]->
b_d©a
, 512 );

245 
i
=0; i< 
CLUSTER_IN_BLOCK
; i ++){

247 if(
d©a
[
i
] == 0x0FFFFFFF){

248 
	`´štk
("\n[cheÚ] S—rch Offfffff, off£ˆ%d \n", 
i
);

250 if(
i
==0)

251 
d©a
[
i
] = data[i+1] - 1;

253 
d©a
[
i
] = data[i-1] + 1;

259 
	`´štk
("\n");

261 if(
i
 =ð
CLUSTER_IN_BLOCK
)

262 
	`´štk
("[cheon] Error, can't find…roper oldƒof \n");

263 
	`memýy
(
bh
[
block_num
]->
b_d©a
 ,
d©a
, 512 );

267 
block_num
 = 
upd©e_block_pos
 - 
eof_š·ge_¡¬t_block_pos
;

268 
	`memýy
(
d©a
,
bh
[
block_num
]->
b_d©a
 , 512 );

269 
Ãw_eof_þu¡”
 = (
	`MSDOS_I
(
šode
)->
i_log¡¬t
è+ 
	`ûž
(
u£d_size
, 
sbi
->
þu¡”_size
);

271 if(
Ãw_eof_þu¡”
 > 
sbi
->
bx_’d_þu¡”
[
¬—_num
])

272 
Ãw_eof_þu¡”
 =‚ew_eof_þu¡” - (
sbi
->
bx_’d_þu¡”
[
¬—_num
] - sbi->
bx_¡¬t_þu¡”
[area_num]) -1 ;

274 
	`´štk
("[cheÚ]‚ewƒoàþu¡”‚um : %u \n", 
Ãw_eof_þu¡”
 -1 );

276 
i
=0; i<
CLUSTER_IN_BLOCK
; i ++){

278 if(
d©a
[
i
] =ð
Ãw_eof_þu¡”
){

279 
	`´štk
("\n[cheÚ] S—rch‚ewƒoàpos™iÚ, clu¡”‚um %u \n", 
Ãw_eof_þu¡”
);

280 
d©a
[
i
] = 0x0FFFFFFF;

284 if(
i
 =ð
CLUSTER_IN_BLOCK
)

285 
	`´štk
("[cheon] Error, can't find…roper‚ewƒof \n");

287 
	`memýy
(
bh
[
block_num
]->
b_d©a
 ,
d©a
, 512 );

291 
i
=0; i<
BLOCK_IN_PAGE
; i++){

292 
	`m¬k_bufãr_dœty
(
bh
[
i
]);

295 
	`çt_sync_bhs
(
bh
, 
BLOCK_IN_PAGE
);

297 
i
=0; i<
BLOCK_IN_PAGE
; i++)

298 
	`b»l£
(
bh
[
i
]);

300 
	`´štk
("[cheon] Write FAT \n");

306 
	`´štk
("[cheon] FAT update occur inwo…age \n");

308 
i
=0; i<
BLOCK_IN_PAGE
; i++){

309 
bh
[
i
] = 
	`sb_b»ad
(
sb
, 
eof_š·ge_¡¬t_block_pos
 + i);

313 
block_num
 = 
eof_block_pos
 - 
eof_š·ge_¡¬t_block_pos
;

314 
	`memýy
(
d©a
,
bh
[
block_num
]->
b_d©a
, 512 );

315 
i
=0; i< 
CLUSTER_IN_BLOCK
; i ++){

317 if(
d©a
[
i
] == 0x0FFFFFFF){

318 
	`´štk
("\n[cheÚ] S—rch Offfffff, off£ˆ%d \n", 
i
);

320 if(
i
==0)

321 
d©a
[
i
] = data[i+1] - 1;

323 
d©a
[
i
] = data[i-1] + 1;

328 if(
i
 =ð
CLUSTER_IN_BLOCK
)

329 
	`´štk
("[cheon] Error, can't find…roper oldƒof \n");

330 
	`memýy
(
bh
[
block_num
]->
b_d©a
 ,
d©a
, 512 );

332 
	`Î_rw_block
(
WRITE
, 
BLOCK_IN_PAGE
, 
bh
);

333 
i
=0; i<
BLOCK_IN_PAGE
; i++)

334 
	`b»l£
(
bh
[
i
]);

335 
	`´štk
("[cheon] Origianl EoF…age Write \n");

337 
i
=0; i<
BLOCK_IN_PAGE
; i++){

338 
bh
[
i
] = 
	`sb_b»ad
(
sb
, 
š·ge_¡¬t_block_pos
 + i);

341 
block_num
 = 
upd©e_block_pos
 - 
š·ge_¡¬t_block_pos
;

342 
	`memýy
(
d©a
,
bh
[
block_num
]->
b_d©a
 , 512 );

343 
Ãw_eof_þu¡”
 = (
	`MSDOS_I
(
šode
)->
i_log¡¬t
è+ 
	`ûž
(
u£d_size
, 
sbi
->
þu¡”_size
) ;

344 
i
=0; i<
CLUSTER_IN_BLOCK
; i ++){

345 if(
d©a
[
i
] =ð
Ãw_eof_þu¡”
){

346 
	`´štk
("\n[cheÚ] S—rch‚ewƒoàpos™iÚ, clu¡”‚um %u\n", 
Ãw_eof_þu¡”
);

347 
d©a
[
i
] = 0x0FFFFFFF;

351 if(
i
 =ð
CLUSTER_IN_BLOCK
)

352 
	`´štk
("[cheon] Error, can't find…roper‚ewƒof \n");

354 
	`memýy
(
bh
[
block_num
]->
b_d©a
 ,
d©a
, 512 );

356 
i
=0; i<
BLOCK_IN_PAGE
; i++){

357 
	`m¬k_bufãr_dœty
(
bh
[
i
]);

360 
	`çt_sync_bhs
(
bh
, 
BLOCK_IN_PAGE
);

361 
i
=0; i<
BLOCK_IN_PAGE
; i++)

362 
	`b»l£
(
bh
[
i
]);

363 
	`´štk
("[cheon] New EoF…age Write \n");

368 
	`kä“
(
d©a
);

369 
sbi
->
bx_Ãxt_¡¬t
[
¬—_num
] = 
Ãw_eof_þu¡”
;

371 
	}
}

374 
	$fšd_v®id_Ãw_Ãxt
(
šode
 *šode, 
¬—
, * 
Ãxt
, * 
´ev
)

376 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

377 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

378 
bufãr_h—d
 *
´ev_bh
;

379 
bufãr_h—d
 *
Ãxt_bh
;

381 *
´ev_d©a
;

382 *
Ãxt_d©a
;

383 
block_pos
;

385 
þ_¡¬t
 = 
sbi
->
bx_¡¬t_þu¡”
[
¬—
];

386 
þ_’d
 = 
sbi
->
bx_’d_þu¡”
[
¬—
];

388 
block_¡¬t
 = 
çt_block
 + 
þ_¡¬t
/
CLUSTER_IN_BLOCK
;

389 
block_’d
 = 
çt_block
 + 
þ_’d
/
CLUSTER_IN_BLOCK
;

391 
Ãw_Ãxt
;

393 
i
, 
j
;

395 
block_pos
 = 
block_¡¬t
;

397 
	`´štk
("[cheon] Start valid‚ew‚ext... \n");

398 
	`´štk
("[cheÚ] A»¨:%d , cl_¡¬t,’d : %d/%d, block s¹,’d : %d/%d \n", 
¬—
, 
þ_¡¬t
, 
þ_’d
, 
block_¡¬t
, 
block_’d
);

401 if((
block_pos
 % 
BLOCK_IN_PAGE
) != BLOCK_IN_PAGE-1 )

402 
block_pos
 = block_po + (
BLOCK_IN_PAGE
 - 1 - (block_pos % BLOCK_IN_PAGE));

404 
	`´štk
("[cheÚ] block_po : %u \n", 
block_pos
 );

408  
block_pos
 + 1 <ð
block_’d
 )

411 
´ev_bh
 = 
	`sb_b»ad
(
sb
, 
block_pos
);

412 
Ãxt_bh
 = 
	`sb_b»ad
(
sb
, 
block_pos
+1);

414 
´ev_d©a
 = (*)
´ev_bh
->
b_d©a
;

415 
Ãxt_d©a
 = (*)
Ãxt_bh
->
b_d©a
;

417 
	`´štk
("[cheÚ] Now s—rchšg... %uh block,…»v_Ï¡ : %u,‚ext_fœ¡ : %u \n",
block_pos
, 
´ev_d©a
[
CLUSTER_IN_BLOCK
-1], 
Ãxt_d©a
[0]);

420 if((
´ev_d©a
[
CLUSTER_IN_BLOCK
-1] !ð0 &&…»v_d©a[CLUSTER_IN_BLOCK-1] =ð0x0fffffffè&& 
Ãxt_d©a
[0] == 0){

421 
	`´štk
("[cheÚ] Fšd clu¡”!†a¡ block : %d\n", 
block_pos
);

423 *
´ev
 = (
block_pos
 - 
çt_block
 + 1è* 
CLUSTER_IN_BLOCK
 - 1;

425 
i
=
BLOCK_IN_PAGE
; i>=0; i--){

426 
j
=
CLUSTER_IN_BLOCK
 ; j>=0; j--){

427 if(
´ev_d©a
[
j
] == 0x0fffffff){

430 
Ãw_Ãxt
 = 
block_pos
 - 
çt_block
;

431 
Ãw_Ãxt
 =‚ew_Ãxˆ* 
CLUSTER_IN_BLOCK
 ;

432 
Ãw_Ãxt
 =‚ew_Ãxˆ+ 
j
 + 1;

434 *
Ãxt
 = 
Ãw_Ãxt
;

436 
	`´štk
("[cheÚ] Com¶‘fšd :‚exˆ%u,…»v %u \n", *
Ãxt
, *
´ev
);

438 
	`b»l£
(
´ev_bh
);

439 
	`b»l£
(
Ãxt_bh
);

444 
block_pos
--;

445 
	`b»l£
(
´ev_bh
);

446 
´ev_bh
 = 
	`sb_b»ad
(
sb
, 
block_pos
);

447 
´ev_d©a
 = (*)
´ev_bh
->
b_d©a
;

450 
block_pos
 +ð
BLOCK_IN_PAGE
 ;

455 
block_pos
+=
BLOCK_IN_PAGE
 ;

456 
	`b»l£
(
´ev_bh
);

457 
	`b»l£
(
Ãxt_bh
);

460 
	`´štk
("[cheon] Error, Can't find valid value!! \n");

463 
	}
}

464 
	$sbi_upd©e_w™h_´—Îoc
Ð
šode
 *šode, 
Ãw_Ãxt
, 
Ãw_´ev
, 
num_´e_®loc
, 
Ãxt
, 
¬—
 )

466 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

467 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

472 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
Ãxt
;

473 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 
Ãxt
;

474 
šode
->
i_blocks
 = 
num_´e_®loc
 << (
sbi
->
þu¡”_b™s
 - 9);

480 
sbi
->
bx_ä“_þu¡”s
[
¬—
] -ð
num_´e_®loc
;

481 
sbi
->
ä“_þu¡”s
 -ð
num_´e_®loc
;

484 ifÐ
Ãw_Ãxt
 + (
num_´e_®loc
 - 1è> 
sbi
->
bx_’d_þu¡”
[
¬—
] )

485 
sbi
->
bx_Ãxt_¡¬t
[
¬—
] = sbi->
bx_¡¬t_þu¡”
[‡rea ];

487 
sbi
->
bx_Ãxt_¡¬t
[
¬—
] = 
Ãw_Ãxt
;

489 ifÐ
Ãw_´ev
 !ð
NULL
 )

490 
sbi
->
bx_´ev_ä“
[
¬—
] = 
Ãw_´ev
;

491 
	}
}

493 
	$check_¬—_lim™
Ð
su³r_block
 *
sb
, 
¡¬t
, 
Ãed_to_®loc
, 
¬—
 )

495 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

496 
two_äag
 = -1;

497 
couÁ
 =0;

498 
i
;

500 
num_of_·ge
 = 
Ãed_to_®loc
 / 
CLUSTER_IN_PAGE
;

501 
·ge_off£t
 = 
Ãed_to_®loc
 % 
CLUSTER_IN_PAGE
;

504 if(
¡¬t
 + 
Ãed_to_®loc
 > 
sbi
->
bx_’d_þu¡”
[
¬—
])

506 
two_äag
 = 0;

508 if(
·ge_off£t
 == 0)

509 
couÁ
 = 
num_of_·ge
;

511 
couÁ
 = 
num_of_·ge
+1;

513 
i
=1; i<=
couÁ
; i++){

515 ifÐÐ(
¡¬t
 ) + (
i
 * 
CLUSTER_IN_PAGE
)è<ð
sbi
->
bx_’d_þu¡”
[
¬—
])

516 
two_äag
++;

522  
two_äag
;

523 
	}
}

525 
	$fžl_·ge_ªd_»pos_¡¬t
Ð
su³r_block
 *
sb
, 
two_äag
, *
chaš
, **
d©a
, 
Ãed_to_®loc
, 
¬—
 )

527 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

528 
‹mp_¡¬t
=0;

529 
i
,
j
;

530 
·ge_num
 = 0;

531 
num_of_·ge
 = 
Ãed_to_®loc
 / 
CLUSTER_IN_PAGE
;

533 
j
=0; j<
num_of_·ge
; j++)

535 if(
j
==
two_äag
)

538 *
chaš
 = 
sbi
->
bx_¡¬t_þu¡”
[
¬—
];

539 
‹mp_¡¬t
 = *
chaš
 = *chaš + ( 
CLUSTER_IN_PAGE
 - ( *chain % CLUSTER_IN_PAGE ) );

541 if(
·ge_num
 != 0)

542 
d©a
[
·ge_num
-1][
CLUSTER_IN_PAGE
 -1] = *
chaš
;

544 (*
chaš
)++;

547 
i
=0; i<
CLUSTER_IN_PAGE
; i++)

549 
d©a
[
·ge_num
][
i
] = *
chaš
;

550 (*
chaš
)++;

554 
·ge_num
++;

557  
‹mp_¡¬t
;

558 
	}
}

561 
	$Ý–_çt_mœrÜ_bhs
(
su³r_block
 *
sb
, 
bufãr_h—d
 **
bhs
,

562 
Ä_bhs
)

564 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

565 
bufãr_h—d
 *
c_bh
;

566 
”r
, 
n
, 
cÝy
;

568 
”r
 = 0;

569 
cÝy
 = 1; cÝy < 
sbi
->
çts
; copy++) {

570 
£ùÜ_t
 
backup_çt
 = 
sbi
->
çt_Ëngth
 * 
cÝy
;

572 
n
 = 0;‚ < 
Ä_bhs
;‚++) {

573 
c_bh
 = 
	`sb_g‘blk
(
sb
, 
backup_çt
 + 
bhs
[
n
]->
b_blockÄ
);

574 ià(!
c_bh
) {

575 
”r
 = -
ENOMEM
;

576 
”rÜ
;

578 
	`memýy
(
c_bh
->
b_d©a
, 
bhs
[
n
]->b_d©a, 
sb
->
s_blocksize
);

579 
	`£t_bufãr_u±od©e
(
c_bh
);

580 
	`m¬k_bufãr_dœty_šode
(
c_bh
, 
sbi
->
çt_šode
);

581 ià(
sb
->
s_æags
 & 
MS_SYNCHRONOUS
)

582 
”r
 = 
	`sync_dœty_bufãr
(
c_bh
);

583 
	`b»l£
(
c_bh
);

584 ià(
”r
)

585 
”rÜ
;

588 
”rÜ
:

589  
”r
;

590 
	}
}

593 
	$çt_bË_upd©e
Ð
su³r_block
 *
sb
, 
¡¬t
, 
two_äag
, 
·ge_num
, 
‹mp_¡¬t
, **
d©a
 )

595 
”r
;

596 
çt_block_pos
 = 
çt_block
 + 
¡¬t
 / 
CLUSTER_IN_BLOCK
;

597 
num_buf
=0, 
i
=0, 
j
=0;

598 
bufãr_h—d
 *
bh
[300];

602  
i
=0; i<
·ge_num
; i++ )

604 if(
i
 =ð
two_äag
)

608 
çt_block_pos
 = 
çt_block
 + 
‹mp_¡¬t
 / 
CLUSTER_IN_BLOCK
 ;

611  
j
=0 ; j < 
BLOCK_IN_PAGE
 ; j++ )

614 
bh
[
num_buf
] = 
	`sb_b»ad
(
sb
, 
çt_block_pos
);

615 
	`memýy
Ð
bh
[
num_buf
]->
b_d©a
 , 
d©a
[
i
] + ( 
j
 * 
CLUSTER_IN_BLOCK
 ), 512 );

617 
	`m¬k_bufãr_dœty
Ð
bh
[ 
num_buf
 ] );

619 
num_buf
++;

620 
çt_block_pos
++;

627 
	`çt_sync_bhs
(
bh
, 
num_buf
);

628 
	`Ý–_çt_mœrÜ_bhs
(
sb
,
bh
,
num_buf
);

630 
i
=0;i<
num_buf
;i++)

631 
	`b»l£
Ð
bh
[
i
] );

634  
i
 = 0 ; i < 
·ge_num
 ; i++)

635 
	`kä“
(
d©a
[
i
]);

636 
	}
}

641 if(
	g·ge_off£t
 != 0)

643 
´štk
("[cheon]…age_offset != 0, Fill†ast Page \n");

644 if(
	gtwo_äag
 =ð0 && 
num_of_·ge
==0){

646 
chaš
 = 
sbi
->
bx_¡¬t_þu¡”
[
¬—
]+1;

648 
	gi
=0; i<
	g·ge_off£t
; i++){

649 
	gd©a
[
·ge_num
][
i
] = 
chaš
;

650 
	gchaš
++;

651 
	gÃed_to_®loc
--;

652 
	g®loÿ‹d
++;

654 
	gd©a
[
·ge_num
][
·ge_off£t
-1] = 
FAT_ENT_EOF
;

656 *
	gÃw_Ãxt
 = 
chaš
-1;

658 if(
	gÃed_to_®loc
 != 0)

659 
´štk
("[cheon] Allocation Failed, some Error! \n");

661 
	gi
=
·ge_off£t
; i<
	gCLUSTER_IN_PAGE
; i++){

662 
	gd©a
[
·ge_num
][
i
] = 
chaš
;

663 
	gchaš
++;

665 if(
	gchaš
 >ð
sbi
->
bx_’d_þu¡”
[
¬—
]){

667 
d©a
[
·ge_num
][
CLUSTER_IN_PAGE
-1] = 
sbi
->
bx_¡¬t_þu¡”
[
¬—
];

669 
	g·ge_num
++;

673 *
	gÃw_Ãxt
 = 
chaš
-1;

679 
	$´eAÎoc
Ð
šode
 *šode, 
¡¬t
, 
’d
, 
·_þu¡”_num
, 
¬—
 )

681 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

682 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

683 
bufãr_h—d
 *
bh
[300];

685 
i
=0, 
j
=0;

686 
þu¡”
 = 
¡¬t
 + 1;

687 
num_of_·ge
 = 
·_þu¡”_num
 / 
CLUSTER_IN_PAGE
;

688 
·ge_off£t
 = 
·_þu¡”_num
 % 
CLUSTER_IN_PAGE
;

689 
p_út
 = 0, 
num_buf
 = 0, 
út
=0;

692 *
d©a
;

693 
çt_block_pos
 = 
çt_block
 + 
¡¬t
 / 
CLUSTER_IN_BLOCK
;

700 
	`´štk
("[cheÚ] f©_block_po : %u \n", 
çt_block_pos
 );

708 
d©a
 = ( * )
	`km®loc
Ð(
’d
-
¡¬t
+1è* (è, 
GFP_KERNEL
 );

711 
p_út
=0;…_út<
num_of_·ge
;…_cnt++){

712 
i
=0; i<
CLUSTER_IN_PAGE
; i++){

713 
d©a
[ 
p_út
 ][
i
] = 
þu¡”
;

715 
þu¡”
++;

720  
út
 = 
þu¡”
 ; cÁ <ð(
’d
+1) ; cnt++ )

722 
d©a
[
i
++] = 
út
;

730 
	`´štk
("[cheÚ] d©¨¡¬ˆ’d : %d %d \n", 
d©a
[0], d©a[
’d
-
¡¬t
] );

736 
d©a
[ 
’d
-
¡¬t
] = 
FAT_ENT_EOF
;

743 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
¡¬t
;

744 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 
¡¬t
;

745 
šode
->
i_blocks
 = 
·_þu¡”_num
 << (
sbi
->
þu¡”_b™s
 - 9);

748 
sbi
->
bx_ä“_þu¡”s
[
¬—
] -ð
·_þu¡”_num
;

749 
sbi
->
ä“_þu¡”s
 -ð
·_þu¡”_num
;

752 
sbi
->
bx_Ãxt_¡¬t
[
¬—
] = 
’d
 + 1;

753 
sbi
->
bx_´ev_ä“
[
¬—
] = 
’d
;

757  
i
=0; i<
num_of_·ge
; i++ ){

758  
j
=0 ; j < 
BLOCK_IN_PAGE
 ; j++ ){

760 
bh
[
num_buf
] = 
	`sb_b»ad
(
sb
, 
çt_block_pos
);

761 
	`memýy
Ð
bh
[
num_buf
]->
b_d©a
 , 
d©a
[
i
] + ( 
j
 * 
CLUSTER_IN_BLOCK
 ), 512 );

762 
	`m¬k_bufãr_dœty
Ð
bh
[ 
num_buf
 ] );

764 
num_buf
++;

765 
çt_block_pos
++;

769  
i
=0 ; i < (
’d
-
¡¬t
+1)/128 ; i++ )

771 
bh
[
num_buf
] = 
	`sb_b»ad
(
sb
, 
çt_block_pos
);

772 
	`memýy
Ð
bh
[
num_buf
]->
b_d©a
 , 
d©a
 + ( 128 * 
i
 ), 512 );

773 
	`m¬k_bufãr_dœty
Ð
bh
[ 
num_buf
 ] );

775 
num_buf
++;

776 
çt_block_pos
++;

780 
	`çt_sync_bhs
(
bh
, 
num_buf
);

781 
	`Ý–_çt_mœrÜ_bhs
(
sb
,
bh
,
num_buf
);

783 
i
=0;i<
num_buf
;i++)

784 
	`b»l£
Ð
bh
[
i
] );

789 
	`kä“
(
d©a
);

794 
	}
}

800 * 
	gÃw_´ev
, 
	g®loÿ‹d
, 
	gÃed_to_®loc
, 
	g¬—
)

801 
´eAÎoc
Ð
šode
 *šode, *
Ãxt
, 
´ev
, * 
Ãw_Ãxt
, \

802 * 
Ãw_´ev
, 
®loÿ‹d
, 
Ãed_to_®loc
, 
¬—
)

804 
su³r_block
 *
	gsb
 = 
šode
->
i_sb
;

805 
msdos_sb_šfo
 *
	gsbi
 = 
MSDOS_SB
(
sb
);

807 
	gi
, 
	gj
, 
	g·ge_num
 = 0;

808 
	gtwo_äag
 = -1, 
	gcouÁ
 = 0, 
	gnum_buf
 = 0;

810 
	gæags
;

812 *
	gd©a
[100];

813 
	g¡¬t
 = 
´ev
 + 1;

814 
	gchaš
 = 
¡¬t
 + 1;

815 
	g‹mp_¡¬t
 = 0;

817 
	gnum_of_·ge
 = 
Ãed_to_®loc
 / 
CLUSTER_IN_PAGE
 ;

818 
	g·ge_off£t
 = 
Ãed_to_®loc
 % 
CLUSTER_IN_PAGE
 ;

820 
bufãr_h—d
 *
	gbh
[300];

821 
	gnum_´e_®loc
 = 0;

822 
	gçt_block_pos
 = 
çt_block
 + 
¡¬t
 / 
CLUSTER_IN_BLOCK
 ;

824 
´štk
("[cheÚ] f©_block_po : %u \n", 
çt_block_pos
 );

829 
	gnum_´e_®loc
 = ( 
sbi
->
bx_´e_size
[ 
¬—
 ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

831 
	gi
=0; i< 
	gnum_of_·ge
; i++)

832 
	gd©a
[
i
] = ( *)
km®loc
((
SD_PAGE_SIZE
 * 1024),
GFP_KERNEL
);

835 
	gtwo_äag
 = 
check_¬—_lim™
Ð
sb
, 
´ev
+1, 
Ãed_to_®loc
, 
¬—
 );

837 
	g‹mp_¡¬t
 = 
fžl_·ge_ªd_»pos_¡¬t
Ð
sb
, 
two_äag
, &
chaš
, 
d©a
, 
Ãed_to_®loc
, 
¬—
 );

839 
	g·ge_num
 = 
num_of_·ge
;

840 
	gÃed_to_®loc
 -ð(
chaš
 - 1 - 
¡¬t
);

841 
	g®loÿ‹d
 +ð(
chaš
 - 1 - 
¡¬t
);

845 *
	gÃw_Ãxt
 = 
chaš
-1;

846 *
	gÃw_´ev
 = 
chaš
 -2;

847 *
	gÃxt
 = 
d©a
[0][0] - 1;

850 
´štk
("[cheÚ] index Fœ¡ %u, index La¡ : %u\n", 
d©a
[0][0] - 1, d©a[ 
num_of_·ge
 -1 ][1023] -1 );

852 
	gd©a
[
·ge_num
-1][1023] = 
FAT_ENT_EOF
;

854 
sbi_upd©e_w™h_´—Îoc
Ð
šode
, *
Ãw_Ãxt
, *
Ãw_´ev
, 
num_´e_®loc
, *
Ãxt
, 
¬—
 );

855 
çt_bË_upd©e
Ð
sb
, 
¡¬t
, 
two_äag
, 
·ge_num
, 
‹mp_¡¬t
, 
d©a
 );

871 if((
	gsbi
->
	gçt_¡¬t
 % 8) != 0)

873 
adju¡
 = 
sbi
->
çt_¡¬t
 % 
BLOCK_IN_PAGE
 ;

874 
	gÃxt
 = 
Ãxt
 - (
adju¡
 * 
CLUSTER_IN_BLOCK
 );

875 
	g´ev
 = 
Ãxt
 - 1;

876 if(
	gÃxt
 < 
	gsbi
->
	gbx_¡¬t_þu¡”
[
¬—
]) {

877 
	gÃxt
 = 
Ãxt
 + 
CLUSTER_IN_PAGE
 ;

878 
	g´ev
 = 
Ãxt
 -1;

883 
šlše
 
	$®ign_check
Ð
msdos_sb_šfo
 *
sbi
, 
Ãxt
, 
¬—
 )

886 ifÐ
Ãxt
 % 
CLUSTER_IN_PAGE
 == 0 );

888 
Ãxt
 =‚exˆ+ (
CLUSTER_IN_PAGE
 - (next % CLUSTER_IN_PAGE ));

890 ifÐ(
sbi
->
çt_¡¬t
 % 8) != 0 )

892 
adju¡
 = 
sbi
->
çt_¡¬t
 % 
BLOCK_IN_PAGE
 ;

893 
Ãxt
 =‚exˆ- (
adju¡
 * 
CLUSTER_IN_BLOCK
 );

896 if(
Ãxt
 < 
sbi
->
bx_¡¬t_þu¡”
[
¬—
]) {

897 
Ãxt
 =‚exˆ+ 
CLUSTER_IN_PAGE
 ;

902  
Ãxt
;

903 
	}
}

905 
	$check_chaš_numb”_lim™
Ð
su³r_block
 *
sb
, 
two_äag
, 
num_´e_®loc
, **
d©a
, 
¬—
 )

907 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

908 
i
,
j
;

909 
·ge_num
 = 0;

910 
num_of_·ge
 = 
num_´e_®loc
 / 
CLUSTER_IN_PAGE
;

911 
chaš
;

914 
j
=0; j<
num_of_·ge
; j++)

916 if(
j
==
two_äag
)

918 
chaš
 = 
sbi
->
bx_¡¬t_þu¡”
[
¬—
];

919 if(
·ge_num
 != 0)

920 
d©a
[
·ge_num
-1][
CLUSTER_IN_PAGE
 -1] = 
chaš
;

921 
chaš
++;

923 
i
=0; i<
CLUSTER_IN_PAGE
; i++)

925 
d©a
[
·ge_num
][
i
] = 
chaš
;

926 
chaš
++;

928 
·ge_num
++;

931  
·ge_num
;

932 
	}
}

935 
	$çt_hªdË_þu¡”
Ð
šode
 *šode, 
mode
 )

937 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

938 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

939 
d’Œy
 *d’Œy = 
NULL
;

940 
PA_un™_t
 *
pun™
 = 
NULL
;

941 
PA
 *
·
 = 
NULL
;

943 
num_´e_®loc
;

945 
”r
 = 0, 
þu¡”
 = 0, 
¬—
 = 0, 
rs
;

946 
un™_num
 = 0;

947 
út
 = 0;

949 
msdos_šode_šfo
 *
ms_i
;

950 
hli¡_h—d
 *
h—d
ð
sbi
->
šode_hashbË
;

953 
	`g‘_¬—_numb”
Ð&
¬—
, 
šode
 );

954 
num_´e_®loc
 = ( 
sbi
->
bx_´e_size
[ 
¬—
 ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

956 ifÐ
¬—
 =ð
BB_ETC
 || 
sbi
->
çt_Üigš®_æag
 =ð
ON
 )

957 
NORMAL_ALLOC
;

958 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

959 ifÐ
d’Œy
 =ð
NULL
 || 
	`¡r¡r
Ðd’Œy->
d_Çme
.
Çme
, "mp4" ) == NULL )

960 
NORMAL_ALLOC
;

963 ifÐ
	`MSDOS_I
Ð
šode
 )->
´e_couÁ
 < 
num_´e_®loc
)

965 
	`MSDOS_I
(
šode
)->
´e_couÁ
++;

970 
	`´štk
("[cheon] PA sizeƒxceeded \n");

971  -
EIO
;

981 ifÐ
	`MSDOS_I
(
šode
)->
´e_®loûd
 =ð
ON
 )

987 
	`mu‹x_lock
(&
sbi
->
çt_lock
);

989 
·
 = 
sbi
->
·»a_PA
[ 
¬—
 ];

991 
pun™
 = 
·
->
·_un™
;

992 
un™_num
 = 
·
->
·_num
;

994 
	`MSDOS_I
(
šode
)->
´e_®loûd
 = 
ON
;

998 ifÐ
út
 >ð
un™_num
 ){

999 
	`´štk
("[cheon] There is‚o PA Unit \n");

1000 
	`MSDOS_I
(
šode
)->
´e_®loûd
 = 
OFF
;

1003 
	`show_the_¡©us_un™_æag
Ð
sb
,
¬—
 );

1004 
”r
 = -
ENOSPC
;

1008 ifÐ
pun™
[ 
·
->
cur_·_út
 ].
æag
 =ð
FREE
 ){

1010 
pun™
[ 
·
->
cur_·_út
 ].
æag
 = 
USED
;

1011 
rs
 = 
	`´eAÎoc
Ð
šode
, 
pun™
[ 
·
->
cur_·_út
 ].
¡¬t
,…un™[…a->cur_·_úˆ].
’d
,…a->
·_þu¡”_num
, 
¬—
 );

1012 ifÐ!
rs
 ){

1020 
·
->
cur_·_út
++;

1021 
út
++;

1022 ifÐ
·
->
cur_·_út
 >ð
un™_num
 )…a->cur_pa_cnt = 0;

1029 } 
·
->
cur_·_út
 < 
un™_num
 );

1032 
	`mu‹x_uÆock
(&
sbi
->
çt_lock
);

1034  
”r
;

1036 
NORMAL_ALLOC
:

1041 
”r
 = 
	`çt_®loc_þu¡”s
Ð
šode
, &
þu¡”
, 1 );

1042 ià(
”r
)

1043  
”r
;

1046 
”r
 = 
	`çt_chaš_add
(
šode
, 
þu¡”
, 1);

1047 ià(
”r
)

1049 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_chain_addƒrror !!!, fat_free_clusters\n");

1050 
	`çt_ä“_þu¡”s
(
šode
, 
þu¡”
);

1052  
”r
;

1053 
	}
}

1060 
	$çt_hªdË_þu¡”
Ð
šode
 *šode, 
mode
 )

1062 
”r
 = 0, 
þu¡”
 = 0, 
¬—
 = 0, 
two_äag
 = -1, 
i
;

1063 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

1064 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1065 
d’Œy
 *d’Œy = 
NULL
;

1067 
num_´e_®loc
 = 0;

1069 
Ãxt
 = 0,

1070 
´ev
 = 0,

1071 
Ãw_Ãxt
 = 0,

1072 
Ãw_´ev
 = 0, 
·ge_num
;

1073 
®loÿ‹d
 = 0,

1074 
Ãed_to_®loc
 = 0, *
d©a
[100];

1075 
æags
;

1078 
	`g‘_¬—_numb”
Ð&
¬—
, 
šode
 );

1079 ifÐ
¬—
 =ð
BB_ETC
 || 
sbi
->
çt_Üigš®_æag
 =ð
ON
 )

1080 
NORMAL_ALLOC
;

1081 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

1082 ifÐ
d’Œy
 =ð
NULL
 || 
	`¡r¡r
Ðd’Œy->
d_Çme
.
Çme
, "mp4" ) == NULL )

1083 
NORMAL_ALLOC
;

1086 ifÐ
	`MSDOS_I
(
šode
)->
´e_®loûd
 =ð
ON
 )

1089 
	`mu‹x_lock
(&
sbi
->
çt_lock
);

1091 
num_´e_®loc
 = ( 
sbi
->
bx_´e_size
[ 
¬—
 ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

1092 ifÐ(
num_´e_®loc
 << 1è> 
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ] )

1094 
	`´štk
("[cheon] ===============Area Limit Check \n");

1095 
	`mu‹x_uÆock
(&
sbi
->
çt_lock
);

1096  -
ENOSPC
;

1100 
	`MSDOS_I
(
šode
)->
´e_®loûd
 = 
ON
;

1105 ifÐ
sbi
->
bx_Ãxt_¡¬t
[
¬—
] == -1 )

1110 ifÐ(
sbi
->
bx_ä“_þu¡”s
[ 
¬—
 ] + 
num_´e_®loc
è> (sbi->
bx_’d_þu¡”
[‡»¨] - sbi->
bx_¡¬t_þu¡”
[‡rea ] + 1 ) )

1112 
´ev
 = 
sbi
->
bx_´ev_ä“
[ 
¬—
 ];

1113 
Ãxt
 = 
´ev
+1;

1115 
®loÿ‹d
 = 0;

1116 
Ãed_to_®loc
 = 
num_´e_®loc
;

1118 
Ãxt
 = 
	`®ign_check
Ð
sbi
,‚ext, 
¬—
 );

1119 
´ev
 = 
Ãxt
 - 1;

1126 
	`fšd_v®id_Ãw_Ãxt
Ð
šode
, 
¬—
, &
Ãxt
, &
´ev
 );

1128 
®loÿ‹d
 = 
´ev
 - 
Ãxt
 + 1;

1129 
Ãed_to_®loc
 = 
num_´e_®loc
 - 
®loÿ‹d
;

1132 
”r
 = 
	`´eAÎoc
Ð
šode
, &
Ãxt
, 
´ev
, &
Ãw_Ãxt
, &
Ãw_´ev
, 
®loÿ‹d
, 
Ãed_to_®loc
, 
¬—
);

1135 
two_äag
 = 
	`check_¬—_lim™
Ð
sb
, 
´ev
+1, 
Ãed_to_®loc
, 
¬—
 );

1137 
‹mp_¡¬t
 = 
	`fžl_·ge_ªd_»pos_¡¬t
Ð
sb
, 
two_äag
, &
chaš
, 
d©a
, 
Ãed_to_®loc
, 
¬—
 );

1143 
Ãxt
 = 
sbi
->
bx_Ãxt_¡¬t
[
¬—
];

1144 
´ev
 = 
sbi
->
bx_´ev_ä“
[
¬—
];

1145 
®loÿ‹d
 = 
´ev
 - 
Ãxt
 + 1;

1146 
Ãed_to_®loc
 = 
num_´e_®loc
 - 
®loÿ‹d
;

1148 if(
Ãed_to_®loc
 < 0){

1149 
	`´štk
("[cheon]‚eed_to_alloc < 0\n");

1150 
	`sbi_upd©e_w™h_´—Îoc
Ð
šode
, (
sbi
->
bx_Ãxt_¡¬t
[
¬—
]+
num_´e_®loc
-1), 
NULL
,‚um_´e_®loc, 
Ãxt
,‡rea );

1154 
”r
 = 
	`´eAÎoc
Ð
šode
, &
Ãxt
, 
´ev
, &
Ãw_Ãxt
, &
Ãw_´ev
, 
®loÿ‹d
, 
Ãed_to_®loc
, 
¬—
);

1159 
	`mu‹x_uÆock
(&
sbi
->
çt_lock
);

1161  
”r
;

1163 
NORMAL_ALLOC
:

1166 
	`´štk
("[cheon] NORMAL ALLOC\n");

1168 
”r
 = 
	`çt_®loc_þu¡”s
Ð
šode
, &
þu¡”
, 1 );

1169 ià(
”r
)

1170  
”r
;

1173 
”r
 = 
	`çt_chaš_add
(
šode
, 
þu¡”
, 1);

1174 ià(
”r
)

1176 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_chain_addƒrror !!!, fat_free_clusters\n");

1177 
	`çt_ä“_þu¡”s
(
šode
, 
þu¡”
);

1179  
”r
;

1180 
	}
}

1183 
	$çt_add_þu¡”
(
šode
 *inode)

1185 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

1186 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

1187 
d’Œy
 *d’Œy = 
NULL
;

1189 
v®
;

1190 
time
;

1194 
”r
, 
þu¡”
;

1199 ifÐ
šode
->
i_d’Œy
.
fœ¡
 =ð
NULL
 )

1201 
	`´štk
("[cheon] i_dentry.next : NULL \n");

1205 ifÐ
sbi
->
i_šo
 == -1 )

1207 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

1208 
sbi
->
i_šo
 = 
šode
->i_ino;

1209 
sbi
->
fže_Çme
 = ( * ) 
d’Œy
->
d_Çme
.
Çme
;

1211 ifÐ
sbi
->
i_šo
 !ð
šode
->i_ino )

1213 
	`´štk
("[cheÚ -im] Fž: %s,im: %u, couÁ : %À\n", 
sbi
->
fže_Çme
, sbi->
time
, sbi->
couÁ
 );

1215 
sbi
->
i_šo
 = 
šode
->i_ino;

1216 
sbi
->
couÁ
 = 0;

1217 
sbi
->
time
 = 0;

1219 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

1220 
sbi
->
fže_Çme
 = ( * ) 
d’Œy
->
d_Çme
.
Çme
;

1223 
sbi
->
couÁ
++;

1228 
v®
 = 
	`çt_hªdË_þu¡”
Ð
šode
, 
FAT_ALLOC_CLUSTER
 );

1232 
	`do_g‘timeofday
Ð&
Ãw_ts
 );

1234 ifÐ
Ãw_ts
.
tv_£c
 =ð
Þd_ts
.
tv_n£c
 )

1235 
time
 = 
Ãw_ts
.
tv_u£c
 - 
Þd_ts
.tv_usec;

1237 
time
 = 1000000 + 
Ãw_ts
.
tv_u£c
 - 
Þd_ts
.tv_usec;

1239 
sbi
->
time
 +=ime;

1241  
v®
;

1246 
”r
 = 
	`çt_®loc_þu¡”s
(
šode
, &
þu¡”
, 1);

1247 ià(
”r
)

1248  
”r
;

1256 
”r
 = 
	`çt_chaš_add
(
šode
, 
þu¡”
, 1);

1257 ià(
”r
)

1259 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_chain_addƒrror !!!, fat_free_clusters\n");

1260 
	`çt_ä“_þu¡”s
(
šode
, 
þu¡”
);

1262  
”r
;

1264 
	}
}

1265 
	$check_·ge_®ign
Ð*
þu¡”
, 
max_þu¡”
, 
çt_¡¬t
 )

1269 
adju¡
 = 
çt_¡¬t
 % 
BLOCK_IN_PAGE
;

1270 
off£t
 = (*
þu¡”
 + 
adju¡
 * 
CLUSTER_IN_BLOCK
è% 
CLUSTER_IN_PAGE
;

1272 *
þu¡”
 = *þu¡” + (
CLUSTER_IN_PAGE
 - 
off£t
);

1274 if(*
þu¡”
 >ð
max_þu¡”
)

1275 *
þu¡”
 = *þu¡” - 
CLUSTER_IN_PAGE
;

1277 
	}
}

1278 
	$çt_ju¡_š™_su³r
(
su³r_block
 *
sb
)

1280 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1282 
sbi
->
bx_ä“_v®id
 = -1;

1284 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL
 ] = 10;

1285 
sbi
->
bx_¬—_¿tio
[ 
BB_NORMAL_EVENT
 ] = 10;

1286 
sbi
->
bx_¬—_¿tio
[ 
BB_PARKING
 ] = 10;

1287 
sbi
->
bx_¬—_¿tio
[ 
BB_MANUAL
 ] = 10;

1288 
sbi
->
bx_¬—_¿tio
[ 
BB_IMAGE
 ] = 10;

1289 
sbi
->
bx_¬—_¿tio
[ 
BB_ETC
 ] = 10;

1291 
sbi
->
bx_´e_size
[ 
BB_NORMAL
 ] = 20;

1292 
sbi
->
bx_´e_size
[ 
BB_NORMAL_EVENT
 ] = 20;

1293 
sbi
->
bx_´e_size
[ 
BB_PARKING
 ] = 20;

1294 
sbi
->
bx_´e_size
[ 
BB_MANUAL
 ] = 20;

1296 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_ETC
 ] = 
FAT_START_ENT
 + 2;

1297 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ] = 
FAT_START_ENT
 + 2 + 
COUNT_AREA_0
;

1298 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ] = 
FAT_START_ENT
 + 2 + 
COUNT_AREA_0
 + ( 
COUNT_AREA_1
 );

1299 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ] = 
FAT_START_ENT
 + 2 + 
COUNT_AREA_0
 + ( 
COUNT_AREA_1
 ) + 
COUNT_AREA_2
;

1300 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ] = 
FAT_START_ENT
 + 2 + 
COUNT_AREA_0
 + ( 
COUNT_AREA_1
 ) + 
COUNT_AREA_2
 + 
COUNT_AREA_3
;

1301 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ] = 
FAT_START_ENT
 + 2 + 
COUNT_AREA_0
 + ( 
COUNT_AREA_1
 ) + 
COUNT_AREA_2
 + 
COUNT_AREA_3
 + 
COUNT_AREA_4
;

1303 
sbi
->
bx_’d_þu¡”
[ 
BB_ETC
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ] - 1;

1304 
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ] - 1;

1305 
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL_EVENT
] = sbi->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ] - 1;

1306 
sbi
->
bx_’d_þu¡”
[ 
BB_PARKING
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ] - 1;

1307 
sbi
->
bx_’d_þu¡”
[ 
BB_MANUAL
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ] - 1;

1308 
sbi
->
bx_’d_þu¡”
[ 
BB_IMAGE
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_IMAGE ] + 
COUNT_AREA_5
 - 1;

1310 
sbi
->
bx_´ev_ä“
[ 
BB_ETC
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_ETC ];

1311 
sbi
->
bx_´ev_ä“
[ 
BB_NORMAL
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_NORMAL ];

1312 
sbi
->
bx_´ev_ä“
[ 
BB_NORMAL_EVENT
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_NORMAL_EVENT ];

1313 
sbi
->
bx_´ev_ä“
[ 
BB_PARKING
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_PARKING ];

1314 
sbi
->
bx_´ev_ä“
[ 
BB_MANUAL
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_MANUAL ];

1315 
sbi
->
bx_´ev_ä“
[ 
BB_IMAGE
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_IMAGE ];

1317 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_ETC
 ] = -1;

1318 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_NORMAL
 ] = -1;

1319 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_NORMAL_EVENT
 ] = -1;

1320 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_PARKING
 ] = -1;

1321 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_MANUAL
 ] = -1;

1322 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_IMAGE
 ] = -1;

1324 
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ] = 0;

1325 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL
 ] = 0;

1326 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL_EVENT
 ] = 0;

1327 
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ] = 0;

1328 
sbi
->
bx_ä“_þu¡”s
[ 
BB_MANUAL
 ] = 0;

1329 
sbi
->
bx_ä“_þu¡”s
[ 
BB_IMAGE
 ] = 0;

1332 
sbi
->
çt_Üigš®_æag
 = 
OFF
;

1333 
	`çt_couÁ_ä“_þu¡”s_fÜ_¬—
Ð
sb
 );

1336 
	}
}

1337 
EXPORT_SYMBOL_GPL
Ð
çt_ju¡_š™_su³r
 );

1340 
	$çt_upd©e_su³r
(
su³r_block
 *
sb
){

1341 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1350 
sbi
->
bx_ä“_v®id
 = -1;

1352 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_ETC
 ] = 
FAT_START_ENT
 + 2;

1353 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BX_ETC
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1356 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ] = sbi->bx_¡¬t_þu¡”[ 
BB_ETC
 ] + ( sbi->
max_þu¡”
 * sbi->
bx_¬—_¿tio
[ BB_ETC ] ) / 100;

1357 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1359 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ] = sbi->bx_¡¬t_þu¡”[ 
BB_NORMAL
 ] + ( sbi->
max_þu¡”
 * sbi->
bx_¬—_¿tio
[ BB_NORMAL ] ) / 100;

1360 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1362 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ] = sbi->bx_¡¬t_þu¡”[ 
BB_NORMAL_EVENT
 ] + ( sbi->
max_þu¡”
 * sbi->
bx_¬—_¿tio
[ BB_NORMAL_EVENT ] ) / 100;

1363 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1365 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ] = sbi->bx_¡¬t_þu¡”[ 
BB_PARKING
 ] + ( sbi->
max_þu¡”
 * sbi->
bx_¬—_¿tio
[ BB_PARKING ] ) / 100;

1366 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1368 
sbi
->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ] = sbi->bx_¡¬t_þu¡”[ 
BB_MANUAL
 ] + ( sbi->
max_þu¡”
 * sbi->
bx_¬—_¿tio
[ BB_MANUAL ] ) / 100;

1369 
	`check_·ge_®ign
Ð&
sbi
->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ], sbi->
max_þu¡”
, sbi->
çt_¡¬t
 );

1371 
sbi
->
bx_’d_þu¡”
[ 
BB_ETC
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_NORMAL
 ] - 1;

1372 
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_NORMAL_EVENT
 ] - 1;

1373 
sbi
->
bx_’d_þu¡”
[ 
BB_NORMAL_EVENT
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_PARKING
 ] - 1;

1374 
sbi
->
bx_’d_þu¡”
[ 
BB_PARKING
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_MANUAL
 ] - 1;

1375 
sbi
->
bx_’d_þu¡”
[ 
BB_MANUAL
 ] = sbi->
bx_¡¬t_þu¡”
[ 
BB_IMAGE
 ] - 1;

1376 
sbi
->
bx_’d_þu¡”
[ 
BB_IMAGE
 ] = sbi->
max_þu¡”
 - 1;

1379 
sbi
->
bx_´ev_ä“
[ 
BB_ETC
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_ETC ];

1380 
sbi
->
bx_´ev_ä“
[ 
BB_NORMAL
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_NORMAL ];

1381 
sbi
->
bx_´ev_ä“
[ 
BB_NORMAL_EVENT
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_NORMAL_EVENT ];

1382 
sbi
->
bx_´ev_ä“
[ 
BB_PARKING
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_PARKING ];

1383 
sbi
->
bx_´ev_ä“
[ 
BB_MANUAL
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_MANUAL ];

1384 
sbi
->
bx_´ev_ä“
[ 
BB_IMAGE
 ] = sbi->
bx_¡¬t_þu¡”
[ BB_IMAGE ];

1386 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_ETC
 ] = -1;

1387 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_NORMAL
 ] = -1;

1388 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_NORMAL_EVENT
 ] = -1;

1389 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_PARKING
 ] = -1;

1390 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_MANUAL
 ] = -1;

1391 
sbi
->
bx_Ãxt_¡¬t
[ 
BB_IMAGE
 ] = -1;

1393 
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ] = 0;

1394 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL
 ] = 0;

1395 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL_EVENT
 ] = 0;

1396 
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ] = 0;

1397 
sbi
->
bx_ä“_þu¡”s
[ 
BB_MANUAL
 ] = 0;

1398 
sbi
->
bx_ä“_þu¡”s
[ 
BB_IMAGE
 ] = 0;

1401 
sbi
->
çt_Üigš®_æag
 = 
OFF
;

1402 
	`çt_couÁ_ä“_þu¡”s_fÜ_¬—
Ð
sb
 );

1404 
i
;

1410 
	`´štk
("[cheon] Complete cluster calculation \n");

1411 
	`´štk
("[cheÚ] 1. [%2d%%] ETC [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d \n", 
sbi
->
bx_¬—_¿tio
[
BB_ETC
], sbi->
bx_¡¬t_þu¡”
[BB_ETC], sbi->
bx_’d_þu¡”
[BB_ETC],sbi->
bx_ä“_þu¡”s
[BB_ETC], \

1412 (
sbi
->
bx_ä“_þu¡”s
[
BB_ETC
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_ETC] - sbi->
bx_¡¬t_þu¡”
[BB_ETC] + 1 ), sbi->bx_ä“_þu¡”s[ BB_ETC ] * (sbi->
þu¡”_size
/1024) / 1024 );

1414 
	`´štk
("[cheÚ] 2. [%2d%%] NÜm® [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d\n", 
sbi
->
bx_¬—_¿tio
[
BB_NORMAL
], sbi->
bx_¡¬t_þu¡”
[BB_NORMAL], sbi->
bx_’d_þu¡”
[BB_NORMAL],sbi->
bx_ä“_þu¡”s
[BB_NORMAL], \

1415 (
sbi
->
bx_ä“_þu¡”s
[
BB_NORMAL
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_NORMAL]-sbi->
bx_¡¬t_þu¡”
[BB_NORMAL] + 1 ) , sbi->bx_ä“_þu¡”s[ BB_NORMAL ] * (sbi->
þu¡”_size
/1024) / 1024 );

1417 
	`´štk
("[cheÚ] 3. [%2d%%] Ev’t [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d \n", 
sbi
->
bx_¬—_¿tio
[
BB_NORMAL_EVENT
], sbi->
bx_¡¬t_þu¡”
[BB_NORMAL_EVENT], sbi->
bx_’d_þu¡”
[BB_NORMAL_EVENT],sbi->
bx_ä“_þu¡”s
[BB_NORMAL_EVENT], \

1418 (
sbi
->
bx_ä“_þu¡”s
[
BB_NORMAL_EVENT
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_NORMAL_EVENT]-sbi->
bx_¡¬t_þu¡”
[BB_NORMAL_EVENT] + 1 ) , sbi->bx_ä“_þu¡”s[ BB_NORMAL_EVENT ] * (sbi->
þu¡”_size
/1024) / 1024 );

1420 
	`´štk
("[cheÚ] 4. [%2d%%] P¬kšg [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d \n", 
sbi
->
bx_¬—_¿tio
[
BB_PARKING
], sbi->
bx_¡¬t_þu¡”
[BB_PARKING], sbi->
bx_’d_þu¡”
[BB_PARKING],sbi->
bx_ä“_þu¡”s
[BB_PARKING], \

1421 (
sbi
->
bx_ä“_þu¡”s
[
BB_PARKING
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_PARKING]-sbi->
bx_¡¬t_þu¡”
[ BB_PARKING ] + 1è, sbi->bx_ä“_þu¡”s[ BB_PARKING ] * (sbi->
þu¡”_size
/1024) / 1024 );

1423 
	`´štk
("[cheÚ] 5. [%2d%%] Mªu® [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d \n", 
sbi
->
bx_¬—_¿tio
[
BB_MANUAL
], sbi->
bx_¡¬t_þu¡”
[BB_MANUAL], sbi->
bx_’d_þu¡”
[BB_MANUAL],sbi->
bx_ä“_þu¡”s
[BB_MANUAL], \

1424 (
sbi
->
bx_ä“_þu¡”s
[
BB_MANUAL
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_MANUAL]-sbi->
bx_¡¬t_þu¡”
[BB_MANUAL] + 1è, sbi->bx_ä“_þu¡”s[ BB_MANUAL ] * (sbi->
þu¡”_size
/1024) / 1024 );

1426 
	`´štk
("[cheÚ] 6. [%2d%%] CÚfig [%6d ~%6d] / F»%6d(%3d%%è/ MB : %d \n", 
sbi
->
bx_¬—_¿tio
[
BB_IMAGE
], sbi->
bx_¡¬t_þu¡”
[BB_IMAGE], sbi->
bx_’d_þu¡”
[BB_IMAGE],sbi->
bx_ä“_þu¡”s
[BB_IMAGE], \

1427 (
sbi
->
bx_ä“_þu¡”s
[
BB_IMAGE
] * 100è/ (sbi->
bx_’d_þu¡”
[BB_IMAGE]-sbi->
bx_¡¬t_þu¡”
[BB_IMAGE] + 1è, sbi->bx_ä“_þu¡”s[ BB_IMAGE ] * (sbi->
þu¡”_size
/1024) / 1024 );

1431 
	`´štk
("[cheÚ] TÙ® SD_Siz: %u[KB] \n", (
sbi
->
max_þu¡”
-2è* (sbi->
þu¡”_size
 / 1024) );

1434 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_ETC] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ] );

1435 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_NORMAL] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL
 ] );

1436 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_NORMAL_EVENT] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL_EVENT
 ] );

1437 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_PARKING] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ] );

1438 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_PARKING] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_MANUAL
 ] );

1439 
	`´štk
("[cheÚ] sbi->ä“_þu¡”s[BB_IMAGE] : %d \n", 
sbi
->
bx_ä“_þu¡”s
[ 
BB_IMAGE
 ] );

1442 ifÐ
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ] =ð0 || sbi->bx_ä“_þu¡”s[ 
BB_NORMAL
 ] =ð0 || sbi->bx_ä“_þu¡”s[ 
BB_NORMAL_EVENT
 ] == 0 ||

1443 
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ] =ð0 || sbi->bx_ä“_þu¡”s[ 
BB_MANUAL
 ] =ð0 || sbi->bx_ä“_þu¡”s[ 
BB_IMAGE
 ] == 0 )

1445 
	`´štk
("[cheon] Any…art is full, Our…olicyurn into‡ original FAT \n");

1446 
sbi
->
çt_Üigš®_æag
 = 
ON
;

1451 
	}
}

1452 
EXPORT_SYMBOL_GPL
Ð
çt_upd©e_su³r
 );

1454 
šlše
 
	$__çt_g‘_block
(
šode
 *šode, 
£ùÜ_t
 
iblock
,

1455 *
max_blocks
,

1456 
bufãr_h—d
 *
bh_»suÉ
, 
ü—‹
)

1458 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

1459 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1460 
m­³d_blocks
;

1461 
£ùÜ_t
 
phys
;

1462 
”r
, 
off£t
;

1464 
”r
 = 
	`çt_bm­
(
šode
, 
iblock
, &
phys
, &
m­³d_blocks
, 
ü—‹
);

1465 ià(
”r
)

1466  
”r
; ià(
phys
è{ 
	`m­_bh
(
bh_»suÉ
, 
sb
,…hys); *
max_blocks
 = 
	`mš
(
m­³d_blocks
, *max_blocks);

1469 ià(!
ü—‹
)

1472 ià(
iblock
 !ð
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 >> 
sb
->
s_blocksize_b™s
) {

1473 
	`çt_fs_”rÜ
(
sb
, "corrupted file size (i_pos %lld, %lld)",

1474 
	`MSDOS_I
(
šode
)->
i_pos
, MSDOS_I(šode)->
mmu_´iv©e
);

1475  -
EIO
;

1478 
off£t
 = ()
iblock
 & (
sbi
->
£c_³r_þus
 - 1);

1479 ià(!
off£t
) {

1482 
”r
 = 
	`çt_add_þu¡”
(
šode
);

1483 ià(
”r
)

1484  
”r
;

1487 
m­³d_blocks
 = 
sbi
->
£c_³r_þus
 - 
off£t
;

1489 *
max_blocks
 = 
	`mš
(
m­³d_blocks
, *max_blocks);

1490 
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 +ð*
max_blocks
 << 
sb
->
s_blocksize_b™s
;

1492 
”r
 = 
	`çt_bm­
(
šode
, 
iblock
, &
phys
, &
m­³d_blocks
, 
ü—‹
);

1493 ià(
”r
)

1494  
”r
;

1496 
	`BUG_ON
(!
phys
);

1497 
	`BUG_ON
(*
max_blocks
 !ð
m­³d_blocks
);

1498 
	`£t_bufãr_Ãw
(
bh_»suÉ
);

1499 
	`m­_bh
(
bh_»suÉ
, 
sb
, 
phys
);

1502 
	}
}

1504 
	$çt_g‘_block
(
šode
 *šode, 
£ùÜ_t
 
iblock
,

1505 
bufãr_h—d
 *
bh_»suÉ
, 
ü—‹
)

1507 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

1508 
max_blocks
 = 
bh_»suÉ
->
b_size
 >> 
šode
->
i_blkb™s
;

1509 
”r
;

1513 
”r
 = 
	`__çt_g‘_block
(
šode
, 
iblock
, &
max_blocks
, 
bh_»suÉ
, 
ü—‹
);

1514 ià(
”r
)

1515  
”r
;

1516 
bh_»suÉ
->
b_size
 = 
max_blocks
 << 
sb
->
s_blocksize_b™s
;

1522 
	}
}

1524 
	$çt_wr™•age
(
·ge
 *·ge, 
wr™eback_cÚŒÞ
 *
wbc
)

1527  
	`block_wr™e_fuÎ_·ge
(
·ge
, 
çt_g‘_block
, 
wbc
);

1528 
	}
}

1530 
	$çt_wr™•ages
(
add»ss_¥aû
 *
m­pšg
,

1531 
wr™eback_cÚŒÞ
 *
wbc
)

1534  
	`m·ge_wr™•ages
(
m­pšg
, 
wbc
, 
çt_g‘_block
);

1535 
	}
}

1537 
	$çt_»ad·ge
(
fže
 *fže, 
·ge
 *page)

1540  
	`m·ge_»ad·ge
(
·ge
, 
çt_g‘_block
);

1541 
	}
}

1543 
	$çt_»ad·ges
(
fže
 *fže, 
add»ss_¥aû
 *
m­pšg
,

1544 
li¡_h—d
 *
·ges
, 
Ä_·ges
)

1547  
	`m·ge_»ad·ges
(
m­pšg
, 
·ges
, 
Ä_·ges
, 
çt_g‘_block
);

1548 
	}
}

1550 
	$çt_wr™e_çžed
(
add»ss_¥aû
 *
m­pšg
, 
loff_t
 
to
)

1552 
šode
 *šodð
m­pšg
->
ho¡
;

1554 ià(
to
 > 
šode
->
i_size
) {

1555 
	`Œunÿ‹_·geÿche
(
šode
, 
to
, inode->
i_size
);

1556 
	`çt_Œunÿ‹_blocks
(
šode
, inode->
i_size
);

1558 
	}
}

1560 
	$çt_wr™e_begš
(
fže
 *fže, 
add»ss_¥aû
 *
m­pšg
,

1561 
loff_t
 
pos
, 
Ën
, 
æags
,

1562 
·ge
 **
·g•
, **
fsd©a
)

1564 
”r
;

1567 *
·g•
 = 
NULL
;

1568 
”r
 = 
	`cÚt_wr™e_begš
(
fže
, 
m­pšg
, 
pos
, 
Ën
, 
æags
,

1569 
·g•
, 
fsd©a
, 
çt_g‘_block
,

1570 &
	`MSDOS_I
(
m­pšg
->
ho¡
)->
mmu_´iv©e
);

1571 ià(
”r
 < 0)

1574 
	`çt_wr™e_çžed
(
m­pšg
, 
pos
 + 
Ën
);

1576  
”r
;

1577 
	}
}

1579 
	$çt_wr™e_’d
(
fže
 *fže, 
add»ss_¥aû
 *
m­pšg
,

1580 
loff_t
 
pos
, 
Ën
, 
cÝ›d
,

1581 
·ge
 *
·g•
, *
fsd©a
)

1583 
šode
 *šodð
m­pšg
->
ho¡
;

1584 
”r
;

1585 
”r
 = 
	`g’”ic_wr™e_’d
(
fže
, 
m­pšg
, 
pos
, 
Ën
, 
cÝ›d
, 
·g•
, 
fsd©a
);

1586 ià(
”r
 < 
Ën
)

1587 
	`çt_wr™e_çžed
(
m­pšg
, 
pos
 + 
Ën
);

1588 ià(!(
”r
 < 0è&& !(
	`MSDOS_I
(
šode
)->
i_©Œs
 & 
ATTR_ARCH
)) {

1590 
šode
->
i_mtime
 = inode->
i_ùime
 = 
CURRENT_TIME_SEC
;

1591 
	`MSDOS_I
(
šode
)->
i_©Œs
 |ð
ATTR_ARCH
;

1592 
	`m¬k_šode_dœty
(
šode
);

1594  
”r
;

1595 
	}
}

1597 
ssize_t
 
	$çt_dœeù_IO
(
rw
, 
kiocb
 *
iocb
,

1598 cÚ¡ 
iovec
 *
iov
,

1599 
loff_t
 
off£t
, 
Ä_£gs
)

1601 
fže
 *fžð
iocb
->
ki_fžp
;

1602 
add»ss_¥aû
 *
m­pšg
 = 
fže
->
f_m­pšg
;

1603 
šode
 *šodð
m­pšg
->
ho¡
;

1604 
ssize_t
 
»t
;

1606 ià(
rw
 =ð
WRITE
) {

1616 
loff_t
 
size
 = 
off£t
 + 
	`iov_Ëngth
(
iov
, 
Ä_£gs
);

1617 ià(
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 < 
size
)

1625 
»t
 = 
	`blockdev_dœeù_IO
(
rw
, 
iocb
, 
šode
, 
iov
, 
off£t
, 
Ä_£gs
,

1626 
çt_g‘_block
);

1627 ià(
»t
 < 0 && (
rw
 & 
WRITE
))

1628 
	`çt_wr™e_çžed
(
m­pšg
, 
off£t
 + 
	`iov_Ëngth
(
iov
, 
Ä_£gs
));

1630  
»t
;

1631 
	}
}

1633 
£ùÜ_t
 
	$_çt_bm­
(
add»ss_¥aû
 *
m­pšg
, 
£ùÜ_t
 
block
)

1635 
£ùÜ_t
 
blockÄ
;

1638 
	`down_»ad
(&
	`MSDOS_I
(
m­pšg
->
ho¡
)->
Œunÿ‹_lock
);

1639 
blockÄ
 = 
	`g’”ic_block_bm­
(
m­pšg
, 
block
, 
çt_g‘_block
);

1640 
	`up_»ad
(&
	`MSDOS_I
(
m­pšg
->
ho¡
)->
Œunÿ‹_lock
);

1642  
blockÄ
;

1643 
	}
}

1645 cÚ¡ 
add»ss_¥aû_Ý”©iÚs
 
	gçt_aÝs
 = {

1646 .
»ad·ge
 = 
çt_»ad·ge
,

1647 .
	g»ad·ges
 = 
çt_»ad·ges
,

1648 .
	gwr™•age
 = 
çt_wr™•age
,

1649 .
	gwr™•ages
 = 
çt_wr™•ages
,

1650 .
	gwr™e_begš
 = 
çt_wr™e_begš
,

1651 .
	gwr™e_’d
 = 
çt_wr™e_’d
,

1652 .
	gdœeù_IO
 = 
çt_dœeù_IO
,

1653 .
	gbm­
 = 
_çt_bm­


1680 
	$çt_hash_š™
(
su³r_block
 *
sb
)

1682 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1683 
i
;

1685 
	`¥š_lock_š™
(&
sbi
->
šode_hash_lock
);

1686 
i
 = 0; i < 
FAT_HASH_SIZE
; i++)

1687 
	`INIT_HLIST_HEAD
(&
sbi
->
šode_hashbË
[
i
]);

1688 
	}
}

1690 
šlše
 
	$çt_hash
(
loff_t
 
i_pos
)

1692  
	`hash_32
(
i_pos
, 
FAT_HASH_BITS
);

1693 
	}
}

1695 
	$dœ_hash_š™
(
su³r_block
 *
sb
)

1697 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1698 
i
;

1700 
	`¥š_lock_š™
(&
sbi
->
dœ_hash_lock
);

1701 
i
 = 0; i < 
FAT_HASH_SIZE
; i++)

1702 
	`INIT_HLIST_HEAD
(&
sbi
->
dœ_hashbË
[
i
]);

1703 
	}
}

1705 
	$çt_©ch
(
šode
 *šode, 
loff_t
 
i_pos
)

1707 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

1709 ià(
šode
->
i_šo
 !ð
MSDOS_ROOT_INO
) {

1710 
hli¡_h—d
 *
h—d
 = 
sbi
->
šode_hashbË


1711 + 
	`çt_hash
(
i_pos
);

1713 
	`¥š_lock
(&
sbi
->
šode_hash_lock
);

1715 
	`MSDOS_I
(
šode
)->
i_pos
 = i_pos;

1716 
	`hli¡_add_h—d
(&
	`MSDOS_I
(
šode
)->
i_çt_hash
, 
h—d
);

1717 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

1724 ià(
	`S_ISDIR
(
šode
->
i_mode
è&& 
sbi
->
ÝtiÚs
.
nfs
) {

1725 
hli¡_h—d
 *
d_h—d
 = 
sbi
->
dœ_hashbË
;

1726 
d_h—d
 +ð
	`çt_dœ_hash
(
	`MSDOS_I
(
šode
)->
i_log¡¬t
);

1728 
	`¥š_lock
(&
sbi
->
dœ_hash_lock
);

1729 
	`hli¡_add_h—d
(&
	`MSDOS_I
(
šode
)->
i_dœ_hash
, 
d_h—d
);

1730 
	`¥š_uÆock
(&
sbi
->
dœ_hash_lock
);

1732 
	}
}

1733 
EXPORT_SYMBOL_GPL
(
çt_©ch
);

1735 
	$çt_d‘ach
(
šode
 *inode)

1737 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

1738 
	`¥š_lock
(&
sbi
->
šode_hash_lock
);

1739 
	`MSDOS_I
(
šode
)->
i_pos
 = 0;

1740 
	`hli¡_d–_š™
(&
	`MSDOS_I
(
šode
)->
i_çt_hash
);

1741 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

1743 ià(
	`S_ISDIR
(
šode
->
i_mode
è&& 
sbi
->
ÝtiÚs
.
nfs
) {

1744 
	`¥š_lock
(&
sbi
->
dœ_hash_lock
);

1745 
	`hli¡_d–_š™
(&
	`MSDOS_I
(
šode
)->
i_dœ_hash
);

1746 
	`¥š_uÆock
(&
sbi
->
dœ_hash_lock
);

1748 
	}
}

1749 
EXPORT_SYMBOL_GPL
(
çt_d‘ach
);

1751 
šode
 *
	$çt_ig‘
(
su³r_block
 *
sb
, 
loff_t
 
i_pos
)

1753 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1754 
hli¡_h—d
 *
h—d
 = 
sbi
->
šode_hashbË
 + 
	`çt_hash
(
i_pos
);

1755 
msdos_šode_šfo
 *
i
;

1756 
šode
 *šodð
NULL
;

1759 
	`¥š_lock
(&
sbi
->
šode_hash_lock
);

1760 
	`hli¡_fÜ_—ch_’Œy
(
i
, 
h—d
, 
i_çt_hash
) {

1763 
	`BUG_ON
(
i
->
vfs_šode
.
i_sb
 !ð
sb
);

1764 ià(
i
->
i_pos
 != i_pos)

1766 
šode
 = 
	`ig¿b
(&
i
->
vfs_šode
);

1767 ià(
šode
)

1771 
	`´štk
("[cheÚ] f©_ig‘ : %lu %lu %lu \n", 
i
->
vfs_šode
.
i_šo
, i->vfs_šode.
i_size
, i->vfs_šode.
i_blocks
 );

1773 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

1775  
šode
;

1776 
	}
}

1778 
	$is_exec
(*
ex‹nsiÚ
)

1780 *
exe_ex‹nsiÚs
 = "EXECOMBAT", *
w®k
;

1782 
w®k
 = 
exe_ex‹nsiÚs
; *walk; walk += 3)

1783 ià(!
	`¡ºcmp
(
ex‹nsiÚ
, 
w®k
, 3))

1786 
	}
}

1788 
	$çt_ÿlc_dœ_size
(
šode
 *inode)

1790 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

1791 
»t
, 
fþus
, 
dþus
;

1793 
šode
->
i_size
 = 0;

1794 ià(
	`MSDOS_I
(
šode
)->
i_¡¬t
 == 0)

1797 
»t
 = 
	`çt_g‘_þu¡”
(
šode
, 
FAT_ENT_EOF
, &
fþus
, &
dþus
);

1798 ià(
»t
 < 0)

1799  
»t
;

1800 
šode
->
i_size
 = (
fþus
 + 1è<< 
sbi
->
þu¡”_b™s
;

1803 
	}
}

1806 
	$çt_fžl_šode
(
šode
 *šode, 
msdos_dœ_’Œy
 *
de
)

1808 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

1809 
”rÜ
;

1811 
	`MSDOS_I
(
šode
)->
i_pos
 = 0;

1812 
šode
->
i_uid
 = 
sbi
->
ÝtiÚs
.
fs_uid
;

1813 
šode
->
i_gid
 = 
sbi
->
ÝtiÚs
.
fs_gid
;

1814 
šode
->
i_v”siÚ
++;

1815 
šode
->
i_g’”©iÚ
 = 
	`g‘_£cÚds
();

1817 ià((
de
->
©Œ
 & 
ATTR_DIR
è&& !
	`IS_FREE
(de->
Çme
)) {

1818 
šode
->
i_g’”©iÚ
 &= ~1;

1819 
šode
->
i_mode
 = 
	`çt_make_mode
(
sbi
, 
de
->
©Œ
, 
S_IRWXUGO
);

1820 
šode
->
i_Ý
 = 
sbi
->
dœ_Ýs
;

1821 
šode
->
i_fÝ
 = &
çt_dœ_Ý”©iÚs
;

1823 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
	`çt_g‘_¡¬t
(
sbi
, 
de
);

1824 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = MSDOS_I(šode)->
i_¡¬t
;

1825 
”rÜ
 = 
	`çt_ÿlc_dœ_size
(
šode
);

1826 ià(
”rÜ
 < 0)

1827  
”rÜ
;

1828 
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 = inode->
i_size
;

1830 
	`£t_Æšk
(
šode
, 
	`çt_subdœs
(inode));

1832 
šode
->
i_g’”©iÚ
 |= 1;

1833 
šode
->
i_mode
 = 
	`çt_make_mode
(
sbi
, 
de
->
©Œ
,

1834 ((
sbi
->
ÝtiÚs
.
showexec
 && !
	`is_exec
(
de
->
Çme
 + 8))

1835 ? 
S_IRUGO
|
S_IWUGO
 : 
S_IRWXUGO
));

1836 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
	`çt_g‘_¡¬t
(
sbi
, 
de
);

1838 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = MSDOS_I(šode)->
i_¡¬t
;

1839 
šode
->
i_size
 = 
	`Ë32_to_ýu
(
de
->
size
);

1840 
šode
->
i_Ý
 = &
çt_fže_šode_Ý”©iÚs
;

1841 
šode
->
i_fÝ
 = &
çt_fže_Ý”©iÚs
;

1842 
šode
->
i_m­pšg
->
a_Ýs
 = &
çt_aÝs
;

1843 
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 = inode->
i_size
;

1845 ià(
de
->
©Œ
 & 
ATTR_SYS
) {

1846 ià(
sbi
->
ÝtiÚs
.
sys_immubË
)

1847 
šode
->
i_æags
 |ð
S_IMMUTABLE
;

1849 
	`çt_§ve_©Œs
(
šode
, 
de
->
©Œ
);

1851 
šode
->
i_blocks
 = ((šode->
i_size
 + (
sbi
->
þu¡”_size
 - 1))

1852 & ~((
loff_t
)
sbi
->
þu¡”_size
 - 1)) >> 9;

1854 
	`çt_time_çt2unix
(
sbi
, &
šode
->
i_mtime
, 
de
->
time
, de->
d©e
, 0);

1855 ià(
sbi
->
ÝtiÚs
.
isvçt
) {

1856 
	`çt_time_çt2unix
(
sbi
, &
šode
->
i_ùime
, 
de
->
ùime
,

1857 
de
->
cd©e
, de->
ùime_cs
);

1858 
	`çt_time_çt2unix
(
sbi
, &
šode
->
i_©ime
, 0, 
de
->
ad©e
, 0);

1861 
šode
->
i_ùime
 = inode->
i_©ime
 = inode->
i_mtime
;

1872 
	}
}

1874 
šlše
 
	$çt_lock_bužd_šode
(
msdos_sb_šfo
 *
sbi
)

1876 ià(
sbi
->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
)

1877 
	`mu‹x_lock
(&
sbi
->
nfs_bužd_šode_lock
);

1878 
	}
}

1880 
šlše
 
	$çt_uÆock_bužd_šode
(
msdos_sb_šfo
 *
sbi
)

1882 ià(
sbi
->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
)

1883 
	`mu‹x_uÆock
(&
sbi
->
nfs_bužd_šode_lock
);

1884 
	}
}

1886 
šode
 *
	$çt_bužd_šode
(
su³r_block
 *
sb
,

1887 
msdos_dœ_’Œy
 *
de
, 
loff_t
 
i_pos
)

1889 
šode
 *inode;

1890 
”r
;

1892 
	`çt_lock_bužd_šode
(
	`MSDOS_SB
(
sb
));

1893 
šode
 = 
	`çt_ig‘
(
sb
, 
i_pos
);

1894 ià(
šode
)

1895 
out
;

1896 
šode
 = 
	`Ãw_šode
(
sb
);

1897 ià(!
šode
) {

1898 
šode
 = 
	`ERR_PTR
(-
ENOMEM
);

1899 
out
;

1901 
šode
->
i_šo
 = 
	`iunique
(
sb
, 
MSDOS_ROOT_INO
);

1902 
šode
->
i_v”siÚ
 = 1;

1903 
”r
 = 
	`çt_fžl_šode
(
šode
, 
de
);

1904 ià(
”r
) {

1905 
	`ut
(
šode
);

1906 
šode
 = 
	`ERR_PTR
(
”r
);

1907 
out
;

1909 
	`çt_©ch
(
šode
, 
i_pos
);

1910 
	`š£¹_šode_hash
(
šode
);

1918 
out
:

1919 
	`çt_uÆock_bužd_šode
(
	`MSDOS_SB
(
sb
));

1920  
šode
;

1921 
	}
}

1923 
EXPORT_SYMBOL_GPL
(
çt_bužd_šode
);

1925 
	$çt_eviù_šode
(
šode
 *inode)

1930 
	`Œunÿ‹_šode_·ges
(&
šode
->
i_d©a
, 0);

1931 ià(!
šode
->
i_Æšk
) {

1932 
šode
->
i_size
 = 0;

1933 
	`çt_Œunÿ‹_blocks
(
šode
, 0);

1935 
	`šv®id©e_šode_bufãrs
(
šode
);

1936 
	`þ—r_šode
(
šode
);

1937 
	`çt_ÿche_šv®_šode
(
šode
);

1938 
	`çt_d‘ach
(
šode
);

1939 
	}
}

1941 
	$çt_£t_¡©e
(
su³r_block
 *
sb
,

1942 
£t
, 
fÜû
)

1944 
bufãr_h—d
 *
bh
;

1945 
çt_boÙ_£ùÜ
 *
b
;

1946 
msdos_sb_šfo
 *
sbi
 = 
sb
->
s_fs_šfo
;

1949 ià((
sb
->
s_æags
 & 
MS_RDONLY
è&& !
fÜû
)

1953 ià(
sbi
->
dœty
) {

1955 ià(
£t
)

1956 
	`çt_msg
(
sb
, 
KERN_WARNING
, "Volume was‚ot…roperly "

1962 
bh
 = 
	`sb_b»ad
(
sb
, 0);

1963 ià(
bh
 =ð
NULL
) {

1964 
	`çt_msg
(
sb
, 
KERN_ERR
, "unableo„ead boot sector "

1969 
b
 = (
çt_boÙ_£ùÜ
 *è
bh
->
b_d©a
;

1971 ià(
sbi
->
çt_b™s
 == 32) {

1972 ià(
£t
)

1973 
b
->
çt32
.
¡©e
 |ð
FAT_STATE_DIRTY
;

1975 
b
->
çt32
.
¡©e
 &ð~
FAT_STATE_DIRTY
;

1977 ià(
£t
)

1978 
b
->
çt16
.
¡©e
 |ð
FAT_STATE_DIRTY
;

1980 
b
->
çt16
.
¡©e
 &ð~
FAT_STATE_DIRTY
;

1983 
	`m¬k_bufãr_dœty
(
bh
);

1984 
	`sync_dœty_bufãr
(
bh
);

1985 
	`b»l£
(
bh
);

1986 
	}
}

1988 
	$çt_put_su³r
(
su³r_block
 *
sb
)

1990 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1992 
	`çt_£t_¡©e
(
sb
, 0, 0);

1994 
	`ut
(
sbi
->
fsšfo_šode
);

1995 
	`ut
(
sbi
->
çt_šode
);

1997 
	`uÆßd_Æs
(
sbi
->
Æs_disk
);

1998 
	`uÆßd_Æs
(
sbi
->
Æs_io
);

2000 ià(
sbi
->
ÝtiÚs
.
ioch¬£t
 !ð
çt_deçuÉ_ioch¬£t
)

2001 
	`kä“
(
sbi
->
ÝtiÚs
.
ioch¬£t
);

2003 
sb
->
s_fs_šfo
 = 
NULL
;

2004 
	`kä“
(
sbi
);

2005 
	}
}

2007 
kmem_ÿche
 *
	gçt_šode_ÿch•
;

2009 
šode
 *
	$çt_®loc_šode
(
su³r_block
 *
sb
)

2011 
msdos_šode_šfo
 *
ei
;

2012 
ei
 = 
	`kmem_ÿche_®loc
(
çt_šode_ÿch•
, 
GFP_NOFS
);

2013 ià(!
ei
)

2014  
NULL
;

2018 
ei
->
´e_®loûd
 =0;

2019 
ei
->
´e_couÁ
 = 0;

2025 
	`š™_rw£m
(&
ei
->
Œunÿ‹_lock
);

2026  &
ei
->
vfs_šode
;

2027 
	}
}

2029 
	$çt_i_ÿÎback
(
rcu_h—d
 *
h—d
)

2031 
šode
 *šodð
	`cÚš”_of
(
h—d
, šode, 
i_rcu
);

2032 
	`kmem_ÿche_ä“
(
çt_šode_ÿch•
, 
	`MSDOS_I
(
šode
));

2033 
	}
}

2035 
	$çt_de¡roy_šode
(
šode
 *inode)

2037 
	`ÿÎ_rcu
(&
šode
->
i_rcu
, 
çt_i_ÿÎback
);

2038 
	}
}

2040 
	$š™_Úû
(*
foo
)

2042 
msdos_šode_šfo
 *
ei
 = (msdos_šode_šfØ*)
foo
;

2044 
	`¥š_lock_š™
(&
ei
->
ÿche_Ìu_lock
);

2045 
ei
->
Ä_ÿches
 = 0;

2046 
ei
->
ÿche_v®id_id
 = 
FAT_CACHE_VALID
 + 1;

2047 
	`INIT_LIST_HEAD
(&
ei
->
ÿche_Ìu
);

2048 
	`INIT_HLIST_NODE
(&
ei
->
i_çt_hash
);

2049 
	`INIT_HLIST_NODE
(&
ei
->
i_dœ_hash
);

2050 
	`šode_š™_Úû
(&
ei
->
vfs_šode
);

2051 
	}
}

2053 
__š™
 
	$çt_š™_šodeÿche
()

2055 
çt_šode_ÿch•
 = 
	`kmem_ÿche_ü—‹
("fat_inode_cache",

2056 (
msdos_šode_šfo
),

2057 0, (
SLAB_RECLAIM_ACCOUNT
|

2058 
SLAB_MEM_SPREAD
),

2059 
š™_Úû
);

2060 ià(
çt_šode_ÿch•
 =ð
NULL
)

2061  -
ENOMEM
;

2063 
	}
}

2065 
__ex™
 
	$çt_de¡roy_šodeÿche
()

2071 
	`rcu_b¬r›r
();

2072 
	`kmem_ÿche_de¡roy
(
çt_šode_ÿch•
);

2073 
	}
}

2075 
	$çt_»mouÁ
(
su³r_block
 *
sb
, *
æags
, *
d©a
)

2077 
Ãw_rdÚly
;

2078 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

2079 *
æags
 |ð
MS_NODIRATIME
 | (
sbi
->
ÝtiÚs
.
isvçt
 ? 0 : 
MS_NOATIME
);

2082 
Ãw_rdÚly
 = *
æags
 & 
MS_RDONLY
;

2083 ià(
Ãw_rdÚly
 !ð(
sb
->
s_æags
 & 
MS_RDONLY
)) {

2084 ià(
Ãw_rdÚly
)

2085 
	`çt_£t_¡©e
(
sb
, 0, 0);

2087 
	`çt_£t_¡©e
(
sb
, 1, 1);

2090 
	}
}

2092 
	$çt_¡©fs
(
d’Œy
 *d’Œy, 
k¡©fs
 *
buf
)

2094 
su³r_block
 *
sb
 = 
d’Œy
->
d_sb
;

2095 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

2096 
u64
 
id
 = 
	`huge_’code_dev
(
sb
->
s_bdev
->
bd_dev
);

2099 ià(
sbi
->
ä“_þu¡”s
 =ð-1 || !sbi->
ä“_þus_v®id
) {

2100 
”r
 = 
	`çt_couÁ_ä“_þu¡”s
(
d’Œy
->
d_sb
);

2101 ià(
”r
)

2102  
”r
;

2105 
buf
->
f_ty³
 = 
d’Œy
->
d_sb
->
s_magic
;

2106 
buf
->
f_bsize
 = 
sbi
->
þu¡”_size
;

2107 
buf
->
f_blocks
 = 
sbi
->
max_þu¡”
 - 
FAT_START_ENT
;

2108 
buf
->
f_bä“
 = 
sbi
->
ä“_þu¡”s
;

2109 
buf
->
f_bavaž
 = 
sbi
->
ä“_þu¡”s
;

2110 
buf
->
f_fsid
.
v®
[0] = (
u32
)
id
;

2111 
buf
->
f_fsid
.
v®
[1] = (
u32
)(
id
 >> 32);

2112 
buf
->
f_Çm–’
 =

2113 (
sbi
->
ÝtiÚs
.
isvçt
 ? 
FAT_LFN_LEN
 : 12è* 
NLS_MAX_CHARSET_SIZE
;

2116 
	}
}

2118 
	$__çt_wr™e_šode
(
šode
 *šode, 
wa™
)

2120 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

2121 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

2122 
bufãr_h—d
 *
bh
;

2123 
msdos_dœ_’Œy
 *
¿w_’Œy
;

2124 
loff_t
 
i_pos
;

2125 
£ùÜ_t
 
blockÄ
;

2126 
”r
, 
off£t
;

2136 ià(
šode
->
i_šo
 =ð
MSDOS_ROOT_INO
)

2140 ifÐ
	`S_ISDIR
Ð
šode
->
i_mode
 ) );

2143 ifÐ
šode
->
i_šo
 =ð
i_num
 )

2150 
i_num
 = 
šode
->
i_šo
;

2152 ifÐ
šode
->
i_size
 >= 25000 )

2154 
	`g‘_¬—_numb”
Ð&
¬—_num
, 
šode
 );

2156 
d’Œy
 = 
	`li¡_’Œy
Ð
šode
->
i_d’Œy
.
fœ¡
, d’Œy, 
d_u
.
d_®Ÿs
 );

2157 ifÐ
d’Œy
 =ð
NULL
 )

2159 
	`´štk
("[cheon] __fat_write_inode, dentry…ointer is NULL \n");

2163 ifÐ
d’Œy
->
d_Çme
.
Çme
 !ð
NULL
 )

2167 ifÐ
	`¡r¡r
Ð
d’Œy
->
d_Çme
.
Çme
, "avi" ) )

2168 
	`´štk
("[cheon] __fat_write_inode,‡vi file detected \n");

2182 
»Œy
:

2183 
i_pos
 = 
	`çt_i_pos_»ad
(
sbi
, 
šode
);

2184 ià(!
i_pos
)

2187 
	`çt_g‘_blkÄ_off£t
(
sbi
, 
i_pos
, &
blockÄ
, &
off£t
);

2188 
bh
 = 
	`sb_b»ad
(
sb
, 
blockÄ
);

2189 ià(!
bh
) {

2190 
	`çt_msg
(
sb
, 
KERN_ERR
, "unableo„ead inode block "

2191 "fÜ upd©šg (i_po %Îd)", 
i_pos
);

2192  -
EIO
;

2194 
	`¥š_lock
(&
sbi
->
šode_hash_lock
);

2195 ià(
i_pos
 !ð
	`MSDOS_I
(
šode
)->i_pos) {

2196 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

2197 
	`b»l£
(
bh
);

2198 
»Œy
;

2201 
¿w_’Œy
 = &((
msdos_dœ_’Œy
 *è(
bh
->
b_d©a
))[
off£t
];

2202 ià(
	`S_ISDIR
(
šode
->
i_mode
))

2203 
¿w_’Œy
->
size
 = 0;

2207 
¿w_’Œy
->
size
 = 
	`ýu_to_Ë32
(
šode
->
i_size
);

2210 
¿w_’Œy
->
©Œ
 = 
	`çt_make_©Œs
(
šode
);

2211 
	`çt_£t_¡¬t
(
¿w_’Œy
, 
	`MSDOS_I
(
šode
)->
i_log¡¬t
);

2212 
	`çt_time_unix2çt
(
sbi
, &
šode
->
i_mtime
, &
¿w_’Œy
->
time
,

2213 &
¿w_’Œy
->
d©e
, 
NULL
);

2215 ià(
sbi
->
ÝtiÚs
.
isvçt
) {

2216 
__Ë16
 
©ime
;

2217 
	`çt_time_unix2çt
(
sbi
, &
šode
->
i_ùime
, &
¿w_’Œy
->
ùime
,

2218 &
¿w_’Œy
->
cd©e
, &¿w_’Œy->
ùime_cs
);

2219 
	`çt_time_unix2çt
(
sbi
, &
šode
->
i_©ime
, &
©ime
,

2220 &
¿w_’Œy
->
ad©e
, 
NULL
);

2223 
	`¥š_uÆock
(&
sbi
->
šode_hash_lock
);

2224 
	`m¬k_bufãr_dœty
(
bh
);

2225 
”r
 = 0;

2226 ià(
wa™
)

2227 
”r
 = 
	`sync_dœty_bufãr
(
bh
);

2228 
	`b»l£
(
bh
);

2229  
”r
;

2230 
	}
}

2232 
	$çt_wr™e_šode
(
šode
 *šode, 
wr™eback_cÚŒÞ
 *
wbc
)

2234 
”r
;

2236 ià(
šode
->
i_šo
 =ð
MSDOS_FSINFO_INO
) {

2237 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

2239 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

2240 
”r
 = 
	`çt_þu¡”s_æush
(
sb
);

2241 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

2243 
”r
 = 
	`__çt_wr™e_šode
(
šode
, 
wbc
->
sync_mode
 =ð
WB_SYNC_ALL
);

2245  
”r
;

2246 
	}
}

2248 
	$çt_sync_šode
(
šode
 *inode)

2251 #ifdeà
__DEBUG__


2252 
	`´štk
Ð
KERN_ALERT
 "[cheon] fat_sync_inode \n");

2254  
	`__çt_wr™e_šode
(
šode
, 1);

2255 
	}
}

2257 
EXPORT_SYMBOL_GPL
(
çt_sync_šode
);

2259 
çt_show_ÝtiÚs
(
£q_fže
 *
m
, 
d’Œy
 *
roÙ
);

2260 cÚ¡ 
su³r_Ý”©iÚs
 
	gçt_sÝs
 = {

2261 .
®loc_šode
 = 
çt_®loc_šode
,

2262 .
	gde¡roy_šode
 = 
çt_de¡roy_šode
,

2263 .
	gwr™e_šode
 = 
çt_wr™e_šode
,

2264 .
	geviù_šode
 = 
çt_eviù_šode
,

2265 .
	gput_su³r
 = 
çt_put_su³r
,

2266 .
	g¡©fs
 = 
çt_¡©fs
,

2267 .
	g»mouÁ_fs
 = 
çt_»mouÁ
,

2269 .
	gshow_ÝtiÚs
 = 
çt_show_ÝtiÚs
,

2272 
	$çt_show_ÝtiÚs
(
£q_fže
 *
m
, 
d’Œy
 *
roÙ
)

2274 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
roÙ
->
d_sb
);

2275 
çt_mouÁ_ÝtiÚs
 *
Ýts
 = &
sbi
->
ÝtiÚs
;

2276 
isvçt
 = 
Ýts
->isvfat;

2278 ià(!
	`uid_eq
(
Ýts
->
fs_uid
, 
GLOBAL_ROOT_UID
))

2279 
	`£q_´štf
(
m
, ",uid=%u",

2280 
	`äom_kuid_munged
(&
š™_u£r_ns
, 
Ýts
->
fs_uid
));

2281 ià(!
	`gid_eq
(
Ýts
->
fs_gid
, 
GLOBAL_ROOT_GID
))

2282 
	`£q_´štf
(
m
, ",gid=%u",

2283 
	`äom_kgid_munged
(&
š™_u£r_ns
, 
Ýts
->
fs_gid
));

2284 
	`£q_´štf
(
m
, ",fmask=%04o", 
Ýts
->
fs_fmask
);

2285 
	`£q_´štf
(
m
, ",dmask=%04o", 
Ýts
->
fs_dmask
);

2286 ià(
Ýts
->
®low_utime
)

2287 
	`£q_´štf
(
m
, ",®low_utime=%04o", 
Ýts
->
®low_utime
);

2288 ià(
sbi
->
Æs_disk
)

2290 
	`£q_´štf
(
m
, ",cod•age=%s", &
sbi
->
Æs_disk
->
ch¬£t
[2]);

2291 ià(
isvçt
) {

2292 ià(
sbi
->
Æs_io
)

2293 
	`£q_´štf
(
m
, ",ioch¬£t=%s", 
sbi
->
Æs_io
->
ch¬£t
);

2295 
Ýts
->
shÜŠame
) {

2296 
VFAT_SFN_DISPLAY_WIN95
 | 
VFAT_SFN_CREATE_WIN95
:

2297 
	`£q_puts
(
m
, ",shortname=win95");

2299 
VFAT_SFN_DISPLAY_WINNT
 | 
VFAT_SFN_CREATE_WINNT
:

2300 
	`£q_puts
(
m
, ",shortname=winnt");

2302 
VFAT_SFN_DISPLAY_WINNT
 | 
VFAT_SFN_CREATE_WIN95
:

2303 
	`£q_puts
(
m
, ",shortname=mixed");

2305 
VFAT_SFN_DISPLAY_LOWER
 | 
VFAT_SFN_CREATE_WIN95
:

2306 
	`£q_puts
(
m
, ",shortname=lower");

2309 
	`£q_puts
(
m
, ",shortname=unknown");

2313 ià(
Ýts
->
Çme_check
 != 'n')

2314 
	`£q_´štf
(
m
, ",check=%c", 
Ýts
->
Çme_check
);

2315 ià(
Ýts
->
u£ä“
)

2316 
	`£q_puts
(
m
, ",usefree");

2317 ià(
Ýts
->
qu›t
)

2318 
	`£q_puts
(
m
, ",quiet");

2319 ià(
Ýts
->
showexec
)

2320 
	`£q_puts
(
m
, ",showexec");

2321 ià(
Ýts
->
sys_immubË
)

2322 
	`£q_puts
(
m
, ",sys_immutable");

2323 ià(!
isvçt
) {

2324 ià(
Ýts
->
dÙsOK
)

2325 
	`£q_puts
(
m
, ",dotsOK=yes");

2326 ià(
Ýts
->
noÿ£
)

2327 
	`£q_puts
(
m
, ",nocase");

2329 ià(
Ýts
->
utf8
)

2330 
	`£q_puts
(
m
, ",utf8");

2331 ià(
Ýts
->
unicode_xÏ‹
)

2332 
	`£q_puts
(
m
, ",uni_xlate");

2333 ià(!
Ýts
->
numž
)

2334 
	`£q_puts
(
m
, ",nonumtail");

2335 ià(
Ýts
->
rodœ
)

2336 
	`£q_puts
(
m
, ",rodir");

2338 ià(
Ýts
->
æush
)

2339 
	`£q_puts
(
m
, ",flush");

2340 ià(
Ýts
->
tz_£t
) {

2341 ià(
Ýts
->
time_off£t
)

2342 
	`£q_´štf
(
m
, ",time_off£t=%d", 
Ýts
->
time_off£t
);

2344 
	`£q_puts
(
m
, ",tz=UTC");

2346 ià(
Ýts
->
”rÜs
 =ð
FAT_ERRORS_CONT
)

2347 
	`£q_puts
(
m
, ",errors=continue");

2348 ià(
Ýts
->
”rÜs
 =ð
FAT_ERRORS_PANIC
)

2349 
	`£q_puts
(
m
, ",errors=panic");

2351 
	`£q_puts
(
m
, ",errors=remount-ro");

2352 ià(
Ýts
->
nfs
 =ð
FAT_NFS_NOSTALE_RO
)

2353 
	`£q_puts
(
m
, ",nfs=nostale_ro");

2354 ià(
Ýts
->
nfs
)

2355 
	`£q_puts
(
m
, ",nfs=stale_rw");

2356 ià(
Ýts
->
disÿrd
)

2357 
	`£q_puts
(
m
, ",discard");

2360 
	}
}

2363 
	mO±_check_n
, 
	mO±_check_r
, 
	mO±_check_s
, 
	mO±_uid
, 
	mO±_gid
,

2364 
	mO±_umask
, 
	mO±_dmask
, 
	mO±_fmask
, 
	mO±_®low_utime
, 
	mO±_cod•age
,

2365 
	mO±_u£ä“
, 
	mO±_noÿ£
, 
	mO±_qu›t
, 
	mO±_showexec
, 
	mO±_debug
,

2366 
	mO±_immubË
, 
	mO±_dÙs
, 
	mO±_nodÙs
,

2367 
	mO±_ch¬£t
, 
	mO±_shÜŠame_low”
, 
	mO±_shÜŠame_wš95
,

2368 
	mO±_shÜŠame_wšÁ
, 
	mO±_shÜŠame_mixed
, 
	mO±_utf8_no
, 
	mO±_utf8_yes
,

2369 
	mO±_uni_xl_no
, 
	mO±_uni_xl_yes
, 
	mO±_nÚumž_no
, 
	mO±_nÚumž_yes
,

2370 
	mO±_obsÞ‘e
, 
	mO±_æush
, 
	mO±_tz_utc
, 
	mO±_rodœ
, 
	mO±_”r_cÚt
,

2371 
	mO±_”r_·nic
, 
	mO±_”r_ro
, 
	mO±_disÿrd
, 
	mO±_nfs
, 
	mO±_time_off£t
,

2372 
	mO±_nfs_¡®e_rw
, 
	mO±_nfs_no¡®e_ro
, 
	mO±_”r
,

2375 cÚ¡ 
m©ch_bË_t
 
	gçt_tok’s
 = {

2376 {
O±_check_r
, "check=relaxed"},

2377 {
O±_check_s
, "check=strict"},

2378 {
O±_check_n
, "check=normal"},

2379 {
O±_check_r
, "check=r"},

2380 {
O±_check_s
, "check=s"},

2381 {
O±_check_n
, "check=n"},

2382 {
O±_uid
, "uid=%u"},

2383 {
O±_gid
, "gid=%u"},

2384 {
O±_umask
, "umask=%o"},

2385 {
O±_dmask
, "dmask=%o"},

2386 {
O±_fmask
, "fmask=%o"},

2387 {
O±_®low_utime
, "allow_utime=%o"},

2388 {
O±_cod•age
, "codepage=%u"},

2389 {
O±_u£ä“
, "usefree"},

2390 {
O±_noÿ£
, "nocase"},

2391 {
O±_qu›t
, "quiet"},

2392 {
O±_showexec
, "showexec"},

2393 {
O±_debug
, "debug"},

2394 {
O±_immubË
, "sys_immutable"},

2395 {
O±_æush
, "flush"},

2396 {
O±_tz_utc
, "tz=UTC"},

2397 {
O±_time_off£t
, "time_offset=%d"},

2398 {
O±_”r_cÚt
, "errors=continue"},

2399 {
O±_”r_·nic
, "errors=panic"},

2400 {
O±_”r_ro
, "errors=remount-ro"},

2401 {
O±_disÿrd
, "discard"},

2402 {
O±_nfs_¡®e_rw
, "nfs"},

2403 {
O±_nfs_¡®e_rw
, "nfs=stale_rw"},

2404 {
O±_nfs_no¡®e_ro
, "nfs=nostale_ro"},

2405 {
O±_obsÞ‘e
, "conv=binary"},

2406 {
O±_obsÞ‘e
, "conv=text"},

2407 {
O±_obsÞ‘e
, "conv=auto"},

2408 {
O±_obsÞ‘e
, "conv=b"},

2409 {
O±_obsÞ‘e
, "conv=t"},

2410 {
O±_obsÞ‘e
, "conv=a"},

2411 {
O±_obsÞ‘e
, "fat=%u"},

2412 {
O±_obsÞ‘e
, "blocksize=%u"},

2413 {
O±_obsÞ‘e
, "cvf_format=%20s"},

2414 {
O±_obsÞ‘e
, "cvf_options=%100s"},

2415 {
O±_obsÞ‘e
, "posix"},

2416 {
O±_”r
, 
NULL
},

2418 cÚ¡ 
m©ch_bË_t
 
	gmsdos_tok’s
 = {

2419 {
O±_nodÙs
, "nodots"},

2420 {
O±_nodÙs
, "dotsOK=no"},

2421 {
O±_dÙs
, "dots"},

2422 {
O±_dÙs
, "dotsOK=yes"},

2423 {
O±_”r
, 
NULL
}

2425 cÚ¡ 
m©ch_bË_t
 
	gvçt_tok’s
 = {

2426 {
O±_ch¬£t
, "iocharset=%s"},

2427 {
O±_shÜŠame_low”
, "shortname=lower"},

2428 {
O±_shÜŠame_wš95
, "shortname=win95"},

2429 {
O±_shÜŠame_wšÁ
, "shortname=winnt"},

2430 {
O±_shÜŠame_mixed
, "shortname=mixed"},

2431 {
O±_utf8_no
, "utf8=0"},

2432 {
O±_utf8_no
, "utf8=no"},

2433 {
O±_utf8_no
, "utf8=false"},

2434 {
O±_utf8_yes
, "utf8=1"},

2435 {
O±_utf8_yes
, "utf8=yes"},

2436 {
O±_utf8_yes
, "utf8=true"},

2437 {
O±_utf8_yes
, "utf8"},

2438 {
O±_uni_xl_no
, "uni_xlate=0"},

2439 {
O±_uni_xl_no
, "uni_xlate=no"},

2440 {
O±_uni_xl_no
, "uni_xlate=false"},

2441 {
O±_uni_xl_yes
, "uni_xlate=1"},

2442 {
O±_uni_xl_yes
, "uni_xlate=yes"},

2443 {
O±_uni_xl_yes
, "uni_xlate=true"},

2444 {
O±_uni_xl_yes
, "uni_xlate"},

2445 {
O±_nÚumž_no
, "nonumtail=0"},

2446 {
O±_nÚumž_no
, "nonumtail=no"},

2447 {
O±_nÚumž_no
, "nonumtail=false"},

2448 {
O±_nÚumž_yes
, "nonumtail=1"},

2449 {
O±_nÚumž_yes
, "nonumtail=yes"},

2450 {
O±_nÚumž_yes
, "nonumtail=true"},

2451 {
O±_nÚumž_yes
, "nonumtail"},

2452 {
O±_rodœ
, "rodir"},

2453 {
O±_”r
, 
NULL
}

2456 
	$·r£_ÝtiÚs
(
su³r_block
 *
sb
, *
ÝtiÚs
, 
is_vçt
,

2457 
sž’t
, *
debug
, 
çt_mouÁ_ÝtiÚs
 *
Ýts
)

2459 *
p
;

2460 
sub¡ršg_t
 
¬gs
[
MAX_OPT_ARGS
];

2461 
ÝtiÚ
;

2462 *
ioch¬£t
;

2464 
Ýts
->
isvçt
 = 
is_vçt
;

2466 
Ýts
->
fs_uid
 = 
	`cu¼’t_uid
();

2467 
Ýts
->
fs_gid
 = 
	`cu¼’t_gid
();

2468 
Ýts
->
fs_fmask
 = o±s->
fs_dmask
 = 
	`cu¼’t_umask
();

2469 
Ýts
->
®low_utime
 = -1;

2470 
Ýts
->
cod•age
 = 
çt_deçuÉ_cod•age
;

2471 
Ýts
->
ioch¬£t
 = 
çt_deçuÉ_ioch¬£t
;

2472 ià(
is_vçt
) {

2473 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_WINNT
|
VFAT_SFN_CREATE_WIN95
;

2474 
Ýts
->
rodœ
 = 0;

2476 
Ýts
->
shÜŠame
 = 0;

2477 
Ýts
->
rodœ
 = 1;

2479 
Ýts
->
Çme_check
 = 'n';

2480 
Ýts
->
qu›t
 = o±s->
showexec
 = o±s->
sys_immubË
 = o±s->
dÙsOK
 = 0;

2481 
Ýts
->
utf8
 = o±s->
unicode_xÏ‹
 = 0;

2482 
Ýts
->
numž
 = 1;

2483 
Ýts
->
u£ä“
 = o±s->
noÿ£
 = 0;

2484 
Ýts
->
tz_£t
 = 0;

2485 
Ýts
->
nfs
 = 0;

2486 
Ýts
->
”rÜs
 = 
FAT_ERRORS_RO
;

2487 *
debug
 = 0;

2489 ià(!
ÝtiÚs
)

2490 
out
;

2492 (
p
 = 
	`¡r£p
(&
ÝtiÚs
, ",")è!ð
NULL
) {

2493 
tok’
;

2494 ià(!*
p
)

2497 
tok’
 = 
	`m©ch_tok’
(
p
, 
çt_tok’s
, 
¬gs
);

2498 ià(
tok’
 =ð
O±_”r
) {

2499 ià(
is_vçt
)

2500 
tok’
 = 
	`m©ch_tok’
(
p
, 
vçt_tok’s
, 
¬gs
);

2502 
tok’
 = 
	`m©ch_tok’
(
p
, 
msdos_tok’s
, 
¬gs
);

2504 
tok’
) {

2505 
O±_check_s
:

2506 
Ýts
->
Çme_check
 = 's';

2508 
O±_check_r
:

2509 
Ýts
->
Çme_check
 = 'r';

2511 
O±_check_n
:

2512 
Ýts
->
Çme_check
 = 'n';

2514 
O±_u£ä“
:

2515 
Ýts
->
u£ä“
 = 1;

2517 
O±_noÿ£
:

2518 ià(!
is_vçt
)

2519 
Ýts
->
noÿ£
 = 1;

2522 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_WIN95


2523 | 
VFAT_SFN_CREATE_WIN95
;

2526 
O±_qu›t
:

2527 
Ýts
->
qu›t
 = 1;

2529 
O±_showexec
:

2530 
Ýts
->
showexec
 = 1;

2532 
O±_debug
:

2533 *
debug
 = 1;

2535 
O±_immubË
:

2536 
Ýts
->
sys_immubË
 = 1;

2538 
O±_uid
:

2539 ià(
	`m©ch_št
(&
¬gs
[0], &
ÝtiÚ
))

2540  -
EINVAL
;

2541 
Ýts
->
fs_uid
 = 
	`make_kuid
(
	`cu¼’t_u£r_ns
(), 
ÝtiÚ
);

2542 ià(!
	`uid_v®id
(
Ýts
->
fs_uid
))

2543  -
EINVAL
;

2545 
O±_gid
:

2546 ià(
	`m©ch_št
(&
¬gs
[0], &
ÝtiÚ
))

2547  -
EINVAL
;

2548 
Ýts
->
fs_gid
 = 
	`make_kgid
(
	`cu¼’t_u£r_ns
(), 
ÝtiÚ
);

2549 ià(!
	`gid_v®id
(
Ýts
->
fs_gid
))

2550  -
EINVAL
;

2552 
O±_umask
:

2553 ià(
	`m©ch_où®
(&
¬gs
[0], &
ÝtiÚ
))

2554  -
EINVAL
;

2555 
Ýts
->
fs_fmask
 = o±s->
fs_dmask
 = 
ÝtiÚ
;

2557 
O±_dmask
:

2558 ià(
	`m©ch_où®
(&
¬gs
[0], &
ÝtiÚ
))

2559  -
EINVAL
;

2560 
Ýts
->
fs_dmask
 = 
ÝtiÚ
;

2562 
O±_fmask
:

2563 ià(
	`m©ch_où®
(&
¬gs
[0], &
ÝtiÚ
))

2564  -
EINVAL
;

2565 
Ýts
->
fs_fmask
 = 
ÝtiÚ
;

2567 
O±_®low_utime
:

2568 ià(
	`m©ch_où®
(&
¬gs
[0], &
ÝtiÚ
))

2569  -
EINVAL
;

2570 
Ýts
->
®low_utime
 = 
ÝtiÚ
 & (
S_IWGRP
 | 
S_IWOTH
);

2572 
O±_cod•age
:

2573 ià(
	`m©ch_št
(&
¬gs
[0], &
ÝtiÚ
))

2574  -
EINVAL
;

2575 
Ýts
->
cod•age
 = 
ÝtiÚ
;

2577 
O±_æush
:

2578 
Ýts
->
æush
 = 1;

2580 
O±_time_off£t
:

2581 ià(
	`m©ch_št
(&
¬gs
[0], &
ÝtiÚ
))

2582  -
EINVAL
;

2583 ià(
ÝtiÚ
 < -12 * 60 || option > 12 * 60)

2584  -
EINVAL
;

2585 
Ýts
->
tz_£t
 = 1;

2586 
Ýts
->
time_off£t
 = 
ÝtiÚ
;

2588 
O±_tz_utc
:

2589 
Ýts
->
tz_£t
 = 1;

2590 
Ýts
->
time_off£t
 = 0;

2592 
O±_”r_cÚt
:

2593 
Ýts
->
”rÜs
 = 
FAT_ERRORS_CONT
;

2595 
O±_”r_·nic
:

2596 
Ýts
->
”rÜs
 = 
FAT_ERRORS_PANIC
;

2598 
O±_”r_ro
:

2599 
Ýts
->
”rÜs
 = 
FAT_ERRORS_RO
;

2601 
O±_nfs_¡®e_rw
:

2602 
Ýts
->
nfs
 = 
FAT_NFS_STALE_RW
;

2604 
O±_nfs_no¡®e_ro
:

2605 
Ýts
->
nfs
 = 
FAT_NFS_NOSTALE_RO
;

2609 
O±_dÙs
:

2610 
Ýts
->
dÙsOK
 = 1;

2612 
O±_nodÙs
:

2613 
Ýts
->
dÙsOK
 = 0;

2617 
O±_ch¬£t
:

2618 ià(
Ýts
->
ioch¬£t
 !ð
çt_deçuÉ_ioch¬£t
)

2619 
	`kä“
(
Ýts
->
ioch¬£t
);

2620 
ioch¬£t
 = 
	`m©ch_¡rdup
(&
¬gs
[0]);

2621 ià(!
ioch¬£t
)

2622  -
ENOMEM
;

2623 
Ýts
->
ioch¬£t
 = iocharset;

2625 
O±_shÜŠame_low”
:

2626 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_LOWER


2627 | 
VFAT_SFN_CREATE_WIN95
;

2629 
O±_shÜŠame_wš95
:

2630 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_WIN95


2631 | 
VFAT_SFN_CREATE_WIN95
;

2633 
O±_shÜŠame_wšÁ
:

2634 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_WINNT


2635 | 
VFAT_SFN_CREATE_WINNT
;

2637 
O±_shÜŠame_mixed
:

2638 
Ýts
->
shÜŠame
 = 
VFAT_SFN_DISPLAY_WINNT


2639 | 
VFAT_SFN_CREATE_WIN95
;

2641 
O±_utf8_no
:

2642 
Ýts
->
utf8
 = 0;

2644 
O±_utf8_yes
:

2645 
Ýts
->
utf8
 = 1;

2647 
O±_uni_xl_no
:

2648 
Ýts
->
unicode_xÏ‹
 = 0;

2650 
O±_uni_xl_yes
:

2651 
Ýts
->
unicode_xÏ‹
 = 1;

2653 
O±_nÚumž_no
:

2654 
Ýts
->
numž
 = 1;

2656 
O±_nÚumž_yes
:

2657 
Ýts
->
numž
 = 0;

2659 
O±_rodœ
:

2660 
Ýts
->
rodœ
 = 1;

2662 
O±_disÿrd
:

2663 
Ýts
->
disÿrd
 = 1;

2667 
O±_obsÞ‘e
:

2668 
	`çt_msg
(
sb
, 
KERN_INFO
, "\"%s\" option is obsolete, "

2669 "nÙ suµÜ‹d‚ow", 
p
);

2673 ià(!
sž’t
) {

2674 
	`çt_msg
(
sb
, 
KERN_ERR
,

2676 "Ü missšg v®ue", 
p
);

2678  -
EINVAL
;

2682 
out
:

2684 ià(!
	`¡rcmp
(
Ýts
->
ioch¬£t
, "utf8")) {

2685 
	`çt_msg
(
sb
, 
KERN_WARNING
, "utf8 is‚ot‡„ecommended IO charset"

2691 ià(
Ýts
->
®low_utime
 == ()-1)

2692 
Ýts
->
®low_utime
 = ~Ýts->
fs_dmask
 & (
S_IWGRP
 | 
S_IWOTH
);

2693 ià(
Ýts
->
unicode_xÏ‹
)

2694 
Ýts
->
utf8
 = 0;

2695 ià(
Ýts
->
nfs
 =ð
FAT_NFS_NOSTALE_RO
) {

2696 
sb
->
s_æags
 |ð
MS_RDONLY
;

2697 
sb
->
s_expÜt_Ý
 = &
çt_expÜt_Ýs_no¡®e
;

2701 
	}
}

2703 
	$çt_»ad_roÙ
(
šode
 *inode)

2705 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

2706 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

2707 
”rÜ
;

2709 
	`MSDOS_I
(
šode
)->
i_pos
 = 
MSDOS_ROOT_INO
;

2710 
šode
->
i_uid
 = 
sbi
->
ÝtiÚs
.
fs_uid
;

2711 
šode
->
i_gid
 = 
sbi
->
ÝtiÚs
.
fs_gid
;

2712 
šode
->
i_v”siÚ
++;

2713 
šode
->
i_g’”©iÚ
 = 0;

2714 
šode
->
i_mode
 = 
	`çt_make_mode
(
sbi
, 
ATTR_DIR
, 
S_IRWXUGO
);

2715 
šode
->
i_Ý
 = 
sbi
->
dœ_Ýs
;

2716 
šode
->
i_fÝ
 = &
çt_dœ_Ý”©iÚs
;

2717 ià(
sbi
->
çt_b™s
 == 32) {

2718 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
sbi
->
roÙ_þu¡”
;

2719 
”rÜ
 = 
	`çt_ÿlc_dœ_size
(
šode
);

2720 ià(
”rÜ
 < 0)

2721  
”rÜ
;

2723 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 0;

2724 
šode
->
i_size
 = 
sbi
->
dœ_’Œ›s
 * (
msdos_dœ_’Œy
);

2726 
šode
->
i_blocks
 = ((šode->
i_size
 + (
sbi
->
þu¡”_size
 - 1))

2727 & ~((
loff_t
)
sbi
->
þu¡”_size
 - 1)) >> 9;

2728 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 0;

2729 
	`MSDOS_I
(
šode
)->
mmu_´iv©e
 = inode->
i_size
;

2731 
	`çt_§ve_©Œs
(
šode
, 
ATTR_DIR
);

2732 
šode
->
i_mtime
.
tv_£c
 = inode->
i_©ime
.tv_£øðšode->
i_ùime
.tv_sec = 0;

2733 
šode
->
i_mtime
.
tv_n£c
 = inode->
i_©ime
.tv_n£øðšode->
i_ùime
.tv_nsec = 0;

2734 
	`£t_Æšk
(
šode
, 
	`çt_subdœs
(inode)+2);

2737 
	}
}

2739 
	$ÿlc_çt_þu¡”s
(
su³r_block
 *
sb
)

2741 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

2744 ià(
sbi
->
çt_b™s
 != 12) {

2745 
’t_³r_£c
 = 
sb
->
s_blocksize
 * 8 / 
sbi
->
çt_b™s
;

2746  
’t_³r_£c
 * 
sbi
->
çt_Ëngth
;

2749  
sbi
->
çt_Ëngth
 * 
sb
->
s_blocksize
 * 8 / sbi->
çt_b™s
;

2750 
	}
}

2755 
çt_fžl_su³r
(
su³r_block
 *
sb
, *
d©a
, 
sž’t
, 
isvçt
,

2756 (*
£tup
)(
su³r_block
 *))

2758 
šode
 *
roÙ_šode
 = 
NULL
, *
çt_šode
 = NULL;

2759 
šode
 *
fsšfo_šode
 = 
NULL
;

2760 
bufãr_h—d
 *
bh
;

2761 
çt_boÙ_£ùÜ
 *
b
;

2762 
msdos_sb_šfo
 *
sbi
;

2763 
u16
 
logiÿl_£ùÜ_size
;

2764 
u32
 
tÙ®_£ùÜs
, 
tÙ®_þu¡”s
, 
çt_þu¡”s
, 
roÙdœ_£ùÜs
;

2765 
debug
;

2766 
medŸ
;

2767 
”rÜ
;

2768 
buf
[50];

2776 
sbi
 = 
	`kz®loc
((
msdos_sb_šfo
), 
GFP_KERNEL
);

2777 ià(!
sbi
)

2778  -
ENOMEM
;

2779 
sb
->
s_fs_šfo
 = 
sbi
;

2781 
sb
->
s_æags
 |ð
MS_NODIRATIME
;

2782 
sb
->
s_magic
 = 
MSDOS_SUPER_MAGIC
;

2783 
sb
->
s_Ý
 = &
çt_sÝs
;

2784 
sb
->
s_expÜt_Ý
 = &
çt_expÜt_Ýs
;

2785 
	`mu‹x_š™
(&
sbi
->
nfs_bužd_šode_lock
);

2786 
	`¿‹lim™_¡©e_š™
(&
sbi
->
¿‹lim™
, 
DEFAULT_RATELIMIT_INTERVAL
,

2787 
DEFAULT_RATELIMIT_BURST
);

2789 
”rÜ
 = 
	`·r£_ÝtiÚs
(
sb
, 
d©a
, 
isvçt
, 
sž’t
, &
debug
, &
sbi
->
ÝtiÚs
);

2790 ià(
”rÜ
)

2791 
out_çž
;

2793 
	`£tup
(
sb
);

2795 
”rÜ
 = -
EIO
;

2796 
	`sb_mš_blocksize
(
sb
, 512);

2798 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sb->blocksiz: %u\n", 
sb
->
s_blocksize
);

2801 
bh
 = 
	`sb_b»ad
(
sb
, 0);

2802 ià(
bh
 =ð
NULL
) {

2803 
	`çt_msg
(
sb
, 
KERN_ERR
, "unableo„ead boot sector");

2804 
out_çž
;

2807 
b
 = (
çt_boÙ_£ùÜ
 *è
bh
->
b_d©a
;

2808 ià(!
b
->
»£rved
) {

2809 ià(!
sž’t
)

2810 
	`çt_msg
(
sb
, 
KERN_ERR
, "bogus‚umber of„eserved sectors");

2811 
	`b»l£
(
bh
);

2812 
out_šv®id
;

2814 ià(!
b
->
çts
) {

2815 ià(!
sž’t
)

2816 
	`çt_msg
(
sb
, 
KERN_ERR
, "bogus‚umber of FAT structure");

2817 
	`b»l£
(
bh
);

2818 
out_šv®id
;

2826 
medŸ
 = 
b
->media;

2827 ià(!
	`çt_v®id_medŸ
(
medŸ
)) {

2828 ià(!
sž’t
)

2829 
	`çt_msg
(
sb
, 
KERN_ERR
, "invalid media value (0x%02x)",

2830 
medŸ
);

2831 
	`b»l£
(
bh
);

2832 
out_šv®id
;

2834 
logiÿl_£ùÜ_size
 = 
	`g‘_uÇligÃd_Ë16
(&
b
->
£ùÜ_size
);

2835 
	`´štk
Ð
KERN_ALERT
 "[cheÚ]†ogiÿl_£ùÜ_siz: %u\n", 
logiÿl_£ùÜ_size
 );

2837 ià(!
	`is_pow”_of_2
(
logiÿl_£ùÜ_size
)

2838 || (
logiÿl_£ùÜ_size
 < 512)

2839 || (
logiÿl_£ùÜ_size
 > 4096)) {

2840 ià(!
sž’t
)

2841 
	`çt_msg
(
sb
, 
KERN_ERR
, "bogus†ogical sector size %u",

2842 
logiÿl_£ùÜ_size
);

2843 
	`b»l£
(
bh
);

2844 
out_šv®id
;

2846 
sbi
->
£c_³r_þus
 = 
b
->sec_per_clus;

2848 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sec_³r_þu : %u \n", 
sbi
->
£c_³r_þus
 );

2850 ià(!
	`is_pow”_of_2
(
sbi
->
£c_³r_þus
)) {

2851 ià(!
sž’t
)

2852 
	`çt_msg
(
sb
, 
KERN_ERR
, "bogus sectors…er cluster %u",

2853 
sbi
->
£c_³r_þus
);

2854 
	`b»l£
(
bh
);

2855 
out_šv®id
;

2859 ià(
logiÿl_£ùÜ_size
 < 
sb
->
s_blocksize
) {

2860 
	`çt_msg
(
sb
, 
KERN_ERR
, "logical sector sizeoo small for device"

2861 " (logiÿÈ£ùÜ sizð%u)", 
logiÿl_£ùÜ_size
);

2862 
	`b»l£
(
bh
);

2863 
out_çž
;

2865 ià(
logiÿl_£ùÜ_size
 > 
sb
->
s_blocksize
) {

2866 
	`b»l£
(
bh
);

2868 ià(!
	`sb_£t_blocksize
(
sb
, 
logiÿl_£ùÜ_size
)) {

2869 
	`çt_msg
(
sb
, 
KERN_ERR
, "unableo set blocksize %u",

2870 
logiÿl_£ùÜ_size
);

2871 
out_çž
;

2873 
bh
 = 
	`sb_b»ad
(
sb
, 0);

2874 ià(
bh
 =ð
NULL
) {

2875 
	`çt_msg
(
sb
, 
KERN_ERR
, "unableo„ead boot sector"

2877 
sb
->
s_blocksize
);

2878 
out_çž
;

2880 
b
 = (
çt_boÙ_£ùÜ
 *è
bh
->
b_d©a
;

2883 
	`mu‹x_š™
(&
sbi
->
s_lock
);

2884 
sbi
->
þu¡”_size
 = 
sb
->
s_blocksize
 * sbi->
£c_³r_þus
;

2885 
sbi
->
þu¡”_b™s
 = 
	`ffs
(sbi->
þu¡”_size
) - 1;

2886 
sbi
->
çts
 = 
b
->fats;

2887 
sbi
->
çt_b™s
 = 0;

2888 
sbi
->
çt_¡¬t
 = 
	`Ë16_to_ýu
(
b
->
»£rved
);

2889 
çt_block
 = 
sbi
->
çt_¡¬t
;

2891 
sbi
->
çt_Ëngth
 = 
	`Ë16_to_ýu
(
b
->fat_length);

2892 
sbi
->
roÙ_þu¡”
 = 0;

2893 
sbi
->
ä“_þu¡”s
 = -1;

2894 
sbi
->
ä“_þus_v®id
 = 0;

2895 
sbi
->
´ev_ä“
 = 
FAT_START_ENT
;

2896 
sb
->
s_maxby‹s
 = 0xffffffff;

2898 ià(!
sbi
->
çt_Ëngth
 && 
b
->
çt32
.
Ëngth
) {

2899 
çt_boÙ_fsšfo
 *
fsšfo
;

2900 
bufãr_h—d
 *
fsšfo_bh
;

2903 
sbi
->
çt_b™s
 = 32;

2904 
sbi
->
çt_Ëngth
 = 
	`Ë32_to_ýu
(
b
->
çt32
.
Ëngth
);

2905 
sbi
->
roÙ_þu¡”
 = 
	`Ë32_to_ýu
(
b
->
çt32
.root_cluster);

2908 
sbi
->
fsšfo_£ùÜ
 = 
	`Ë16_to_ýu
(
b
->
çt32
.
šfo_£ùÜ
);

2909 ià(
sbi
->
fsšfo_£ùÜ
 == 0)

2910 
sbi
->
fsšfo_£ùÜ
 = 1;

2912 
fsšfo_bh
 = 
	`sb_b»ad
(
sb
, 
sbi
->
fsšfo_£ùÜ
);

2913 ià(
fsšfo_bh
 =ð
NULL
) {

2914 
	`çt_msg
(
sb
, 
KERN_ERR
, "bread failed, FSINFO block"

2915 " (£ùÜ = %lu)", 
sbi
->
fsšfo_£ùÜ
);

2916 
	`b»l£
(
bh
);

2917 
out_çž
;

2920 
fsšfo
 = (
çt_boÙ_fsšfo
 *)
fsšfo_bh
->
b_d©a
;

2921 ià(!
	`IS_FSINFO
(
fsšfo
)) {

2922 
	`çt_msg
(
sb
, 
KERN_WARNING
, "Invalid FSINFO signature: "

2924 
	`Ë32_to_ýu
(
fsšfo
->
sigÇtu»1
),

2925 
	`Ë32_to_ýu
(
fsšfo
->
sigÇtu»2
),

2926 
sbi
->
fsšfo_£ùÜ
);

2928 ià(
sbi
->
ÝtiÚs
.
u£ä“
)

2929 
sbi
->
ä“_þus_v®id
 = 1;

2930 
sbi
->
ä“_þu¡”s
 = 
	`Ë32_to_ýu
(
fsšfo
->free_clusters);

2931 
sbi
->
´ev_ä“
 = 
	`Ë32_to_ýu
(
fsšfo
->
Ãxt_þu¡”
);

2934 
	`b»l£
(
fsšfo_bh
);

2937 
sbi
->
dœ_³r_block
 = 
sb
->
s_blocksize
 / (
msdos_dœ_’Œy
);

2938 
sbi
->
dœ_³r_block_b™s
 = 
	`ffs
(sbi->
dœ_³r_block
) - 1;

2940 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->dœ_³r_block : %d, sbi->dœ_³r_block_b™ : %d \n", 
sbi
->
dœ_³r_block
, sbi->
dœ_³r_block_b™s
 );

2941 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sb->s_blocksiz: %u \n", 
sb
->
s_blocksize
 );

2942 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->þu¡”_sizðsb->s_blocksiz* sbi->£c_³r_þu : %u\n", 
sbi
->
þu¡”_size
 );

2943 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->çt Òumb” oàçtè: %u \n", 
sbi
->
çts
 );

2944 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->çt_Ëngth : %u \n", 
sbi
->
çt_Ëngth
 );

2945 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->çt_¡¬ˆ: %u \n", 
sbi
->
çt_¡¬t
 );

2947 
sbi
->
dœ_¡¬t
 = sbi->
çt_¡¬t
 + sbi->
çts
 * sbi->
çt_Ëngth
;

2948 
sbi
->
dœ_’Œ›s
 = 
	`g‘_uÇligÃd_Ë16
(&
b
->dir_entries);

2950 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->dœ_¡¬ˆ : %u \n", 
sbi
->
dœ_¡¬t
 );

2951 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->dœ_’Œ›  : %u \n", 
sbi
->
dœ_’Œ›s
 );

2953 ià(
sbi
->
dœ_’Œ›s
 & (sbi->
dœ_³r_block
 - 1)) {

2954 ià(!
sž’t
)

2955 
	`çt_msg
(
sb
, 
KERN_ERR
, "bogus directory-entries…er block"

2956 " (%u)", 
sbi
->
dœ_’Œ›s
);

2957 
	`b»l£
(
bh
);

2958 
out_šv®id
;

2961 
roÙdœ_£ùÜs
 = 
sbi
->
dœ_’Œ›s


2962 * (
msdos_dœ_’Œy
è/ 
sb
->
s_blocksize
;

2963 
sbi
->
d©a_¡¬t
 = sbi->
dœ_¡¬t
 + 
roÙdœ_£ùÜs
;

2965 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sbi->d©a_¡¬ˆ : %u \n", 
sbi
->
d©a_¡¬t
 );

2967 
tÙ®_£ùÜs
 = 
	`g‘_uÇligÃd_Ë16
(&
b
->
£ùÜs
);

2968 ià(
tÙ®_£ùÜs
 == 0)

2969 
tÙ®_£ùÜs
 = 
	`Ë32_to_ýu
(
b
->
tÙ®_£ù
);

2971 
tÙ®_þu¡”s
 = (
tÙ®_£ùÜs
 - 
sbi
->
d©a_¡¬t
è/ sbi->
£c_³r_þus
;

2973 
	`´štk
Ð
KERN_ALERT
 "[cheÚ]Ù®_þu¡” ðÑÙ®_£ùÜ - sbi->d©a_¡¬tè/ sbi->£c_³r_þu  : %u \n", 
tÙ®_þu¡”s
 );

2975 ià(
sbi
->
çt_b™s
 != 32)

2976 
sbi
->
çt_b™s
 = (
tÙ®_þu¡”s
 > 
MAX_FAT12
) ? 16 : 12;

2979 ià(
sbi
->
çt_b™s
 == 32)

2980 
sbi
->
dœty
 = 
b
->
çt32
.
¡©e
 & 
FAT_STATE_DIRTY
;

2982 
sbi
->
dœty
 = 
b
->
çt16
.
¡©e
 & 
FAT_STATE_DIRTY
;

2985 
çt_þu¡”s
 = 
	`ÿlc_çt_þu¡”s
(
sb
);

2986 
tÙ®_þu¡”s
 = 
	`mš
ÑÙ®_þu¡”s, 
çt_þu¡”s
 - 
FAT_START_ENT
);

2988 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] f©_þu¡” ðÿlc_çt_þu¡”s(sb): %u \n", 
çt_þu¡”s
 );

2989 
	`´štk
Ð
KERN_ALERT
 "[cheÚ]Ù®_þu¡” : mšÑÙ®_þu¡”s, f©_þu¡” - FAT_START_ENTè: %u \n", 
tÙ®_þu¡”s
 );

2991 ià(
tÙ®_þu¡”s
 > 
	`MAX_FAT
(
sb
)) {

2992 ià(!
sž’t
)

2993 
	`çt_msg
(
sb
, 
KERN_ERR
, "count of clustersoo big (%u)",

2994 
tÙ®_þu¡”s
);

2995 
	`b»l£
(
bh
);

2996 
out_šv®id
;

2999 
sbi
->
max_þu¡”
 = 
tÙ®_þu¡”s
 + 
FAT_START_ENT
;

3001 ià(
sbi
->
ä“_þu¡”s
 !ð-1 && sbi->ä“_þu¡” > 
tÙ®_þu¡”s
)

3002 
sbi
->
ä“_þu¡”s
 = -1;

3004 
sbi
->
´ev_ä“
 %ðsbi->
max_þu¡”
;

3005 ià(
sbi
->
´ev_ä“
 < 
FAT_START_ENT
)

3006 
sbi
->
´ev_ä“
 = 
FAT_START_ENT
;

3008 
	`b»l£
(
bh
);

3011 
	`çt_hash_š™
(
sb
);

3012 
	`dœ_hash_š™
(
sb
);

3013 
	`çt_’t_acûss_š™
(
sb
);

3023 
”rÜ
 = -
EINVAL
;

3024 
	`¥rštf
(
buf
, "ý%d", 
sbi
->
ÝtiÚs
.
cod•age
);

3025 
sbi
->
Æs_disk
 = 
	`lßd_Æs
(
buf
);

3026 ià(!
sbi
->
Æs_disk
) {

3027 
	`çt_msg
(
sb
, 
KERN_ERR
, "cod•ag% nÙ found", 
buf
);

3028 
out_çž
;

3032 ià(
sbi
->
ÝtiÚs
.
isvçt
) {

3033 
sbi
->
Æs_io
 = 
	`lßd_Æs
(sbi->
ÝtiÚs
.
ioch¬£t
);

3034 ià(!
sbi
->
Æs_io
) {

3035 
	`çt_msg
(
sb
, 
KERN_ERR
, "IO charset %s‚ot found",

3036 
sbi
->
ÝtiÚs
.
ioch¬£t
);

3037 
out_çž
;

3041 
”rÜ
 = -
ENOMEM
;

3042 
çt_šode
 = 
	`Ãw_šode
(
sb
);

3043 ià(!
çt_šode
)

3044 
out_çž
;

3045 
	`MSDOS_I
(
çt_šode
)->
i_pos
 = 0;

3046 
sbi
->
çt_šode
 = fat_inode;

3048 
fsšfo_šode
 = 
	`Ãw_šode
(
sb
);

3049 ià(!
fsšfo_šode
)

3050 
out_çž
;

3051 
fsšfo_šode
->
i_šo
 = 
MSDOS_FSINFO_INO
;

3052 
sbi
->
fsšfo_šode
 = fsinfo_inode;

3053 
	`š£¹_šode_hash
(
fsšfo_šode
);

3055 
roÙ_šode
 = 
	`Ãw_šode
(
sb
);

3056 ià(!
roÙ_šode
)

3057 
out_çž
;

3058 
roÙ_šode
->
i_šo
 = 
MSDOS_ROOT_INO
;

3059 
roÙ_šode
->
i_v”siÚ
 = 1;

3060 
”rÜ
 = 
	`çt_»ad_roÙ
(
roÙ_šode
);

3061 ià(
”rÜ
 < 0) {

3062 
	`ut
(
roÙ_šode
);

3063 
out_çž
;

3065 
”rÜ
 = -
ENOMEM
;

3066 
	`š£¹_šode_hash
(
roÙ_šode
);

3067 
	`çt_©ch
(
roÙ_šode
, 0);

3068 
sb
->
s_roÙ
 = 
	`d_make_roÙ
(
roÙ_šode
);

3069 ià(!
sb
->
s_roÙ
) {

3070 
	`çt_msg
(
sb
, 
KERN_ERR
, "get„oot inode failed");

3071 
out_çž
;

3074 ià(
sbi
->
ÝtiÚs
.
disÿrd
) {

3075 
»que¡_queue
 *
q
 = 
	`bdev_g‘_queue
(
sb
->
s_bdev
);

3076 ià(!
	`blk_queue_disÿrd
(
q
))

3077 
	`çt_msg
(
sb
, 
KERN_WARNING
,

3082 
	`çt_£t_¡©e
(
sb
, 1, 0);

3084 
sbi
->
couÁ
 = 0;

3085 
sbi
->
time
 = 0;

3086 
sbi
->
i_šo
 = -1;

3087 
sbi
->
fže_Çme
 = 
NULL
;

3095 
out_šv®id
:

3096 
”rÜ
 = -
EINVAL
;

3097 ià(!
sž’t
)

3098 
	`çt_msg
(
sb
, 
KERN_INFO
, "Can't find‡ valid FAT filesystem");

3100 
out_çž
:

3101 ià(
fsšfo_šode
)

3102 
	`ut
(
fsšfo_šode
);

3103 ià(
çt_šode
)

3104 
	`ut
(
çt_šode
);

3105 
	`uÆßd_Æs
(
sbi
->
Æs_io
);

3106 
	`uÆßd_Æs
(
sbi
->
Æs_disk
);

3107 ià(
sbi
->
ÝtiÚs
.
ioch¬£t
 !ð
çt_deçuÉ_ioch¬£t
)

3108 
	`kä“
(
sbi
->
ÝtiÚs
.
ioch¬£t
);

3109 
sb
->
s_fs_šfo
 = 
NULL
;

3110 
	`kä“
(
sbi
);

3111  
”rÜ
;

3112 
	}
}

3114 
EXPORT_SYMBOL_GPL
(
çt_fžl_su³r
);

3122 
	$wr™eback_šode
(
šode
 *inode)

3125 
»t
;

3131 
»t
 = 
	`sync_šode_m‘ad©a
(
šode
, 0);

3132 ià(!
»t
)

3133 
»t
 = 
	`fžem­_fd©awr™e
(
šode
->
i_m­pšg
);

3134  
»t
;

3135 
	}
}

3145 
	$çt_æush_šodes
(
su³r_block
 *
sb
, 
šode
 *
i1
, šod*
i2
)

3147 
»t
 = 0;

3148 ià(!
	`MSDOS_SB
(
sb
)->
ÝtiÚs
.
æush
)

3150 ià(
i1
)

3151 
»t
 = 
	`wr™eback_šode
(
i1
);

3152 ià(!
»t
 && 
i2
)

3153 
»t
 = 
	`wr™eback_šode
(
i2
);

3154 ià(!
»t
) {

3155 
add»ss_¥aû
 *
m­pšg
 = 
sb
->
s_bdev
->
bd_šode
->
i_m­pšg
;

3156 
»t
 = 
	`fžem­_æush
(
m­pšg
);

3158  
»t
;

3159 
	}
}

3160 
EXPORT_SYMBOL_GPL
(
çt_æush_šodes
);

3162 
__š™
 
	$š™_çt_fs
()

3164 
”r
;

3166 
”r
 = 
	`çt_ÿche_š™
();

3167 ià(
”r
)

3168  
”r
;

3170 
”r
 = 
	`çt_š™_šodeÿche
();

3171 ià(
”r
)

3172 
çžed
;

3176 
çžed
:

3177 
	`çt_ÿche_de¡roy
();

3178  
”r
;

3179 
	}
}

3181 
__ex™
 
	$ex™_çt_fs
()

3183 
	`çt_ÿche_de¡roy
();

3184 
	`çt_de¡roy_šodeÿche
();

3185 
	}
}

3187 
	$moduË_š™
(
š™_çt_fs
)

3188 
	$moduË_ex™
(
ex™_çt_fs
)

3190 
	`MODULE_LICENSE
("GPL");

	@misc.c

9 
	~<lšux/moduË.h
>

10 
	~<lšux/fs.h
>

11 
	~<lšux/bufãr_h—d.h
>

12 
	~<lšux/time.h
>

13 
	~"çt.h
"

23 
	$__çt_fs_”rÜ
(
su³r_block
 *
sb
, 
»pÜt
, cÚ¡ *
fmt
, ...)

25 
çt_mouÁ_ÝtiÚs
 *
Ýts
 = &
	`MSDOS_SB
(
sb
)->
ÝtiÚs
;

26 
va_li¡
 
¬gs
;

27 
va_fÜm©
 
vaf
;

29 ià(
»pÜt
) {

30 
	`va_¡¬t
(
¬gs
, 
fmt
);

31 
vaf
.
fmt
 = fmt;

32 
vaf
.
va
 = &
¬gs
;

33 
	`´štk
(
KERN_ERR
 "FAT-f (%s):ƒ¼Ü, %pV\n", 
sb
->
s_id
, &
vaf
);

34 
	`va_’d
(
¬gs
);

37 ià(
Ýts
->
”rÜs
 =ð
FAT_ERRORS_PANIC
)

38 
	`·nic
("FAT-f (%s): f ·niøäom…»viou ”rÜ\n", 
sb
->
s_id
);

39 ià(
Ýts
->
”rÜs
 =ð
FAT_ERRORS_RO
 && !(
sb
->
s_æags
 & 
MS_RDONLY
)) {

40 
sb
->
s_æags
 |ð
MS_RDONLY
;

41 
	`´štk
(
KERN_ERR
 "FAT-fs (%s): Filesystem has been "

42 "£ˆ»ad-Úly\n", 
sb
->
s_id
);

44 
	}
}

45 
EXPORT_SYMBOL_GPL
(
__çt_fs_”rÜ
);

51 
	$çt_msg
(
su³r_block
 *
sb
, cÚ¡ *
Ëv–
, cÚ¡ *
fmt
, ...)

53 
va_fÜm©
 
vaf
;

54 
va_li¡
 
¬gs
;

56 
	`va_¡¬t
(
¬gs
, 
fmt
);

57 
vaf
.
fmt
 = fmt;

58 
vaf
.
va
 = &
¬gs
;

59 
	`´štk
("%sFAT-f (%s): %pV\n", 
Ëv–
, 
sb
->
s_id
, &
vaf
);

60 
	`va_’d
(
¬gs
);

61 
	}
}

65 
	$çt_þu¡”s_æush
(
su³r_block
 *
sb
)

67 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

68 
bufãr_h—d
 *
bh
;

69 
çt_boÙ_fsšfo
 *
fsšfo
;

71 ià(
sbi
->
çt_b™s
 != 32)

74 
bh
 = 
	`sb_b»ad
(
sb
, 
sbi
->
fsšfo_£ùÜ
);

75 ià(
bh
 =ð
NULL
) {

76 
	`çt_msg
(
sb
, 
KERN_ERR
, "bread failed in fat_clusters_flush");

77  -
EIO
;

80 
fsšfo
 = (
çt_boÙ_fsšfo
 *)
bh
->
b_d©a
;

82 ià(!
	`IS_FSINFO
(
fsšfo
)) {

83 
	`çt_msg
(
sb
, 
KERN_ERR
, "Invalid FSINFO signature: "

85 
	`Ë32_to_ýu
(
fsšfo
->
sigÇtu»1
),

86 
	`Ë32_to_ýu
(
fsšfo
->
sigÇtu»2
),

87 
sbi
->
fsšfo_£ùÜ
);

89 ià(
sbi
->
ä“_þu¡”s
 != -1)

90 
fsšfo
->
ä“_þu¡”s
 = 
	`ýu_to_Ë32
(
sbi
->free_clusters);

91 ià(
sbi
->
´ev_ä“
 != -1)

92 
fsšfo
->
Ãxt_þu¡”
 = 
	`ýu_to_Ë32
(
sbi
->
´ev_ä“
);

93 
	`m¬k_bufãr_dœty
(
bh
);

95 
	`b»l£
(
bh
);

98 
	}
}

104 
	$çt_chaš_add
(
šode
 *šode, 
Ãw_dþus
, 
Ä_þu¡”
)

106 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

107 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

108 
»t
, 
Ãw_fþus
, 
Ï¡
;

114 
Ï¡
 = 
Ãw_fþus
 = 0;

115 ià(
	`MSDOS_I
(
šode
)->
i_¡¬t
) {

116 
fþus
, 
dþus
;

118 
»t
 = 
	`çt_g‘_þu¡”
(
šode
, 
FAT_ENT_EOF
, &
fþus
, &
dþus
);

119 ià(
»t
 < 0)

120  
»t
;

121 
Ãw_fþus
 = 
fþus
 + 1;

122 
Ï¡
 = 
dþus
;

126 ià(
Ï¡
) {

127 
çt_’Œy
 
ç‹Á
;

129 
	`ç‹Á_š™
(&
ç‹Á
);

130 
»t
 = 
	`çt_’t_»ad
(
šode
, &
ç‹Á
, 
Ï¡
);

131 ià(
»t
 >= 0) {

132 
wa™
 = 
	`šode_Ãeds_sync
(
šode
);

133 
»t
 = 
	`çt_’t_wr™e
(
šode
, &
ç‹Á
, 
Ãw_dþus
, 
wa™
);

134 
	`ç‹Á_b»l£
(&
ç‹Á
);

136 ià(
»t
 < 0)

137  
»t
;

144 
	`MSDOS_I
(
šode
)->
i_¡¬t
 = 
Ãw_dþus
;

145 
	`MSDOS_I
(
šode
)->
i_log¡¬t
 = 
Ãw_dþus
;

150 ià(
	`S_ISDIR
(
šode
->
i_mode
è&& 
	`IS_DIRSYNC
(inode)) {

151 
»t
 = 
	`çt_sync_šode
(
šode
);

152 ià(
»t
)

153  
»t
;

155 
	`m¬k_šode_dœty
(
šode
);

157 ià(
Ãw_fþus
 !ð(
šode
->
i_blocks
 >> (
sbi
->
þu¡”_b™s
 - 9))) {

158 
	`çt_fs_”rÜ
(
sb
, "clusters badly computed (%d != %llu)",

159 
Ãw_fþus
,

160 (
Îu
)(
šode
->
i_blocks
 >> (
sbi
->
þu¡”_b™s
 - 9)));

161 
	`çt_ÿche_šv®_šode
(
šode
);

163 
šode
->
i_blocks
 +ð
Ä_þu¡”
 << (
sbi
->
þu¡”_b™s
 - 9);

166 
	}
}

168 
timezÚe
 
sys_tz
;

180 
	#SECS_PER_MIN
 60

	)

181 
	#SECS_PER_HOUR
 (60 * 60)

	)

182 
	#SECS_PER_DAY
 (
SECS_PER_HOUR
 * 24)

	)

184 
	#DAYS_DELTA
 (365 * 10 + 2)

	)

186 
	#YEAR_2100
 120

	)

187 
	#IS_LEAP_YEAR
(
y
è(!((yè& 3è&& (yè!ð
YEAR_2100
)

	)

190 
time_t
 
	gdays_š_y—r
[] = {

197 
	$çt_time_çt2unix
(
msdos_sb_šfo
 *
sbi
, 
time¥ec
 *
ts
,

198 
__Ë16
 
__time
, __Ë16 
__d©e
, 
u8
 
time_cs
)

200 
u16
 
time
 = 
	`Ë16_to_ýu
(
__time
), 
d©e
 =†e16_to_ýu(
__d©e
);

201 
time_t
 
£cÚd
, 
day
, 
Ë­_day
, 
mÚth
, 
y—r
;

204 
y—r
 = 
d©e
 >> 9;

205 
mÚth
 = 
	`max
(1, (
d©e
 >> 5) & 0xf);

206 
day
 = 
	`max
(1, 
d©e
 & 0x1f) - 1;

208 
Ë­_day
 = (
y—r
 + 3) / 4;

209 ià(
y—r
 > 
YEAR_2100
)

210 
Ë­_day
--;

211 ià(
	`IS_LEAP_YEAR
(
y—r
è&& 
mÚth
 > 2)

212 
Ë­_day
++;

214 
£cÚd
 = (
time
 & 0x1f) << 1;

215 
£cÚd
 +ð((
time
 >> 5è& 0x3fè* 
SECS_PER_MIN
;

216 
£cÚd
 +ð(
time
 >> 11è* 
SECS_PER_HOUR
;

217 
£cÚd
 +ð(
y—r
 * 365 + 
Ë­_day


218 + 
days_š_y—r
[
mÚth
] + 
day


219 + 
DAYS_DELTA
è* 
SECS_PER_DAY
;

221 ià(!
sbi
->
ÝtiÚs
.
tz_£t
)

222 
£cÚd
 +ð
sys_tz
.
tz_mšu‹swe¡
 * 
SECS_PER_MIN
;

224 
£cÚd
 -ð
sbi
->
ÝtiÚs
.
time_off£t
 * 
SECS_PER_MIN
;

226 ià(
time_cs
) {

227 
ts
->
tv_£c
 = 
£cÚd
 + (
time_cs
 / 100);

228 
ts
->
tv_n£c
 = (
time_cs
 % 100) * 10000000;

237 
ts
->
tv_£c
 = 
£cÚd
;

238 
ts
->
tv_n£c
 = 0;

247 
	}
}

250 
	$çt_time_unix2çt
(
msdos_sb_šfo
 *
sbi
, 
time¥ec
 *
ts
,

251 
__Ë16
 *
time
, __Ë16 *
d©e
, 
u8
 *
time_cs
)

253 
tm
m;

254 
	`time_to_tm
(
ts
->
tv_£c
,

255 (
sbi
->
ÝtiÚs
.
tz_£t
 ? sbi->ÝtiÚs.
time_off£t
 :

256 -
sys_tz
.
tz_mšu‹swe¡
è* 
SECS_PER_MIN
, &
tm
);

259 ià(
tm
.
tm_y—r
 < 1980 - 1900) {

260 *
time
 = 0;

261 *
d©e
 = 
	`ýu_to_Ë16
((0 << 9) | (1 << 5) | 1);

262 ià(
time_cs
)

263 *
time_cs
 = 0;

266 ià(
tm
.
tm_y—r
 > 2107 - 1900) {

267 *
time
 = 
	`ýu_to_Ë16
((23 << 11) | (59 << 5) | 29);

268 *
d©e
 = 
	`ýu_to_Ë16
((127 << 9) | (12 << 5) | 31);

269 ià(
time_cs
)

270 *
time_cs
 = 199;

275 
tm
.
tm_y—r
 -= 80;

277 
tm
.
tm_mÚ
++;

279 
tm
.
tm_£c
 >>= 1;

281 *
time
 = 
	`ýu_to_Ë16
(
tm
.
tm_hour
 << 11 |m.
tm_mš
 << 5 |m.
tm_£c
);

282 *
d©e
 = 
	`ýu_to_Ë16
(
tm
.
tm_y—r
 << 9 |m.
tm_mÚ
 << 5 |m.
tm_mday
);

283 ià(
time_cs
)

285 *
time_cs
 = (
ts
->
tv_£c
 & 1è* 100 +s->
tv_n£c
 / 10000000;

291 
	}
}

292 
EXPORT_SYMBOL_GPL
(
çt_time_unix2çt
);

294 
	$çt_sync_bhs
(
bufãr_h—d
 **
bhs
, 
Ä_bhs
)

296 
i
, 
”r
 = 0;

298 
i
 = 0; i < 
Ä_bhs
; i++)

299 
	`wr™e_dœty_bufãr
(
bhs
[
i
], 
WRITE
);

301 
i
 = 0; i < 
Ä_bhs
; i++) {

302 
	`wa™_Ú_bufãr
(
bhs
[
i
]);

303 ià(!
”r
 && !
	`bufãr_u±od©e
(
bhs
[
i
]))

304 
”r
 = -
EIO
;

306  
”r
;

307 
	}
}

	@namei_msdos.c

9 
	~<lšux/moduË.h
>

10 
	~<lšux/time.h
>

11 
	~<lšux/bufãr_h—d.h
>

12 
	~"çt.h
"

15 
	gbad_ch¬s
[] = "*?<>|\"";

16 
	gbad_if_¡riù
[] = "+=,; ";

23 
	$msdos_fÜm©_Çme
(cÚ¡ *
Çme
, 
Ën
,

24 *
»s
, 
çt_mouÁ_ÝtiÚs
 *
Ýts
)

32 *
w®k
;

33 
c
;

34 
¥aû
;

36 ià(
Çme
[0] == '.') {

37 ià(
Ýts
->
dÙsOK
) {

39 
Çme
++;

40 
Ën
--;

42  -
EINVAL
;

47 
¥aû
 = 1;

48 
c
 = 0;

49 
w®k
 = 
»s
; 
Ën
 && walk -„es < 8; walk++) {

50 
c
 = *
Çme
++;

51 
Ën
--;

52 ià(
Ýts
->
Çme_check
 !ð'r' && 
	`¡rchr
(
bad_ch¬s
, 
c
))

53  -
EINVAL
;

54 ià(
Ýts
->
Çme_check
 =ð's' && 
	`¡rchr
(
bad_if_¡riù
, 
c
))

55  -
EINVAL
;

56 ià(
c
 >ð'A' && c <ð'Z' && 
Ýts
->
Çme_check
 == 's')

57  -
EINVAL
;

58 ià(
c
 < ' ' || c == ':' || c == '\\')

59  -
EINVAL
;

68 ià((
»s
 =ð
w®k
è&& (
c
 == 0xE5))

69 
c
 = 0x05;

70 ià(
c
 == '.')

72 
¥aû
 = (
c
 == ' ');

73 *
w®k
 = (!
Ýts
->
noÿ£
 && 
c
 >= 'a' && c <= 'z') ? c - 32 : c;

75 ià(
¥aû
)

76  -
EINVAL
;

77 ià(
Ýts
->
Çme_check
 =ð's' && 
Ën
 && 
c
 != '.') {

78 
c
 = *
Çme
++;

79 
Ën
--;

80 ià(
c
 != '.')

81  -
EINVAL
;

83 
c
 !ð'.' && 
Ën
--)

84 
c
 = *
Çme
++;

85 ià(
c
 == '.') {

86 
w®k
 - 
»s
 < 8)

87 *
w®k
++ = ' ';

88 
Ën
 > 0 && 
w®k
 - 
»s
 < 
MSDOS_NAME
) {

89 
c
 = *
Çme
++;

90 
Ën
--;

91 ià(
Ýts
->
Çme_check
 !ð'r' && 
	`¡rchr
(
bad_ch¬s
, 
c
))

92  -
EINVAL
;

93 ià(
Ýts
->
Çme_check
 == 's' &&

94 
	`¡rchr
(
bad_if_¡riù
, 
c
))

95  -
EINVAL
;

96 ià(
c
 < ' ' || c == ':' || c == '\\')

97  -
EINVAL
;

98 ià(
c
 == '.') {

99 ià(
Ýts
->
Çme_check
 == 's')

100  -
EINVAL
;

103 ià(
c
 >ð'A' && c <ð'Z' && 
Ýts
->
Çme_check
 == 's')

104  -
EINVAL
;

105 
¥aû
 = 
c
 == ' ';

106 ià(!
Ýts
->
noÿ£
 && 
c
 >= 'a' && c <= 'z')

107 *
w®k
++ = 
c
 - 32;

109 *
w®k
++ = 
c
;

111 ià(
¥aû
)

112  -
EINVAL
;

113 ià(
Ýts
->
Çme_check
 =ð's' && 
Ën
)

114  -
EINVAL
;

116 
w®k
 - 
»s
 < 
MSDOS_NAME
)

117 *
w®k
++ = ' ';

120 
	}
}

123 
	$msdos_fšd
(
šode
 *
dœ
, cÚ¡ *
Çme
, 
Ën
,

124 
çt_¦Ù_šfo
 *
sšfo
)

126 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
dœ
->
i_sb
);

127 
msdos_Çme
[
MSDOS_NAME
];

128 
”r
;

130 
”r
 = 
	`msdos_fÜm©_Çme
(
Çme
, 
Ën
, 
msdos_Çme
, &
sbi
->
ÝtiÚs
);

131 ià(
”r
)

132  -
ENOENT
;

134 
”r
 = 
	`çt_sÿn
(
dœ
, 
msdos_Çme
, 
sšfo
);

135 ià(!
”r
 && 
sbi
->
ÝtiÚs
.
dÙsOK
) {

136 ià(
Çme
[0] == '.') {

137 ià(!(
sšfo
->
de
->
©Œ
 & 
ATTR_HIDDEN
))

138 
”r
 = -
ENOENT
;

140 ià(
sšfo
->
de
->
©Œ
 & 
ATTR_HIDDEN
)

141 
”r
 = -
ENOENT
;

143 ià(
”r
)

144 
	`b»l£
(
sšfo
->
bh
);

146  
”r
;

147 
	}
}

155 
	$msdos_hash
(cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

156 
q¡r
 *qstr)

158 
çt_mouÁ_ÝtiÚs
 *
ÝtiÚs
 = &
	`MSDOS_SB
(
d’Œy
->
d_sb
)->options;

159 
msdos_Çme
[
MSDOS_NAME
];

160 
”rÜ
;

162 
”rÜ
 = 
	`msdos_fÜm©_Çme
(
q¡r
->
Çme
, q¡r->
Ën
, 
msdos_Çme
, 
ÝtiÚs
);

163 ià(!
”rÜ
)

164 
q¡r
->
hash
 = 
	`fuÎ_Çme_hash
(
msdos_Çme
, 
MSDOS_NAME
);

166 
	}
}

172 
	$msdos_cmp
(cÚ¡ 
d’Œy
 *
·»Á
, cÚ¡ 
šode
 *
pšode
,

173 cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

174 
Ën
, cÚ¡ *
¡r
, cÚ¡ 
q¡r
 *
Çme
)

176 
çt_mouÁ_ÝtiÚs
 *
ÝtiÚs
 = &
	`MSDOS_SB
(
·»Á
->
d_sb
)->options;

177 
a_msdos_Çme
[
MSDOS_NAME
], 
b_msdos_Çme
[MSDOS_NAME];

178 
”rÜ
;

180 
”rÜ
 = 
	`msdos_fÜm©_Çme
(
Çme
->Çme,‚ame->
Ën
, 
a_msdos_Çme
, 
ÝtiÚs
);

181 ià(
”rÜ
)

182 
Þd_com·»
;

183 
”rÜ
 = 
	`msdos_fÜm©_Çme
(
¡r
, 
Ën
, 
b_msdos_Çme
, 
ÝtiÚs
);

184 ià(
”rÜ
)

185 
Þd_com·»
;

186 
”rÜ
 = 
	`memcmp
(
a_msdos_Çme
, 
b_msdos_Çme
, 
MSDOS_NAME
);

187 
out
:

188  
”rÜ
;

190 
Þd_com·»
:

191 
”rÜ
 = 1;

192 ià(
Çme
->
Ën
 ==†en)

193 
”rÜ
 = 
	`memcmp
(
Çme
->Çme, 
¡r
, 
Ën
);

194 
out
;

195 
	}
}

197 cÚ¡ 
d’Œy_Ý”©iÚs
 
	gmsdos_d’Œy_Ý”©iÚs
 = {

198 .
d_hash
 = 
msdos_hash
,

199 .
	gd_com·»
 = 
msdos_cmp
,

207 
d’Œy
 *
	$msdos_lookup
(
šode
 *
dœ
, 
d’Œy
 *dentry,

208 
æags
)

210 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

211 
çt_¦Ù_šfo
 
sšfo
;

212 
šode
 *inode;

213 
”r
;

215 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

216 
”r
 = 
	`msdos_fšd
(
dœ
, 
d’Œy
->
d_Çme
.
Çme
, d’Œy->d_Çme.
Ën
, &
sšfo
);

217 
”r
) {

218 -
ENOENT
:

219 
šode
 = 
NULL
;

222 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

223 
	`b»l£
(
sšfo
.
bh
);

226 
šode
 = 
	`ERR_PTR
(
”r
);

228 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

229  
	`d_¥liû_®Ÿs
(
šode
, 
d’Œy
);

230 
	}
}

233 
	$msdos_add_’Œy
(
šode
 *
dœ
, cÚ¡ *
Çme
,

234 
is_dœ
, 
is_hid
, 
þu¡”
,

235 
time¥ec
 *
ts
, 
çt_¦Ù_šfo
 *
sšfo
)

237 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
dœ
->
i_sb
);

238 
msdos_dœ_’Œy
 
de
;

239 
__Ë16
 
time
, 
d©e
;

240 
”r
;

242 
	`memýy
(
de
.
Çme
,‚ame, 
MSDOS_NAME
);

243 
de
.
©Œ
 = 
is_dœ
 ? 
ATTR_DIR
 : 
ATTR_ARCH
;

244 ià(
is_hid
)

245 
de
.
©Œ
 |ð
ATTR_HIDDEN
;

246 
de
.
lÿ£
 = 0;

247 
	`çt_time_unix2çt
(
sbi
, 
ts
, &
time
, &
d©e
, 
NULL
);

248 
de
.
cd©e
 = de.
ad©e
 = 0;

249 
de
.
ùime
 = 0;

250 
de
.
ùime_cs
 = 0;

251 
de
.
time
 =ime;

252 
de
.
d©e
 = date;

253 
	`çt_£t_¡¬t
(&
de
, 
þu¡”
);

254 
de
.
size
 = 0;

256 
”r
 = 
	`çt_add_’Œ›s
(
dœ
, &
de
, 1, 
sšfo
);

257 ià(
”r
)

258  
”r
;

260 
dœ
->
i_ùime
 = dœ->
i_mtime
 = *
ts
;

261 ià(
	`IS_DIRSYNC
(
dœ
))

262 ()
	`çt_sync_šode
(
dœ
);

264 
	`m¬k_šode_dœty
(
dœ
);

267 
	}
}

270 
	$msdos_ü—‹
(
šode
 *
dœ
, 
d’Œy
 *d’Œy, 
umode_t
 
mode
,

271 
boÞ
 
exþ
)

273 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

274 
šode
 *šodð
NULL
;

275 
çt_¦Ù_šfo
 
sšfo
;

276 
time¥ec
 
ts
;

277 
msdos_Çme
[
MSDOS_NAME
];

278 
”r
, 
is_hid
;

280 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

282 
”r
 = 
	`msdos_fÜm©_Çme
(
d’Œy
->
d_Çme
.
Çme
, d’Œy->d_Çme.
Ën
,

283 
msdos_Çme
, &
	`MSDOS_SB
(
sb
)->
ÝtiÚs
);

284 ià(
”r
)

285 
out
;

286 
is_hid
 = (
d’Œy
->
d_Çme
.
Çme
[0] =ð'.'è&& (
msdos_Çme
[0] != '.');

288 ià(!
	`çt_sÿn
(
dœ
, 
msdos_Çme
, &
sšfo
)) {

289 
	`b»l£
(
sšfo
.
bh
);

290 
”r
 = -
EINVAL
;

291 
out
;

294 
ts
 = 
CURRENT_TIME_SEC
;

296 
”r
 = 
	`msdos_add_’Œy
(
dœ
, 
msdos_Çme
, 0, 
is_hid
, 0, &
ts
, &
sšfo
);

297 ià(
”r
)

298 
out
;

299 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

300 
	`b»l£
(
sšfo
.
bh
);

301 ià(
	`IS_ERR
(
šode
)) {

302 
”r
 = 
	`PTR_ERR
(
šode
);

303 
out
;

305 
šode
->
i_mtime
 = inode->
i_©ime
 = inode->
i_ùime
 = 
ts
;

308 
	`d_š¡ªtŸ‹
(
d’Œy
, 
šode
);

309 
out
:

310 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

311 ià(!
”r
)

312 
”r
 = 
	`çt_æush_šodes
(
sb
, 
dœ
, 
šode
);

313  
”r
;

314 
	}
}

317 
	$msdos_rmdœ
(
šode
 *
dœ
, 
d’Œy
 *dentry)

319 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

320 
šode
 *šodð
d’Œy
->
d_šode
;

321 
çt_¦Ù_šfo
 
sšfo
;

322 
”r
;

324 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

329 
”r
 = 
	`çt_dœ_em±y
(
šode
);

330 ià(
”r
)

331 
out
;

332 
”r
 = 
	`msdos_fšd
(
dœ
, 
d’Œy
->
d_Çme
.
Çme
, d’Œy->d_Çme.
Ën
, &
sšfo
);

333 ià(
”r
)

334 
out
;

336 
	`´štk
Ð
KERN_ALERT
 "[cheon] msdos_rmdir \n" );

337 
”r
 = 
	`çt_»move_’Œ›s
(
dœ
, &
sšfo
);

338 ià(
”r
)

339 
out
;

340 
	`drÝ_Æšk
(
dœ
);

342 
	`þ—r_Æšk
(
šode
);

343 
šode
->
i_ùime
 = 
CURRENT_TIME_SEC
;

345 
	`çt_d‘ach
(
šode
);

346 
out
:

347 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

348 ià(!
”r
)

349 
”r
 = 
	`çt_æush_šodes
(
sb
, 
dœ
, 
šode
);

351  
”r
;

352 
	}
}

355 
	$msdos_mkdœ
(
šode
 *
dœ
, 
d’Œy
 *d’Œy, 
umode_t
 
mode
)

357 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

358 
çt_¦Ù_šfo
 
sšfo
;

359 
šode
 *inode;

360 
msdos_Çme
[
MSDOS_NAME
];

361 
time¥ec
 
ts
;

362 
”r
, 
is_hid
, 
þu¡”
;

364 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

366 
”r
 = 
	`msdos_fÜm©_Çme
(
d’Œy
->
d_Çme
.
Çme
, d’Œy->d_Çme.
Ën
,

367 
msdos_Çme
, &
	`MSDOS_SB
(
sb
)->
ÝtiÚs
);

368 ià(
”r
)

369 
out
;

370 
is_hid
 = (
d’Œy
->
d_Çme
.
Çme
[0] =ð'.'è&& (
msdos_Çme
[0] != '.');

372 ià(!
	`çt_sÿn
(
dœ
, 
msdos_Çme
, &
sšfo
)) {

373 
	`b»l£
(
sšfo
.
bh
);

374 
”r
 = -
EINVAL
;

375 
out
;

379 
ts
 = 
CURRENT_TIME_SEC
;

380 
þu¡”
 = 
	`çt_®loc_Ãw_dœ
(
dœ
, &
ts
);

381 ià(
þu¡”
 < 0) {

382 
”r
 = 
þu¡”
;

383 
out
;

385 
”r
 = 
	`msdos_add_’Œy
(
dœ
, 
msdos_Çme
, 1, 
is_hid
, 
þu¡”
, &
ts
, &
sšfo
);

386 ià(
”r
)

387 
out_ä“
;

388 
	`šc_Æšk
(
dœ
);

390 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

391 
	`b»l£
(
sšfo
.
bh
);

392 ià(
	`IS_ERR
(
šode
)) {

393 
”r
 = 
	`PTR_ERR
(
šode
);

395 
out
;

397 
	`£t_Æšk
(
šode
, 2);

398 
šode
->
i_mtime
 = inode->
i_©ime
 = inode->
i_ùime
 = 
ts
;

401 
	`d_š¡ªtŸ‹
(
d’Œy
, 
šode
);

403 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

404 
	`çt_æush_šodes
(
sb
, 
dœ
, 
šode
);

407 
out_ä“
:

408 
	`´štk
Ð
KERN_ALERT
 "[cheon] msdos_mkdir, fat_free_clusters \n" );

409 
	`çt_ä“_þu¡”s
(
dœ
, 
þu¡”
);

410 
out
:

411 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

412  
”r
;

413 
	}
}

416 
	$msdos_uÆšk
(
šode
 *
dœ
, 
d’Œy
 *dentry)

418 
šode
 *šodð
d’Œy
->
d_šode
;

419 
su³r_block
 *
sb
 = 
šode
->
i_sb
;

420 
çt_¦Ù_šfo
 
sšfo
;

421 
”r
;

423 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

424 
”r
 = 
	`msdos_fšd
(
dœ
, 
d’Œy
->
d_Çme
.
Çme
, d’Œy->d_Çme.
Ën
, &
sšfo
);

425 ià(
”r
)

426 
out
;

428 
	`´štk
Ð
KERN_ALERT
 "[cheon] msdos_unlink \n" );

429 
”r
 = 
	`çt_»move_’Œ›s
(
dœ
, &
sšfo
);

430 ià(
”r
)

431 
out
;

432 
	`þ—r_Æšk
(
šode
);

434 
šode
->
i_ùime
 = 
CURRENT_TIME_SEC
;

435 
	`çt_d‘ach
(
šode
);

436 
out
:

437 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

438 ià(!
”r
)

439 
”r
 = 
	`çt_æush_šodes
(
sb
, 
dœ
, 
šode
);

441  
”r
;

442 
	}
}

444 
	$do_msdos_»Çme
(
šode
 *
Þd_dœ
, *
Þd_Çme
,

445 
d’Œy
 *
Þd_d’Œy
,

446 
šode
 *
Ãw_dœ
, *
Ãw_Çme
,

447 
d’Œy
 *
Ãw_d’Œy
, 
is_hid
)

449 
bufãr_h—d
 *
dÙdÙ_bh
;

450 
msdos_dœ_’Œy
 *
dÙdÙ_de
;

451 
šode
 *
Þd_šode
, *
Ãw_šode
;

452 
çt_¦Ù_šfo
 
Þd_sšfo
, 
sšfo
;

453 
time¥ec
 
ts
;

454 
loff_t
 
Ãw_i_pos
;

455 
”r
, 
Þd_©Œs
, 
is_dœ
, 
upd©e_dÙdÙ
, 
cÜru±
 = 0;

457 
Þd_sšfo
.
bh
 = 
sšfo
.bh = 
dÙdÙ_bh
 = 
NULL
;

458 
Þd_šode
 = 
Þd_d’Œy
->
d_šode
;

459 
Ãw_šode
 = 
Ãw_d’Œy
->
d_šode
;

461 
”r
 = 
	`çt_sÿn
(
Þd_dœ
, 
Þd_Çme
, &
Þd_sšfo
);

462 ià(
”r
) {

463 
”r
 = -
EIO
;

464 
out
;

467 
is_dœ
 = 
	`S_ISDIR
(
Þd_šode
->
i_mode
);

468 
upd©e_dÙdÙ
 = (
is_dœ
 && 
Þd_dœ
 !ð
Ãw_dœ
);

469 ià(
upd©e_dÙdÙ
) {

470 ià(
	`çt_g‘_dÙdÙ_’Œy
(
Þd_šode
, &
dÙdÙ_bh
, &
dÙdÙ_de
)) {

471 
”r
 = -
EIO
;

472 
out
;

476 
Þd_©Œs
 = 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
;

477 
”r
 = 
	`çt_sÿn
(
Ãw_dœ
, 
Ãw_Çme
, &
sšfo
);

478 ià(!
”r
) {

479 ià(!
Ãw_šode
) {

481 ià(
sšfo
.
de
 !ð
Þd_sšfo
.de) {

482 
”r
 = -
EINVAL
;

483 
out
;

485 ià(
is_hid
)

486 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 |ð
ATTR_HIDDEN
;

488 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 &ð~
ATTR_HIDDEN
;

489 ià(
	`IS_DIRSYNC
(
Þd_dœ
)) {

490 
”r
 = 
	`çt_sync_šode
(
Þd_šode
);

491 ià(
”r
) {

492 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 = 
Þd_©Œs
;

493 
out
;

496 
	`m¬k_šode_dœty
(
Þd_šode
);

498 
Þd_dœ
->
i_v”siÚ
++;

500 
Þd_dœ
->
i_ùime
 = old_dœ->
i_mtime
 = 
CURRENT_TIME_SEC
;

501 ià(
	`IS_DIRSYNC
(
Þd_dœ
))

502 ()
	`çt_sync_šode
(
Þd_dœ
);

504 
	`m¬k_šode_dœty
(
Þd_dœ
);

505 
out
;

509 
ts
 = 
CURRENT_TIME_SEC
;

511 ià(
Ãw_šode
) {

512 ià(
”r
)

513 
out
;

514 ià(
is_dœ
) {

515 
”r
 = 
	`çt_dœ_em±y
(
Ãw_šode
);

516 ià(
”r
)

517 
out
;

519 
Ãw_i_pos
 = 
	`MSDOS_I
(
Ãw_šode
)->
i_pos
;

520 
	`çt_d‘ach
(
Ãw_šode
);

522 
”r
 = 
	`msdos_add_’Œy
(
Ãw_dœ
, 
Ãw_Çme
, 
is_dœ
, 
is_hid
, 0,

523 &
ts
, &
sšfo
);

524 ià(
”r
)

525 
out
;

526 
Ãw_i_pos
 = 
sšfo
.
i_pos
;

528 
Ãw_dœ
->
i_v”siÚ
++;

530 
	`çt_d‘ach
(
Þd_šode
);

531 
	`çt_©ch
(
Þd_šode
, 
Ãw_i_pos
);

532 ià(
is_hid
)

533 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 |ð
ATTR_HIDDEN
;

535 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 &ð~
ATTR_HIDDEN
;

536 ià(
	`IS_DIRSYNC
(
Ãw_dœ
)) {

537 
”r
 = 
	`çt_sync_šode
(
Þd_šode
);

538 ià(
”r
)

539 
”rÜ_šode
;

541 
	`m¬k_šode_dœty
(
Þd_šode
);

543 ià(
upd©e_dÙdÙ
) {

544 
	`çt_£t_¡¬t
(
dÙdÙ_de
, 
	`MSDOS_I
(
Ãw_dœ
)->
i_log¡¬t
);

545 
	`m¬k_bufãr_dœty_šode
(
dÙdÙ_bh
, 
Þd_šode
);

546 ià(
	`IS_DIRSYNC
(
Ãw_dœ
)) {

547 
”r
 = 
	`sync_dœty_bufãr
(
dÙdÙ_bh
);

548 ià(
”r
)

549 
”rÜ_dÙdÙ
;

551 
	`drÝ_Æšk
(
Þd_dœ
);

552 ià(!
Ãw_šode
)

553 
	`šc_Æšk
(
Ãw_dœ
);

556 
	`´štk
Ð
KERN_ALERT
 "[cheon] do_msdos_rename \n");

557 
”r
 = 
	`çt_»move_’Œ›s
(
Þd_dœ
, &
Þd_sšfo
);

558 
Þd_sšfo
.
bh
 = 
NULL
;

559 ià(
”r
)

560 
”rÜ_dÙdÙ
;

561 
Þd_dœ
->
i_v”siÚ
++;

562 
Þd_dœ
->
i_ùime
 = old_dœ->
i_mtime
 = 
ts
;

563 ià(
	`IS_DIRSYNC
(
Þd_dœ
))

564 ()
	`çt_sync_šode
(
Þd_dœ
);

566 
	`m¬k_šode_dœty
(
Þd_dœ
);

568 ià(
Ãw_šode
) {

569 
	`drÝ_Æšk
(
Ãw_šode
);

570 ià(
is_dœ
)

571 
	`drÝ_Æšk
(
Ãw_šode
);

572 
Ãw_šode
->
i_ùime
 = 
ts
;

574 
out
:

575 
	`b»l£
(
sšfo
.
bh
);

576 
	`b»l£
(
dÙdÙ_bh
);

577 
	`b»l£
(
Þd_sšfo
.
bh
);

578  
”r
;

580 
”rÜ_dÙdÙ
:

582 
cÜru±
 = 1;

584 ià(
upd©e_dÙdÙ
) {

585 
	`çt_£t_¡¬t
(
dÙdÙ_de
, 
	`MSDOS_I
(
Þd_dœ
)->
i_log¡¬t
);

586 
	`m¬k_bufãr_dœty_šode
(
dÙdÙ_bh
, 
Þd_šode
);

587 
cÜru±
 |ð
	`sync_dœty_bufãr
(
dÙdÙ_bh
);

589 
”rÜ_šode
:

590 
	`çt_d‘ach
(
Þd_šode
);

591 
	`çt_©ch
(
Þd_šode
, 
Þd_sšfo
.
i_pos
);

592 
	`MSDOS_I
(
Þd_šode
)->
i_©Œs
 = 
Þd_©Œs
;

593 ià(
Ãw_šode
) {

594 
	`çt_©ch
(
Ãw_šode
, 
Ãw_i_pos
);

595 ià(
cÜru±
)

596 
cÜru±
 |ð
	`çt_sync_šode
(
Ãw_šode
);

603 
	`´štk
Ð
KERN_ALERT
 "[cheon] do_msdos_rename,ƒrr_inode \n");

604 
”r2
 = 
	`çt_»move_’Œ›s
(
Ãw_dœ
, &
sšfo
);

605 ià(
cÜru±
)

606 
cÜru±
 |ð
”r2
;

607 
sšfo
.
bh
 = 
NULL
;

609 ià(
cÜru±
 < 0) {

610 
	`çt_fs_”rÜ
(
Ãw_dœ
->
i_sb
,

612 
__func__
, 
sšfo
.
i_pos
);

614 
out
;

615 
	}
}

618 
	$msdos_»Çme
(
šode
 *
Þd_dœ
, 
d’Œy
 *
Þd_d’Œy
,

619 
šode
 *
Ãw_dœ
, 
d’Œy
 *
Ãw_d’Œy
)

621 
su³r_block
 *
sb
 = 
Þd_dœ
->
i_sb
;

622 
Þd_msdos_Çme
[
MSDOS_NAME
], 
Ãw_msdos_Çme
[MSDOS_NAME];

623 
”r
, 
is_hid
;

625 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

627 
”r
 = 
	`msdos_fÜm©_Çme
(
Þd_d’Œy
->
d_Çme
.
Çme
,

628 
Þd_d’Œy
->
d_Çme
.
Ën
, 
Þd_msdos_Çme
,

629 &
	`MSDOS_SB
(
Þd_dœ
->
i_sb
)->
ÝtiÚs
);

630 ià(
”r
)

631 
out
;

632 
”r
 = 
	`msdos_fÜm©_Çme
(
Ãw_d’Œy
->
d_Çme
.
Çme
,

633 
Ãw_d’Œy
->
d_Çme
.
Ën
, 
Ãw_msdos_Çme
,

634 &
	`MSDOS_SB
(
Ãw_dœ
->
i_sb
)->
ÝtiÚs
);

635 ià(
”r
)

636 
out
;

638 
is_hid
 =

639 (
Ãw_d’Œy
->
d_Çme
.
Çme
[0] =ð'.'è&& (
Ãw_msdos_Çme
[0] != '.');

641 
”r
 = 
	`do_msdos_»Çme
(
Þd_dœ
, 
Þd_msdos_Çme
, 
Þd_d’Œy
,

642 
Ãw_dœ
, 
Ãw_msdos_Çme
, 
Ãw_d’Œy
, 
is_hid
);

643 
out
:

644 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

645 ià(!
”r
)

646 
”r
 = 
	`çt_æush_šodes
(
sb
, 
Þd_dœ
, 
Ãw_dœ
);

647  
”r
;

648 
	}
}

650 cÚ¡ 
šode_Ý”©iÚs
 
	gmsdos_dœ_šode_Ý”©iÚs
 = {

651 .
ü—‹
 = 
msdos_ü—‹
,

652 .
	glookup
 = 
msdos_lookup
,

653 .
	guÆšk
 = 
msdos_uÆšk
,

654 .
	gmkdœ
 = 
msdos_mkdœ
,

655 .
	grmdœ
 = 
msdos_rmdœ
,

656 .
	g»Çme
 = 
msdos_»Çme
,

657 .
	g£‰r
 = 
çt_£‰r
,

658 .
	gg‘©Œ
 = 
çt_g‘©Œ
,

661 
	$£tup
(
su³r_block
 *
sb
)

663 
	`MSDOS_SB
(
sb
)->
dœ_Ýs
 = &
msdos_dœ_šode_Ý”©iÚs
;

664 
sb
->
s_d_Ý
 = &
msdos_d’Œy_Ý”©iÚs
;

665 
sb
->
s_æags
 |ð
MS_NOATIME
;

666 
	}
}

668 
	$msdos_fžl_su³r
(
su³r_block
 *
sb
, *
d©a
, 
sž’t
)

670  
	`çt_fžl_su³r
(
sb
, 
d©a
, 
sž’t
, 0, 
£tup
);

671 
	}
}

673 
d’Œy
 *
	$msdos_mouÁ
(
fže_sy¡em_ty³
 *
fs_ty³
,

674 
æags
, cÚ¡ *
dev_Çme
,

675 *
d©a
)

677  
	`mouÁ_bdev
(
fs_ty³
, 
æags
, 
dev_Çme
, 
d©a
, 
msdos_fžl_su³r
);

678 
	}
}

680 
fže_sy¡em_ty³
 
	gmsdos_fs_ty³
 = {

681 .
owÃr
 = 
THIS_MODULE
,

682 .
	gÇme
 = "msdos_opel",

683 .
	gmouÁ
 = 
msdos_mouÁ
,

684 .
	gkžl_sb
 = 
kžl_block_su³r
,

685 .
	gfs_æags
 = 
FS_REQUIRES_DEV
,

687 
MODULE_ALIAS_FS
("msdos_opel");

689 
__š™
 
	$š™_msdos_fs
()

691  
	`»gi¡”_fžesy¡em
(&
msdos_fs_ty³
);

692 
	}
}

694 
__ex™
 
	$ex™_msdos_fs
()

696 
	`uÄegi¡”_fžesy¡em
(&
msdos_fs_ty³
);

697 
	}
}

699 
MODULE_LICENSE
("GPL");

700 
MODULE_AUTHOR
("Werner Almesberger");

701 
MODULE_DESCRIPTION
("MS-DOS filesystem support");

703 
	$moduË_š™
(
š™_msdos_fs
)

704 
	`moduË_ex™
(
ex™_msdos_fs
)

	@namei_vfat.c

18 
	#_FAT_


	)

19 
	#__VARIABLE_EXT__


	)

20 
	~<lšux/k”Ãl.h
>

22 
	~<lšux/moduË.h
>

23 
	~<lšux/jiff›s.h
>

24 
	~<lšux/ùy³.h
>

25 
	~<lšux/¦ab.h
>

26 
	~<lšux/bufãr_h—d.h
>

27 
	~<lšux/Çmei.h
>

28 
	~"çt.h
"

31 
PA
 
	g¬—_PA
[ 
TOTAL_AREA_CNT
 ];

35 
	gmªag”_cÚŒÞ_sd1
[20];

36 
	gmªag”_cÚŒÞ_sd2
[20];

37 
su³r_block
 *
	gg_sb_s1
;

38 
su³r_block
 *
	gg_sb_s2
;

39 
	gg_tÙ®_þu¡”_s1
[10];

40 
	gg_tÙ®_þu¡”_s2
[10];

50 
	$vçt_»v®id©e_shÜŠame
(
d’Œy
 *dentry)

52 
»t
 = 1;

53 
	`¥š_lock
(&
d’Œy
->
d_lock
);

54 ià(
d’Œy
->
d_time
 !ðd’Œy->
d_·»Á
->
d_šode
->
i_v”siÚ
)

55 
»t
 = 0;

56 
	`¥š_uÆock
(&
d’Œy
->
d_lock
);

57  
»t
;

58 
	}
}

60 
	$vçt_»v®id©e
(
d’Œy
 *d’Œy, 
æags
)

62 ià(
æags
 & 
LOOKUP_RCU
)

63  -
ECHILD
;

66 ià(
d’Œy
->
d_šode
)

68  
	`vçt_»v®id©e_shÜŠame
(
d’Œy
);

69 
	}
}

71 
	$vçt_»v®id©e_ci
(
d’Œy
 *d’Œy, 
æags
)

73 ià(
æags
 & 
LOOKUP_RCU
)

74  -
ECHILD
;

86 ià(
d’Œy
->
d_šode
)

93 ià(!
æags
)

101 ià(
æags
 & (
LOOKUP_CREATE
 | 
LOOKUP_RENAME_TARGET
))

104  
	`vçt_»v®id©e_shÜŠame
(
d’Œy
);

105 
	}
}

108 
	$__vçt_¡rž_Ën
(
Ën
, cÚ¡ *
Çme
)

110 
Ën
 && 
Çme
[len - 1] == '.')

111 
Ën
--;

112  
Ën
;

113 
	}
}

115 
	$vçt_¡rž_Ën
(cÚ¡ 
q¡r
 *qstr)

117  
	`__vçt_¡rž_Ën
(
q¡r
->
Ën
, q¡r->
Çme
);

118 
	}
}

126 
	$vçt_hash
(cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

127 
q¡r
 *qstr)

129 
q¡r
->
hash
 = 
	`fuÎ_Çme_hash
(q¡r->
Çme
, 
	`vçt_¡rž_Ën
(qstr));

131 
	}
}

139 
	$vçt_hashi
(cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

140 
q¡r
 *qstr)

142 
Æs_bË
 *
t
 = 
	`MSDOS_SB
(
d’Œy
->
d_sb
)->
Æs_io
;

143 cÚ¡ *
Çme
;

144 
Ën
;

145 
hash
;

147 
Çme
 = 
q¡r
->name;

148 
Ën
 = 
	`vçt_¡rž_Ën
(
q¡r
);

150 
hash
 = 
	`š™_Çme_hash
();

151 
Ën
--)

152 
hash
 = 
	`·¹Ÿl_Çme_hash
(
	`Æs_tÞow”
(
t
, *
Çme
++), hash);

153 
q¡r
->
hash
 = 
	`’d_Çme_hash
(hash);

156 
	}
}

161 
	$vçt_cmpi
(cÚ¡ 
d’Œy
 *
·»Á
, cÚ¡ 
šode
 *
pšode
,

162 cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

163 
Ën
, cÚ¡ *
¡r
, cÚ¡ 
q¡r
 *
Çme
)

165 
Æs_bË
 *
t
 = 
	`MSDOS_SB
(
·»Á
->
d_sb
)->
Æs_io
;

166 
®’
, 
bËn
;

169 
®’
 = 
	`vçt_¡rž_Ën
(
Çme
);

170 
bËn
 = 
	`__vçt_¡rž_Ën
(
Ën
, 
¡r
);

171 ià(
®’
 =ð
bËn
) {

172 ià(
	`Æs_¡ºicmp
(
t
, 
Çme
->Çme, 
¡r
, 
®’
) == 0)

176 
	}
}

181 
	$vçt_cmp
(cÚ¡ 
d’Œy
 *
·»Á
, cÚ¡ 
šode
 *
pšode
,

182 cÚ¡ 
d’Œy
 *d’Œy, cÚ¡ 
šode
 *inode,

183 
Ën
, cÚ¡ *
¡r
, cÚ¡ 
q¡r
 *
Çme
)

185 
®’
, 
bËn
;

188 
®’
 = 
	`vçt_¡rž_Ën
(
Çme
);

189 
bËn
 = 
	`__vçt_¡rž_Ën
(
Ën
, 
¡r
);

190 ià(
®’
 =ð
bËn
) {

191 ià(
	`¡ºcmp
(
Çme
->Çme, 
¡r
, 
®’
) == 0)

195 
	}
}

197 cÚ¡ 
d’Œy_Ý”©iÚs
 
	gvçt_ci_d’Œy_Ýs
 = {

198 .
d_»v®id©e
 = 
vçt_»v®id©e_ci
,

199 .
	gd_hash
 = 
vçt_hashi
,

200 .
	gd_com·»
 = 
vçt_cmpi
,

203 cÚ¡ 
d’Œy_Ý”©iÚs
 
	gvçt_d’Œy_Ýs
 = {

204 .
d_»v®id©e
 = 
vçt_»v®id©e
,

205 .
	gd_hash
 = 
vçt_hash
,

206 .
	gd_com·»
 = 
vçt_cmp
,

211 
šlše
 
wch¬_t
 
	$vçt_bad_ch¬
(
wch¬_t
 
w
)

213  (
w
 < 0x0020)

214 || (
w
 == '*') || (w == '?') || (w == '<') || (w == '>')

215 || (
w
 == '|') || (w == '"') || (w == ':') || (w == '/')

216 || (
w
 == '\\');

217 
	}
}

219 
šlše
 
wch¬_t
 
	$vçt_»¶aû_ch¬
(
wch¬_t
 
w
)

221  (
w
 == '[') || (w == ']') || (w == ';') || (w == ',')

222 || (
w
 == '+') || (w == '=');

223 
	}
}

225 
wch¬_t
 
	$vçt_sk_ch¬
(
wch¬_t
 
w
)

227  (
w
 == '.') || (w == ' ');

228 
	}
}

230 
šlše
 
	$vçt_is_u£d_badch¬s
(cÚ¡ 
wch¬_t
 *
s
, 
Ën
)

232 
i
;

234 
i
 = 0; i < 
Ën
; i++)

235 ià(
	`vçt_bad_ch¬
(
s
[
i
]))

236  -
EINVAL
;

238 ià(
s
[
i
 - 1] == ' ')

239  -
EINVAL
;

242 
	}
}

244 
	$vçt_fšd_fÜm
(
šode
 *
dœ
, *
Çme
)

246 
çt_¦Ù_šfo
 
sšfo
;

247 
”r
 = 
	`çt_sÿn
(
dœ
, 
Çme
, &
sšfo
);

248 ià(
”r
)

249  -
ENOENT
;

250 
	`b»l£
(
sšfo
.
bh
);

252 
	}
}

274 
	sshÜŠame_šfo
 {

275 
	mlow”
:1,

276 
	muµ”
:1,

277 
	mv®id
:1;

279 
	#INIT_SHORTNAME_INFO
(
x
) do { \

280 (
x
)->
low”
 = 1; \

281 (
x
)->
uµ”
 = 1; \

282 (
x
)->
v®id
 = 1; \

283 } 0)

	)

285 
šlše
 
	$to_shÜŠame_ch¬
(
Æs_bË
 *
Æs
,

286 *
buf
, 
buf_size
,

287 
wch¬_t
 *
¤c
, 
shÜŠame_šfo
 *
šfo
)

289 
Ën
;

291 ià(
	`vçt_sk_ch¬
(*
¤c
)) {

292 
šfo
->
v®id
 = 0;

295 ià(
	`vçt_»¶aû_ch¬
(*
¤c
)) {

296 
šfo
->
v®id
 = 0;

297 
buf
[0] = '_';

301 
Ën
 = 
Æs
->
	`uni2ch¬
(*
¤c
, 
buf
, 
buf_size
);

302 ià(
Ën
 <= 0) {

303 
šfo
->
v®id
 = 0;

304 
buf
[0] = '_';

305 
Ën
 = 1;

306 } ià(
Ën
 == 1) {

307 
´ev
 = 
buf
[0];

309 ià(
buf
[0] >= 0x7F) {

310 
šfo
->
low”
 = 0;

311 
šfo
->
uµ”
 = 0;

314 
buf
[0] = 
	`Æs_touµ”
(
Æs
, buf[0]);

315 ià(
	`i§Íha
(
buf
[0])) {

316 ià(
buf
[0] =ð
´ev
)

317 
šfo
->
low”
 = 0;

319 
šfo
->
uµ”
 = 0;

322 
šfo
->
low”
 = 0;

323 
šfo
->
uµ”
 = 0;

326  
Ën
;

327 
	}
}

335 
	$vçt_ü—‹_shÜŠame
(
šode
 *
dœ
, 
Æs_bË
 *
Æs
,

336 
wch¬_t
 *
uÇme
, 
uËn
,

337 *
Çme_»s
, *
lÿ£
)

339 
çt_mouÁ_ÝtiÚs
 *
Ýts
 = &
	`MSDOS_SB
(
dœ
->
i_sb
)->
ÝtiÚs
;

340 
wch¬_t
 *

, *
ext_¡¬t
, *
’d
, *
Çme_¡¬t
;

341 
ba£
[9], 
ext
[4], 
buf
[5], *
p
;

342 
ch¬buf
[
NLS_MAX_CHARSET_SIZE
];

343 
chl
, 
chi
;

344 
sz
 = 0, 
exŽ’
, 
ba£Ën
, 
i
, 
numž_ba£Ën
, 
numž2_ba£Ën
;

345 
is_shÜŠame
;

346 
shÜŠame_šfo
 
ba£_šfo
, 
ext_šfo
;

348 
is_shÜŠame
 = 1;

349 
	`INIT_SHORTNAME_INFO
(&
ba£_šfo
);

350 
	`INIT_SHORTNAME_INFO
(&
ext_šfo
);

353 
ext_¡¬t
 = 
’d
 = &
uÇme
[
uËn
];

354 --
ext_¡¬t
 >ð
uÇme
) {

355 ià(*
ext_¡¬t
 == 0x002E) {

356 ià(
ext_¡¬t
 =ð
’d
 - 1) {

357 
sz
 = 
uËn
;

358 
ext_¡¬t
 = 
NULL
;

364 ià(
ext_¡¬t
 =ð
uÇme
 - 1) {

365 
sz
 = 
uËn
;

366 
ext_¡¬t
 = 
NULL
;

367 } ià(
ext_¡¬t
) {

373 
Çme_¡¬t
 = &
uÇme
[0];

374 
Çme_¡¬t
 < 
ext_¡¬t
) {

375 ià(!
	`vçt_sk_ch¬
(*
Çme_¡¬t
))

377 
Çme_¡¬t
++;

379 ià(
Çme_¡¬t
 !ð
ext_¡¬t
) {

380 
sz
 = 
ext_¡¬t
 - 
uÇme
;

381 
ext_¡¬t
++;

383 
sz
 = 
uËn
;

384 
ext_¡¬t
 = 
NULL
;

388 
numž_ba£Ën
 = 6;

389 
numž2_ba£Ën
 = 2;

390 
ba£Ën
 = 
i
 = 0, 
p
 = 
ba£
, 

 = 
uÇme
; i < 
sz
; i++, ip++) {

391 
chl
 = 
	`to_shÜŠame_ch¬
(
Æs
, 
ch¬buf
, (charbuf),

392 

, &
ba£_šfo
);

393 ià(
chl
 == 0)

396 ià(
ba£Ën
 < 2 && (ba£ËÀ+ 
chl
) > 2)

397 
numž2_ba£Ën
 = 
ba£Ën
;

398 ià(
ba£Ën
 < 6 && (ba£ËÀ+ 
chl
) > 6)

399 
numž_ba£Ën
 = 
ba£Ën
;

400 
chi
 = 0; ch˜< 
chl
; chi++) {

401 *
p
++ = 
ch¬buf
[
chi
];

402 
ba£Ën
++;

403 ià(
ba£Ën
 >= 8)

406 ià(
ba£Ën
 >= 8) {

407 ià((
chi
 < 
chl
 - 1è|| (

 + 1è- 
uÇme
 < 
sz
)

408 
is_shÜŠame
 = 0;

412 ià(
ba£Ën
 == 0) {

413  -
EINVAL
;

416 
exŽ’
 = 0;

417 ià(
ext_¡¬t
) {

418 
p
 = 
ext
, 

 = 
ext_¡¬t
; 
exŽ’
 < 3 && i°< 
’d
; ip++) {

419 
chl
 = 
	`to_shÜŠame_ch¬
(
Æs
, 
ch¬buf
, (charbuf),

420 

, &
ext_šfo
);

421 ià(
chl
 == 0)

424 ià((
exŽ’
 + 
chl
) > 3) {

425 
is_shÜŠame
 = 0;

428 
chi
 = 0; ch˜< 
chl
; chi++) {

429 *
p
++ = 
ch¬buf
[
chi
];

430 
exŽ’
++;

432 ià(
exŽ’
 >= 3) {

433 ià(

 + 1 !ð
’d
)

434 
is_shÜŠame
 = 0;

439 
ext
[
exŽ’
] = '\0';

440 
ba£
[
ba£Ën
] = '\0';

443 ià(
ba£
[0] =ð
DELETED_FLAG
)

444 
ba£
[0] = 0x05;

451 
	`mem£t
(
Çme_»s
, ' ', 
MSDOS_NAME
);

452 
	`memýy
(
Çme_»s
, 
ba£
, 
ba£Ën
);

453 
	`memýy
(
Çme_»s
 + 8, 
ext
, 
exŽ’
);

454 *
lÿ£
 = 0;

455 ià(
is_shÜŠame
 && 
ba£_šfo
.
v®id
 && 
ext_šfo
.valid) {

456 ià(
	`vçt_fšd_fÜm
(
dœ
, 
Çme_»s
) == 0)

457  -
EEXIST
;

459 ià(
Ýts
->
shÜŠame
 & 
VFAT_SFN_CREATE_WIN95
) {

460  (
ba£_šfo
.
uµ”
 && 
ext_šfo
.upper);

461 } ià(
Ýts
->
shÜŠame
 & 
VFAT_SFN_CREATE_WINNT
) {

462 ià((
ba£_šfo
.
uµ”
 || ba£_šfo.
low”
) &&

463 (
ext_šfo
.
uµ”
 ||ƒxt_šfo.
low”
)) {

464 ià(!
ba£_šfo
.
uµ”
 && ba£_šfo.
low”
)

465 *
lÿ£
 |ð
CASE_LOWER_BASE
;

466 ià(!
ext_šfo
.
uµ”
 &&ƒxt_šfo.
low”
)

467 *
lÿ£
 |ð
CASE_LOWER_EXT
;

472 
	`BUG
();

476 ià(
Ýts
->
numž
 == 0)

477 ià(
	`vçt_fšd_fÜm
(
dœ
, 
Çme_»s
) < 0)

488 ià(
ba£Ën
 > 6) {

489 
ba£Ën
 = 
numž_ba£Ën
;

490 
Çme_»s
[7] = ' ';

492 
Çme_»s
[
ba£Ën
] = '~';

493 
i
 = 1; i < 10; i++) {

494 
Çme_»s
[
ba£Ën
 + 1] = 
i
 + '0';

495 ià(
	`vçt_fšd_fÜm
(
dœ
, 
Çme_»s
) < 0)

499 
i
 = 
jiff›s
;

500 
sz
 = (
jiff›s
 >> 16) & 0x7;

501 ià(
ba£Ën
 > 2) {

502 
ba£Ën
 = 
numž2_ba£Ën
;

503 
Çme_»s
[7] = ' ';

505 
Çme_»s
[
ba£Ën
 + 4] = '~';

506 
Çme_»s
[
ba£Ën
 + 5] = '1' + 
sz
;

508 
	`¢´štf
(
buf
, (buf), "%04X", 
i
 & 0xffff);

509 
	`memýy
(&
Çme_»s
[
ba£Ën
], 
buf
, 4);

510 ià(
	`vçt_fšd_fÜm
(
dœ
, 
Çme_»s
) < 0)

512 
i
 -= 11;

515 
	}
}

519 
	$xÏ‹_to_uni
(cÚ¡ *
Çme
, 
Ën
, *
ouŠame
,

520 *
lÚgËn
, *
ouŽ’
, 
esÿ³
, 
utf8
,

521 
Æs_bË
 *
Æs
)

523 cÚ¡ *

;

524 
nc
;

525 *
Ý
;

526 
ec
;

527 
i
, 
k
, 
fžl
;

528 
ch¬Ën
;

530 ià(
utf8
) {

531 *
ouŽ’
 = 
	`utf8s_to_utf16s
(
Çme
, 
Ën
, 
UTF16_HOST_ENDIAN
,

532 (
wch¬_t
 *è
ouŠame
, 
FAT_LFN_LEN
 + 2);

533 ià(*
ouŽ’
 < 0)

534  *
ouŽ’
;

535 ià(*
ouŽ’
 > 
FAT_LFN_LEN
)

536  -
ENAMETOOLONG
;

538 
Ý
 = &
ouŠame
[*
ouŽ’
 * (
wch¬_t
)];

540 
i
 = 0, 

 = 
Çme
, 
Ý
 = 
ouŠame
, *
ouŽ’
 = 0;

541 
i
 < 
Ën
 && *
ouŽ’
 < 
FAT_LFN_LEN
;

542 *
ouŽ’
 += 1) {

543 ià(
esÿ³
 && (*

 == ':')) {

544 ià(
i
 > 
Ën
 - 5)

545  -
EINVAL
;

546 
ec
 = 0;

547 
k
 = 1; k < 5; k++) {

548 
nc
 = 

[
k
];

549 
ec
 <<= 4;

550 ià(
nc
 >= '0' &&‚c <= '9') {

551 
ec
 |ð
nc
 - '0';

554 ià(
nc
 >= 'a' &&‚c <= 'f') {

555 
ec
 |ð
nc
 - ('a' - 10);

558 ià(
nc
 >= 'A' &&‚c <= 'F') {

559 
ec
 |ð
nc
 - ('A' - 10);

562  -
EINVAL
;

564 *
Ý
++ = 
ec
 & 0xFF;

565 *
Ý
++ = 
ec
 >> 8;

566 

 += 5;

567 
i
 += 5;

569 
ch¬Ën
 = 
Æs
->
	`ch¬2uni
(

, 
Ën
 - 
i
,

570 (
wch¬_t
 *)
Ý
);

571 ià(
ch¬Ën
 < 0)

572  -
EINVAL
;

573 

 +ð
ch¬Ën
;

574 
i
 +ð
ch¬Ën
;

575 
Ý
 += 2;

578 ià(
i
 < 
Ën
)

579  -
ENAMETOOLONG
;

582 *
lÚgËn
 = *
ouŽ’
;

583 ià(*
ouŽ’
 % 13) {

584 *
Ý
++ = 0;

585 *
Ý
++ = 0;

586 *
ouŽ’
 += 1;

587 ià(*
ouŽ’
 % 13) {

588 
fžl
 = 13 - (*
ouŽ’
 % 13);

589 
i
 = 0; i < 
fžl
; i++) {

590 *
Ý
++ = 0xff;

591 *
Ý
++ = 0xff;

593 *
ouŽ’
 +ð
fžl
;

598 
	}
}

600 
	$vçt_bužd_¦Ùs
(
šode
 *
dœ
, cÚ¡ *
Çme
,

601 
Ën
, 
is_dœ
, 
þu¡”
,

602 
time¥ec
 *
ts
,

603 
msdos_dœ_¦Ù
 *
¦Ùs
, *
Ä_¦Ùs
)

605 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
dœ
->
i_sb
);

606 
çt_mouÁ_ÝtiÚs
 *
Ýts
 = &
sbi
->
ÝtiÚs
;

607 
msdos_dœ_¦Ù
 *
ps
;

608 
msdos_dœ_’Œy
 *
de
;

609 
cksum
, 
lÿ£
;

610 
msdos_Çme
[
MSDOS_NAME
];

611 
wch¬_t
 *
uÇme
;

612 
__Ë16
 
time
, 
d©e
;

613 
u8
 
time_cs
;

614 
”r
, 
uËn
, 
usize
, 
i
;

615 
loff_t
 
off£t
;

617 *
Ä_¦Ùs
 = 0;

619 
uÇme
 = 
	`__g‘Çme
();

620 ià(!
uÇme
)

621  -
ENOMEM
;

623 
”r
 = 
	`xÏ‹_to_uni
(
Çme
, 
Ën
, (*)
uÇme
, &
uËn
, &
usize
,

624 
Ýts
->
unicode_xÏ‹
, o±s->
utf8
, 
sbi
->
Æs_io
);

625 ià(
”r
)

626 
out_ä“
;

628 
”r
 = 
	`vçt_is_u£d_badch¬s
(
uÇme
, 
uËn
);

629 ià(
”r
)

630 
out_ä“
;

632 
”r
 = 
	`vçt_ü—‹_shÜŠame
(
dœ
, 
sbi
->
Æs_disk
, 
uÇme
, 
uËn
,

633 
msdos_Çme
, &
lÿ£
);

634 ià(
”r
 < 0)

635 
out_ä“
;

636 ià(
”r
 == 1) {

637 
de
 = (
msdos_dœ_’Œy
 *)
¦Ùs
;

638 
”r
 = 0;

639 
shÜŠame
;

643 
cksum
 = 
	`çt_checksum
(
msdos_Çme
);

645 *
Ä_¦Ùs
 = 
usize
 / 13;

646 
ps
 = 
¦Ùs
, 
i
 = *
Ä_¦Ùs
; i > 0; i--,…s++) {

647 
ps
->
id
 = 
i
;

648 
ps
->
©Œ
 = 
ATTR_EXT
;

649 
ps
->
»£rved
 = 0;

650 
ps
->
®Ÿs_checksum
 = 
cksum
;

651 
ps
->
¡¬t
 = 0;

652 
off£t
 = (
i
 - 1) * 13;

653 
	`çtwch¬_to16
(
ps
->
Çme0_4
, 
uÇme
 + 
off£t
, 5);

654 
	`çtwch¬_to16
(
ps
->
Çme5_10
, 
uÇme
 + 
off£t
 + 5, 6);

655 
	`çtwch¬_to16
(
ps
->
Çme11_12
, 
uÇme
 + 
off£t
 + 11, 2);

657 
¦Ùs
[0].
id
 |= 0x40;

658 
de
 = (
msdos_dœ_’Œy
 *)
ps
;

660 
shÜŠame
:

662 (*
Ä_¦Ùs
)++;

663 
	`memýy
(
de
->
Çme
, 
msdos_Çme
, 
MSDOS_NAME
);

664 
de
->
©Œ
 = 
is_dœ
 ? 
ATTR_DIR
 : 
ATTR_ARCH
;

665 
de
->
lÿ£
 =†case;

666 
	`çt_time_unix2çt
(
sbi
, 
ts
, &
time
, &
d©e
, &
time_cs
);

669 
time
 = 123;

670 
de
->
time
 = de->
ùime
 =ime;

671 
de
->
d©e
 = de->
cd©e
 = de->
ad©e
 = date;

672 
de
->
ùime_cs
 = 
time_cs
;

674 
	`çt_£t_¡¬t
(
de
, 
þu¡”
);

675 
de
->
size
 = 0;

676 
out_ä“
:

677 
	`__puŠame
(
uÇme
);

678  
”r
;

679 
	}
}

681 
	$vçt_add_’Œy
(
šode
 *
dœ
, 
q¡r
 *
qÇme
, 
is_dœ
,

682 
þu¡”
, 
time¥ec
 *
ts
,

683 
çt_¦Ù_šfo
 *
sšfo
)

685 
msdos_dœ_¦Ù
 *
¦Ùs
;

686 
Ën
;

687 
”r
, 
Ä_¦Ùs
;

689 
Ën
 = 
	`vçt_¡rž_Ën
(
qÇme
);

690 ià(
Ën
 == 0)

691  -
ENOENT
;

693 
¦Ùs
 = 
	`km®loc
((*¦Ùsè* 
MSDOS_SLOTS
, 
GFP_NOFS
);

694 ià(
¦Ùs
 =ð
NULL
)

695  -
ENOMEM
;

697 
”r
 = 
	`vçt_bužd_¦Ùs
(
dœ
, 
qÇme
->
Çme
, 
Ën
, 
is_dœ
, 
þu¡”
, 
ts
,

698 
¦Ùs
, &
Ä_¦Ùs
);

699 ià(
”r
)

700 
þ—nup
;

702 
”r
 = 
	`çt_add_’Œ›s
(
dœ
, 
¦Ùs
, 
Ä_¦Ùs
, 
sšfo
);

703 ià(
”r
)

704 
þ—nup
;

707 
dœ
->
i_ùime
 = dœ->
i_mtime
 = dœ->
i_©ime
 = *
ts
;

716 ià(
	`IS_DIRSYNC
(
dœ
))

717 ()
	`çt_sync_šode
(
dœ
);

719 
	`m¬k_šode_dœty
(
dœ
);

720 
þ—nup
:

721 
	`kä“
(
¦Ùs
);

722  
”r
;

723 
	}
}

725 
	$vçt_fšd
(
šode
 *
dœ
, 
q¡r
 *
qÇme
,

726 
çt_¦Ù_šfo
 *
sšfo
)

728 
Ën
 = 
	`vçt_¡rž_Ën
(
qÇme
);

729 ià(
Ën
 == 0)

730  -
ENOENT
;

731  
	`çt_£¬ch_lÚg
(
dœ
, 
qÇme
->
Çme
, 
Ën
, 
sšfo
);

732 
	}
}

738 
	$vçt_d_ªÚ_discÚn
(
d’Œy
 *dentry)

740  
	`IS_ROOT
(
d’Œy
è&& (d’Œy->
d_æags
 & 
DCACHE_DISCONNECTED
);

741 
	}
}

743 
d’Œy
 *
	$vçt_lookup
(
šode
 *
dœ
, 
d’Œy
 *dentry,

744 
æags
)

746 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

747 
çt_¦Ù_šfo
 
sšfo
;

748 
šode
 *inode;

749 
d’Œy
 *
®Ÿs
;

750 
”r
;

752 
	`´štk
Ð
KERN_ALERT
 "[cheon] vfat_lookup \n");

754 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

756 
”r
 = 
	`vçt_fšd
(
dœ
, &
d’Œy
->
d_Çme
, &
sšfo
);

757 ià(
”r
) {

758 ià(
”r
 =ð-
ENOENT
) {

759 
šode
 = 
NULL
;

760 
out
;

762 
”rÜ
;

765 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

766 
	`b»l£
(
sšfo
.
bh
);

767 ià(
	`IS_ERR
(
šode
)) {

768 
”r
 = 
	`PTR_ERR
(
šode
);

769 
”rÜ
;

772 
®Ÿs
 = 
	`d_fšd_®Ÿs
(
šode
);

773 ià(
®Ÿs
 && !
	`vçt_d_ªÚ_discÚn
(alias)) {

781 
	`BUG_ON
(
	`d_unhashed
(
®Ÿs
));

782 ià(!
	`S_ISDIR
(
šode
->
i_mode
))

783 
	`d_move
(
®Ÿs
, 
d’Œy
);

784 
	`ut
(
šode
);

785 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

786  
®Ÿs
;

788 
	`dput
(
®Ÿs
);

790 
out
:

791 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

792 
d’Œy
->
d_time
 = d’Œy->
d_·»Á
->
d_šode
->
i_v”siÚ
;

793 
d’Œy
 = 
	`d_¥liû_®Ÿs
(
šode
, dentry);

794 ià(
d’Œy
)

796 
d’Œy
->
d_time
 = d’Œy->
d_·»Á
->
d_šode
->
i_v”siÚ
;

800  
d’Œy
;

802 
”rÜ
:

803 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

804  
	`ERR_PTR
(
”r
);

805 
	}
}

807 
	$vçt_ü—‹
(
šode
 *
dœ
, 
d’Œy
 *d’Œy, 
umode_t
 
mode
,

808 
boÞ
 
exþ
)

810 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

811 
šode
 *inode;

812 
çt_¦Ù_šfo
 
sšfo
;

813 
time¥ec
 
ts
;

814 
”r
;

818 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

821 
ts
 = 
CURRENT_TIME_SEC
;

822 
”r
 = 
	`vçt_add_’Œy
(
dœ
, &
d’Œy
->
d_Çme
, 0, 0, &
ts
, &
sšfo
);

823 ià(
”r
)

824 
out
;

825 
dœ
->
i_v”siÚ
++;

827 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

828 
	`b»l£
(
sšfo
.
bh
);

829 ià(
	`IS_ERR
(
šode
)) {

830 
”r
 = 
	`PTR_ERR
(
šode
);

831 
out
;

833 
šode
->
i_v”siÚ
++;

835 
šode
->
i_mtime
 = inode->
i_©ime
 = inode->
i_ùime
 = 
ts
;

840 
d’Œy
->
d_time
 = d’Œy->
d_·»Á
->
d_šode
->
i_v”siÚ
;

842 
	`d_š¡ªtŸ‹
(
d’Œy
, 
šode
);

843 
out
:

844 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

845  
”r
;

846 
	}
}

848 
	$vçt_rmdœ
(
šode
 *
dœ
, 
d’Œy
 *dentry)

850 
šode
 *šodð
d’Œy
->
d_šode
;

851 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

852 
çt_¦Ù_šfo
 
sšfo
;

853 
”r
;

855 
	`´štk
Ð
KERN_ALERT
 "[cheon] vfat_rmdir \n" );

857 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

859 
”r
 = 
	`çt_dœ_em±y
(
šode
);

860 ià(
”r
)

861 
out
;

862 
”r
 = 
	`vçt_fšd
(
dœ
, &
d’Œy
->
d_Çme
, &
sšfo
);

863 ià(
”r
)

864 
out
;

866 
”r
 = 
	`çt_»move_’Œ›s
(
dœ
, &
sšfo
);

867 ià(
”r
)

868 
out
;

869 
	`drÝ_Æšk
(
dœ
);

871 
	`þ—r_Æšk
(
šode
);

873 
šode
->
i_mtime
 = inode->
i_©ime
 = 
CURRENT_TIME_SEC
;

881 
	`çt_d‘ach
(
šode
);

882 
out
:

883 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

885  
”r
;

886 
	}
}

888 
	$vçt_uÆšk
(
šode
 *
dœ
, 
d’Œy
 *dentry)

890 
šode
 *šodð
d’Œy
->
d_šode
;

891 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

892 
çt_¦Ù_šfo
 
sšfo
;

893 
”r
;

898 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

900 
”r
 = 
	`vçt_fšd
(
dœ
, &
d’Œy
->
d_Çme
, &
sšfo
);

901 ià(
”r
)

902 
out
;

905 
”r
 = 
	`çt_»move_’Œ›s
(
dœ
, &
sšfo
);

906 ià(
”r
)

907 
out
;

908 
	`þ—r_Æšk
(
šode
);

910 
šode
->
i_mtime
 = inode->
i_©ime
 = 
CURRENT_TIME_SEC
;

918 
	`çt_d‘ach
(
šode
);

919 
out
:

920 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

922  
”r
;

923 
	}
}

925 
	$vçt_mkdœ
(
šode
 *
dœ
, 
d’Œy
 *d’Œy, 
umode_t
 
mode
)

927 
su³r_block
 *
sb
 = 
dœ
->
i_sb
;

928 
šode
 *inode;

929 
çt_¦Ù_šfo
 
sšfo
;

930 
time¥ec
 
ts
;

931 
”r
, 
þu¡”
;

935 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

937 
ts
 = 
CURRENT_TIME_SEC
;

939 
þu¡”
 = 
	`çt_®loc_Ãw_dœ
(
dœ
, &
ts
);

940 ià(
þu¡”
 < 0) {

941 
”r
 = 
þu¡”
;

942 
out
;

944 
”r
 = 
	`vçt_add_’Œy
(
dœ
, &
d’Œy
->
d_Çme
, 1, 
þu¡”
, &
ts
, &
sšfo
);

945 ià(
”r
)

946 
out_ä“
;

947 
dœ
->
i_v”siÚ
++;

948 
	`šc_Æšk
(
dœ
);

950 
šode
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

951 
	`b»l£
(
sšfo
.
bh
);

952 ià(
	`IS_ERR
(
šode
)) {

953 
”r
 = 
	`PTR_ERR
(
šode
);

955 
out
;

957 
šode
->
i_v”siÚ
++;

958 
	`£t_Æšk
(
šode
, 2);

959 
šode
->
i_mtime
 = inode->
i_©ime
 = inode->
i_ùime
 = 
ts
;

971 
d’Œy
->
d_time
 = d’Œy->
d_·»Á
->
d_šode
->
i_v”siÚ
;

973 
	`d_š¡ªtŸ‹
(
d’Œy
, 
šode
);

975 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

978 
out_ä“
:

980 
	`çt_ä“_þu¡”s
(
dœ
, 
þu¡”
);

981 
out
:

982 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

983  
”r
;

984 
	}
}

986 
	$vçt_»Çme
(
šode
 *
Þd_dœ
, 
d’Œy
 *
Þd_d’Œy
,

987 
šode
 *
Ãw_dœ
, 
d’Œy
 *
Ãw_d’Œy
)

989 
bufãr_h—d
 *
dÙdÙ_bh
;

990 
msdos_dœ_’Œy
 *
dÙdÙ_de
;

991 
šode
 *
Þd_šode
, *
Ãw_šode
;

992 
çt_¦Ù_šfo
 
Þd_sšfo
, 
sšfo
;

993 
time¥ec
 
ts
;

994 
loff_t
 
Ãw_i_pos
;

995 
”r
, 
is_dœ
, 
upd©e_dÙdÙ
, 
cÜru±
 = 0;

996 
su³r_block
 *
sb
 = 
Þd_dœ
->
i_sb
;

1000 
Þd_sšfo
.
bh
 = 
sšfo
.bh = 
dÙdÙ_bh
 = 
NULL
;

1001 
Þd_šode
 = 
Þd_d’Œy
->
d_šode
;

1002 
Ãw_šode
 = 
Ãw_d’Œy
->
d_šode
;

1003 
	`mu‹x_lock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

1004 
”r
 = 
	`vçt_fšd
(
Þd_dœ
, &
Þd_d’Œy
->
d_Çme
, &
Þd_sšfo
);

1005 ià(
”r
)

1006 
out
;

1008 
is_dœ
 = 
	`S_ISDIR
(
Þd_šode
->
i_mode
);

1009 
upd©e_dÙdÙ
 = (
is_dœ
 && 
Þd_dœ
 !ð
Ãw_dœ
);

1010 ià(
upd©e_dÙdÙ
) {

1011 ià(
	`çt_g‘_dÙdÙ_’Œy
(
Þd_šode
, &
dÙdÙ_bh
, &
dÙdÙ_de
)) {

1012 
”r
 = -
EIO
;

1013 
out
;

1018 
ts
 = 
CURRENT_TIME_SEC
;

1019 ià(
Ãw_šode
) {

1020 ià(
is_dœ
) {

1021 
”r
 = 
	`çt_dœ_em±y
(
Ãw_šode
);

1022 ià(
”r
)

1023 
out
;

1025 
Ãw_i_pos
 = 
	`MSDOS_I
(
Ãw_šode
)->
i_pos
;

1026 
	`çt_d‘ach
(
Ãw_šode
);

1028 
”r
 = 
	`vçt_add_’Œy
(
Ãw_dœ
, &
Ãw_d’Œy
->
d_Çme
, 
is_dœ
, 0,

1029 &
ts
, &
sšfo
);

1030 ià(
”r
)

1031 
out
;

1032 
Ãw_i_pos
 = 
sšfo
.
i_pos
;

1034 
Ãw_dœ
->
i_v”siÚ
++;

1036 
	`çt_d‘ach
(
Þd_šode
);

1037 
	`çt_©ch
(
Þd_šode
, 
Ãw_i_pos
);

1038 ià(
	`IS_DIRSYNC
(
Ãw_dœ
)) {

1039 
”r
 = 
	`çt_sync_šode
(
Þd_šode
);

1040 ià(
”r
)

1041 
”rÜ_šode
;

1043 
	`m¬k_šode_dœty
(
Þd_šode
);

1045 ià(
upd©e_dÙdÙ
) {

1046 
	`çt_£t_¡¬t
(
dÙdÙ_de
, 
	`MSDOS_I
(
Ãw_dœ
)->
i_log¡¬t
);

1047 
	`m¬k_bufãr_dœty_šode
(
dÙdÙ_bh
, 
Þd_šode
);

1048 ià(
	`IS_DIRSYNC
(
Ãw_dœ
)) {

1049 
”r
 = 
	`sync_dœty_bufãr
(
dÙdÙ_bh
);

1050 ià(
”r
)

1051 
”rÜ_dÙdÙ
;

1053 
	`drÝ_Æšk
(
Þd_dœ
);

1054 ià(!
Ãw_šode
)

1055 
	`šc_Æšk
(
Ãw_dœ
);

1058 
”r
 = 
	`çt_»move_’Œ›s
(
Þd_dœ
, &
Þd_sšfo
);

1059 
Þd_sšfo
.
bh
 = 
NULL
;

1060 ià(
”r
)

1061 
”rÜ_dÙdÙ
;

1062 
Þd_dœ
->
i_v”siÚ
++;

1063 
Þd_dœ
->
i_ùime
 = old_dœ->
i_mtime
 = 
ts
;

1064 ià(
	`IS_DIRSYNC
(
Þd_dœ
))

1065 ()
	`çt_sync_šode
(
Þd_dœ
);

1067 
	`m¬k_šode_dœty
(
Þd_dœ
);

1069 ià(
Ãw_šode
) {

1070 
	`drÝ_Æšk
(
Ãw_šode
);

1071 ià(
is_dœ
)

1072 
	`drÝ_Æšk
(
Ãw_šode
);

1073 
Ãw_šode
->
i_ùime
 = 
ts
;

1075 
out
:

1076 
	`b»l£
(
sšfo
.
bh
);

1077 
	`b»l£
(
dÙdÙ_bh
);

1078 
	`b»l£
(
Þd_sšfo
.
bh
);

1079 
	`mu‹x_uÆock
(&
	`MSDOS_SB
(
sb
)->
s_lock
);

1081  
”r
;

1083 
”rÜ_dÙdÙ
:

1085 
cÜru±
 = 1;

1087 ià(
upd©e_dÙdÙ
) {

1088 
	`çt_£t_¡¬t
(
dÙdÙ_de
, 
	`MSDOS_I
(
Þd_dœ
)->
i_log¡¬t
);

1089 
	`m¬k_bufãr_dœty_šode
(
dÙdÙ_bh
, 
Þd_šode
);

1090 
cÜru±
 |ð
	`sync_dœty_bufãr
(
dÙdÙ_bh
);

1092 
”rÜ_šode
:

1093 
	`çt_d‘ach
(
Þd_šode
);

1094 
	`çt_©ch
(
Þd_šode
, 
Þd_sšfo
.
i_pos
);

1095 ià(
Ãw_šode
) {

1096 
	`çt_©ch
(
Ãw_šode
, 
Ãw_i_pos
);

1097 ià(
cÜru±
)

1098 
cÜru±
 |ð
	`çt_sync_šode
(
Ãw_šode
);

1105 
”r2
 = 
	`çt_»move_’Œ›s
(
Ãw_dœ
, &
sšfo
);

1106 ià(
cÜru±
)

1107 
cÜru±
 |ð
”r2
;

1108 
sšfo
.
bh
 = 
NULL
;

1110 ià(
cÜru±
 < 0) {

1111 
	`çt_fs_”rÜ
(
Ãw_dœ
->
i_sb
,

1113 
__func__
, 
sšfo
.
i_pos
);

1115 
out
;

1116 
	}
}

1118 cÚ¡ 
šode_Ý”©iÚs
 
	gvçt_dœ_šode_Ý”©iÚs
 = {

1119 .
ü—‹
 = 
vçt_ü—‹
,

1120 .
	glookup
 = 
vçt_lookup
,

1121 .
	guÆšk
 = 
vçt_uÆšk
,

1122 .
	gmkdœ
 = 
vçt_mkdœ
,

1123 .
	grmdœ
 = 
vçt_rmdœ
,

1124 .
	g»Çme
 = 
vçt_»Çme
,

1125 .
	g£‰r
 = 
çt_£‰r
,

1126 .
	gg‘©Œ
 = 
çt_g‘©Œ
,

1129 
	$£tup
(
su³r_block
 *
sb
)

1131 
	`MSDOS_SB
(
sb
)->
dœ_Ýs
 = &
vçt_dœ_šode_Ý”©iÚs
;

1132 ià(
	`MSDOS_SB
(
sb
)->
ÝtiÚs
.
Çme_check
 != 's')

1133 
sb
->
s_d_Ý
 = &
vçt_ci_d’Œy_Ýs
;

1135 
sb
->
s_d_Ý
 = &
vçt_d’Œy_Ýs
;

1136 
	}
}

1138 
šlše
 
	$®ign_check
Ð
msdos_sb_šfo
 *
sbi
, 
Ãxt
, 
¬—
 )

1140 ifÐ
Ãxt
 % 
CLUSTER_IN_PAGE
 == 0 );

1142 
Ãxt
 =‚exˆ+ (
CLUSTER_IN_PAGE
 - (next % CLUSTER_IN_PAGE ));

1144 ifÐ(
sbi
->
çt_¡¬t
 % 8) != 0 )

1146 
adju¡
 = 
sbi
->
çt_¡¬t
 % 
BLOCK_IN_PAGE
 ;

1147 
Ãxt
 =‚exˆ- (
adju¡
 * 
CLUSTER_IN_BLOCK
 );

1150 if(
Ãxt
 < 
sbi
->
bx_¡¬t_þu¡”
[
¬—
]) {

1151 
Ãxt
 =‚exˆ+ 
CLUSTER_IN_PAGE
 ;

1156  
Ãxt
;

1157 
	}
}

1159 
	$£‰šg_¡¬t_’d_š_memÜy
Ð
su³r_block
 *
sb
 )

1161 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

1162 
PA_un™_t
 *
pun™
;

1163 
¡¬t
 = 0, 
’d
 = 0, 
num_´e_®loc
= 0;

1164 
út
=0, 
i
=0;

1166  
i
 = 1 ; i < (
TOTAL_AREA_CNT
-1) ; i++ )

1169 
¡¬t
 = 
	`®ign_check
Ð
sbi
, sbi->
bx_´ev_ä“
[
i
]+1, i );

1170 
pun™
 = 
¬—_PA
[ 
i
 ].
·_un™
;

1172 
num_´e_®loc
 = ( 
sbi
->
bx_´e_size
[ 
i
 ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

1178 
pun™
[
út
].
¡¬t
 = start;

1179 
pun™
[
út
].
’d
 = 
¡¬t
 + 
num_´e_®loc
 - 1;

1181 
¡¬t
 +ð
num_´e_®loc
;

1183 
pun™
[
út
].
æag
 = 
FREE
;

1184 ifÐ
i
 == 1 )

1185 
	`´štk
("[cheÚ] s¹,ƒnd : %u, %u \n", 
pun™
[
út
].
¡¬t
,…un™[út].
’d
 );

1187 
út
++;

1188 ifÐ
út
 =ð
¬—_PA
[ 
i
 ].
·_num
 ){

1189 
út
 = 0;

1194 
	}
}

1196 
	$PA_mªagem’t
Ð
su³r_block
 *
sb
 )

1198 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
sb
 );

1203 
msdos_šode_šfo
 *
ms_i
;

1204 
hli¡_h—d
 *
h—d
 = 
sbi
->
šode_hashbË
;

1206 
	`´štk
("[cheon] PA_management Test \n");

1208 
i
;

1210  
i
 = 1 ; i < (
TOTAL_AREA_CNT
-1) ; i++ )

1212 
¬—_PA
[ 
i
 ].
·_num
 = ( ( 
sbi
->
bx_’d_þu¡”
[ i ] - sbi->
bx_¡¬t_þu¡”
[ i ] + 1 ) ) / ((sbi->
bx_´e_size
[ i ] * 1024è/ (sbi->
þu¡”_size
 / 1024));

1213 
¬—_PA
[ 
i
 ].
·_num
 -= 1;

1214 
¬—_PA
[ 
i
 ].
·_þu¡”_num
 = ( 
sbi
->
bx_´e_size
[ i ] * 1024 ) / ( sbi->
þu¡”_size
 / 1024 );

1215 
¬—_PA
[ 
i
 ].
cur_·_út
 = 0;

1216 
	`´štk
("[cheÚ]‡»a[%d].·_num : %d \n", 
i
, 
¬—_PA
[ i ].
·_num
 );

1218 
¬—_PA
[ 
i
 ].
·_un™
 = ( 
PA_un™_t
 *)
	`km®loc
ÐÐPA_un™_ˆè*‡»a_PA[ i ].
·_num
, 
GFP_KERNEL
 );

1219 
	`mem£t
ÐÐ*)
¬—_PA
[ 
i
 ].
·_un™
, 0x0, Ð
PA_un™_t
 ) *‡»a_PA[ i ].
·_num
 );

1221 
sbi
->
·»a_PA
[
i
] = &
¬—_PA
[i];

1224 
	`£‰šg_¡¬t_’d_š_memÜy
Ð
sb
 );

1226  
i
 = 1 ; i < (
TOTAL_AREA_CNT
 -1) ; i++ )

1227 
	`decide_—ch_·_¡©us
Ð
sb
, 
¬—_PA
[ 
i
 ].
·_un™
, i );

1230 
sbi
->
bx_ä“_þu¡”s
[ 
BB_ETC
 ] = 0;

1231 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL
 ] = 0;

1232 
sbi
->
bx_ä“_þu¡”s
[ 
BB_NORMAL_EVENT
 ] = 0;

1233 
sbi
->
bx_ä“_þu¡”s
[ 
BB_PARKING
 ] = 0;

1234 
sbi
->
bx_ä“_þu¡”s
[ 
BB_MANUAL
 ] = 0;

1235 
sbi
->
bx_ä“_þu¡”s
[ 
BB_IMAGE
 ] = 0;

1237 
sbi
->
bx_ä“_v®id
 = -1;

1238 
	`çt_couÁ_ä“_þu¡”s_fÜ_¬—
Ð
sb
 );

1240  
i
 = 1 ; i < (
TOTAL_AREA_CNT
 -1) ; i++ )

1241 
	`show_the_¡©us_un™_æag
Ð
sb
, 
i
 );

1243 
	`´štk
("[cheon] ==test==\n");

1246 
	`¥š_lock
Ð&
sbi
->
šode_hash_lock
 );

1258 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1259 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1260 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1261 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1262 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1263 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1264 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1265 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1266 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1267 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1268 
ms_i
 = 
	`hli¡_’Œy_§ã
Ð(ms_i)->
i_çt_hash
.
Ãxt
, 
	`ty³of
(*(ms_i)), i_fat_hash );

1269 
	`´štk
("[cheÚ] ms_˜: %d \n", 
ms_i
->
i_¡¬t
 );

1275 
h


1276 
	`hli¡_fÜ_—ch_’Œy
Ð
ms_i
, 
h—d
, 
i_çt_hash
 )

1278 
	`´štk
("%d %d %u\n", 
ms_i
->
i_¡¬t
, ms_i->
i_log¡¬t
, ms_i->
i_pos
 );

1283 
	`¥š_uÆock
Ð&
sbi
->
šode_hash_lock
 );

1287 
	}
}

1289 
	$vçt_fžl_su³r
(
su³r_block
 *
sb
, *
d©a
, 
sž’t
)

1291 
»s
;

1292 
i
;

1294 
	`´štk
Ð"[cheÚ] vçt_fžl_su³¸ S_ID : %s\n", 
sb
->
s_id
 );

1295 
»s
 = 
	`çt_fžl_su³r
(
sb
, 
d©a
, 
sž’t
, 1, 
£tup
);

1296 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1298 ifÐ!
	`¡rcmp
Ð
sb
->
s_id
, 
SD1_S_ID
 ) || !¡rcmpÐsb->s_id, 
SD2_S_ID
 ) )

1300 
	`´štk
("SD_card\n");

1302 
	`çt_cÚfig_š™
Ð
sb
 );

1303 
	`çt_upd©e_su³r
Ð
sb
 );

1305 
g_sb_s1
 = 
NULL
;

1306 
g_sb_s2
 = 
NULL
;

1308 ifÐ
sbi
->
çt_Üigš®_æag
 =ð
ON
 )

1310 ifÐ!
	`¡rcmp
Ð
sb
->
s_id
, 
SD1_S_ID
 ) )

1311 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd1
, "START_ORIGINAL" );

1313 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd2
, "START_ORIGINAL" );

1318 ifÐ!
	`¡rcmp
Ð
sb
->
s_id
, 
SD1_S_ID
 ) )

1320 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd1
, "START_OPEL" );

1322 
	`PA_mªagem’t
Ð
sb
 );

1326 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd2
, "START_OPEL" );

1328 
	`PA_mªagem’t
Ð
sb
 );

1332 ifÐ!
	`¡rcmp
Ð
sb
->
s_id
, 
SD1_S_ID
 ) )

1334 
g_sb_s1
 = 
sb
;

1335 ifÐ
g_sb_s2
 =ð
NULL
 )

1336 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd2
, "Not mounted" );

1339 
i
=0;i<
TOTAL_AREA_CNT
;i++)

1340 
g_tÙ®_þu¡”_s1
[
i
] = 
sbi
->
bx_’d_þu¡”
[i] - sbi->
bx_¡¬t_þu¡”
[i] + 1;

1347 
g_sb_s2
 = 
sb
;

1348 ifÐ
g_sb_s1
 =ð
NULL
 )

1349 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd1
, "Not mounted" );

1352 
i
=0;i<
TOTAL_AREA_CNT
;i++)

1353 
g_tÙ®_þu¡”_s2
[
i
] = 
sbi
->
bx_’d_þu¡”
[i] - sbi->
bx_¡¬t_þu¡”
[i] + 1;

1360 
	`´štk
Ð
KERN_ALERT
 "mªag”_cÚŒÞ_sd1 : % \n", 
mªag”_cÚŒÞ_sd1
 );

1361 
	`´štk
Ð
KERN_ALERT
 "mªag”_cÚŒÞ_sd2 : % \n", 
mªag”_cÚŒÞ_sd2
 );

1365 
	`´štk
("For Android\n");

1367 
	`çt_ju¡_š™_su³r
Ð
sb
 );

1368 
sbi
->
çt_Üigš®_æag
 = 
ON
;

1371  
»s
;

1372 
	}
}

1374 
d’Œy
 *
	$vçt_mouÁ
(
fže_sy¡em_ty³
 *
fs_ty³
,

1375 
æags
, cÚ¡ *
dev_Çme
,

1376 *
d©a
)

1378 
	`´štk
Ð
KERN_ALERT
 "[cheon] 0906 1627\n");

1379 
	`´štk
Ð
KERN_ALERT
 "[cheon] vfat_mount !! \n");

1380  
	`mouÁ_bdev
(
fs_ty³
, 
æags
, 
dev_Çme
, 
d©a
, 
vçt_fžl_su³r
);

1381 
	}
}

1385 
kobjeù
 *
	gÝ–_çt_kobj
;

1387 
ssize_t
 
	$cÚŒÞ_show_s1
Ð
kobjeù
 *
kobj
, 
kobj_©Œibu‹
 *
©Œ
, *
buff
 )

1389 ifÐ
g_sb_s1
 =ð
NULL
 ){

1390 
	`´štk
("[cheon] sd1 is‚ot mounted \n");

1394 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sysf cÚŒÞ_show_s1(è: %s\n", 
mªag”_cÚŒÞ_sd1
 );

1396  
	`¢´štf
Ð
buff
, 
PAGE_SIZE
, "% \n", 
mªag”_cÚŒÞ_sd1
 );

1397 
	}
}

1399 
ssize_t
 
	$cÚŒÞ_show_s2
Ð
kobjeù
 *
kobj
, 
kobj_©Œibu‹
 *
©Œ
, *
buff
 )

1401 ifÐ
g_sb_s2
 =ð
NULL
 ){

1402 
	`´štk
("[cheon] sd2 is‚ot mounted \n");

1406 
	`´štk
Ð
KERN_ALERT
 "[cheÚ] sysf cÚŒÞ_show_s2(è: %s\n", 
mªag”_cÚŒÞ_sd2
 );

1408  
	`¢´štf
Ð
buff
, 
PAGE_SIZE
, "% \n", 
mªag”_cÚŒÞ_sd2
 );

1409 
	}
}

1411 
ssize_t
 
	$size_show_s1
Ð
kobjeù
 *
kobj
, 
kobj_©Œibu‹
 *
©Œ
, *
buff
 )

1413 
i
 = 0;

1414 
út
 = 0;

1415 
u£d_size
[10] = {0,};

1416 
ä“_size
[10] = {0,};

1417 
tÙ®_size
[10] = {0,};

1420 ifÐ
g_sb_s1
 =ð
NULL
 )

1422 
	`´štk
("[cheon] sd1 is‚ot mounted \n");

1426 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
g_sb_s1
 );

1429 
i
=0;i<
TOTAL_AREA_CNT
;i++)

1431 
u£d_size
[
i
] = (
g_tÙ®_þu¡”_s1
[i] - 
sbi
->
bx_ä“_þu¡”s
[i] ) * (sbi->
þu¡”_size
/1024);

1432 
ä“_size
[
i
] = 
sbi
->
bx_ä“_þu¡”s
[i] * (sbi->
þu¡”_size
/1024);

1433 
tÙ®_size
[
i
] = 
g_tÙ®_þu¡”_s1
[i] * (
sbi
->
þu¡”_size
/1024);

1437 
út
 = 
	`¢´štf
Ð
buff
, 
PAGE_SIZE
, "%u\t%u\t%u\t%u\t%u\t%u \n%u\t%u\t%u\t%u\t%u\t%u \n%u\t%u\t%u\t%u\t%u\t%u \n", 
tÙ®_size
[0],otal_size[1],total_size[2],otal_size[3],otal_size[4],otal_size[5], \

1438 
u£d_size
[0], used_size[1], used_size[2], used_size[3], used_size[4], used_size[5], \

1439 
ä“_size
[0], free_size[1], free_size[2], free_size[3], free_size[4], free_size[5] );

1442 
út
 = 
	`¢´štf
Ð
buff
, 
PAGE_SIZE
, "%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n", 
tÙ®_size
[0],otal_size[1],total_size[2],otal_size[3],otal_size[4],otal_size[5], \

1443 
u£d_size
[0], used_size[1], used_size[2], used_size[3], used_size[4], used_size[5], \

1444 
ä“_size
[0], free_size[1], free_size[2], free_size[3], free_size[4], free_size[5] );

1447  
út
;

1448 
	}
}

1450 
ssize_t
 
	$size_show_s2
Ð
kobjeù
 *
kobj
, 
kobj_©Œibu‹
 *
©Œ
, *
buff
 )

1452 
i
 = 0;

1453 
út
 = 0;

1454 
u£d_size
[10] = {0,};

1455 
ä“_size
[10] = {0,};

1456 
tÙ®_size
[10] = {0,};

1459 ifÐ
g_sb_s2
 =ð
NULL
 )

1461 
	`´štk
("[cheon] sd2 is‚ot mounted \n");

1465 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
Ð
g_sb_s2
 );

1468 
i
=0;i<
TOTAL_AREA_CNT
;i++)

1470 
u£d_size
[
i
] = (
g_tÙ®_þu¡”_s2
[i] -
sbi
->
bx_ä“_þu¡”s
[i] ) * (sbi->
þu¡”_size
/1024);

1471 
ä“_size
[
i
] = 
sbi
->
bx_ä“_þu¡”s
[i] * (sbi->
þu¡”_size
/1024);

1472 
tÙ®_size
[
i
] = 
g_tÙ®_þu¡”_s2
[i] * (
sbi
->
þu¡”_size
/1024);

1475 
út
 = 
	`¢´štf
Ð
buff
, 
PAGE_SIZE
, "%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n%Îu\t%Îu\t%Îu\t%Îu\t%Îu\t%Îu \n", 
tÙ®_size
[0],otal_size[1],total_size[2],otal_size[3],otal_size[4],otal_size[5], \

1476 
u£d_size
[0], used_size[1], used_size[2], used_size[3], used_size[4], used_size[5], \

1477 
ä“_size
[0], free_size[1], free_size[2], free_size[3], free_size[4], free_size[5] );

1479  
út
;

1480 
	}
}

1482 
ssize_t
 
	$cÚŒÞ_¡Üe
Ð
kobjeù
 *
kobj
, 
kobj_©Œibu‹
 *
©Œ
, cÚ¡ *
buff
, 
size_t
 
couÁ
 )

1484 
num
;

1486 
	`ssÿnf
Ð
buff
, "%d", &
num
 );

1488 
	`´štk
Ð
KERN_ALERT
 "num : %d \n", 
num
 );

1489 
	`´štk
Ð
KERN_ALERT
 "bufà: % \n", 
buff
 );

1491  
couÁ
;

1492 
	}
}

1494 
kobj_©Œibu‹
 
	gcÚŒÞ_©Œ1
 = 
__ATTR
Ð
SD1_cÚŒÞ
, 0644, 
cÚŒÞ_show_s1
, 
cÚŒÞ_¡Üe
 );

1495 
kobj_©Œibu‹
 
	gcÚŒÞ_©Œ2
 = 
__ATTR
Ð
SD2_cÚŒÞ
, 0644, 
cÚŒÞ_show_s2
, 
cÚŒÞ_¡Üe
 );

1496 
kobj_©Œibu‹
 
	gcÚŒÞ_©Œ3
 = 
__ATTR
Ð
SD1_size_mÚ™Üšg
, 0644, 
size_show_s1
, 
cÚŒÞ_¡Üe
 );

1497 
kobj_©Œibu‹
 
	gcÚŒÞ_©Œ4
 = 
__ATTR
Ð
SD2_size_mÚ™Üšg
, 0644, 
size_show_s2
, 
cÚŒÞ_¡Üe
 );

1500 
©Œibu‹
 *
	g©Œibu‹s
[ ] = {

1501 &
cÚŒÞ_©Œ1
.
©Œ
,

1502 &
cÚŒÞ_©Œ2
.
©Œ
,

1503 &
cÚŒÞ_©Œ3
.
©Œ
,

1504 &
cÚŒÞ_©Œ4
.
©Œ
,

1505 
NULL
,

1508 
©Œibu‹_group
 
	g©Œ_group
 = {

1509 .
©Œs
 = 
©Œibu‹s
,

1512 
	$do_fs_sysfs_»gi¡¿tiÚ
( )

1514 
rc
;

1516 
Ý–_çt_kobj
 = 
	`kobjeù_ü—‹_ªd_add
Ð"OPEL_FAT", 
fs_kobj
 );

1518 ifÐ!
Ý–_çt_kobj
 ){

1519 
	`´štk
Ð
KERN_ERR
 "Unableo create opel fat‡ttributes \n" );

1520 
out
;

1523 
rc
 = 
	`sysfs_ü—‹_group
Ð
Ý–_çt_kobj
, &
©Œ_group
 );

1525 ifÐ
rc
 )

1527 
	`´štk
Ð
KERN_ERR
 "Unableo create opel fat‡ttributes \n");

1528 
	`kobjeù_put
Ð
Ý–_çt_kobj
 );

1531 
out
:

1532  
rc
;

1533 
	}
}

1535 
	$do_fs_sysfs_uÄegi¡¿tiÚ
( )

1537 
	`sysfs_»move_group
Ð
Ý–_çt_kobj
, &
©Œ_group
 );

1539 
	`kobjeù_put
Ð
Ý–_çt_kobj
 );

1540 
	`kobjeù_d–
Ð
Ý–_çt_kobj
 );

1541 
	}
}

1544 
	$Ý–_kžl_block_su³r
Ð
su³r_block
 *
sb
 )

1546 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

1547 
i
 = 0;

1549  
i
 = 0 ; i < ( 
TOTAL_AREA_CNT
 - 1 ) ; i++ )

1550 
	`kä“
Ð
¬—_PA
[ 
i
 ].
·_un™
 );

1553 ifÐ
sbi
->
çt_Üigš®_æag
 !ð
ON
 )

1555 ifÐ!
	`¡rcmp
Ð
sb
->
s_id
, 
SD1_S_ID
 ) )

1557 
g_sb_s1
 = 
NULL
;

1558 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd1
, "Not mounted" );

1562 
g_sb_s2
 = 
NULL
;

1563 
	`¡rýy
Ð
mªag”_cÚŒÞ_sd2
, "Not mounted" );

1567 
	`kžl_block_su³r
Ð
sb
 );

1568 
	}
}

1571 
fže_sy¡em_ty³
 
	gvçt_fs_ty³
 = {

1572 .
owÃr
 = 
THIS_MODULE
,

1573 .
	gÇme
 = "vfat",

1574 .
	gmouÁ
 = 
vçt_mouÁ
,

1576 .
	gkžl_sb
 = 
Ý–_kžl_block_su³r
,

1577 .
	gfs_æags
 = 
FS_REQUIRES_DEV
,

1579 
MODULE_ALIAS_FS
("vfat");

1581 
__š™
 
	$š™_vçt_fs
()

1584 
rc
 = 0;

1585 
	`´štk
Ð
KERN_ALERT
 "[cheon] FAT sysfs Test!! \n");

1587 
rc
 = 
	`do_fs_sysfs_»gi¡¿tiÚ
();

1589 ifÐ
rc
 ){

1590 
	`´štk
Ð
KERN_ALERT
 "[cheon] sysfs„egistration faild \b");

1594  
	`»gi¡”_fžesy¡em
(&
vçt_fs_ty³
);

1595 
	}
}

1597 
__ex™
 
	$ex™_vçt_fs
()

1600 
	`do_fs_sysfs_uÄegi¡¿tiÚ
();

1601 
	`uÄegi¡”_fžesy¡em
(&
vçt_fs_ty³
);

1602 
	}
}

1604 
MODULE_LICENSE
("GPL");

1605 
MODULE_DESCRIPTION
("VFAT filesystem support");

1606 
MODULE_AUTHOR
("Gordon Chaffee");

1608 
	$moduË_š™
(
š™_vçt_fs
)

1609 
	`moduË_ex™
(
ex™_vçt_fs
)

	@nfs.c

14 
	~<lšux/expÜtfs.h
>

15 
	~"çt.h
"

17 
	sçt_fid
 {

18 
u32
 
	mi_g’
;

19 
u32
 
	mi_pos_low
;

20 
u16
 
	mi_pos_hi
;

21 
u16
 
	m·»Á_i_pos_hi
;

22 
u32
 
	m·»Á_i_pos_low
;

23 
u32
 
	m·»Á_i_g’
;

26 
	#FAT_FID_SIZE_WITHOUT_PARENT
 3

	)

27 
	#FAT_FID_SIZE_WITH_PARENT
 ((
çt_fid
)/(
u32
))

	)

32 
šode
 *
	$çt_dg‘
(
su³r_block
 *
sb
, 
i_log¡¬t
)

34 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

35 
hli¡_h—d
 *
h—d
;

36 
msdos_šode_šfo
 *
i
;

37 
šode
 *šodð
NULL
;

39 
h—d
 = 
sbi
->
dœ_hashbË
 + 
	`çt_dœ_hash
(
i_log¡¬t
);

40 
	`¥š_lock
(&
sbi
->
dœ_hash_lock
);

41 
	`hli¡_fÜ_—ch_’Œy
(
i
, 
h—d
, 
i_dœ_hash
) {

42 
	`BUG_ON
(
i
->
vfs_šode
.
i_sb
 !ð
sb
);

43 ià(
i
->
i_log¡¬t
 != i_logstart)

45 
šode
 = 
	`ig¿b
(&
i
->
vfs_šode
);

46 ià(
šode
)

49 
	`¥š_uÆock
(&
sbi
->
dœ_hash_lock
);

50  
šode
;

51 
	}
}

53 
šode
 *
	$çt_žookup
(
su³r_block
 *
sb
, 
u64
 
šo
, 
loff_t
 
i_pos
)

55 ià(
	`MSDOS_SB
(
sb
)->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
)

56  
	`çt_ig‘
(
sb
, 
i_pos
);

59 ià((
šo
 < 
MSDOS_ROOT_INO
è|| (šØ=ð
MSDOS_FSINFO_INO
))

60  
NULL
;

61  
	`žookup
(
sb
, 
šo
);

63 
	}
}

65 
šode
 *
	$__çt_nfs_g‘_šode
(
su³r_block
 *
sb
,

66 
u64
 
šo
, 
u32
 
g’”©iÚ
, 
loff_t
 
i_pos
)

68 
šode
 *šodð
	`çt_žookup
(
sb
, 
šo
, 
i_pos
);

70 ià(
šode
 && 
g’”©iÚ
 && (šode->
i_g’”©iÚ
 != generation)) {

71 
	`ut
(
šode
);

72 
šode
 = 
NULL
;

74 ià(
šode
 =ð
NULL
 && 
	`MSDOS_SB
(
sb
)->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
) {

75 
bufãr_h—d
 *
bh
 = 
NULL
;

76 
msdos_dœ_’Œy
 *
de
 ;

77 
£ùÜ_t
 
blockÄ
;

78 
off£t
;

79 
	`çt_g‘_blkÄ_off£t
(
	`MSDOS_SB
(
sb
), 
i_pos
, &
blockÄ
, &
off£t
);

80 
bh
 = 
	`sb_b»ad
(
sb
, 
blockÄ
);

81 ià(!
bh
) {

82 
	`çt_msg
(
sb
, 
KERN_ERR
,

84 (
Îu
)
blockÄ
);

85  
šode
;

87 
de
 = (
msdos_dœ_’Œy
 *)
bh
->
b_d©a
;

91 ià(
	`IS_FREE
(
de
[
off£t
].
Çme
))

92 
šode
 = 
NULL
;

94 
šode
 = 
	`çt_bužd_šode
(
sb
, &
de
[
off£t
], 
i_pos
);

95 
	`b»l£
(
bh
);

98  
šode
;

99 
	}
}

101 
šode
 *
	$çt_nfs_g‘_šode
(
su³r_block
 *
sb
,

102 
u64
 
šo
, 
u32
 
g’”©iÚ
)

105  
	`__çt_nfs_g‘_šode
(
sb
, 
šo
, 
g’”©iÚ
, 0);

106 
	}
}

109 
	$çt_’code_fh_no¡®e
(
šode
 *šode, 
__u32
 *
fh
, *
ËÅ
,

110 
šode
 *
·»Á
)

112 
Ën
 = *
ËÅ
;

113 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
šode
->
i_sb
);

114 
çt_fid
 *
fid
 = (çt_fid *è
fh
;

115 
loff_t
 
i_pos
;

116 
ty³
 = 
FILEID_FAT_WITHOUT_PARENT
;

118 ià(
·»Á
) {

119 ià(
Ën
 < 
FAT_FID_SIZE_WITH_PARENT
) {

120 *
ËÅ
 = 
FAT_FID_SIZE_WITH_PARENT
;

121  
FILEID_INVALID
;

124 ià(
Ën
 < 
FAT_FID_SIZE_WITHOUT_PARENT
) {

125 *
ËÅ
 = 
FAT_FID_SIZE_WITHOUT_PARENT
;

126  
FILEID_INVALID
;

130 
i_pos
 = 
	`çt_i_pos_»ad
(
sbi
, 
šode
);

131 *
ËÅ
 = 
FAT_FID_SIZE_WITHOUT_PARENT
;

132 
fid
->
i_g’
 = 
šode
->
i_g’”©iÚ
;

133 
fid
->
i_pos_low
 = 
i_pos
 & 0xFFFFFFFF;

134 
fid
->
i_pos_hi
 = (
i_pos
 >> 32) & 0xFFFF;

135 ià(
·»Á
) {

136 
i_pos
 = 
	`çt_i_pos_»ad
(
sbi
, 
·»Á
);

137 
fid
->
·»Á_i_pos_hi
 = (
i_pos
 >> 32) & 0xFFFF;

138 
fid
->
·»Á_i_pos_low
 = 
i_pos
 & 0xFFFFFFFF;

139 
fid
->
·»Á_i_g’
 = 
·»Á
->
i_g’”©iÚ
;

140 
ty³
 = 
FILEID_FAT_WITH_PARENT
;

141 *
ËÅ
 = 
FAT_FID_SIZE_WITH_PARENT
;

144  
ty³
;

145 
	}
}

151 
d’Œy
 *
	$çt_fh_to_d’Œy
(
su³r_block
 *
sb
, 
fid
 *fid,

152 
fh_Ën
, 
fh_ty³
)

154  
	`g’”ic_fh_to_d’Œy
(
sb
, 
fid
, 
fh_Ën
, 
fh_ty³
,

155 
çt_nfs_g‘_šode
);

156 
	}
}

158 
d’Œy
 *
	$çt_fh_to_d’Œy_no¡®e
(
su³r_block
 *
sb
,

159 
fid
 *
fh
, 
fh_Ën
,

160 
fh_ty³
)

162 
šode
 *šodð
NULL
;

163 
çt_fid
 *
fid
 = (çt_fid *)
fh
;

164 
loff_t
 
i_pos
;

166 
fh_ty³
) {

167 
FILEID_FAT_WITHOUT_PARENT
:

168 ià(
fh_Ën
 < 
FAT_FID_SIZE_WITHOUT_PARENT
)

169  
NULL
;

171 
FILEID_FAT_WITH_PARENT
:

172 ià(
fh_Ën
 < 
FAT_FID_SIZE_WITH_PARENT
)

173  
NULL
;

176  
NULL
;

178 
i_pos
 = 
fid
->
i_pos_hi
;

179 
i_pos
 = (i_po << 32è| (
fid
->
i_pos_low
);

180 
šode
 = 
	`__çt_nfs_g‘_šode
(
sb
, 0, 
fid
->
i_g’
, 
i_pos
);

182  
	`d_obš_®Ÿs
(
šode
);

183 
	}
}

189 
d’Œy
 *
	$çt_fh_to_·»Á
(
su³r_block
 *
sb
, 
fid
 *fid,

190 
fh_Ën
, 
fh_ty³
)

192  
	`g’”ic_fh_to_·»Á
(
sb
, 
fid
, 
fh_Ën
, 
fh_ty³
,

193 
çt_nfs_g‘_šode
);

194 
	}
}

196 
d’Œy
 *
	$çt_fh_to_·»Á_no¡®e
(
su³r_block
 *
sb
,

197 
fid
 *
fh
, 
fh_Ën
,

198 
fh_ty³
)

200 
šode
 *šodð
NULL
;

201 
çt_fid
 *
fid
 = (çt_fid *)
fh
;

202 
loff_t
 
i_pos
;

204 ià(
fh_Ën
 < 
FAT_FID_SIZE_WITH_PARENT
)

205  
NULL
;

207 
fh_ty³
) {

208 
FILEID_FAT_WITH_PARENT
:

209 
i_pos
 = 
fid
->
·»Á_i_pos_hi
;

210 
i_pos
 = (i_po << 32è| (
fid
->
·»Á_i_pos_low
);

211 
šode
 = 
	`__çt_nfs_g‘_šode
(
sb
, 0, 
fid
->
·»Á_i_g’
, 
i_pos
);

215  
	`d_obš_®Ÿs
(
šode
);

216 
	}
}

223 
šode
 *
	$çt_»bužd_·»Á
(
su³r_block
 *
sb
, 
·»Á_log¡¬t
)

225 
£¬ch_þus
, 
þus_to_m©ch
;

226 
msdos_dœ_’Œy
 *
de
;

227 
šode
 *
·»Á
 = 
NULL
;

228 
šode
 *
dummy_g¿nd_·»Á
 = 
NULL
;

229 
çt_¦Ù_šfo
 
sšfo
;

230 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

231 
£ùÜ_t
 
blkÄ
 = 
	`çt_þus_to_blkÄ
(
sbi
, 
·»Á_log¡¬t
);

232 
bufãr_h—d
 *
·»Á_bh
 = 
	`sb_b»ad
(
sb
, 
blkÄ
);

233 ià(!
·»Á_bh
) {

234 
	`çt_msg
(
sb
, 
KERN_ERR
,

236  
NULL
;

239 
de
 = (
msdos_dœ_’Œy
 *è
·»Á_bh
->
b_d©a
;

240 
þus_to_m©ch
 = 
	`çt_g‘_¡¬t
(
sbi
, &
de
[0]);

241 
£¬ch_þus
 = 
	`çt_g‘_¡¬t
(
sbi
, &
de
[1]);

243 
dummy_g¿nd_·»Á
 = 
	`çt_dg‘
(
sb
, 
£¬ch_þus
);

244 ià(!
dummy_g¿nd_·»Á
) {

245 
dummy_g¿nd_·»Á
 = 
	`Ãw_šode
(
sb
);

246 ià(!
dummy_g¿nd_·»Á
) {

247 
	`b»l£
(
·»Á_bh
);

248  
·»Á
;

251 
dummy_g¿nd_·»Á
->
i_šo
 = 
	`iunique
(
sb
, 
MSDOS_ROOT_INO
);

252 
	`çt_fžl_šode
(
dummy_g¿nd_·»Á
, &
de
[1]);

253 
	`MSDOS_I
(
dummy_g¿nd_·»Á
)->
i_pos
 = -1;

256 ià(!
	`çt_sÿn_log¡¬t
(
dummy_g¿nd_·»Á
, 
þus_to_m©ch
, &
sšfo
))

257 
·»Á
 = 
	`çt_bužd_šode
(
sb
, 
sšfo
.
de
, sšfo.
i_pos
);

259 
	`b»l£
(
·»Á_bh
);

260 
	`ut
(
dummy_g¿nd_·»Á
);

262  
·»Á
;

263 
	}
}

271 
d’Œy
 *
	$çt_g‘_·»Á
(
d’Œy
 *
chžd_dœ
)

273 
su³r_block
 *
sb
 = 
chžd_dœ
->
d_sb
;

274 
bufãr_h—d
 *
bh
 = 
NULL
;

275 
msdos_dœ_’Œy
 *
de
;

276 
šode
 *
·»Á_šode
 = 
NULL
;

277 
msdos_sb_šfo
 *
sbi
 = 
	`MSDOS_SB
(
sb
);

279 ià(!
	`çt_g‘_dÙdÙ_’Œy
(
chžd_dœ
->
d_šode
, &
bh
, &
de
)) {

280 
·»Á_log¡¬t
 = 
	`çt_g‘_¡¬t
(
sbi
, 
de
);

281 
·»Á_šode
 = 
	`çt_dg‘
(
sb
, 
·»Á_log¡¬t
);

282 ià(!
·»Á_šode
 && 
sbi
->
ÝtiÚs
.
nfs
 =ð
FAT_NFS_NOSTALE_RO
)

283 
·»Á_šode
 = 
	`çt_»bužd_·»Á
(
sb
, 
·»Á_log¡¬t
);

285 
	`b»l£
(
bh
);

287  
	`d_obš_®Ÿs
(
·»Á_šode
);

288 
	}
}

290 cÚ¡ 
expÜt_Ý”©iÚs
 
	gçt_expÜt_Ýs
 = {

291 .
fh_to_d’Œy
 = 
çt_fh_to_d’Œy
,

292 .
	gfh_to_·»Á
 = 
çt_fh_to_·»Á
,

293 .
	gg‘_·»Á
 = 
çt_g‘_·»Á
,

296 cÚ¡ 
expÜt_Ý”©iÚs
 
	gçt_expÜt_Ýs_no¡®e
 = {

297 .
’code_fh
 = 
çt_’code_fh_no¡®e
,

298 .
	gfh_to_d’Œy
 = 
çt_fh_to_d’Œy_no¡®e
,

299 .
	gfh_to_·»Á
 = 
çt_fh_to_·»Á_no¡®e
,

300 .
	gg‘_·»Á
 = 
çt_g‘_·»Á
,

	@/usr/include/linux/capability.h

13 #iâdeà
_LINUX_CAPABILITY_H


14 
	#_LINUX_CAPABILITY_H


	)

16 
	~<lšux/ty³s.h
>

18 
	gsk_¡ruù
;

31 
	#_LINUX_CAPABILITY_VERSION_1
 0x19980330

	)

32 
	#_LINUX_CAPABILITY_U32S_1
 1

	)

34 
	#_LINUX_CAPABILITY_VERSION_2
 0x20071026

	)

35 
	#_LINUX_CAPABILITY_U32S_2
 2

	)

37 
	#_LINUX_CAPABILITY_VERSION_3
 0x20080522

	)

38 
	#_LINUX_CAPABILITY_U32S_3
 2

	)

40 
	s__u£r_ÿp_h—d”_¡ruù
 {

41 
__u32
 
	mv”siÚ
;

42 
	mpid
;

43 } *
	tÿp_u£r_h—d”_t
;

45 
	s__u£r_ÿp_d©a_¡ruù
 {

46 
__u32
 
	mefãùive
;

47 
__u32
 
	m³rm™‹d
;

48 
__u32
 
	mšh”™abË
;

49 } *
	tÿp_u£r_d©a_t
;

52 
	#VFS_CAP_REVISION_MASK
 0xFF000000

	)

53 
	#VFS_CAP_REVISION_SHIFT
 24

	)

54 
	#VFS_CAP_FLAGS_MASK
 ~
VFS_CAP_REVISION_MASK


	)

55 
	#VFS_CAP_FLAGS_EFFECTIVE
 0x000001

	)

57 
	#VFS_CAP_REVISION_1
 0x01000000

	)

58 
	#VFS_CAP_U32_1
 1

	)

59 
	#XATTR_CAPS_SZ_1
 ((
__Ë32
)*(1 + 2*
VFS_CAP_U32_1
))

	)

61 
	#VFS_CAP_REVISION_2
 0x02000000

	)

62 
	#VFS_CAP_U32_2
 2

	)

63 
	#XATTR_CAPS_SZ_2
 ((
__Ë32
)*(1 + 2*
VFS_CAP_U32_2
))

	)

65 
	#XATTR_CAPS_SZ
 
XATTR_CAPS_SZ_2


	)

66 
	#VFS_CAP_U32
 
VFS_CAP_U32_2


	)

67 
	#VFS_CAP_REVISION
 
VFS_CAP_REVISION_2


	)

69 
	svfs_ÿp_d©a
 {

70 
__Ë32
 
	mmagic_‘c
;

72 
__Ë32
 
	m³rm™‹d
;

73 
__Ë32
 
	mšh”™abË
;

74 } 
	md©a
[
VFS_CAP_U32
];

83 
	#_LINUX_CAPABILITY_VERSION
 
_LINUX_CAPABILITY_VERSION_1


	)

84 
	#_LINUX_CAPABILITY_U32S
 
_LINUX_CAPABILITY_U32S_1


	)

96 
	#CAP_CHOWN
 0

	)

102 
	#CAP_DAC_OVERRIDE
 1

	)

108 
	#CAP_DAC_READ_SEARCH
 2

	)

114 
	#CAP_FOWNER
 3

	)

123 
	#CAP_FSETID
 4

	)

129 
	#CAP_KILL
 5

	)

135 
	#CAP_SETGID
 6

	)

140 
	#CAP_SETUID
 7

	)

157 
	#CAP_SETPCAP
 8

	)

161 
	#CAP_LINUX_IMMUTABLE
 9

	)

166 
	#CAP_NET_BIND_SERVICE
 10

	)

170 
	#CAP_NET_BROADCAST
 11

	)

186 
	#CAP_NET_ADMIN
 12

	)

192 
	#CAP_NET_RAW
 13

	)

198 
	#CAP_IPC_LOCK
 14

	)

202 
	#CAP_IPC_OWNER
 15

	)

205 
	#CAP_SYS_MODULE
 16

	)

210 
	#CAP_SYS_RAWIO
 17

	)

214 
	#CAP_SYS_CHROOT
 18

	)

218 
	#CAP_SYS_PTRACE
 19

	)

222 
	#CAP_SYS_PACCT
 20

	)

261 
	#CAP_SYS_ADMIN
 21

	)

265 
	#CAP_SYS_BOOT
 22

	)

274 
	#CAP_SYS_NICE
 23

	)

288 
	#CAP_SYS_RESOURCE
 24

	)

294 
	#CAP_SYS_TIME
 25

	)

299 
	#CAP_SYS_TTY_CONFIG
 26

	)

303 
	#CAP_MKNOD
 27

	)

307 
	#CAP_LEASE
 28

	)

309 
	#CAP_AUDIT_WRITE
 29

	)

311 
	#CAP_AUDIT_CONTROL
 30

	)

313 
	#CAP_SETFCAP
 31

	)

321 
	#CAP_MAC_OVERRIDE
 32

	)

330 
	#CAP_MAC_ADMIN
 33

	)

334 
	#CAP_SYSLOG
 34

	)

338 
	#CAP_WAKE_ALARM
 35

	)

342 
	#CAP_BLOCK_SUSPEND
 36

	)

344 
	#CAP_LAST_CAP
 
CAP_BLOCK_SUSPEND


	)

346 
	#ÿp_v®id
(
x
è((xè>ð0 && (xè<ð
CAP_LAST_CAP
)

	)

352 
	#CAP_TO_INDEX
(
x
è((xè>> 5è

	)

353 
	#CAP_TO_MASK
(
x
è(1 << ((xè& 31)è

	)

	@/usr/include/linux/fs.h

1 #iâdeà
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<lšux/lim™s.h
>

10 
	~<lšux/ioùl.h
>

11 
	~<lšux/ty³s.h
>

24 #undeà
NR_OPEN


25 
	#INR_OPEN_CUR
 1024

	)

26 
	#INR_OPEN_MAX
 4096

	)

28 
	#BLOCK_SIZE_BITS
 10

	)

29 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

31 
	#SEEK_SET
 0

	)

32 
	#SEEK_CUR
 1

	)

33 
	#SEEK_END
 2

	)

34 
	#SEEK_DATA
 3

	)

35 
	#SEEK_HOLE
 4

	)

36 
	#SEEK_MAX
 
SEEK_HOLE


	)

38 
	sf¡rim_¿nge
 {

39 
__u64
 
	m¡¬t
;

40 
__u64
 
	mËn
;

41 
__u64
 
	mmšËn
;

45 
	sfžes_¡©_¡ruù
 {

46 
	mÄ_fžes
;

47 
	mÄ_ä“_fžes
;

48 
	mmax_fžes
;

51 
	sšodes_¡©_t
 {

52 
	mÄ_šodes
;

53 
	mÄ_unu£d
;

54 
	mdummy
[5];

58 
	#NR_FILE
 8192

	)

64 
	#MS_RDONLY
 1

	)

65 
	#MS_NOSUID
 2

	)

66 
	#MS_NODEV
 4

	)

67 
	#MS_NOEXEC
 8

	)

68 
	#MS_SYNCHRONOUS
 16

	)

69 
	#MS_REMOUNT
 32

	)

70 
	#MS_MANDLOCK
 64

	)

71 
	#MS_DIRSYNC
 128

	)

72 
	#MS_NOATIME
 1024

	)

73 
	#MS_NODIRATIME
 2048

	)

74 
	#MS_BIND
 4096

	)

75 
	#MS_MOVE
 8192

	)

76 
	#MS_REC
 16384

	)

77 
	#MS_VERBOSE
 32768

	)

79 
	#MS_SILENT
 32768

	)

80 
	#MS_POSIXACL
 (1<<16è

	)

81 
	#MS_UNBINDABLE
 (1<<17è

	)

82 
	#MS_PRIVATE
 (1<<18è

	)

83 
	#MS_SLAVE
 (1<<19è

	)

84 
	#MS_SHARED
 (1<<20è

	)

85 
	#MS_RELATIME
 (1<<21è

	)

86 
	#MS_KERNMOUNT
 (1<<22è

	)

87 
	#MS_I_VERSION
 (1<<23è

	)

88 
	#MS_STRICTATIME
 (1<<24è

	)

91 
	#MS_NOSEC
 (1<<28)

	)

92 
	#MS_BORN
 (1<<29)

	)

93 
	#MS_ACTIVE
 (1<<30)

	)

94 
	#MS_NOUSER
 (1<<31)

	)

99 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
)

	)

104 
	#MS_MGC_VAL
 0xC0ED0000

	)

105 
	#MS_MGC_MSK
 0xffff0000

	)

110 
	#BLKROSET
 
	`_IO
(0x12,93è

	)

111 
	#BLKROGET
 
	`_IO
(0x12,94è

	)

112 
	#BLKRRPART
 
	`_IO
(0x12,95è

	)

113 
	#BLKGETSIZE
 
	`_IO
(0x12,96è

	)

114 
	#BLKFLSBUF
 
	`_IO
(0x12,97è

	)

115 
	#BLKRASET
 
	`_IO
(0x12,98è

	)

116 
	#BLKRAGET
 
	`_IO
(0x12,99è

	)

117 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

118 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

119 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

120 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

121 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

123 
	#BLKPG
 
	`_IO
(0x12,105)

	)

127 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

128 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

133 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

134 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

135 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

136 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_Œaû_£tup
)

	)

137 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

138 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

139 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

140 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

141 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

142 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

143 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

144 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

145 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

146 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

147 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

148 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

150 
	#BMAP_IOCTL
 1

	)

151 
	#FIBMAP
 
	`_IO
(0x00,1è

	)

152 
	#FIGETBSZ
 
	`_IO
(0x00,2è

	)

153 
	#FIFREEZE
 
	`_IOWR
('X', 119, è

	)

154 
	#FITHAW
 
	`_IOWR
('X', 120, è

	)

155 
	#FITRIM
 
	`_IOWR
('X', 121, 
f¡rim_¿nge
è

	)

157 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

158 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

159 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

160 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

161 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
f›m­
)

	)

162 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

163 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

164 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

165 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

170 
	#FS_SECRM_FL
 0x00000001

	)

171 
	#FS_UNRM_FL
 0x00000002

	)

172 
	#FS_COMPR_FL
 0x00000004

	)

173 
	#FS_SYNC_FL
 0x00000008

	)

174 
	#FS_IMMUTABLE_FL
 0x00000010

	)

175 
	#FS_APPEND_FL
 0x00000020

	)

176 
	#FS_NODUMP_FL
 0x00000040

	)

177 
	#FS_NOATIME_FL
 0x00000080

	)

179 
	#FS_DIRTY_FL
 0x00000100

	)

180 
	#FS_COMPRBLK_FL
 0x00000200

	)

181 
	#FS_NOCOMP_FL
 0x00000400

	)

182 
	#FS_ECOMPR_FL
 0x00000800

	)

184 
	#FS_BTREE_FL
 0x00001000

	)

185 
	#FS_INDEX_FL
 0x00001000

	)

186 
	#FS_IMAGIC_FL
 0x00002000

	)

187 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

188 
	#FS_NOTAIL_FL
 0x00008000

	)

189 
	#FS_DIRSYNC_FL
 0x00010000

	)

190 
	#FS_TOPDIR_FL
 0x00020000

	)

191 
	#FS_EXTENT_FL
 0x00080000

	)

192 
	#FS_DIRECTIO_FL
 0x00100000

	)

193 
	#FS_NOCOW_FL
 0x00800000

	)

194 
	#FS_RESERVED_FL
 0x80000000

	)

196 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

197 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

200 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

201 
	#SYNC_FILE_RANGE_WRITE
 2

	)

202 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<lšux/sysšfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
è
	`__ALIGN_KERNEL_MASK
(x, (
	`ty³of
(x))×è- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
è(((xè+ (mask)è& ~(mask))

	)

	@/usr/include/linux/msdos_fs.h

1 #iâdeà
_LINUX_MSDOS_FS_H


2 
	#_LINUX_MSDOS_FS_H


	)

4 
	~<lšux/ty³s.h
>

5 
	~<lšux/magic.h
>

6 
	~<asm/by‹Üd”.h
>

12 
	#SECTOR_SIZE
 512

	)

13 
	#SECTOR_BITS
 9

	)

14 
	#MSDOS_DPB
 (
MSDOS_DPS
è

	)

15 
	#MSDOS_DPB_BITS
 4

	)

16 
	#MSDOS_DPS
 (
SECTOR_SIZE
 / (
msdos_dœ_’Œy
))

	)

17 
	#MSDOS_DPS_BITS
 4

	)

18 
	#MSDOS_LONGNAME
 256

	)

19 
	#CF_LE_W
(
v
è
	`Ë16_to_ýu
(v)

	)

20 
	#CF_LE_L
(
v
è
	`Ë32_to_ýu
(v)

	)

21 
	#CT_LE_W
(
v
è
	`ýu_to_Ë16
(v)

	)

22 
	#CT_LE_L
(
v
è
	`ýu_to_Ë32
(v)

	)

24 
	#MSDOS_ROOT_INO
 1

	)

25 
	#MSDOS_FSINFO_INO
 2

	)

27 
	#MSDOS_DIR_BITS
 5

	)

30 
	#FAT_MAX_DIR_ENTRIES
 (65536)

	)

31 
	#FAT_MAX_DIR_SIZE
 (
FAT_MAX_DIR_ENTRIES
 << 
MSDOS_DIR_BITS
)

	)

33 
	#ATTR_NONE
 0

	)

34 
	#ATTR_RO
 1

	)

35 
	#ATTR_HIDDEN
 2

	)

36 
	#ATTR_SYS
 4

	)

37 
	#ATTR_VOLUME
 8

	)

38 
	#ATTR_DIR
 16

	)

39 
	#ATTR_ARCH
 32

	)

42 
	#ATTR_UNUSED
 (
ATTR_VOLUME
 | 
ATTR_ARCH
 | 
ATTR_SYS
 | 
ATTR_HIDDEN
)

	)

44 
	#ATTR_EXT
 (
ATTR_RO
 | 
ATTR_HIDDEN
 | 
ATTR_SYS
 | 
ATTR_VOLUME
)

	)

46 
	#CASE_LOWER_BASE
 8

	)

47 
	#CASE_LOWER_EXT
 16

	)

49 
	#DELETED_FLAG
 0xe5

	)

50 
	#IS_FREE
(
n
è(!*Òè|| *Òè=ð
DELETED_FLAG
)

	)

52 
	#FAT_LFN_LEN
 255

	)

53 
	#MSDOS_NAME
 11

	)

54 
	#MSDOS_SLOTS
 21

	)

55 
	#MSDOS_DOT
 ". "

	)

56 
	#MSDOS_DOTDOT
 ".. "

	)

58 
	#FAT_FIRST_ENT
(
s
, 
x
è((
	`MSDOS_SB
(s)->
çt_b™s
 == 32 ? 0x0FFFFF00 : \

59 
	`MSDOS_SB
(
s
)->
çt_b™s
 =ð16 ? 0xFF00 : 0xF00è| (
x
))

	)

62 
	#FAT_START_ENT
 2

	)

65 
	#MAX_FAT12
 0xFF4

	)

66 
	#MAX_FAT16
 0xFFF4

	)

67 
	#MAX_FAT32
 0x0FFFFFF6

	)

68 
	#MAX_FAT
(
s
è(
	`MSDOS_SB
(s)->
çt_b™s
 =ð32 ? 
MAX_FAT32
 : \

69 
	`MSDOS_SB
(
s
)->
çt_b™s
 =ð16 ? 
MAX_FAT16
 : 
MAX_FAT12
)

	)

72 
	#BAD_FAT12
 0xFF7

	)

73 
	#BAD_FAT16
 0xFFF7

	)

74 
	#BAD_FAT32
 0x0FFFFFF7

	)

77 
	#EOF_FAT12
 0xFFF

	)

78 
	#EOF_FAT16
 0xFFFF

	)

79 
	#EOF_FAT32
 0x0FFFFFFF

	)

81 
	#FAT_ENT_FREE
 (0)

	)

82 
	#FAT_ENT_BAD
 (
BAD_FAT32
)

	)

83 
	#FAT_ENT_EOF
 (
EOF_FAT32
)

	)

85 
	#FAT_FSINFO_SIG1
 0x41615252

	)

86 
	#FAT_FSINFO_SIG2
 0x61417272

	)

87 
	#IS_FSINFO
(
x
è(
	`Ë32_to_ýu
((x)->
sigÇtu»1
è=ð
FAT_FSINFO_SIG1
 \

88 && 
	`Ë32_to_ýu
((
x
)->
sigÇtu»2
è=ð
FAT_FSINFO_SIG2
)

	)

90 
	#FAT_STATE_DIRTY
 0x01

	)

92 
	s__çt_dœ’t
 {

93 
	md_šo
;

94 
__k”Ãl_off_t
 
	md_off
;

95 
	md_»þ’
;

96 
	md_Çme
[256];

102 
	#VFAT_IOCTL_READDIR_BOTH
 
	`_IOR
('r', 1, 
__çt_dœ’t
[2])

	)

103 
	#VFAT_IOCTL_READDIR_SHORT
 
	`_IOR
('r', 2, 
__çt_dœ’t
[2])

	)

105 
	#FAT_IOCTL_GET_ATTRIBUTES
 
	`_IOR
('r', 0x10, 
__u32
)

	)

106 
	#FAT_IOCTL_SET_ATTRIBUTES
 
	`_IOW
('r', 0x11, 
__u32
)

	)

108 
	#FAT_IOCTL_GET_VOLUME_ID
 
	`_IOR
('r', 0x13, 
__u32
)

	)

110 
	sçt_boÙ_£ùÜ
 {

111 
__u8
 
	mignÜed
[3];

112 
__u8
 
	msy¡em_id
[8];

114 
__u8
 
	m£ùÜ_size
[2];

115 
__u8
 
	m£c_³r_þus
;

116 
__Ë16
 
	m»£rved
;

117 
__u8
 
	mçts
;

118 
__u8
 
	mdœ_’Œ›s
[2];

119 
__u8
 
	m£ùÜs
[2];

120 
__u8
 
	mmedŸ
;

121 
__Ë16
 
	mçt_Ëngth
;

122 
__Ë16
 
	m£cs_Œack
;

123 
__Ë16
 
	mh—ds
;

124 
__Ë32
 
	mhidd’
;

125 
__Ë32
 
	mtÙ®_£ù
;

130 
__u8
 
	mdrive_numb”
;

131 
__u8
 
	m¡©e
;

133 
__u8
 
	msigÇtu»
;

134 
__u8
 
	mvÞ_id
[4];

135 
__u8
 
	mvÞ_Ïb–
[11];

136 
__u8
 
	mfs_ty³
[8];

138 } 
	mçt16
;

142 
__Ë32
 
	mËngth
;

143 
__Ë16
 
	mæags
;

145 
__u8
 
	mv”siÚ
[2];

147 
__Ë32
 
	mroÙ_þu¡”
;

149 
__Ë16
 
	mšfo_£ùÜ
;

150 
__Ë16
 
	mbackup_boÙ
;

151 
__Ë16
 
	m»£rved2
[6];

153 
__u8
 
	mdrive_numb”
;

154 
__u8
 
	m¡©e
;

156 
__u8
 
	msigÇtu»
;

157 
__u8
 
	mvÞ_id
[4];

158 
__u8
 
	mvÞ_Ïb–
[11];

159 
__u8
 
	mfs_ty³
[8];

161 } 
	mçt32
;

165 
	sçt_boÙ_fsšfo
 {

166 
__Ë32
 
	msigÇtu»1
;

167 
__Ë32
 
	m»£rved1
[120];

168 
__Ë32
 
	msigÇtu»2
;

169 
__Ë32
 
	mä“_þu¡”s
;

170 
__Ë32
 
	mÃxt_þu¡”
;

171 
__Ë32
 
	m»£rved2
[4];

174 
	smsdos_dœ_’Œy
 {

175 
__u8
 
	mÇme
[
MSDOS_NAME
];

176 
__u8
 
	m©Œ
;

177 
__u8
 
	mlÿ£
;

178 
__u8
 
	mùime_cs
;

179 
__Ë16
 
	mùime
;

180 
__Ë16
 
	mcd©e
;

181 
__Ë16
 
	mad©e
;

182 
__Ë16
 
	m¡¬thi
;

183 
__Ë16
 
	mtime
,
	md©e
,
	m¡¬t
;

184 
__Ë32
 
	msize
;

188 
	smsdos_dœ_¦Ù
 {

189 
__u8
 
	mid
;

190 
__u8
 
	mÇme0_4
[10];

191 
__u8
 
	m©Œ
;

192 
__u8
 
	m»£rved
;

193 
__u8
 
	m®Ÿs_checksum
;

194 
__u8
 
	mÇme5_10
[12];

195 
__Ë16
 
	m¡¬t
;

196 
__u8
 
	mÇme11_12
[4];

	@/usr/include/linux/string.h

1 #iâdeà
_LINUX_STRING_H_


2 
	#_LINUX_STRING_H_


	)

6 
	~<¡ršg.h
>

	@/usr/include/linux/time.h

1 #iâdeà
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<lšux/ty³s.h
>

7 #iâdeà
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stime¥ec
 {

10 
__k”Ãl_time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

15 
	stimev®
 {

16 
__k”Ãl_time_t
 
	mtv_£c
;

17 
__k”Ãl_su£cÚds_t
 
	mtv_u£c
;

20 
	stimezÚe
 {

21 
	mtz_mšu‹swe¡
;

22 
	mtz_d¡time
;

30 
	#ITIMER_REAL
 0

	)

31 
	#ITIMER_VIRTUAL
 1

	)

32 
	#ITIMER_PROF
 2

	)

34 
	s™im”¥ec
 {

35 
time¥ec
 
	m™_š‹rv®
;

36 
time¥ec
 
	m™_v®ue
;

39 
	s™im”v®
 {

40 
timev®
 
	m™_š‹rv®
;

41 
timev®
 
	m™_v®ue
;

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

57 
	#CLOCK_SGI_CYCLE
 10

	)

58 
	#CLOCK_TAI
 11

	)

60 
	#MAX_CLOCKS
 16

	)

61 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

62 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

67 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/uio.h

9 #iâdeà
__LINUX_UIO_H


10 
	#__LINUX_UIO_H


	)

13 
	~<lšux/ty³s.h
>

16 
	siovec


18 *
	miov_ba£
;

19 
__k”Ãl_size_t
 
	miov_Ën
;

26 
	#UIO_FASTIOV
 8

	)

27 
	#UIO_MAXIOV
 1024

	)

	@/usr/include/asm/byteorder.h

1 #iâdeà
_ASM_X86_BYTEORDER_H


2 
	#_ASM_X86_BYTEORDER_H


	)

4 
	~<lšux/by‹Üd”/l™Že_’dŸn.h
>

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/limits.h

1 #iâdeà
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/magic.h

1 #iâdeà
__LINUX_MAGIC_H__


2 
	#__LINUX_MAGIC_H__


	)

4 
	#ADFS_SUPER_MAGIC
 0xadf5

	)

5 
	#AFFS_SUPER_MAGIC
 0xadff

	)

6 
	#AFS_SUPER_MAGIC
 0x5346414F

	)

7 
	#AUTOFS_SUPER_MAGIC
 0x0187

	)

8 
	#CODA_SUPER_MAGIC
 0x73757245

	)

9 
	#CRAMFS_MAGIC
 0x28cd3d45

	)

10 
	#CRAMFS_MAGIC_WEND
 0x453dcd28

	)

11 
	#DEBUGFS_MAGIC
 0x64626720

	)

12 
	#SECURITYFS_MAGIC
 0x73636673

	)

13 
	#SELINUX_MAGIC
 0xf97cff8c

	)

14 
	#SMACK_MAGIC
 0x43415d53

	)

15 
	#RAMFS_MAGIC
 0x858458f6

	)

16 
	#TMPFS_MAGIC
 0x01021994

	)

17 
	#HUGETLBFS_MAGIC
 0x958458f6

	)

18 
	#SQUASHFS_MAGIC
 0x73717368

	)

19 
	#ECRYPTFS_SUPER_MAGIC
 0xf15f

	)

20 
	#EFS_SUPER_MAGIC
 0x414A53

	)

21 
	#EXT2_SUPER_MAGIC
 0xEF53

	)

22 
	#EXT3_SUPER_MAGIC
 0xEF53

	)

23 
	#XENFS_SUPER_MAGIC
 0xabba1974

	)

24 
	#EXT4_SUPER_MAGIC
 0xEF53

	)

25 
	#BTRFS_SUPER_MAGIC
 0x9123683E

	)

26 
	#NILFS_SUPER_MAGIC
 0x3434

	)

27 
	#F2FS_SUPER_MAGIC
 0xF2F52010

	)

28 
	#HPFS_SUPER_MAGIC
 0xf995e849

	)

29 
	#ISOFS_SUPER_MAGIC
 0x9660

	)

30 
	#JFFS2_SUPER_MAGIC
 0x72b6

	)

31 
	#PSTOREFS_MAGIC
 0x6165676C

	)

32 
	#EFIVARFS_MAGIC
 0xde5e81e4

	)

33 
	#HOSTFS_SUPER_MAGIC
 0x00c0fãe

	)

35 
	#MINIX_SUPER_MAGIC
 0x137F

	)

36 
	#MINIX_SUPER_MAGIC2
 0x138F

	)

37 
	#MINIX2_SUPER_MAGIC
 0x2468

	)

38 
	#MINIX2_SUPER_MAGIC2
 0x2478

	)

39 
	#MINIX3_SUPER_MAGIC
 0x4d5¨

	)

41 
	#MSDOS_SUPER_MAGIC
 0x4d44

	)

42 
	#NCP_SUPER_MAGIC
 0x564ø

	)

43 
	#NFS_SUPER_MAGIC
 0x6969

	)

44 
	#OPENPROM_SUPER_MAGIC
 0x9ç1

	)

45 
	#QNX4_SUPER_MAGIC
 0x002à

	)

46 
	#QNX6_SUPER_MAGIC
 0x68191122

	)

48 
	#REISERFS_SUPER_MAGIC
 0x52654973

	)

51 
	#REISERFS_SUPER_MAGIC_STRING
 "ReIsErFs"

	)

52 
	#REISER2FS_SUPER_MAGIC_STRING
 "ReIsEr2Fs"

	)

53 
	#REISER2FS_JR_SUPER_MAGIC_STRING
 "ReIsEr3Fs"

	)

55 
	#SMB_SUPER_MAGIC
 0x517B

	)

56 
	#CGROUP_SUPER_MAGIC
 0x27e0eb

	)

59 
	#STACK_END_MAGIC
 0x57AC6E9D

	)

61 
	#V9FS_MAGIC
 0x01021997

	)

63 
	#BDEVFS_MAGIC
 0x62646576

	)

64 
	#BINFMTFS_MAGIC
 0x42494e4d

	)

65 
	#DEVPTS_SUPER_MAGIC
 0x1cd1

	)

66 
	#FUTEXFS_SUPER_MAGIC
 0xBAD1DEA

	)

67 
	#PIPEFS_MAGIC
 0x50495045

	)

68 
	#PROC_SUPER_MAGIC
 0x9ç0

	)

69 
	#SOCKFS_MAGIC
 0x534F434B

	)

70 
	#SYSFS_MAGIC
 0x62656572

	)

71 
	#USBDEVICE_SUPER_MAGIC
 0x9ç2

	)

72 
	#MTD_INODE_FS_MAGIC
 0x11307854

	)

73 
	#ANON_INODE_FS_MAGIC
 0x09041934

	)

74 
	#BTRFS_TEST_MAGIC
 0x73727279

	)

	@/usr/include/linux/sysinfo.h

1 #iâdeà
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<lšux/ty³s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysšfo
 {

8 
__k”Ãl_lÚg_t
 
	mu±ime
;

9 
__k”Ãl_ulÚg_t
 
	mlßds
[3];

10 
__k”Ãl_ulÚg_t
 
	mtÙ®¿m
;

11 
__k”Ãl_ulÚg_t
 
	mä“¿m
;

12 
__k”Ãl_ulÚg_t
 
	msh¬ed¿m
;

13 
__k”Ãl_ulÚg_t
 
	mbufã¼am
;

14 
__k”Ãl_ulÚg_t
 
	mtÙ®sw­
;

15 
__k”Ãl_ulÚg_t
 
	mä“sw­
;

16 
__u16
 
	m´ocs
;

17 
__u16
 
	m·d
;

18 
__k”Ãl_ulÚg_t
 
	mtÙ®high
;

19 
__k”Ãl_ulÚg_t
 
	mä“high
;

20 
__u32
 
	mmem_un™
;

21 
	m_f
[20-2*(
__k”Ãl_ulÚg_t
)-(
__u32
)];

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty³s.h
>

6 #iâdeà
__ASSEMBLY__


8 
	~<lšux/posix_ty³s.h
>

16 #ifdeà
__CHECKER__


17 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

19 
	#__b™wi£__


	)

21 #ifdeà
__CHECK_ENDIAN__


22 
	#__b™wi£
 
__b™wi£__


	)

24 
	#__b™wi£


	)

27 
__u16
 
	t__b™wi£
 
	t__Ë16
;

28 
__u16
 
	t__b™wi£
 
	t__be16
;

29 
__u32
 
	t__b™wi£
 
	t__Ë32
;

30 
__u32
 
	t__b™wi£
 
	t__be32
;

31 
__u64
 
	t__b™wi£
 
	t__Ë64
;

32 
__u64
 
	t__b™wi£
 
	t__be64
;

34 
__u16
 
	t__b™wi£
 
	t__sum16
;

35 
__u32
 
	t__b™wi£
 
	t__wsum
;

46 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

48 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

39 #ià
defšed
 
__ýlu¥lus
 && (__ýlu¥lu >ð199711L || 
__GNUC_PREREQ
 (4, 4))

40 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

44 
__BEGIN_NAMESPACE_STD


46 *
	$memýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

47 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

50 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

51 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 
__END_NAMESPACE_STD


57 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


58 *
	$memcýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

59 
__c
, 
size_t
 
__n
)

60 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

64 
__BEGIN_NAMESPACE_STD


66 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

69 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

70 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

73 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


76 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

77 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

79 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ifdeà
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__bužtš_memchr
 (
__s
, 
__c
, 
__n
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


91  
	`__bužtš_memchr
 (
__s
, 
__c
, 
__n
);

94 
	}
}

96 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

99 
__END_NAMESPACE_STD


101 #ifdeà
__USE_GNU


104 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


105 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

106 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

107 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

108 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

110 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

111 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

115 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


116 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

117 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

118 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

119 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

122 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

127 
__BEGIN_NAMESPACE_STD


129 *
	$¡rýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºýy
 (*
__»¡riù
 
__de¡
,

133 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

137 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

138 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

141 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

144 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

151 
	$¡rcÞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

154 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

155 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

156 
__THROW
 
	`__nÚnuÎ
 ((2));

157 
__END_NAMESPACE_STD


159 #ifdeà
__USE_XOPEN2K8


163 
	~<xloÿË.h
>

166 
	$¡rcÞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

169 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

170 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

173 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

174 || 
defšed
 
__USE_XOPEN2K8


176 *
	$¡rdup
 (cÚ¡ *
__s
)

177 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_XOPEN2K8


184 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

185 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

188 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


190 
	#¡rdu·
(
s
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Þd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Þd
) + 1; \

195 *
__Ãw
 = (*è
	`__bužtš_®loÿ
 (
__Ën
); \

196 (*è
	`memýy
 (
__Ãw
, 
__Þd
, 
__Ën
); \

197 
	}
}))

	)

200 
	#¡ºdu·
(
s
, 
n
) \

201 (
__ex‹nsiÚ__
 \

203 cÚ¡ *
__Þd
 = (
s
); \

204 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Þd
, (
n
)); \

205 *
__Ãw
 = (*è
	`__bužtš_®loÿ
 (
__Ën
 + 1); \

206 
__Ãw
[
__Ën
] = '\0'; \

207 (*è
	`memýy
 (
__Ãw
, 
__Þd
, 
__Ën
); \

208 }))

	)

211 
	g__BEGIN_NAMESPACE_STD


213 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


216 *
¡rchr
 (*
__s
, 
__c
)

217 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

218 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

219 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

221 #ifdeà
__OPTIMIZE__


222 
__ex‹º_®ways_šlše
 *

223 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


225  
__bužtš_¡rchr
 (
__s
, 
__c
);

228 
__ex‹º_®ways_šlše
 const *

229 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


231  
__bužtš_¡rchr
 (
__s
, 
__c
);

236 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

237 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


243 *
	`¡¼chr
 (*
__s
, 
__c
)

244 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

245 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

246 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

248 #ifdeà
__OPTIMIZE__


249 
__ex‹º_®ways_šlše
 *

250 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


252  
	`__bužtš_¡¼chr
 (
__s
, 
__c
);

255 
__ex‹º_®ways_šlše
 const *

256 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


258  
	`__bužtš_¡¼chr
 (
__s
, 
__c
);

261 
	}
}

263 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

264 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

266 
__END_NAMESPACE_STD


268 #ifdeà
__USE_GNU


271 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


272 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

273 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

274 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

275 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

278 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

282 
__BEGIN_NAMESPACE_STD


285 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

286 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

289 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

290 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


295 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

296 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

297 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

298 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

300 #ifdeà
__OPTIMIZE__


301 
__ex‹º_®ways_šlše
 *

302 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


304  
	`__bužtš_¡½brk
 (
__s
, 
__acû±
);

307 
__ex‹º_®ways_šlše
 const *

308 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


310  
	`__bužtš_¡½brk
 (
__s
, 
__acû±
);

313 
	}
}

315 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

316 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


322 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

323 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

324 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


331  
	`__bužtš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 const *

335 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


337  
	`__bužtš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 cÚ¡ *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

370 cÚ¡ *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempýy
 (*
__»¡riù
 
__de¡
,

389 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempýy
 (*
__»¡riù
 
__de¡
,

392 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcÝy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__bužtš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 const *

482 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


484  
	`__bužtš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__bužtš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 const *

510 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


512  
	`__bužtš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

530 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

534 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

535 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

538 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

539 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

542 #ifdef 
__USE_GNU


545 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

546 
__loÿË_t
 
__loc
)

547 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

549 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

550 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

551 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

554 #ifdef 
__USE_BSD


557 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

558 cÚ¡ *
__»¡riù
 
__d–im
)

559 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

562 #ifdef 
__USE_XOPEN2K8


564 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

567 *
	$__¡pýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

568 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$¡pýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 *
	$__¡²ýy
 (*
__»¡riù
 
__de¡
,

575 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 *
	$¡²ýy
 (*
__»¡riù
 
__de¡
,

578 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

582 #ifdef 
__USE_GNU


584 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

585 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

588 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 #iâdeà
ba£Çme


598 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


599 "C++" *
	$ba£Çme
 (*
__fž’ame
)

600 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

601 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__fž’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

604 *
	$ba£Çme
 (cÚ¡ *
__fž’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

610 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

611 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

612 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ýlu¥lus


632 
	~<b™s/¡ršg.h
>

635 
	~<b™s/¡ršg2.h
>

638 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


640 
	~<b™s/¡ršg3.h
>

644 
__END_DECLS


	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/bits/string.h

19 #iâdeà
_STRING_H


24 
	#_STRING_ARCH_uÇligÃd
 1

	)

28 #ià!
defšed
 
__x86_64__
 && (defšed 
__i486__
 || defšed 
__³Áium__
 \

29 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

30 || 
defšed
 
	g__nocÚa__
 || defšed 
	g__©om__
 \

31 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__cÜei7__
 \

32 || 
defšed
 
	g__k6__
 || defšed 
	g__geode__
 \

33 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

34 || 
defšed
 
	g__amdçm10__
)

38 #ià!
defšed
 
__NO_STRING_INLINES
 && defšed 
__USE_STRING_INLINES
 \

39 && 
defšed
 
	g__GNUC__
 && __GNUC__ >= 2

41 #iâdeà
__STRING_INLINE


42 #iâdeà
__ex‹º_šlše


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

50 
	#__STRING_SMALL_GET16
(
¤c
, 
idx
) \

51 ((((cÚ¡ *è(
¤c
))[
idx
 + 1] << 8) \

52 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

53 
	#__STRING_SMALL_GET32
(
¤c
, 
idx
) \

54 (((((cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

55 | ((cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

56 | ((cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

57 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

61 
	#_HAVE_STRING_ARCH_memýy
 1

	)

62 
	#memýy
(
de¡
, 
¤c
, 
n
) \

63 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
n
) \

64 ? 
	`__memýy_c
 ((
de¡
), (
¤c
), (
n
)) \

65 : 
	`__memýy_g
 ((
de¡
), (
¤c
), (
n
))))

	)

66 
	#__memýy_c
(
de¡
, 
¤c
, 
n
) \

67 ((
n
) == 0 \

68 ? (
de¡
) \

69 : (((
n
) % 4 == 0) \

70 ? 
	`__memýy_by4
 (
de¡
, 
¤c
, 
n
) \

71 : (((
n
) % 2 == 0) \

72 ? 
	`__memýy_by2
 (
de¡
, 
¤c
, 
n
) \

73 : 
	`__memýy_g
 (
de¡
, 
¤c
, 
n
))))

	)

75 
__STRING_INLINE
 *
__memýy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

76 
size_t
 
__n
);

78 
__STRING_INLINE
 *

79 
	$__memýy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

81 
__d0
, 
__d1
;

82 *
__tmp
 = 
__de¡
;

83 
__asm__
 
__vÞ©že__


91 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

92 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 4)

94  
__de¡
;

95 
	}
}

97 
__STRING_INLINE
 *
__memýy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

98 
size_t
 
__n
);

100 
__STRING_INLINE
 *

101 
	$__memýy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

103 
__d0
, 
__d1
;

104 *
__tmp
 = 
__de¡
;

105 
__asm__
 
__vÞ©že__


118 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

119 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 2)

121  
__de¡
;

122 
	}
}

124 
__STRING_INLINE
 *
__memýy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
);

126 
__STRING_INLINE
 *

127 
	$__memýy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

129 
__d0
, 
__d1
, 
__d2
;

130 *
__tmp
 = 
__de¡
;

131 
__asm__
 
__vÞ©že__


142 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

143 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

144 : "0" (
__n
), "1" (
__tmp
), "2" (
__¤c
),

145 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
)

147  
__de¡
;

148 
	}
}

150 
	#_HAVE_STRING_ARCH_memmove
 1

	)

151 #iâdeà
_FORCE_INLINES


154 
	#memmove
(
de¡
, 
¤c
, 
n
è
	`__memmove_g
 (de¡, src,‚)

	)

156 
__STRING_INLINE
 *
	$__memmove_g
 (*, cÚ¡ *, 
size_t
)

157 
	`__asm__
 ("memmove");

159 
__STRING_INLINE
 *

160 
	$__memmove_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

162 
__d0
, 
__d1
, 
__d2
;

163 *
__tmp
 = 
__de¡
;

164 ià(
__de¡
 < 
__¤c
)

165 
__asm__
 
__vÞ©že__


168 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

169 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

170 : "0" (
__n
), "1" (
__¤c
), "2" (
__tmp
),

171 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

173 
__asm__
 
__vÞ©že__


177 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

178 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

179 : "0" (
__n
), "1" (__À- 1 + (cÚ¡ *è
__¤c
),

180 "2" (
__n
 - 1 + (*è
__tmp
),

181 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

182  
__de¡
;

183 
	}
}

187 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

188 #iâdeà
_FORCE_INLINES


189 #iâdeà
__PIC__


191 
__STRING_INLINE
 

192 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

194 
__d0
, 
__d1
, 
__d2
;

195 
__»s
;

196 
__asm__
 
__vÞ©že__


204 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

205 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

206 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

207 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

209  
__»s
;

210 
	}
}

215 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

216 
	#_USE_STRING_ARCH_mem£t
 1

	)

217 
	#mem£t
(
s
, 
c
, 
n
) \

218 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

219 ? ((
n
) == 1 \

220 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

221 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

222 : (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

223 ? (
	`__bužtš_cÚ¡ªt_p
 (
n
) \

224 ? 
	`__mem£t_cú
 ((
s
), (
c
), (
n
)) \

225 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

226 : (
	`__bužtš_cÚ¡ªt_p
 (
n
) \

227 ? 
	`__mem£t_gú
 ((
s
), (
c
), (
n
)) \

228 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

230 
	#__mem£t_c1
(
s
, 
c
è({ *
__s
 = (s); \

231 *((*è
__s
èð(è(
c
); \

232 
__s
; })

	)

234 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

235 ({ *
__s
 = (
s
); \

237 
__ui
; \

238 
__usi
; \

239 
__uc
; \

240 } *
__u
 = 
__s
; \

241 
__c
 = ((è((è(
c
))) * 0x01010101; \

247 ià((
n
) == 3 || (n) >= 5) \

248 
__asm__
 
	`__vÞ©že__
 ("" : "ô" (
__c
) : "0" (__c)); \

251 
n
) \

254 
__u
->
__ui
 = 
__c
; \

255 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

257 
__u
->
__ui
 = 
__c
; \

258 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

260 
__u
->
__ui
 = 
__c
; \

261 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

263 
__u
->
__usi
 = (è
__c
; \

264 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

265 
__u
->
__uc
 = (è
__c
; \

269 
__u
->
__ui
 = 
__c
; \

270 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

272 
__u
->
__ui
 = 
__c
; \

273 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

275 
__u
->
__ui
 = 
__c
; \

276 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

278 
__u
->
__usi
 = (è
__c
; \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

285 
__u
->
__ui
 = 
__c
; \

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

288 
__u
->
__ui
 = 
__c
; \

289 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

291 
__u
->
__uc
 = (è
__c
; \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

299 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

301 
__u
->
__ui
 = 
__c
; \

302 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

304 
__u
->
__ui
 = 
__c
; \

309 
__s
; })

	)

311 
	#__mem£t_cú
(
s
, 
c
, 
n
) \

312 (((
n
) % 4 == 0) \

313 ? 
	`__mem£t_cú_by4
 (
s
, ((è((è(
c
))) * 0x01010101,\

314 
n
) \

315 : (((
n
) % 2 == 0) \

316 ? 
	`__mem£t_cú_by2
 (
s
, \

317 ((è((è(
c
))) * 0x01010101,\

318 
n
) \

319 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

321 
__STRING_INLINE
 *
__mem£t_cú_by4
 (*
__s
, 
__c
,

322 
size_t
 
__n
);

324 
__STRING_INLINE
 *

325 
	$__mem£t_cú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

327 *
__tmp
 = 
__s
;

328 
__d0
;

329 #ifdeà
__i686__


330 
__asm__
 
__vÞ©že__


333 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

334 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

335 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

338 
__asm__
 
__vÞ©že__


344 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

345 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

346 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

349  
__s
;

350 
	}
}

352 
__STRING_INLINE
 *
__mem£t_cú_by2
 (*
__s
, 
__c
,

353 
size_t
 
__n
);

355 
__STRING_INLINE
 *

356 
	$__mem£t_cú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

358 
__d0
, 
__d1
;

359 *
__tmp
 = 
__s
;

360 #ifdeà
__i686__


361 
__asm__
 
__vÞ©že__


365 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

366 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

367 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

370 
__asm__
 
__vÞ©že__


376 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

377 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

378 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

381  
__s
;

382 
	}
}

384 
	#__mem£t_gú
(
s
, 
c
, 
n
) \

385 (((
n
) % 4 == 0) \

386 ? 
	`__mem£t_gú_by4
 (
s
, 
c
, 
n
) \

387 : (((
n
) % 2 == 0) \

388 ? 
	`__mem£t_gú_by2
 (
s
, 
c
, 
n
) \

389 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

391 
__STRING_INLINE
 *
__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

393 
__STRING_INLINE
 *

394 
	$__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

396 *
__tmp
 = 
__s
;

397 
__d0
;

398 
__asm__
 
__vÞ©že__


408 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

409 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

410 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

412  
__s
;

413 
	}
}

415 
__STRING_INLINE
 *
__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

417 
__STRING_INLINE
 *

418 
	$__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

420 
__d0
, 
__d1
;

421 *
__tmp
 = 
__s
;

422 
__asm__
 
__vÞ©že__


433 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

434 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

435 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

437  
__s
;

438 
	}
}

442 
	#_HAVE_STRING_ARCH_memchr
 1

	)

443 #iâdeà
_FORCE_INLINES


444 
__STRING_INLINE
 *

445 
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

447 
__d0
;

448 #ifdeà
__i686__


449 
__d1
;

451 *
__»s
;

452 ià(
__n
 == 0)

453  
NULL
;

454 #ifdeà
__i686__


455 
__asm__
 
__vÞ©že__


459 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

460 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

461 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

464 
__asm__
 
__vÞ©že__


470 : "=D" (
__»s
), "=&c" (
__d0
)

471 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

472 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

475  
__»s
 - 1;

476 
	}
}

479 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

480 #iâdeà
_FORCE_INLINES


481 
__STRING_INLINE
 *
__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
);

483 
__STRING_INLINE
 *

484 
	$__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

486 
__d0
;

487 #ifdeà
__i686__


488 
__d1
;

490 *
__»s
;

491 ià(
__n
 == 0)

492  
NULL
;

493 #ifdeà
__i686__


494 
__asm__
 
__vÞ©že__


500 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

501 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

502 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

505 
__asm__
 
__vÞ©že__


512 : "=D" (
__»s
), "=&c" (
__d0
)

513 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

514 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

517  
__»s
;

518 
	}
}

519 #ifdeà
__USE_GNU


520 
	#memrchr
(
s
, 
c
, 
n
è
	`__memrchr
 ((s), (c), (n))

	)

525 
	#_HAVE_STRING_ARCH_¿wmemchr
 1

	)

526 
__STRING_INLINE
 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

528 #iâdeà
_FORCE_INLINES


529 
__STRING_INLINE
 *

530 
	$__¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

532 
__d0
;

533 *
__»s
;

534 
__asm__
 
__vÞ©že__


537 : "=D" (
__»s
), "=&c" (
__d0
)

538 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

539 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

541  
__»s
 - 1;

542 
	}
}

543 #ifdeà
__USE_GNU


544 
__STRING_INLINE
 *

545 
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

547  
	`__¿wmemchr
 (
__s
, 
__c
);

548 
	}
}

554 
	#_HAVE_STRING_ARCH_¡¾’
 1

	)

555 
	#¡¾’
(
¡r
) \

556 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¡r
) \

557 ? 
	`__bužtš_¡¾’
 (
¡r
) \

558 : 
	`__¡¾’_g
 (
¡r
)))

	)

559 
__STRING_INLINE
 
size_t
 
__¡¾’_g
 (cÚ¡ *
__¡r
);

561 
__STRING_INLINE
 
size_t


562 
	$__¡¾’_g
 (cÚ¡ *
__¡r
)

564 
__dummy
;

565 cÚ¡ *
__tmp
 = 
__¡r
;

566 
__asm__
 
__vÞ©že__


572 : "ô" (
__tmp
), "=&q" (
__dummy
)

573 : "0" (
__¡r
),

574 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¡r
)

576  
__tmp
 - 
__¡r
 - 1;

577 
	}
}

581 
	#_HAVE_STRING_ARCH_¡rýy
 1

	)

582 
	#¡rýy
(
de¡
, 
¤c
) \

583 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

584 ? ( ((
¤c
)[0]è=ð1 && 
	`¡¾’
 (src) + 1 <= 8 \

585 ? 
	`__¡rýy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

586 : (*è
	`memýy
 ((*è(
de¡
), \

587 (cÚ¡ *è(
¤c
), \

588 
	`¡¾’
 (
¤c
) + 1)) \

589 : 
	`__¡rýy_g
 ((
de¡
), (
¤c
))))

	)

591 
	#__¡rýy_a_sm®l
(
de¡
, 
¤c
, 
¤þ’
) \

592 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

594 
__ui
; \

595 
__usi
; \

596 
__uc
; \

597 
__c
; \

598 } *
__u
 = (*è
__de¡
; \

599 
¤þ’
) \

602 
__u
->
__uc
 = '\0'; \

605 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

608 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

609 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

610 
__u
->
__uc
 = '\0'; \

613 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

616 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

617 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

618 
__u
->
__uc
 = '\0'; \

621 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

622 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

623 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

626 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

627 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

628 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

629 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

630 
__u
->
__uc
 = '\0'; \

633 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

634 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

635 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

638 (*è
__de¡
; }))

	)

640 
__STRING_INLINE
 *
__¡rýy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

642 
__STRING_INLINE
 *

643 
	$__¡rýy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

645 *
__tmp
 = 
__de¡
;

646 
__dummy
;

647 
__asm__
 
__vÞ©že__


656 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

657 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

658 : "0" (
__¤c
), "1" (
__tmp
),

659 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

661  
__de¡
;

662 
	}
}

665 #ifdeà
__USE_GNU


666 
	#_HAVE_STRING_ARCH_¡pýy
 1

	)

668 
	#__¡pýy
(
de¡
, 
¤c
) \

669 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

670 ? (
	`¡¾’
 (
¤c
) + 1 <= 8 \

671 ? 
	`__¡pýy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

672 : 
	`__¡pýy_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1)) \

673 : 
	`__¡pýy_g
 ((
de¡
), (
¤c
))))

	)

674 
	#__¡pýy_c
(
de¡
, 
¤c
, 
¤þ’
) \

675 ((
¤þ’
) % 4 == 0 \

676 ? 
	`__mempýy_by4
 (
de¡
, 
¤c
, 
¤þ’
) - 1 \

677 : ((
¤þ’
) % 2 == 0 \

678 ? 
	`__mempýy_by2
 (
de¡
, 
¤c
, 
¤þ’
) - 1 \

679 : 
	`__mempýy_byn
 (
de¡
, 
¤c
, 
¤þ’
è- 1))

	)

682 
	#¡pýy
(
de¡
, 
¤c
è
	`__¡pýy
 ((de¡), (¤c))

	)

684 
	#__¡pýy_a_sm®l
(
de¡
, 
¤c
, 
¤þ’
) \

685 (
	`__ex‹nsiÚ__
 ({ union { \

686 
__ui
; \

687 
__usi
; \

688 
__uc
; \

689 
__c
; \

690 } *
__u
 = (*è(
de¡
); \

691 
¤þ’
) \

694 
__u
->
__uc
 = '\0'; \

697 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

698 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

701 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

702 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

703 
__u
->
__uc
 = '\0'; \

706 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

707 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

710 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

711 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

712 
__u
->
__uc
 = '\0'; \

715 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

716 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

717 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

718 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

721 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

722 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

723 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

724 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

725 
__u
->
__uc
 = '\0'; \

728 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

729 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

730 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

731 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

734 (*è
__u
; }))

	)

736 
__STRING_INLINE
 *
__mempýy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

737 
size_t
 
__¤þ’
);

739 
__STRING_INLINE
 *

740 
	$__mempýy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤þ’
)

742 *
__tmp
 = 
__de¡
;

743 
__d0
, 
__d1
;

744 
__asm__
 
__vÞ©že__


752 : "=&r" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

753 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤þ’
 / 4)

755  
__tmp
;

756 
	}
}

758 
__STRING_INLINE
 *
__mempýy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

759 
size_t
 
__¤þ’
);

761 
__STRING_INLINE
 *

762 
	$__mempýy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤þ’
)

764 *
__tmp
 = 
__de¡
;

765 
__d0
, 
__d1
;

766 
__asm__
 
__vÞ©že__


779 : "=&q" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
),

780 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__de¡
)

781 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤þ’
 / 2),

782 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

784  
__tmp
 + 2;

785 
	}
}

787 
__STRING_INLINE
 *
__mempýy_byn
 (*
__de¡
, cÚ¡ *
__¤c
,

788 
size_t
 
__¤þ’
);

790 
__STRING_INLINE
 *

791 
	$__mempýy_byn
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤þ’
)

793 
__d0
, 
__d1
;

794 *
__tmp
 = 
__de¡
;

795 
__asm__
 
__vÞ©že__


806 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

807 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__de¡
)

808 : "0" (
__tmp
), "1" (
__¤þ’
), "2" (
__¤c
),

809 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

811  
__tmp
;

812 
	}
}

814 
__STRING_INLINE
 *
__¡pýy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

816 
__STRING_INLINE
 *

817 
	$__¡pýy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

819 *
__tmp
 = 
__de¡
;

820 
__dummy
;

821 
__asm__
 
__vÞ©že__


830 : "=&r" (
__¤c
), "ô" (
__tmp
), "=&q" (
__dummy
),

831 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

832 : "0" (
__¤c
), "1" (
__tmp
),

833 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

835  
__tmp
 - 1;

836 
	}
}

841 
	#_HAVE_STRING_ARCH_¡ºýy
 1

	)

842 
	#¡ºýy
(
de¡
, 
¤c
, 
n
) \

843 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

844 ? ((
	`¡¾’
 (
¤c
è+ 1 >ð((
size_t
è(
n
)) \

845 ? (*è
	`memýy
 ((*è(
de¡
), \

846 (cÚ¡ *è(
¤c
), 
n
) \

847 : 
	`__¡ºýy_cg
 ((
de¡
), (
¤c
), 
	`¡¾’
 (¤cè+ 1, 
n
))) \

848 : 
	`__¡ºýy_gg
 ((
de¡
), (
¤c
), 
n
)))

	)

849 
	#__¡ºýy_cg
(
de¡
, 
¤c
, 
¤þ’
, 
n
) \

850 (((
¤þ’
) % 4 == 0) \

851 ? 
	`__¡ºýy_by4
 (
de¡
, 
¤c
, 
¤þ’
, 
n
) \

852 : (((
¤þ’
) % 2 == 0) \

853 ? 
	`__¡ºýy_by2
 (
de¡
, 
¤c
, 
¤þ’
, 
n
) \

854 : 
	`__¡ºýy_byn
 (
de¡
, 
¤c
, 
¤þ’
, 
n
)))

	)

856 
__STRING_INLINE
 *
__¡ºýy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[],

857 
size_t
 
__¤þ’
, size_ˆ
__n
);

859 
__STRING_INLINE
 *

860 
	$__¡ºýy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤þ’
, size_ˆ
__n
)

862 *
__tmp
 = 
__de¡
;

863 
__dummy1
, 
__dummy2
;

864 
__asm__
 
__vÞ©že__


872 : "=&r" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

873 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__de¡
)

874 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤þ’
 / 4),

875 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

877 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤þ’
);

878  
__de¡
;

879 
	}
}

881 
__STRING_INLINE
 *
__¡ºýy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[],

882 
size_t
 
__¤þ’
, size_ˆ
__n
);

884 
__STRING_INLINE
 *

885 
	$__¡ºýy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤þ’
, size_ˆ
__n
)

887 *
__tmp
 = 
__de¡
;

888 
__dummy1
, 
__dummy2
;

889 
__asm__
 
__vÞ©že__


902 : "=&q" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

903 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__de¡
)

904 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤þ’
 / 2),

905 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

907 (è
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__¤þ’
);

908  
__de¡
;

909 
	}
}

911 
__STRING_INLINE
 *
__¡ºýy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[],

912 
size_t
 
__¤þ’
, size_ˆ
__n
);

914 
__STRING_INLINE
 *

915 
	$__¡ºýy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤þ’
, size_ˆ
__n
)

917 
__d0
, 
__d1
;

918 *
__tmp
 = 
__de¡
;

919 
__asm__
 
__vÞ©že__


930 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

931 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__de¡
)

932 : "1" (
__¤þ’
), "0" (
__tmp
),"2" (
__¤c
),

933 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

935 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤þ’
);

936  
__de¡
;

937 
	}
}

939 
__STRING_INLINE
 *
__¡ºýy_gg
 (*
__de¡
, cÚ¡ *
__¤c
,

940 
size_t
 
__n
);

942 
__STRING_INLINE
 *

943 
	$__¡ºýy_gg
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

945 *
__tmp
 = 
__de¡
;

946 
__dummy
;

947 ià(
__n
 > 0)

948 
__asm__
 
__vÞ©že__


964 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

965 : "0" (
__¤c
), "1" (
__tmp
), "3" (
__n
)

968  
__de¡
;

969 
	}
}

973 
	#_HAVE_STRING_ARCH_¡rÿt
 1

	)

974 
	#¡rÿt
(
de¡
, 
¤c
) \

975 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

976 ? 
	`__¡rÿt_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

977 : 
	`__¡rÿt_g
 ((
de¡
), (
¤c
))))

	)

979 
__STRING_INLINE
 *
__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[],

980 
size_t
 
__¤þ’
);

982 
__STRING_INLINE
 *

983 
	$__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤þ’
)

985 #ifdeà
__i686__


986 
__d0
;

987 *
__tmp
;

988 
__asm__
 
__vÞ©že__


990 : "=D" (
__tmp
), "=&c" (
__d0
),

991 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

992 : "0" (
__de¡
), "1" (0xffffffff), "a" (0),

993 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

995 --
__tmp
;

997 *
__tmp
 = 
__de¡
 - 1;

998 
__asm__
 
__vÞ©že__


1003 : "ô" (
__tmp
),

1004 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1005 : "0" (
__tmp
),

1006 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤þ’
]; } *)
__¤c
)

1009 (è
	`memýy
 (
__tmp
, 
__¤c
, 
__¤þ’
);

1010  
__de¡
;

1011 
	}
}

1013 
__STRING_INLINE
 *
__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
);

1015 
__STRING_INLINE
 *

1016 
	$__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
)

1018 *
__tmp
 = 
__de¡
 - 1;

1019 
__dummy
;

1020 
__asm__
 
__vÞ©že__


1032 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
),

1033 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1034 : "1" (
__tmp
), "2" (
__¤c
),

1035 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

1037  
__de¡
;

1038 
	}
}

1042 
	#_HAVE_STRING_ARCH_¡ºÿt
 1

	)

1043 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

1044 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

1045 
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

1046 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

1047 ? 
	`¡rÿt
 (
__de¡
, (
¤c
)) \

1048 : (*(*)
	`__mempýy
 (
	`¡rchr
 (
__de¡
, '\0'), \

1049 (cÚ¡ *è(
¤c
), \

1050 (
n
)èð0, 
__de¡
)) \

1051 : 
	`__¡ºÿt_g
 (
__de¡
, (
¤c
), (
n
)); }))

	)

1053 
__STRING_INLINE
 *
__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[],

1054 
size_t
 
__n
);

1056 
__STRING_INLINE
 *

1057 
	$__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__n
)

1059 *
__tmp
 = 
__de¡
;

1060 
__dummy
;

1061 #ifdeà
__i686__


1062 
__asm__
 
__vÞ©že__


1076 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__¤c
), "=&c" (
__n
)

1077 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__¤c
), "3" (0xffffffff)

1080 --
__tmp
;

1081 
__asm__
 
__vÞ©že__


1098 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__n
)

1099 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
)

1102  
__de¡
;

1103 
	}
}

1107 
	#_HAVE_STRING_ARCH_¡rcmp
 1

	)

1108 
	#¡rcmp
(
s1
, 
s2
) \

1109 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& __bužtš_cÚ¡ªt_°(
s2
) \

1110 && ( ((
s1
)[0]è!ð1 || 
	`¡¾’
 (s1) >= 4) \

1111 && ( ((
s2
)[0]è!ð1 || 
	`¡¾’
 (s2) >= 4) \

1112 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

1113 (
	`¡¾’
 (
s1
è< sŒËÀ(
s2
) \

1114 ? 
	`¡¾’
 (
s1
è: sŒËÀ(
s2
)) + 1) \

1115 : (
	`__bužtš_cÚ¡ªt_p
 (
s1
) &&  ((s1)[0]) == 1 \

1116 &&  ((
s2
)[0]è=ð1 && 
	`¡¾’
 (
s1
) < 4 \

1117 ? (
	`__bužtš_cÚ¡ªt_p
 (
s2
) &&  ((s2)[0]) == 1 \

1118 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1119 (cÚ¡ *è(
s2
), \

1120 
	`¡¾’
 (
s1
)) \

1121 : 
	`__¡rcmp_cg
 ((cÚ¡ *è(
s1
), \

1122 (cÚ¡ *è(
s2
), \

1123 
	`¡¾’
 (
s1
))) \

1124 : (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&&  ((
s1
)[0]) == 1 \

1125 &&  ((
s2
)[0]è=ð1 && 
	`¡¾’
 (s2) < 4 \

1126 ? (
	`__bužtš_cÚ¡ªt_p
 (
s1
) \

1127 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1128 (cÚ¡ *è(
s2
), \

1129 
	`¡¾’
 (
s2
)) \

1130 : 
	`__¡rcmp_gc
 ((cÚ¡ *è(
s1
), \

1131 (cÚ¡ *è(
s2
), \

1132 
	`¡¾’
 (
s2
))) \

1133 : 
	`__¡rcmp_gg
 ((
s1
), (
s2
))))))

	)

1135 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

1136 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = (
s1
)[0] - (
s2
)[0]; \

1137 ià(
l
 > 0 && 
__»suÉ
 == 0) \

1139 
__»suÉ
 = (
s1
)[1] - (
s2
)[1]; \

1140 ià(
l
 > 1 && 
__»suÉ
 == 0) \

1142 
__»suÉ
 = (
s1
)[2] - (
s2
)[2]; \

1143 ià(
l
 > 2 && 
__»suÉ
 == 0) \

1144 
__»suÉ
 = (
s1
)[3] - (
s2
)[3]; \

1147 
__»suÉ
; }))

	)

1149 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

1150 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = (
s2
); \

1151 
__»suÉ
 = (
s1
)[0] - 
__s2
[0]; \

1152 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

1154 
__»suÉ
 = (
s1
)[1] - 
__s2
[1]; \

1155 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

1157 
__»suÉ
 = (
s1
)[2] - 
__s2
[2]; \

1158 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

1159 
__»suÉ
 = (
s1
)[3] - 
__s2
[3]; \

1162 
__»suÉ
; }))

	)

1164 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

1165 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s1
 = (
s1
); \

1166 
__»suÉ
 = 
__s1
[0] - (
s2
)[0]; \

1167 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

1169 
__»suÉ
 = 
__s1
[1] - (
s2
)[1]; \

1170 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

1172 
__»suÉ
 = 
__s1
[2] - (
s2
)[2]; \

1173 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

1174 
__»suÉ
 = 
__s1
[3] - (
s2
)[3]; \

1177 
__»suÉ
; }))

	)

1179 
__STRING_INLINE
 
__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
);

1181 
__STRING_INLINE
 

1182 
	$__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

1184 
__»s
;

1185 
__asm__
 
__vÞ©že__


1201 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
)

1202 : "1" (
__s1
), "2" (
__s2
),

1203 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s1
),

1204 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s2
)

1206  
__»s
;

1207 
	}
}

1211 
	#_HAVE_STRING_ARCH_¡ºcmp
 1

	)

1212 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

1213 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& 
	`¡¾’
 (s1è< ((
size_t
è(
n
)) \

1214 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1215 : (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&& 
	`¡¾’
 (s2è< ((
size_t
è(
n
))\

1216 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1217 : 
	`__¡ºcmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1219 
__STRING_INLINE
 
__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

1220 
size_t
 
__n
);

1222 
__STRING_INLINE
 

1223 
	$__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

1225 
__»s
;

1226 
__asm__
 
__vÞ©že__


1245 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1246 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1247 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

1248 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

1250  
__»s
;

1251 
	}
}

1255 
	#_HAVE_STRING_ARCH_¡rchr
 1

	)

1256 
	#_USE_STRING_ARCH_¡rchr
 1

	)

1257 
	#¡rchr
(
s
, 
c
) \

1258 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

1259 ? ((
c
) == '\0' \

1260 ? (*è
	`__¿wmemchr
 ((
s
), (
c
)) \

1261 : 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1262 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1264 
__STRING_INLINE
 *
__¡rchr_c
 (cÚ¡ *
__s
, 
__c
);

1266 
__STRING_INLINE
 *

1267 
	$__¡rchr_c
 (cÚ¡ *
__s
, 
__c
)

1269 
__d0
;

1270 *
__»s
;

1271 
__asm__
 
__vÞ©že__


1281 : "ô" (
__»s
), "=&a" (
__d0
)

1282 : "0" (
__s
), "1" (
__c
),

1283 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1285  
__»s
;

1286 
	}
}

1288 
__STRING_INLINE
 *
__¡rchr_g
 (cÚ¡ *
__s
, 
__c
);

1290 
__STRING_INLINE
 *

1291 
	$__¡rchr_g
 (cÚ¡ *
__s
, 
__c
)

1293 
__d0
;

1294 *
__»s
;

1295 
__asm__
 
__vÞ©že__


1306 : "ô" (
__»s
), "=&a" (
__d0
)

1307 : "0" (
__s
), "1" (
__c
),

1308 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1310  
__»s
;

1311 
	}
}

1315 
	#_HAVE_STRING_ARCH_¡rchºul
 1

	)

1316 
	#__¡rchºul
(
s
, 
c
) \

1317 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

1318 ? ((
c
) == '\0' \

1319 ? (*è
	`__¿wmemchr
 ((
s
), 
c
) \

1320 : 
	`__¡rchºul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1321 : 
	`__¡rchºul_g
 ((
s
), 
c
)))

	)

1323 
__STRING_INLINE
 *
__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
);

1325 
__STRING_INLINE
 *

1326 
	$__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
)

1328 
__d0
;

1329 *
__»s
;

1330 
__asm__
 
__vÞ©že__


1340 : "ô" (
__»s
), "=&a" (
__d0
)

1341 : "0" (
__s
), "1" (
__c
),

1342 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1344  
__»s
;

1345 
	}
}

1347 
__STRING_INLINE
 *
__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
);

1349 
__STRING_INLINE
 *

1350 
	$__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
)

1352 
__d0
;

1353 *
__»s
;

1354 
__asm__
 
__vÞ©že__


1365 : "ô" (
__»s
), "=&a" (
__d0
)

1366 : "0" (
__s
), "1" (
__c
),

1367 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1369  
__»s
;

1370 
	}
}

1371 #ifdeà
__USE_GNU


1372 
	#¡rchºul
(
s
, 
c
è
	`__¡rchºul
 ((s), (c))

	)

1376 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1378 
	#_HAVE_STRING_ARCH_šdex
 1

	)

1379 
	#šdex
(
s
, 
c
) \

1380 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

1381 ? 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1382 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1387 
	#_HAVE_STRING_ARCH_¡¼chr
 1

	)

1388 
	#¡¼chr
(
s
, 
c
) \

1389 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

1390 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1391 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1393 #ifdeà
__i686__


1394 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1396 
__STRING_INLINE
 *

1397 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1399 
__d0
, 
__d1
;

1400 *
__»s
;

1401 
__asm__
 
__vÞ©že__


1409 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1410 : "0" (1), "1" (
__s
), "2" (
__c
),

1411 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1413  
__»s
 - 1;

1414 
	}
}

1416 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1418 
__STRING_INLINE
 *

1419 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1421 
__d0
, 
__d1
;

1422 *
__»s
;

1423 
__asm__
 
__vÞ©že__


1432 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1433 : "0" (1), "1" (
__s
), "2" (
__c
),

1434 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1436  
__»s
 - 1;

1437 
	}
}

1439 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1441 
__STRING_INLINE
 *

1442 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1444 
__d0
, 
__d1
;

1445 *
__»s
;

1446 
__asm__
 
__vÞ©že__


1456 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1457 : "0" (0), "1" (
__s
), "2" (
__c
),

1458 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1460  
__»s
;

1461 
	}
}

1463 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1465 
__STRING_INLINE
 *

1466 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1468 
__d0
, 
__d1
;

1469 *
__»s
;

1470 
__asm__
 
__vÞ©že__


1481 : "ô" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1482 : "0" (0), "1" (
__s
), "2" (
__c
),

1483 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1485  
__»s
;

1486 
	}
}

1490 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1492 
	#_HAVE_STRING_ARCH_ršdex
 1

	)

1493 
	#ršdex
(
s
, 
c
) \

1494 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) \

1495 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1496 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1502 
	#_HAVE_STRING_ARCH_¡rc¥n
 1

	)

1503 
	#¡rc¥n
(
s
, 
»jeù
) \

1504 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
»jeù
) &&  ((reject)[0]) == 1 \

1505 ? ((
»jeù
)[0] == '\0' \

1506 ? 
	`¡¾’
 (
s
) \

1507 : ((
»jeù
)[1] == '\0' \

1508 ? 
	`__¡rc¥n_c1
 ((
s
), (((
»jeù
)[0] << 8) & 0xff00)) \

1509 : 
	`__¡rc¥n_cg
 ((
s
), (
»jeù
), 
	`¡¾’
 (reject)))) \

1510 : 
	`__¡rc¥n_g
 ((
s
), (
»jeù
))))

	)

1512 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

1514 #iâdeà
_FORCE_INLINES


1515 
__STRING_INLINE
 
size_t


1516 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

1518 
__d0
;

1519 *
__»s
;

1520 
__asm__
 
__vÞ©že__


1529 : "ô" (
__»s
), "=&a" (
__d0
)

1530 : "0" (
__s
), "1" (
__»jeù
),

1531 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1533  (
__»s
 - 1è- 
__s
;

1534 
	}
}

1537 
__STRING_INLINE
 
size_t
 
__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[],

1538 
size_t
 
__»jeù_Ën
);

1540 
__STRING_INLINE
 
size_t


1541 
	$__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[], 
size_t
 
__»jeù_Ën
)

1543 
__d0
, 
__d1
, 
__d2
;

1544 cÚ¡ *
__»s
;

1545 
__asm__
 
__vÞ©že__


1556 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1557 : "0" (
__s
), "d" (
__»jeù
), "g" (
__»jeù_Ën
)

1559  (
__»s
 - 1è- 
__s
;

1560 
	}
}

1562 
__STRING_INLINE
 
size_t
 
__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
);

1563 #ifdeà
__PIC__


1565 
__STRING_INLINE
 
size_t


1566 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1568 
__d0
, 
__d1
, 
__d2
;

1569 cÚ¡ *
__»s
;

1570 
__asm__
 
__vÞ©že__


1587 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1588 : "r" (
__»jeù
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1590  (
__»s
 - 1è- 
__s
;

1591 
	}
}

1593 
__STRING_INLINE
 
size_t


1594 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1596 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1597 cÚ¡ *
__»s
;

1598 
__asm__
 
__vÞ©že__


1612 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1613 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__»jeù
), "b" (__reject)

1616  (
__»s
 - 1è- 
__s
;

1617 
	}
}

1623 
	#_HAVE_STRING_ARCH_¡r¥n
 1

	)

1624 
	#¡r¥n
(
s
, 
acû±
) \

1625 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1626 ? ((
acû±
)[0] == '\0' \

1627 ? ((è(
s
), 0) \

1628 : ((
acû±
)[1] == '\0' \

1629 ? 
	`__¡r¥n_c1
 ((
s
), (((
acû±
)[0] << 8 ) & 0xff00)) \

1630 : 
	`__¡r¥n_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1631 : 
	`__¡r¥n_g
 ((
s
), (
acû±
))))

	)

1633 #iâdeà
_FORCE_INLINES


1634 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1636 
__STRING_INLINE
 
size_t


1637 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1639 
__d0
;

1640 *
__»s
;

1642 
__asm__
 
__vÞ©že__


1648 : "ô" (
__»s
), "=&q" (
__d0
)

1649 : "0" (
__s
), "1" (
__acû±
),

1650 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1652  (
__»s
 - 1è- 
__s
;

1653 
	}
}

1656 
__STRING_INLINE
 
size_t
 
__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1657 
size_t
 
__acû±_Ën
);

1659 
__STRING_INLINE
 
size_t


1660 
	$__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1662 
__d0
, 
__d1
, 
__d2
;

1663 cÚ¡ *
__»s
;

1664 
__asm__
 
__vÞ©že__


1675 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1676 : "0" (
__s
), "g" (
__acû±
), "g" (
__acû±_Ën
),

1679 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
),

1680 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__acû±_Ën
]; } *)
__acû±
)

1682  (
__»s
 - 1è- 
__s
;

1683 
	}
}

1685 
__STRING_INLINE
 
size_t
 
__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1686 #ifdeà
__PIC__


1688 
__STRING_INLINE
 
size_t


1689 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1691 
__d0
, 
__d1
, 
__d2
;

1692 cÚ¡ *
__»s
;

1693 
__asm__
 
__vÞ©že__


1709 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1710 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1712  (
__»s
 - 1è- 
__s
;

1713 
	}
}

1715 
__STRING_INLINE
 
size_t


1716 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1718 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1719 cÚ¡ *
__»s
;

1720 
__asm__
 
__vÞ©že__


1734 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1735 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__acû±
), "b" (__accept)

1737  (
__»s
 - 1è- 
__s
;

1738 
	}
}

1743 
	#_HAVE_STRING_ARCH_¡½brk
 1

	)

1744 
	#¡½brk
(
s
, 
acû±
) \

1745 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1746 ? ((
acû±
)[0] == '\0' \

1747 ? ((è(
s
), (*) 0) \

1748 : ((
acû±
)[1] == '\0' \

1749 ? 
	`¡rchr
 ((
s
), (
acû±
)[0]) \

1750 : 
	`__¡½brk_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1751 : 
	`__¡½brk_g
 ((
s
), (
acû±
))))

	)

1753 
__STRING_INLINE
 *
__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1754 
size_t
 
__acû±_Ën
);

1756 
__STRING_INLINE
 *

1757 
	$__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1759 
__d0
, 
__d1
, 
__d2
;

1760 *
__»s
;

1761 
__asm__
 
__vÞ©že__


1776 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1777 : "0" (
__s
), "d" (
__acû±
), "g" (
__acû±_Ën
)

1779  
__»s
;

1780 
	}
}

1782 
__STRING_INLINE
 *
__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1783 #ifdeà
__PIC__


1785 
__STRING_INLINE
 *

1786 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1788 
__d0
, 
__d1
, 
__d2
;

1789 *
__»s
;

1790 
__asm__
 
__vÞ©že__


1811 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1812 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1814  
__»s
;

1815 
	}
}

1817 
__STRING_INLINE
 *

1818 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1820 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1821 *
__»s
;

1822 
__asm__
 
__vÞ©že__


1841 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1842 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__acû±
)

1844  
__»s
;

1845 
	}
}

1850 
	#_HAVE_STRING_ARCH_¡r¡r
 1

	)

1851 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1852 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
ÃedË
) &&  ((needle)[0]) == 1 \

1853 ? ((
ÃedË
)[0] == '\0' \

1854 ? (
hay¡ack
) \

1855 : ((
ÃedË
)[1] == '\0' \

1856 ? 
	`¡rchr
 ((
hay¡ack
), (
ÃedË
)[0]) \

1857 : 
	`__¡r¡r_cg
 ((
hay¡ack
), (
ÃedË
), \

1858 
	`¡¾’
 (
ÃedË
)))) \

1859 : 
	`__¡r¡r_g
 ((
hay¡ack
), (
ÃedË
))))

	)

1863 
__STRING_INLINE
 *
__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
,

1864 cÚ¡ 
__ÃedË
[],

1865 
size_t
 
__ÃedË_Ën
);

1867 
__STRING_INLINE
 *

1868 
	$__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
, cÚ¡ 
__ÃedË
[],

1869 
size_t
 
__ÃedË_Ën
)

1871 
__d0
, 
__d1
, 
__d2
;

1872 *
__»s
;

1873 
__asm__
 
__vÞ©že__


1886 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1887 : "g" (
__ÃedË_Ën
), "1" (
__hay¡ack
), "d" (
__ÃedË
)

1889  
__»s
;

1890 
	}
}

1892 
__STRING_INLINE
 *
__¡r¡r_g
 (cÚ¡ *
__hay¡ack
,

1893 cÚ¡ *
__ÃedË
);

1894 #ifdeà
__PIC__


1896 
__STRING_INLINE
 *

1897 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1899 
__d0
, 
__d1
, 
__d2
;

1900 *
__»s
;

1901 
__asm__
 
__vÞ©že__


1920 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1921 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1922 "d" (
__ÃedË
)

1924  
__»s
;

1925 
	}
}

1927 
__STRING_INLINE
 *

1928 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1930 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1931 *
__»s
;

1932 
__asm__
 
__vÞ©že__


1949 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1950 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1951 "b" (
__ÃedË
)

1953  
__»s
;

1954 
	}
}

1960 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1961 #ifdeà
__i686__


1962 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1963 
	#ffs
(
wÜd
è(
	`__bužtš_cÚ¡ªt_p
 (word) \

1964 ? 
	`__bužtš_ffs
 (
wÜd
) \

1965 : ({ 
__út
, 
__tmp
; \

1966 
__asm__
 
__vÞ©že__
 \

1969 : "=&r" (
__út
), "ô" (
__tmp
) \

1970 : "rm" (
wÜd
), "1" (-1)); \

1971 
__út
 + 1; }))

	)

1973 #iâdeà
ff¦


1974 
	#ff¦
(
wÜd
è
	`ffs
(wÜd)

	)

1979 #iâdeà
_FORCE_INLINES


1980 #undeà
__STRING_INLINE


	@/usr/include/bits/string2.h

20 #iâdeà
_STRING_H


24 #iâdeà
__NO_STRING_INLINES


41 #iâdeà
__STRING_INLINE


42 #ifdeà
__ýlu¥lus


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

49 #ià
_STRING_ARCH_uÇligÃd


51 
	~<’dŸn.h
>

52 
	~<b™s/ty³s.h
>

54 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


55 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

56 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1] << 8 \

57 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

58 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

59 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

60 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

61 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

62 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

64 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

65 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

66 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1])

	)

67 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

68 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

69 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

70 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

71 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3])

	)

76 
	#__STRING2_COPY_TYPE
(
N
) \

77 ¡ruù { 
__¬r
[
N
]; } \

78 
	t__©Œibu‹__
 ((
	t__·cked__
)è
	t__STRING2_COPY_ARR
##
	tN


	)

79 
	t__STRING2_COPY_TYPE
 (2);

80 
__STRING2_COPY_TYPE
 (3);

81 
__STRING2_COPY_TYPE
 (4);

82 
__STRING2_COPY_TYPE
 (5);

83 
__STRING2_COPY_TYPE
 (6);

84 
__STRING2_COPY_TYPE
 (7);

85 
__STRING2_COPY_TYPE
 (8);

86 #undeà
__STRING2_COPY_TYPE


92 
	#__¡ršg2_1b±r_p
(
__x
) \

93 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ð1)

	)

96 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


97 #ià!
__GNUC_PREREQ
 (3, 0)

98 #ià
_STRING_ARCH_uÇligÃd


99 
	#mem£t
(
s
, 
c
, 
n
) \

100 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

101 ? ((
n
) == 1 \

102 ? 
	`__mem£t_1
 (
s
, 
c
) \

103 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

104 : (
	`__bužtš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

105 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

106 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

108 
	#__mem£t_1
(
s
, 
c
è({ *
__s
 = (s); \

109 *((
__ušt8_t
 *è
__s
èð(__ušt8_tè
c
; __s; })

	)

111 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

112 ({ *
__s
 = (
s
); \

114 
__ui
; \

115 
__usi
; \

116 
__uc
; \

117 } *
__u
 = 
__s
; \

118 
__ušt8_t
 
__c
 = (__ušt8_tè(
c
); \

121 (è(
n
)) \

124 
__u
->
__ui
 = 
__c
 * 0x01010101; \

125 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

127 
__u
->
__ui
 = 
__c
 * 0x01010101; \

128 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

130 
__u
->
__ui
 = 
__c
 * 0x01010101; \

131 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

133 
__u
->
__usi
 = (è
__c
 * 0x0101; \

134 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

135 
__u
->
__uc
 = (è
__c
; \

139 
__u
->
__ui
 = 
__c
 * 0x01010101; \

140 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

142 
__u
->
__ui
 = 
__c
 * 0x01010101; \

143 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

145 
__u
->
__ui
 = 
__c
 * 0x01010101; \

146 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

148 
__u
->
__usi
 = (è
__c
 * 0x0101; \

152 
__u
->
__ui
 = 
__c
 * 0x01010101; \

153 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

155 
__u
->
__ui
 = 
__c
 * 0x01010101; \

156 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

158 
__u
->
__ui
 = 
__c
 * 0x01010101; \

159 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

161 
__u
->
__uc
 = (è
__c
; \

165 
__u
->
__ui
 = 
__c
 * 0x01010101; \

166 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

168 
__u
->
__ui
 = 
__c
 * 0x01010101; \

169 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

171 
__u
->
__ui
 = 
__c
 * 0x01010101; \

172 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

174 
__u
->
__ui
 = 
__c
 * 0x01010101; \

179 
__s
; })

	)

181 
	#mem£t
(
s
, 
c
, 
n
) \

182 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

183 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

184 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

193 #ià
__GNUC_PREREQ
 (2, 91)

194 
	#__bz”o
(
s
, 
n
è
	`__bužtš_mem£t
 (s, '\0',‚)

	)

202 #ifdeà
__USE_GNU


203 #ià!
defšed
 
_HAVE_STRING_ARCH_mempýy
 || defšed 
_FORCE_INLINES


204 #iâdeà
_HAVE_STRING_ARCH_mempýy


205 #ià
__GNUC_PREREQ
 (3, 4)

206 
	#__mempýy
(
de¡
, 
¤c
, 
n
è
	`__bužtš_mempýy
 (de¡, src,‚)

	)

207 #–ià
__GNUC_PREREQ
 (3, 0)

208 
	#__mempýy
(
de¡
, 
¤c
, 
n
) \

209 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

210 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

211 ? 
	`__bužtš_memýy
 (
de¡
, 
¤c
, 
n
) + (n) \

212 : 
	`__mempýy
 (
de¡
, 
¤c
, 
n
)))

	)

214 
	#__mempýy
(
de¡
, 
¤c
, 
n
) \

215 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

216 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

217 ? 
	`__mempýy_sm®l
 (
de¡
, 
	`__mempýy_¬gs
 (
¤c
), 
n
) \

218 : 
	`__mempýy
 (
de¡
, 
¤c
, 
n
)))

	)

222 
	#mempýy
(
de¡
, 
¤c
, 
n
è
	`__mempýy
 (de¡, src,‚)

	)

225 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


226 #ià
_STRING_ARCH_uÇligÃd


227 #iâdeà
_FORCE_INLINES


228 
	#__mempýy_¬gs
(
¤c
) \

229 ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[2], \

230 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[6], \

231 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

232 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

233 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

234 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

236 
__STRING_INLINE
 *
__mempýy_sm®l
 (*, , , , ,

237 
__ušt16_t
, __ušt16_t, 
__ušt32_t
,

238 
__ušt32_t
, 
size_t
);

239 
__STRING_INLINE
 *

240 
	$__mempýy_sm®l
 (*
__de¡1
,

241 
__¤c0_1
, 
__¤c2_1
, 
__¤c4_1
, 
__¤c6_1
,

242 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

243 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

244 
size_t
 
__¤þ’
)

247 
__ušt32_t
 
__ui
;

248 
__ušt16_t
 
__usi
;

249 
__uc
;

250 
__c
;

251 } *
__u
 = 
__de¡1
;

252 (è
__¤þ’
)

255 
__u
->
__c
 = 
__¤c0_1
;

256 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

259 
__u
->
__usi
 = 
__¤c0_2
;

260 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

263 
__u
->
__usi
 = 
__¤c0_2
;

264 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

265 
__u
->
__c
 = 
__¤c2_1
;

266 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

269 
__u
->
__ui
 = 
__¤c0_4
;

270 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

273 
__u
->
__ui
 = 
__¤c0_4
;

274 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

275 
__u
->
__c
 = 
__¤c4_1
;

276 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

279 
__u
->
__ui
 = 
__¤c0_4
;

280 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

281 
__u
->
__usi
 = 
__¤c4_2
;

282 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

285 
__u
->
__ui
 = 
__¤c0_4
;

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

287 
__u
->
__usi
 = 
__¤c4_2
;

288 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

289 
__u
->
__c
 = 
__¤c6_1
;

290 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

293 
__u
->
__ui
 = 
__¤c0_4
;

294 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

295 
__u
->
__ui
 = 
__¤c4_4
;

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

299  (*è
__u
;

300 
	}
}

302 #iâdeà
_FORCE_INLINES


303 
	#__mempýy_¬gs
(
¤c
) \

304 ((cÚ¡ *è(
¤c
))[0], \

305 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

306 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1] } }), \

307 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

308 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

309 ((cÚ¡ *è(
¤c
))[2] } }), \

310 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

311 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

312 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3] } }), \

313 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

314 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

315 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

316 ((cÚ¡ *è(
¤c
))[4] } }), \

317 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

318 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

319 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

320 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5] } }), \

321 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

322 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

323 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

324 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

325 ((cÚ¡ *è(
¤c
))[6] } }), \

326 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

327 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

328 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

329 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

330 ((cÚ¡ *è(
¤c
))[6], ((cÚ¡ *è(¤c))[7] } })

	)

332 
__STRING_INLINE
 *
__mempýy_sm®l
 (*, , 
__STRING2_COPY_ARR2
,

333 
__STRING2_COPY_ARR3
,

334 
__STRING2_COPY_ARR4
,

335 
__STRING2_COPY_ARR5
,

336 
__STRING2_COPY_ARR6
,

337 
__STRING2_COPY_ARR7
,

338 
__STRING2_COPY_ARR8
, 
size_t
);

339 
__STRING_INLINE
 *

340 
	$__mempýy_sm®l
 (*
__de¡
, 
__¤c1
,

341 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

342 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

343 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

344 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤þ’
)

347 
__c
;

348 
__STRING2_COPY_ARR2
 
__sÿ2
;

349 
__STRING2_COPY_ARR3
 
__sÿ3
;

350 
__STRING2_COPY_ARR4
 
__sÿ4
;

351 
__STRING2_COPY_ARR5
 
__sÿ5
;

352 
__STRING2_COPY_ARR6
 
__sÿ6
;

353 
__STRING2_COPY_ARR7
 
__sÿ7
;

354 
__STRING2_COPY_ARR8
 
__sÿ8
;

355 } *
__u
 = 
__de¡
;

356 (è
__¤þ’
)

359 
__u
->
__c
 = 
__¤c1
;

362 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

365 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

368 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

371 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

374 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

377 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

380 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

383  
	`__ex‹nsiÚ__
 ((*è
__u
 + 
__¤þ’
);

384 
	}
}

392 #iâdeà
_HAVE_STRING_ARCH_¡rchr


393 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

394 #ià
__GNUC_PREREQ
 (3, 2)

395 
	#¡rchr
(
s
, 
c
) \

396 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
è&& !__bužtš_cÚ¡ªt_°(
s
) \

397 && (
c
) == '\0' \

398 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

399 : 
	`__bužtš_¡rchr
 (
s
, 
c
)))

	)

401 
	#¡rchr
(
s
, 
c
) \

402 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

403 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

404 : 
	`¡rchr
 (
s
, 
c
)))

	)

410 #ià(!
defšed
 
_HAVE_STRING_ARCH_¡rýy
 && !
__GNUC_PREREQ
 (3, 0)) \

411 || 
defšed
 
	g_FORCE_INLINES


412 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rýy
 && !
__GNUC_PREREQ
 (3, 0)

413 
	#¡rýy
(
de¡
, 
¤c
) \

414 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

415 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

416 ? 
	`__¡rýy_sm®l
 (
de¡
, 
	`__¡rýy_¬gs
 (
¤c
), \

417 
	`¡¾’
 (
¤c
) + 1) \

418 : (*è
	`memýy
 (
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1)) \

419 : 
	`¡rýy
 (
de¡
, 
¤c
)))

	)

422 #ià
_STRING_ARCH_uÇligÃd


423 #iâdeà
_FORCE_INLINES


424 
	#__¡rýy_¬gs
(
¤c
) \

425 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

426 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

427 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

428 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

430 
__STRING_INLINE
 *
__¡rýy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

431 
__ušt32_t
, __ušt32_t, 
size_t
);

432 
__STRING_INLINE
 *

433 
	$__¡rýy_sm®l
 (*
__de¡
,

434 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

435 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

436 
size_t
 
__¤þ’
)

439 
__ušt32_t
 
__ui
;

440 
__ušt16_t
 
__usi
;

441 
__uc
;

442 } *
__u
 = (*è
__de¡
;

443 (è
__¤þ’
)

446 
__u
->
__uc
 = '\0';

449 
__u
->
__usi
 = 
__¤c0_2
;

452 
__u
->
__usi
 = 
__¤c0_2
;

453 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

454 
__u
->
__uc
 = '\0';

457 
__u
->
__ui
 = 
__¤c0_4
;

460 
__u
->
__ui
 = 
__¤c0_4
;

461 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

462 
__u
->
__uc
 = '\0';

465 
__u
->
__ui
 = 
__¤c0_4
;

466 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

467 
__u
->
__usi
 = 
__¤c4_2
;

470 
__u
->
__ui
 = 
__¤c0_4
;

471 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

472 
__u
->
__usi
 = 
__¤c4_2
;

473 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

474 
__u
->
__uc
 = '\0';

477 
__u
->
__ui
 = 
__¤c0_4
;

478 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

479 
__u
->
__ui
 = 
__¤c4_4
;

482  
__de¡
;

483 
	}
}

485 #iâdeà
_FORCE_INLINES


486 
	#__¡rýy_¬gs
(
¤c
) \

487 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

488 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

489 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

490 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

492 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

493 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

494 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

495 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

496 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

497 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

499 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

500 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

501 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

502 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

503 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

504 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

505 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

506 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

508 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

509 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

510 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

511 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

512 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

514 
__STRING_INLINE
 *
__¡rýy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

515 
__STRING2_COPY_ARR3
,

516 
__STRING2_COPY_ARR4
,

517 
__STRING2_COPY_ARR5
,

518 
__STRING2_COPY_ARR6
,

519 
__STRING2_COPY_ARR7
,

520 
__STRING2_COPY_ARR8
, 
size_t
);

521 
__STRING_INLINE
 *

522 
	$__¡rýy_sm®l
 (*
__de¡
,

523 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

524 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

525 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

526 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤þ’
)

529 
__c
;

530 
__STRING2_COPY_ARR2
 
__sÿ2
;

531 
__STRING2_COPY_ARR3
 
__sÿ3
;

532 
__STRING2_COPY_ARR4
 
__sÿ4
;

533 
__STRING2_COPY_ARR5
 
__sÿ5
;

534 
__STRING2_COPY_ARR6
 
__sÿ6
;

535 
__STRING2_COPY_ARR7
 
__sÿ7
;

536 
__STRING2_COPY_ARR8
 
__sÿ8
;

537 } *
__u
 = (*è
__de¡
;

538 (è
__¤þ’
)

541 
__u
->
__c
 = '\0';

544 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

547 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

550 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

553 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

556 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

559 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

562 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

565  
__de¡
;

566 
	}
}

572 #ifdeà
__USE_GNU


573 #ià!
defšed
 
_HAVE_STRING_ARCH_¡pýy
 || defšed 
_FORCE_INLINES


574 #iâdeà
_HAVE_STRING_ARCH_¡pýy


575 #ià
__GNUC_PREREQ
 (3, 4)

576 
	#__¡pýy
(
de¡
, 
¤c
è
	`__bužtš_¡pýy
 (de¡, src)

	)

577 #–ià
__GNUC_PREREQ
 (3, 0)

578 
	#__¡pýy
(
de¡
, 
¤c
) \

579 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

580 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

581 ? 
	`__bužtš_¡rýy
 (
de¡
, 
¤c
è+ 
	`¡¾’
 (src) \

582 : ((*è(
__mempýy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

584 : 
	`__¡pýy
 (
de¡
, 
¤c
)))

	)

586 
	#__¡pýy
(
de¡
, 
¤c
) \

587 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
) \

588 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

589 ? 
	`__¡pýy_sm®l
 (
de¡
, 
	`__¡pýy_¬gs
 (
¤c
), \

590 
	`¡¾’
 (
¤c
) + 1) \

591 : ((*è(
__mempýy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

593 : 
	`__¡pýy
 (
de¡
, 
¤c
)))

	)

597 
	#¡pýy
(
de¡
, 
¤c
è
	`__¡pýy
 (de¡, src)

	)

600 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


601 #ià
_STRING_ARCH_uÇligÃd


602 #iâdeà
_FORCE_INLINES


603 
	#__¡pýy_¬gs
(
¤c
) \

604 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

605 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

606 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

607 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

609 
__STRING_INLINE
 *
__¡pýy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

610 
__ušt32_t
, __ušt32_t, 
size_t
);

611 
__STRING_INLINE
 *

612 
	$__¡pýy_sm®l
 (*
__de¡
,

613 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

614 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

615 
size_t
 
__¤þ’
)

618 
__ui
;

619 
__usi
;

620 
__uc
;

621 
__c
;

622 } *
__u
 = (*è
__de¡
;

623 (è
__¤þ’
)

626 
__u
->
__uc
 = '\0';

629 
__u
->
__usi
 = 
__¤c0_2
;

630 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

633 
__u
->
__usi
 = 
__¤c0_2
;

634 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

635 
__u
->
__uc
 = '\0';

638 
__u
->
__ui
 = 
__¤c0_4
;

639 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

642 
__u
->
__ui
 = 
__¤c0_4
;

643 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

644 
__u
->
__uc
 = '\0';

647 
__u
->
__ui
 = 
__¤c0_4
;

648 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

649 
__u
->
__usi
 = 
__¤c4_2
;

650 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

653 
__u
->
__ui
 = 
__¤c0_4
;

654 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

655 
__u
->
__usi
 = 
__¤c4_2
;

656 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

657 
__u
->
__uc
 = '\0';

660 
__u
->
__ui
 = 
__¤c0_4
;

661 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

662 
__u
->
__ui
 = 
__¤c4_4
;

663 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

666  &
__u
->
__c
;

667 
	}
}

669 #iâdeà
_FORCE_INLINES


670 
	#__¡pýy_¬gs
(
¤c
) \

671 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

672 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

673 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

674 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

676 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

677 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

678 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

679 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

680 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

681 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

683 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

684 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

685 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

686 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

687 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

688 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

689 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

690 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

692 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

693 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

694 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

695 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

696 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

698 
__STRING_INLINE
 *
__¡pýy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

699 
__STRING2_COPY_ARR3
,

700 
__STRING2_COPY_ARR4
,

701 
__STRING2_COPY_ARR5
,

702 
__STRING2_COPY_ARR6
,

703 
__STRING2_COPY_ARR7
,

704 
__STRING2_COPY_ARR8
, 
size_t
);

705 
__STRING_INLINE
 *

706 
	$__¡pýy_sm®l
 (*
__de¡
,

707 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

708 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

709 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

710 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤þ’
)

713 
__c
;

714 
__STRING2_COPY_ARR2
 
__sÿ2
;

715 
__STRING2_COPY_ARR3
 
__sÿ3
;

716 
__STRING2_COPY_ARR4
 
__sÿ4
;

717 
__STRING2_COPY_ARR5
 
__sÿ5
;

718 
__STRING2_COPY_ARR6
 
__sÿ6
;

719 
__STRING2_COPY_ARR7
 
__sÿ7
;

720 
__STRING2_COPY_ARR8
 
__sÿ8
;

721 } *
__u
 = (*è
__de¡
;

722 (è
__¤þ’
)

725 
__u
->
__c
 = '\0';

728 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

731 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

734 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

737 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

740 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

743 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

746 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

749  
__de¡
 + 
__¤þ’
 - 1;

750 
	}
}

758 #iâdeà
_HAVE_STRING_ARCH_¡ºýy


759 #ià
__GNUC_PREREQ
 (3, 2)

760 
	#¡ºýy
(
de¡
, 
¤c
, 
n
è
	`__bužtš_¡ºýy
 (de¡, src,‚)

	)

762 
	#¡ºýy
(
de¡
, 
¤c
, 
n
) \

763 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

764 ? (
	`¡¾’
 (
¤c
è+ 1 >ð((
size_t
è(
n
)) \

765 ? (*è
	`memýy
 (
de¡
, 
¤c
, 
n
) \

766 : 
	`¡ºýy
 (
de¡
, 
¤c
, 
n
)) \

767 : 
	`¡ºýy
 (
de¡
, 
¤c
, 
n
)))

	)

773 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


774 #ifdeà
_USE_STRING_ARCH_¡rchr


775 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

776 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

777 
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

778 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

779 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

780 : (*((*è
	`__mempýy
 (
	`¡rchr
 (
__de¡
, '\0'), \

781 
¤c
, 
n
)èð'\0', 
__de¡
)) \

782 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

783 #–ià
__GNUC_PREREQ
 (3, 2)

784 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__bužtš_¡ºÿt
 (de¡, src,‚)

	)

786 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

787 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
¤c
è&& __bužtš_cÚ¡ªt_°(
n
) \

788 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

789 ? 
	`¡rÿt
 (
de¡
, 
¤c
) \

790 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)) \

791 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)))

	)

797 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


798 #ià
__GNUC_PREREQ
 (3, 2)

799 
	#¡rcmp
(
s1
, 
s2
) \

800 
__ex‹nsiÚ__
 \

801 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

802 (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& __bužtš_cÚ¡ªt_°(
s2
) \

803 && (
__s1_Ën
 = 
	`__bužtš_¡¾’
 (
s1
), 
__s2_Ën
 = __bužtš_¡¾’ (
s2
), \

804 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

805 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

806 ? 
	`__bužtš_¡rcmp
 (
s1
, 
s2
) \

807 : (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

808 && (
__s1_Ën
 = 
	`__bužtš_¡¾’
 (
s1
), __s1_len < 4) \

809 ? (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

810 ? 
	`__bužtš_¡rcmp
 (
s1
, 
s2
) \

811 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

812 : (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

813 && (
__s2_Ën
 = 
	`__bužtš_¡¾’
 (
s2
), __s2_len < 4) \

814 ? (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

815 ? 
	`__bužtš_¡rcmp
 (
s1
, 
s2
) \

816 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

817 : 
	`__bužtš_¡rcmp
 (
s1
, 
s2
)))); })

	)

819 
	#¡rcmp
(
s1
, 
s2
) \

820 
__ex‹nsiÚ__
 \

821 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

822 (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& __bužtš_cÚ¡ªt_°(
s2
) \

823 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

824 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

825 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

826 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

827 (
__s1_Ën
 < 
__s2_Ën
 ? __s1_len : __s2_len) + 1) \

828 : (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

829 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

830 ? (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

831 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s1_Ën
) \

832 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

833 : (
	`__bužtš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

834 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

835 ? (
	`__bužtš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

836 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s2_Ën
) \

837 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

838 : 
	`¡rcmp
 (
s1
, 
s2
)))); })

	)

841 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

842 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = \

843 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

844 - ((cÚ¡ *è(cÚ¡ *)(
s2
))[0]); \

845 ià(
l
 > 0 && 
__»suÉ
 == 0) \

847 
__»suÉ
 = (((const *) \

848 (cÚ¡ *è(
s1
))[1] \

850 (cÚ¡ *è(
s2
))[1]); \

851 ià(
l
 > 1 && 
__»suÉ
 == 0) \

853 
__»suÉ
 = \

855 (cÚ¡ *è(
s1
))[2] \

857 (cÚ¡ *è(
s2
))[2]); \

858 ià(
l
 > 2 && 
__»suÉ
 == 0) \

859 
__»suÉ
 = \

861 (cÚ¡ *è(
s1
))[3] \

863 (cÚ¡ *è(
s2
))[3]); \

866 
__»suÉ
; }))

	)

868 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

869 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = \

870 (cÚ¡ *è(cÚ¡ *è(
s2
); \

871 
__»suÉ
 = \

872 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

873 - 
__s2
[0]); \

874 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

876 
__»suÉ
 = (((const *) \

877 (cÚ¡ *è(
s1
))[1] - 
__s2
[1]); \

878 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

880 
__»suÉ
 = (((const *) \

881 (cÚ¡ *è(
s1
))[2] - 
__s2
[2]); \

882 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

883 
__»suÉ
 = (((const *) \

884 (cÚ¡ *è(
s1
))[3] \

885 - 
__s2
[3]); \

888 
__»suÉ
; }))

	)

890 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
è(- 
	`__¡rcmp_cg
 (s2, s1,†2))

	)

895 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


896 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

897 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
n
) \

898 && ((
	`__bužtš_cÚ¡ªt_p
 (
s1
) \

899 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

900 || (
	`__bužtš_cÚ¡ªt_p
 (
s2
) \

901 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

902 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

908 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rc¥n
 || defšed 
_FORCE_INLINES


909 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


910 #ià
__GNUC_PREREQ
 (3, 2)

911 
	#¡rc¥n
(
s
, 
»jeù
) \

912 
__ex‹nsiÚ__
 \

913 ({ 
__r0
, 
__r1
, 
__r2
; \

914 (
	`__bužtš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

915 ? ((
	`__bužtš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

916 ? 
	`__bužtš_¡rc¥n
 (
s
, 
»jeù
) \

917 : ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

918 ? 
	`¡¾’
 (
s
) \

919 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

920 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

921 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

922 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

923 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

924 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

925 : 
	`__bužtš_¡rc¥n
 (
s
, 
»jeù
)))))) \

926 : 
	`__bužtš_¡rc¥n
 (
s
, 
»jeù
)); })

	)

928 
	#¡rc¥n
(
s
, 
»jeù
) \

929 
__ex‹nsiÚ__
 \

930 ({ 
__r0
, 
__r1
, 
__r2
; \

931 (
	`__bužtš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

932 ? ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

933 ? 
	`¡¾’
 (
s
) \

934 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

935 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

936 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

937 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

938 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

939 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

940 : 
	`¡rc¥n
 (
s
, 
»jeù
))))) \

941 : 
	`¡rc¥n
 (
s
, 
»jeù
)); })

	)

945 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

946 
__STRING_INLINE
 
size_t


947 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

949 
size_t
 
__»suÉ
 = 0;

950 
__s
[
__»suÉ
] !ð'\0' && __s[__»suÉ] !ð
__»jeù
)

951 ++
__»suÉ
;

952  
__»suÉ
;

953 
	}
}

955 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
,

956 
__»jeù2
);

957 
__STRING_INLINE
 
size_t


958 
	$__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
)

960 
size_t
 
__»suÉ
 = 0;

961 
__s
[
__»suÉ
] !ð'\0' && __s[__»suÉ] !ð
__»jeù1


962 && 
__s
[
__»suÉ
] !ð
__»jeù2
)

963 ++
__»suÉ
;

964  
__»suÉ
;

965 
	}
}

967 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
,

968 
__»jeù2
, 
__»jeù3
);

969 
__STRING_INLINE
 
size_t


970 
	$__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
,

971 
__»jeù3
)

973 
size_t
 
__»suÉ
 = 0;

974 
__s
[
__»suÉ
] !ð'\0' && __s[__»suÉ] !ð
__»jeù1


975 && 
__s
[
__»suÉ
] !ð
__»jeù2
 && __s[__»suÉ] !ð
__»jeù3
)

976 ++
__»suÉ
;

977  
__»suÉ
;

978 
	}
}

984 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¥n
 || defšed 
_FORCE_INLINES


985 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


986 #ià
__GNUC_PREREQ
 (3, 2)

987 
	#¡r¥n
(
s
, 
acû±
) \

988 
__ex‹nsiÚ__
 \

989 ({ 
__a0
, 
__a1
, 
__a2
; \

990 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

991 ? ((
	`__bužtš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

992 ? 
	`__bužtš_¡r¥n
 (
s
, 
acû±
) \

993 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

994 ? ((è(
s
), (
size_t
) 0) \

995 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

996 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

997 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

998 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

999 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1000 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1001 : 
	`__bužtš_¡r¥n
 (
s
, 
acû±
)))))) \

1002 : 
	`__bužtš_¡r¥n
 (
s
, 
acû±
)); })

	)

1004 
	#¡r¥n
(
s
, 
acû±
) \

1005 
__ex‹nsiÚ__
 \

1006 ({ 
__a0
, 
__a1
, 
__a2
; \

1007 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1008 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1009 ? ((è(
s
), (
size_t
) 0) \

1010 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1011 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1012 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1013 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1014 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1015 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1016 : 
	`¡r¥n
 (
s
, 
acû±
))))) \

1017 : 
	`¡r¥n
 (
s
, 
acû±
)); })

	)

1021 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1022 
__STRING_INLINE
 
size_t


1023 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1025 
size_t
 
__»suÉ
 = 0;

1027 
__s
[
__»suÉ
] =ð
__acû±
)

1028 ++
__»suÉ
;

1029  
__»suÉ
;

1030 
	}
}

1032 
__STRING_INLINE
 
size_t
 
__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1033 
__acû±2
);

1034 
__STRING_INLINE
 
size_t


1035 
	$__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1037 
size_t
 
__»suÉ
 = 0;

1039 
__s
[
__»suÉ
] =ð
__acû±1
 || __s[__»suÉ] =ð
__acû±2
)

1040 ++
__»suÉ
;

1041  
__»suÉ
;

1042 
	}
}

1044 
__STRING_INLINE
 
size_t
 
__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1045 
__acû±2
, 
__acû±3
);

1046 
__STRING_INLINE
 
size_t


1047 
	$__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1049 
size_t
 
__»suÉ
 = 0;

1051 
__s
[
__»suÉ
] =ð
__acû±1
 || __s[__»suÉ] =ð
__acû±2


1052 || 
__s
[
__»suÉ
] =ð
__acû±3
)

1053 ++
__»suÉ
;

1054  
__»suÉ
;

1055 
	}
}

1060 #ià!
defšed
 
_HAVE_STRING_ARCH_¡½brk
 || defšed 
_FORCE_INLINES


1061 #iâdeà
_HAVE_STRING_ARCH_¡½brk


1062 #ià
__GNUC_PREREQ
 (3, 2)

1063 
	#¡½brk
(
s
, 
acû±
) \

1064 
__ex‹nsiÚ__
 \

1065 ({ 
__a0
, 
__a1
, 
__a2
; \

1066 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1067 ? ((
	`__bužtš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1068 ? 
	`__bužtš_¡½brk
 (
s
, 
acû±
) \

1069 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1070 ? ((è(
s
), (*è
NULL
) \

1071 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1072 ? 
	`__bužtš_¡rchr
 (
s
, 
__a0
) \

1073 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1074 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1075 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1076 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1077 : 
	`__bužtš_¡½brk
 (
s
, 
acû±
)))))) \

1078 : 
	`__bužtš_¡½brk
 (
s
, 
acû±
)); })

	)

1080 
	#¡½brk
(
s
, 
acû±
) \

1081 
__ex‹nsiÚ__
 \

1082 ({ 
__a0
, 
__a1
, 
__a2
; \

1083 (
	`__bužtš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1084 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1085 ? ((è(
s
), (*è
NULL
) \

1086 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1087 ? 
	`¡rchr
 (
s
, 
__a0
) \

1088 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1089 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1090 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1091 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1092 : 
	`¡½brk
 (
s
, 
acû±
))))) \

1093 : 
	`¡½brk
 (
s
, 
acû±
)); })

	)

1097 
__STRING_INLINE
 *
__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1098 
__acû±2
);

1099 
__STRING_INLINE
 *

1100 
	$__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1103 *
__s
 !ð'\0' && *__ !ð
__acû±1
 && *__ !ð
__acû±2
)

1104 ++
__s
;

1105  *
__s
 =ð'\0' ? 
NULL
 : (*è(
size_t
) __s;

1106 
	}
}

1108 
__STRING_INLINE
 *
__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1109 
__acû±2
, 
__acû±3
);

1110 
__STRING_INLINE
 *

1111 
	$__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1114 *
__s
 !ð'\0' && *__ !ð
__acû±1
 && *__ !ð
__acû±2


1115 && *
__s
 !ð
__acû±3
)

1116 ++
__s
;

1117  *
__s
 =ð'\0' ? 
NULL
 : (*è(
size_t
) __s;

1118 
	}
}

1124 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¡r
 && !
__GNUC_PREREQ
 (2, 97)

1125 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1126 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
ÃedË
è&& 
	`__¡ršg2_1b±r_p
 (needle) \

1127 ? (((cÚ¡ *è(
ÃedË
))[0] == '\0' \

1128 ? (*è(
size_t
è(
hay¡ack
) \

1129 : (((cÚ¡ *è(
ÃedË
))[1] == '\0' \

1130 ? 
	`¡rchr
 (
hay¡ack
, \

1131 ((cÚ¡ *è(
ÃedË
))[0]) \

1132 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
))) \

1133 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
)))

	)

1137 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


1138 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


1139 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

1140 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

1141 && ((cÚ¡ *è(
£p
))[0] != '\0' \

1142 && ((cÚ¡ *è(
£p
))[1] == '\0' \

1143 ? 
	`__¡¹ok_r_1c
 (
s
, ((cÚ¡ *è(
£p
))[0], 
Ãx
) \

1144 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

1147 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

1148 
__STRING_INLINE
 *

1149 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

1151 *
__»suÉ
;

1152 ià(
__s
 =ð
NULL
)

1153 
__s
 = *
__Ãx
;

1154 *
__s
 =ð
__£p
)

1155 ++
__s
;

1156 
__»suÉ
 = 
NULL
;

1157 ià(*
__s
 != '\0')

1159 
__»suÉ
 = 
__s
++;

1160 *
__s
 != '\0')

1161 ià(*
__s
++ =ð
__£p
)

1163 
__s
[-1] = '\0';

1167 *
__Ãx
 = 
__s
;

1168  
__»suÉ
;

1169 
	}
}

1170 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


1171 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

1176 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


1177 #iâdeà
_HAVE_STRING_ARCH_¡r£p


1179 *
__¡r£p_g
 (**
__¡ršgp
, cÚ¡ *
__d–im
);

1180 
	#__¡r£p
(
s
, 
»jeù
) \

1181 
__ex‹nsiÚ__
 \

1182 ({ 
__r0
, 
__r1
, 
__r2
; \

1183 (
	`__bužtš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

1184 && (
__r0
 = ((cÚ¡ *è(
»jeù
))[0], \

1185 ((cÚ¡ *è(
»jeù
))[0] != '\0') \

1186 ? ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], \

1187 ((cÚ¡ *è(
»jeù
))[1] == '\0') \

1188 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

1189 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

1190 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1191 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

1192 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1193 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

1194 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

1197 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

1198 
__STRING_INLINE
 *

1199 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

1201 *
__»tv®
 = *
__s
;

1202 ià(
__»tv®
 !ð
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

1203 *(*
__s
)++ = '\0';

1204  
__»tv®
;

1205 
	}
}

1207 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

1208 
__STRING_INLINE
 *

1209 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

1211 *
__»tv®
 = *
__s
;

1212 ià(
__»tv®
 !ð
NULL
)

1214 *
__ý
 = 
__»tv®
;

1217 ià(*
__ý
 == '\0')

1219 
__ý
 = 
NULL
;

1222 ià(*
__ý
 =ð
__»jeù1
 || *__ý =ð
__»jeù2
)

1224 *
__ý
++ = '\0';

1227 ++
__ý
;

1229 *
__s
 = 
__ý
;

1231  
__»tv®
;

1232 
	}
}

1234 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

1235 
__»jeù3
);

1236 
__STRING_INLINE
 *

1237 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

1239 *
__»tv®
 = *
__s
;

1240 ià(
__»tv®
 !ð
NULL
)

1242 *
__ý
 = 
__»tv®
;

1245 ià(*
__ý
 == '\0')

1247 
__ý
 = 
NULL
;

1250 ià(*
__ý
 =ð
__»jeù1
 || *__ý =ð
__»jeù2
 || *__ý =ð
__»jeù3
)

1252 *
__ý
++ = '\0';

1255 ++
__ý
;

1257 *
__s
 = 
__ý
;

1259  
__»tv®
;

1260 
	}
}

1261 #ifdeà
__USE_BSD


1262 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

1269 #ifdeà
__USE_MISC


1271 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


1272 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

1273 
	~<¡dlib.h
>

1276 #iâdeà
_HAVE_STRING_ARCH_¡rdup


1278 *
	$__¡rdup
 (cÚ¡ *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

1279 
	#__¡rdup
(
s
) \

1280 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1281 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1282 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1283 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1284 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1285 ià(
__»tv®
 !ð
NULL
) \

1286 
__»tv®
 = (*è
	`memýy
 (__»tv®, 
s
, 
__Ën
); \

1287 
__»tv®
; 
	}
})) \

1288 : 
	`__¡rdup
 (
s
)))

	)

1290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1291 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

1295 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


1297 *
	$__¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

1298 
__THROW
 
__©Œibu‹_m®loc__
;

1299 
	#__¡ºdup
(
s
, 
n
) \

1300 (
	`__ex‹nsiÚ__
 (
	`__bužtš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1301 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1302 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1303 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1304 
size_t
 
__n
 = (
n
); \

1305 *
__»tv®
; \

1306 ià(
__n
 < 
__Ën
) \

1307 
__Ën
 = 
__n
 + 1; \

1308 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1309 ià(
__»tv®
 !ð
NULL
) \

1311 
__»tv®
[
__Ën
 - 1] = '\0'; \

1312 
__»tv®
 = (*è
	`memýy
 (__»tv®, 
s
, \

1313 
__Ën
 - 1); \

1315 
__»tv®
; 
	}
})) \

1316 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

1318 #ifdeà
__USE_GNU


1319 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

1325 #iâdeà
_FORCE_INLINES


1326 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

18 #iâdeà
_STRING_H


22 
__w¬ndeþ
 (
__w¬n_mem£t_z”o_Ën
,

25 #iâdeà
__ýlu¥lus


29 #undeà
memýy


30 #undeà
memmove


31 #undeà
mem£t


32 #undeà
¡rÿt


33 #undeà
¡rýy


34 #undeà
¡ºÿt


35 #undeà
¡ºýy


36 #ifdeà
__USE_GNU


37 #undeà
mempýy


38 #undeà
¡pýy


40 #ifdeà
__USE_BSD


41 #undeà
bcÝy


42 #undeà
bz”o


47 
__fÜtify_funùiÚ
 *

48 
__NTH
 (
	$memýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

49 
size_t
 
__Ën
))

51  
	`__bužtš___memýy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

52 
	}
}

54 
__fÜtify_funùiÚ
 *

55 
__NTH
 (
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__Ën
))

57  
	`__bužtš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

58 
	}
}

60 #ifdeà
__USE_GNU


61 
__fÜtify_funùiÚ
 *

62 
__NTH
 (
	$mempýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

63 
size_t
 
__Ën
))

65  
	`__bužtš___mempýy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

66 
	}
}

75 
__fÜtify_funùiÚ
 *

76 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

78 ià(
	`__bužtš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

79 && (!
	`__bužtš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

81 
	`__w¬n_mem£t_z”o_Ën
 ();

82  
__de¡
;

84  
	`__bužtš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

85 
	}
}

87 #ifdeà
__USE_BSD


88 
__fÜtify_funùiÚ
 

89 
__NTH
 (
	$bcÝy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

91 (è
	`__bužtš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

92 
	}
}

94 
__fÜtify_funùiÚ
 

95 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

97 (è
	`__bužtš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

98 
	}
}

101 
__fÜtify_funùiÚ
 *

102 
__NTH
 (
	$¡rýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

104  
	`__bužtš___¡rýy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

105 
	}
}

107 #ifdeà
__USE_GNU


108 
__fÜtify_funùiÚ
 *

109 
__NTH
 (
	$¡pýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

111  
	`__bužtš___¡pýy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

112 
	}
}

116 
__fÜtify_funùiÚ
 *

117 
__NTH
 (
	$¡ºýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

118 
size_t
 
__Ën
))

120  
	`__bužtš___¡ºýy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

121 
	}
}

124 *
	$__¡²ýy_chk
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

125 
size_t
 
__de¡Ën
è
__THROW
;

126 *
	`__REDIRECT_NTH
 (
__¡²ýy_®Ÿs
, (*
__de¡
, cÚ¡ *
__¤c
,

127 
size_t
 
__n
), 
¡²ýy
);

129 
__fÜtify_funùiÚ
 *

130 
	`__NTH
 (
	$¡²ýy
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
))

132 ià(
	`__bos
 (
__de¡
è!ð(
size_t
) -1

133 && (!
	`__bužtš_cÚ¡ªt_p
 (
__n
è|| __À<ð
	`__bos
 (
__de¡
)))

134  
	`__¡²ýy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

135  
	`__¡²ýy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

136 
	}
}

139 
__fÜtify_funùiÚ
 *

140 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

142  
	`__bužtš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

143 
	}
}

146 
__fÜtify_funùiÚ
 *

147 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

148 
size_t
 
__Ën
))

150  
	`__bužtš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

151 
	}
}

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ð((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ýlu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ð1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ð2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ð((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/linux/byteorder/little_endian.h

1 #iâdeà
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


2 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

4 #iâdeà
__LITTLE_ENDIAN


5 
	#__LITTLE_ENDIAN
 1234

	)

7 #iâdeà
__LITTLE_ENDIAN_BITFIELD


8 
	#__LITTLE_ENDIAN_BITFIELD


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/swab.h
>

14 
	#__cÚ¡ªt_htÚl
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

15 
	#__cÚ¡ªt_Áohl
(
x
è
	`___cÚ¡ªt_swab32
((
__be32
)(x))

	)

16 
	#__cÚ¡ªt_htÚs
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

17 
	#__cÚ¡ªt_Áohs
(
x
è
	`___cÚ¡ªt_swab16
((
__be16
)(x))

	)

18 
	#__cÚ¡ªt_ýu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

19 
	#__cÚ¡ªt_Ë64_to_ýu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

20 
	#__cÚ¡ªt_ýu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

21 
	#__cÚ¡ªt_Ë32_to_ýu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

22 
	#__cÚ¡ªt_ýu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

23 
	#__cÚ¡ªt_Ë16_to_ýu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

24 
	#__cÚ¡ªt_ýu_to_be64
(
x
è((
__be64
)
	`___cÚ¡ªt_swab64
((x)))

	)

25 
	#__cÚ¡ªt_be64_to_ýu
(
x
è
	`___cÚ¡ªt_swab64
((
__u64
)(
__be64
)(x))

	)

26 
	#__cÚ¡ªt_ýu_to_be32
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

27 
	#__cÚ¡ªt_be32_to_ýu
(
x
è
	`___cÚ¡ªt_swab32
((
__u32
)(
__be32
)(x))

	)

28 
	#__cÚ¡ªt_ýu_to_be16
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

29 
	#__cÚ¡ªt_be16_to_ýu
(
x
è
	`___cÚ¡ªt_swab16
((
__u16
)(
__be16
)(x))

	)

30 
	#__ýu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

31 
	#__Ë64_to_ýu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

32 
	#__ýu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

33 
	#__Ë32_to_ýu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

34 
	#__ýu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

35 
	#__Ë16_to_ýu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

36 
	#__ýu_to_be64
(
x
è((
__be64
)
	`__swab64
((x)))

	)

37 
	#__be64_to_ýu
(
x
è
	`__swab64
((
__u64
)(
__be64
)(x))

	)

38 
	#__ýu_to_be32
(
x
è((
__be32
)
	`__swab32
((x)))

	)

39 
	#__be32_to_ýu
(
x
è
	`__swab32
((
__u32
)(
__be32
)(x))

	)

40 
	#__ýu_to_be16
(
x
è((
__be16
)
	`__swab16
((x)))

	)

41 
	#__be16_to_ýu
(
x
è
	`__swab16
((
__u16
)(
__be16
)(x))

	)

43 
__šlše__
 
__Ë64
 
	$__ýu_to_Ë64p
(cÚ¡ 
__u64
 *
p
)

45  (
__Ë64
)*
p
;

46 
	}
}

47 
__šlše__
 
__u64
 
	$__Ë64_to_ýup
(cÚ¡ 
__Ë64
 *
p
)

49  (
__u64
)*
p
;

50 
	}
}

51 
__šlše__
 
__Ë32
 
	$__ýu_to_Ë32p
(cÚ¡ 
__u32
 *
p
)

53  (
__Ë32
)*
p
;

54 
	}
}

55 
__šlše__
 
__u32
 
	$__Ë32_to_ýup
(cÚ¡ 
__Ë32
 *
p
)

57  (
__u32
)*
p
;

58 
	}
}

59 
__šlše__
 
__Ë16
 
	$__ýu_to_Ë16p
(cÚ¡ 
__u16
 *
p
)

61  (
__Ë16
)*
p
;

62 
	}
}

63 
__šlše__
 
__u16
 
	$__Ë16_to_ýup
(cÚ¡ 
__Ë16
 *
p
)

65  (
__u16
)*
p
;

66 
	}
}

67 
__šlše__
 
__be64
 
	$__ýu_to_be64p
(cÚ¡ 
__u64
 *
p
)

69  (
__be64
)
	`__swab64p
(
p
);

70 
	}
}

71 
__šlše__
 
__u64
 
	$__be64_to_ýup
(cÚ¡ 
__be64
 *
p
)

73  
	`__swab64p
((
__u64
 *)
p
);

74 
	}
}

75 
__šlše__
 
__be32
 
	$__ýu_to_be32p
(cÚ¡ 
__u32
 *
p
)

77  (
__be32
)
	`__swab32p
(
p
);

78 
	}
}

79 
__šlše__
 
__u32
 
	$__be32_to_ýup
(cÚ¡ 
__be32
 *
p
)

81  
	`__swab32p
((
__u32
 *)
p
);

82 
	}
}

83 
__šlše__
 
__be16
 
	$__ýu_to_be16p
(cÚ¡ 
__u16
 *
p
)

85  (
__be16
)
	`__swab16p
(
p
);

86 
	}
}

87 
__šlše__
 
__u16
 
	$__be16_to_ýup
(cÚ¡ 
__be16
 *
p
)

89  
	`__swab16p
((
__u16
 *)
p
);

90 
	}
}

91 
	#__ýu_to_Ë64s
(
x
èdØ{ ()(x); } 0)

	)

92 
	#__Ë64_to_ýus
(
x
èdØ{ ()(x); } 0)

	)

93 
	#__ýu_to_Ë32s
(
x
èdØ{ ()(x); } 0)

	)

94 
	#__Ë32_to_ýus
(
x
èdØ{ ()(x); } 0)

	)

95 
	#__ýu_to_Ë16s
(
x
èdØ{ ()(x); } 0)

	)

96 
	#__Ë16_to_ýus
(
x
èdØ{ ()(x); } 0)

	)

97 
	#__ýu_to_be64s
(
x
è
	`__swab64s
((x))

	)

98 
	#__be64_to_ýus
(
x
è
	`__swab64s
((x))

	)

99 
	#__ýu_to_be32s
(
x
è
	`__swab32s
((x))

	)

100 
	#__be32_to_ýus
(
x
è
	`__swab32s
((x))

	)

101 
	#__ýu_to_be16s
(
x
è
	`__swab16s
((x))

	)

102 
	#__be16_to_ýus
(
x
è
	`__swab16s
((x))

	)

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__k”Ãl_fd_£t
;

29 (*
	t__k”Ãl_sighªdËr_t
)();

32 
	t__k”Ãl_key_t
;

33 
	t__k”Ãl_mqd_t
;

35 
	~<asm/posix_ty³s.h
>

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tÞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #iâdeà
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #iâdeà
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #iâdeà
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #iâdeà
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #iâdeà
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

66 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

67 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

68 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

69 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
è(Ñ))

	)

74 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

75 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

79 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

80 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

83 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/types.h

1 #iâdeà
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-g’”ic/št-Î64.h
>

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~<asm/posix_ty³s_32.h
>

3 #–ià
defšed
(
__ILP32__
)

4 
	~<asm/posix_ty³s_x32.h
>

6 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/bits/types.h

23 #iâdef 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wÜdsize.h
>

30 
	t__u_ch¬
;

31 
	t__u_shÜt
;

32 
	t__u_št
;

33 
	t__u_lÚg
;

36 sigÃd 
	t__št8_t
;

37 
	t__ušt8_t
;

38 sigÃd 
	t__št16_t
;

39 
	t__ušt16_t
;

40 sigÃd 
	t__št32_t
;

41 
	t__ušt32_t
;

42 #ià
__WORDSIZE
 == 64

43 sigÃd 
	t__št64_t
;

44 
	t__ušt64_t
;

46 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

47 
__ex‹nsiÚ__
 
	t__ušt64_t
;

51 #ià
__WORDSIZE
 == 64

52 
	t__quad_t
;

53 
	t__u_quad_t
;

55 
__ex‹nsiÚ__
 
	t__quad_t
;

56 
__ex‹nsiÚ__
 
	t__u_quad_t
;

89 
	#__S16_TYPE
 

	)

90 
	#__U16_TYPE
 

	)

91 
	#__S32_TYPE
 

	)

92 
	#__U32_TYPE
 

	)

93 
	#__SLONGWORD_TYPE
 

	)

94 
	#__ULONGWORD_TYPE
 

	)

95 #ià
__WORDSIZE
 == 32

96 
	#__SQUAD_TYPE
 
__quad_t


	)

97 
	#__UQUAD_TYPE
 
__u_quad_t


	)

98 
	#__SWORD_TYPE
 

	)

99 
	#__UWORD_TYPE
 

	)

100 
	#__SLONG32_TYPE
 

	)

101 
	#__ULONG32_TYPE
 

	)

102 
	#__S64_TYPE
 
__quad_t


	)

103 
	#__U64_TYPE
 
__u_quad_t


	)

106 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

107 #–ià
__WORDSIZE
 == 64

108 
	t__SQUAD_TYPE
 

	)

109 
	t__UQUAD_TYPE
 

	)

110 
	t__SWORD_TYPE
 

	)

111 
	t__UWORD_TYPE
 

	)

112 
	t__SLONG32_TYPE
 

	)

113 
	t__ULONG32_TYPE
 

	)

114 
	t__S64_TYPE
 

	)

115 
	t__U64_TYPE
 

	)

117 
	t__STD_TYPE
 

	)

121 
	~<b™s/ty³sizes.h
>

124 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

125 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

126 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

127 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

128 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

129 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

130 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

131 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

132 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

133 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

134 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

135 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__þock_t
;

136 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

137 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

138 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

139 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

140 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

141 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

143 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

144 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

147 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__þockid_t
;

150 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

153 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

158 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

159 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

162 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

163 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

166 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfžút_t
;

167 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfžút64_t
;

170 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fswÜd_t
;

172 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

175 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysÿÎ_¦Úg_t
;

177 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysÿÎ_ulÚg_t
;

181 
__off64_t
 
	t__loff_t
;

182 
__quad_t
 *
	t__qaddr_t
;

183 *
	t__ÿddr_t
;

186 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

189 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

192 #undeà
__STD_TYPE


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ð
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htÞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htÞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htÞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htÞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htÞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htÞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/gnu/stubs.h

6 #ià!
defšed
 
__x86_64__


7 
	~<gnu/¡ubs-32.h
>

9 #ià
defšed
 
__x86_64__
 && defšed 
__LP64__


10 
	~<gnu/¡ubs-64.h
>

12 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


13 
	~<gnu/¡ubs-x32.h
>

	@/usr/include/linux/stddef.h

	@/usr/include/linux/swab.h

1 #iâdeà
_LINUX_SWAB_H


2 
	#_LINUX_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

6 
	~<asm/swab.h
>

12 
	#___cÚ¡ªt_swab16
(
x
è((
__u16
)( \

13 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

14 (((
__u16
)(
x
è& (__u16)0xff00Uè>> 8)))

	)

16 
	#___cÚ¡ªt_swab32
(
x
è((
__u32
)( \

17 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

18 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

19 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

20 (((
__u32
)(
x
è& (__u32)0xff000000ULè>> 24)))

	)

22 
	#___cÚ¡ªt_swab64
(
x
è((
__u64
)( \

23 (((
__u64
)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

24 (((
__u64
)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

25 (((
__u64
)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

26 (((
__u64
)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

27 (((
__u64
)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

28 (((
__u64
)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

29 (((
__u64
)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

30 (((
__u64
)(
x
è& (__u64)0xff00000000000000ULLè>> 56)))

	)

32 
	#___cÚ¡ªt_swahw32
(
x
è((
__u32
)( \

33 (((
__u32
)(
x
) & (__u32)0x0000ffffUL) << 16) | \

34 (((
__u32
)(
x
è& (__u32)0xffff0000ULè>> 16)))

	)

36 
	#___cÚ¡ªt_swahb32
(
x
è((
__u32
)( \

37 (((
__u32
)(
x
) & (__u32)0x00ff00ffUL) << 8) | \

38 (((
__u32
)(
x
è& (__u32)0xff00ff00ULè>> 8)))

	)

46 
__šlše__
 
__u16
 
	$__fswab16
(
__u16
 
v®
)

48 #ifdeà
__HAVE_BUILTIN_BSWAP16__


49  
	`__bužtš_bsw­16
(
v®
);

50 #–ià
	`defšed
 (
__¬ch_swab16
)

51  
	`__¬ch_swab16
(
v®
);

53  
	`___cÚ¡ªt_swab16
(
v®
);

55 
	}
}

57 
__šlše__
 
__u32
 
	$__fswab32
(
__u32
 
v®
)

59 #ifdeà
__HAVE_BUILTIN_BSWAP32__


60  
	`__bužtš_bsw­32
(
v®
);

61 #–ià
	`defšed
(
__¬ch_swab32
)

62  
	`__¬ch_swab32
(
v®
);

64  
	`___cÚ¡ªt_swab32
(
v®
);

66 
	}
}

68 
__šlše__
 
__u64
 
	$__fswab64
(
__u64
 
v®
)

70 #ifdeà
__HAVE_BUILTIN_BSWAP64__


71  
	`__bužtš_bsw­64
(
v®
);

72 #–ià
	`defšed
 (
__¬ch_swab64
)

73  
	`__¬ch_swab64
(
v®
);

74 #–ià
	`defšed
(
__SWAB_64_THRU_32__
)

75 
__u32
 
h
 = 
v®
 >> 32;

76 
__u32
 
l
 = 
v®
 & ((1ULL << 32) - 1);

77  (((
__u64
)
	`__fswab32
(
l
)è<< 32è| ((__u64)(__fswab32(
h
)));

79  
	`___cÚ¡ªt_swab64
(
v®
);

81 
	}
}

83 
__šlše__
 
__u32
 
	$__fswahw32
(
__u32
 
v®
)

85 #ifdeà
__¬ch_swahw32


86  
	`__¬ch_swahw32
(
v®
);

88  
	`___cÚ¡ªt_swahw32
(
v®
);

90 
	}
}

92 
__šlše__
 
__u32
 
	$__fswahb32
(
__u32
 
v®
)

94 #ifdeà
__¬ch_swahb32


95  
	`__¬ch_swahb32
(
v®
);

97  
	`___cÚ¡ªt_swahb32
(
v®
);

99 
	}
}

105 
	#__swab16
(
x
) \

106 (
	`__bužtš_cÚ¡ªt_p
((
__u16
)(
x
)) ? \

107 
	`___cÚ¡ªt_swab16
(
x
) : \

108 
	`__fswab16
(
x
))

	)

114 
	#__swab32
(
x
) \

115 (
	`__bužtš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

116 
	`___cÚ¡ªt_swab32
(
x
) : \

117 
	`__fswab32
(
x
))

	)

123 
	#__swab64
(
x
) \

124 (
	`__bužtš_cÚ¡ªt_p
((
__u64
)(
x
)) ? \

125 
	`___cÚ¡ªt_swab64
(
x
) : \

126 
	`__fswab64
(
x
))

	)

134 
	#__swahw32
(
x
) \

135 (
	`__bužtš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

136 
	`___cÚ¡ªt_swahw32
(
x
) : \

137 
	`__fswahw32
(
x
))

	)

145 
	#__swahb32
(
x
) \

146 (
	`__bužtš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

147 
	`___cÚ¡ªt_swahb32
(
x
) : \

148 
	`__fswahb32
(
x
))

	)

154 
__šlše__
 
__u16
 
	$__swab16p
(cÚ¡ 
__u16
 *
p
)

156 #ifdeà
__¬ch_swab16p


157  
	`__¬ch_swab16p
(
p
);

159  
	`__swab16
(*
p
);

161 
	}
}

167 
__šlše__
 
__u32
 
	$__swab32p
(cÚ¡ 
__u32
 *
p
)

169 #ifdeà
__¬ch_swab32p


170  
	`__¬ch_swab32p
(
p
);

172  
	`__swab32
(*
p
);

174 
	}
}

180 
__šlše__
 
__u64
 
	$__swab64p
(cÚ¡ 
__u64
 *
p
)

182 #ifdeà
__¬ch_swab64p


183  
	`__¬ch_swab64p
(
p
);

185  
	`__swab64
(*
p
);

187 
	}
}

195 
__šlše__
 
__u32
 
	$__swahw32p
(cÚ¡ 
__u32
 *
p
)

197 #ifdeà
__¬ch_swahw32p


198  
	`__¬ch_swahw32p
(
p
);

200  
	`__swahw32
(*
p
);

202 
	}
}

210 
__šlše__
 
__u32
 
	$__swahb32p
(cÚ¡ 
__u32
 *
p
)

212 #ifdeà
__¬ch_swahb32p


213  
	`__¬ch_swahb32p
(
p
);

215  
	`__swahb32
(*
p
);

217 
	}
}

223 
__šlše__
 
	$__swab16s
(
__u16
 *
p
)

225 #ifdeà
__¬ch_swab16s


226 
	`__¬ch_swab16s
(
p
);

228 *
p
 = 
	`__swab16p
(p);

230 
	}
}

235 
__šlše__
 
	$__swab32s
(
__u32
 *
p
)

237 #ifdeà
__¬ch_swab32s


238 
	`__¬ch_swab32s
(
p
);

240 *
p
 = 
	`__swab32p
(p);

242 
	}
}

248 
__šlše__
 
	$__swab64s
(
__u64
 *
p
)

250 #ifdeà
__¬ch_swab64s


251 
	`__¬ch_swab64s
(
p
);

253 *
p
 = 
	`__swab64p
(p);

255 
	}
}

263 
__šlše__
 
	$__swahw32s
(
__u32
 *
p
)

265 #ifdeà
__¬ch_swahw32s


266 
	`__¬ch_swahw32s
(
p
);

268 *
p
 = 
	`__swahw32p
(p);

270 
	}
}

278 
__šlše__
 
	$__swahb32s
(
__u32
 *
p
)

280 #ifdeà
__¬ch_swahb32s


281 
	`__¬ch_swahb32s
(
p
);

283 *
p
 = 
	`__swahb32p
(p);

285 
	}
}

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_BSD


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ýlu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ýlu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Þ
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Þl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Þd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Þ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifdeà
__USE_BSD


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Þl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Þ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Þl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Þd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Þ
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Þ
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Þ
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Þl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Þl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Þd_x
[3];

416 
__c
;

417 
__š™
;

418 
__ex‹nsiÚ__
 
__a
;

423 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

424 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

425 
	$”ªd48_r
 (
__xsubi
[3],

426 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

427 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

431 *
__»¡riù
 
__»suÉ
)

432 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

433 
	$Äªd48_r
 (
__xsubi
[3],

434 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

435 *
__»¡riù
 
__»suÉ
)

436 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

439 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

442 
	$j¿nd48_r
 (
__xsubi
[3],

443 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

444 *
__»¡riù
 
__»suÉ
)

445 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

448 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$lcÚg48_r
 (
__·¿m
[7],

455 
d¿nd48_d©a
 *
__bufãr
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

462 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


463 
	#__m®loc_ªd_ÿÎoc_defšed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

468 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

469 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

483 
	$ä“
 (*
__±r
è
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$cä“
 (*
__±r
è
__THROW
;

491 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


492 
	~<®loÿ.h
>

495 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

496 || 
defšed
 
__USE_BSD


498 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

501 #ifdeà
__USE_XOPEN2K


503 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

504 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

507 #ifdeà
__USE_ISOC11


509 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

510 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

521 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


523 #ifdeà
__ýlu¥lus


524 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

527 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

536 
__THROW
 
	`__nÚnuÎ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

545 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


549 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

551 
__END_NAMESPACE_STD


553 #ifdeà
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

565 
__END_NAMESPACE_STD


567 #ifdeà
__USE_GNU


570 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

571 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

574 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


578 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

581 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


584 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

585 
__THROW
 
	`__nÚnuÎ
 ((2));

588 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$þ—»nv
 (è
__THROW
;

599 #ià
defšed
 
__USE_MISC
 \

600 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fže_Çme
 (cÚ¡ *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sÞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
) (const *, const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
) (const *, const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

759 #ifdeà
__USE_EXTERN_INLINES


760 
	~<b™s/¡dlib-b£¬ch.h
>

765 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

766 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

767 #ifdeà
__USE_GNU


768 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

769 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

770 
	`__nÚnuÎ
 ((1, 4));

775 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

776 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

777 
__END_NAMESPACE_STD


779 #ifdeà
__USE_ISOC99


780 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

781 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

785 
__BEGIN_NAMESPACE_STD


789 
div_t
 
	$div
 (
__num”
, 
__d’om
)

790 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

791 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

792 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

793 
__END_NAMESPACE_STD


795 #ifdeà
__USE_ISOC99


796 
__BEGIN_NAMESPACE_C99


797 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

798 
__d’om
)

799 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

800 
__END_NAMESPACE_C99


804 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

805 || 
defšed
 
__USE_SVID


812 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

813 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

818 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

819 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

824 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

825 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

828 #ifdeà
__USE_MISC


830 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

831 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
)

832 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

833 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

834 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
)

835 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

836 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

837 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

842 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

843 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

844 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

846 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

847 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

853 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

854 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
,

855 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

856 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

860 
__BEGIN_NAMESPACE_STD


863 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

866 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

867 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

870 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

874 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

875 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

877 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

878 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

879 
__THROW
;

880 
__END_NAMESPACE_STD


883 #ifdeà
__USE_SVID


888 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


899 
	$g‘subÝt
 (**
__»¡riù
 
__ÝtiÚp
,

900 *cÚ¡ *
__»¡riù
 
__tok’s
,

901 **
__»¡riù
 
__v®u•
)

902 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

906 #ifdeà
__USE_XOPEN


908 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

914 #ifdeà
__USE_XOPEN2KXSI


916 
	$posix_Ý’±
 (
__oæag
è
__wur
;

919 #ifdeà
__USE_XOPEN


924 
	$g¿Á±
 (
__fd
è
__THROW
;

928 
	$uÆock±
 (
__fd
è
__THROW
;

933 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

936 #ifdeà
__USE_GNU


940 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

941 
__THROW
 
	`__nÚnuÎ
 ((2));

944 
	`g‘±
 ();

947 #ifdeà
__USE_BSD


951 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

952 
__THROW
 
	`__nÚnuÎ
 ((1));

955 
	~<b™s/¡dlib-æßt.h
>

958 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


959 
	~<b™s/¡dlib.h
>

961 #ifdeà
__LDBL_COMPAT


962 
	~<b™s/¡dlib-ldbl.h
>

966 #undeà
__Ãed_m®loc_ªd_ÿÎoc


968 
__END_DECLS


	@/usr/include/sys/cdefs.h

18 #iâdef 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #iâdeà
_FEATURES_H


23 
	~<ã©u»s.h
>

29 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


34 #undeà
__P


35 #undeà
__PMT


37 #ifdeà
__GNUC__


41 #ià
__GNUC_PREREQ
 (4, 6è&& !
defšed
 
_LIBC


42 
	#__LEAF
 , 
__Ëaf__


	)

43 
	#__LEAF_ATTR
 
	`__©Œibu‹__
 ((
__Ëaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #ià!
defšed
 
__ýlu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

57 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
)è
	)
fct

59 #ià
defšed
 
__ýlu¥lus
 && 
__GNUC_PREREQ
 (2,8)

60 
	#__THROW
 
	`throw
 ()

	)

61 
	#__THROWNL
 
	`throw
 ()

	)

62 
	#__NTH
(
fù
è
__LEAF_ATTR
 fù 
	`throw
 ()

	)

64 
	#__THROW


	)

65 
	#__THROWNL


	)

66 
	#__NTH
(
fù
è
	)
fct

72 
	#__šlše


	)

74 
	#__THROW


	)

75 
	#__THROWNL


	)

76 
	#__NTH
(
fù
è
	)
fct

82 
	#__P
(
¬gs
è
	)
args

83 
	#__PMT
(
¬gs
è
	)
args

88 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

89 
	#__STRING
(
x
è#x

	)

92 
	#__±r_t
 *

	)

93 
	#__lÚg_doubË_t
 

	)

97 #ifdef 
__ýlu¥lus


98 
	#__BEGIN_DECLS
 "C" {

	)

99 
	#__END_DECLS
 }

	)

101 
	#__BEGIN_DECLS


	)

102 
	#__END_DECLS


	)

111 #ià
defšed
 
__ýlu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


112 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

113 
	#__END_NAMESPACE_STD
 }

	)

114 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

115 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

116 
	#__END_NAMESPACE_C99
 }

	)

117 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

122 
	#__BEGIN_NAMESPACE_STD


	)

123 
	#__END_NAMESPACE_STD


	)

124 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

125 
	#__BEGIN_NAMESPACE_C99


	)

126 
	#__END_NAMESPACE_C99


	)

127 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

132 
	#__bos
(
±r
è
	`__bužtš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__bužtš_objeù_size
 (±r, 0)

	)

134 
	#__fÜtify_funùiÚ
 
__ex‹º_®ways_šlše
 
__©Œibu‹_¬tificŸl__


	)

136 #ià
__GNUC_PREREQ
 (4,3)

137 
	#__w¬ndeþ
(
Çme
, 
msg
) \

138 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

139 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

140 
	#__”rÜdeþ
(
Çme
, 
msg
) \

141 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

143 
	#__w¬ndeþ
(
Çme
, 
msg
è
	`Çme
 ()

	)

144 
	#__w¬Ç‰r
(
msg
)

	)

145 
	#__”rÜdeþ
(
Çme
, 
msg
è
	`Çme
 ()

	)

149 #ià
__GNUC_PREREQ
 (2,97)

151 
	#__æex¬r
 []

	)

153 #ifdeà
__GNUC__


154 
	#__æex¬r
 [0]

	)

156 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

157 
	#__æex¬r
 []

	)

160 
	#__æex¬r
 [1]

	)

176 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

178 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

179 #ifdeà
__ýlu¥lus


180 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

181 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

182 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

183 
Çme
 
´Ùo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

185 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

186 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

187 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

188 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROWNL


	)

190 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

191 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

204 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

205 
	#__©Œibu‹__
(
xyz
è

	)

211 #ià
__GNUC_PREREQ
 (2,96)

212 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

214 
	#__©Œibu‹_m®loc__


	)

219 #ià
__GNUC_PREREQ
 (4, 3)

220 
	#__©Œibu‹_®loc_size__
(
·¿ms
) \

221 
	`__©Œibu‹__
 ((
__®loc_size__
 
·¿ms
))

	)

223 
	#__©Œibu‹_®loc_size__
(
·¿ms
è

	)

229 #ià
__GNUC_PREREQ
 (2,96)

230 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

232 
	#__©Œibu‹_pu»__


	)

236 #ià
__GNUC_PREREQ
 (2,5)

237 
	#__©Œibu‹_cÚ¡__
 
	`__©Œibu‹__
 ((
__cÚ¡__
))

	)

239 
	#__©Œibu‹_cÚ¡__


	)

245 #ià
__GNUC_PREREQ
 (3,1)

246 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

247 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

249 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

250 
	#__©Œibu‹_nošlše__


	)

254 #ià
__GNUC_PREREQ
 (3,2)

255 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

257 
	#__©Œibu‹_d•»ÿ‹d__


	)

266 #ià
__GNUC_PREREQ
 (2,8)

267 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

269 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

276 #ià
__GNUC_PREREQ
 (2,97)

277 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

278 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

280 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

285 #ià
__GNUC_PREREQ
 (3,3)

286 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

288 
	#__nÚnuÎ
(
·¿ms
)

	)

293 #ià
__GNUC_PREREQ
 (3,4)

294 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

295 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

296 #ià
__USE_FORTIFY_LEVEL
 > 0

297 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

300 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

302 #iâdeà
__wur


303 
	#__wur


	)

307 #ià
__GNUC_PREREQ
 (3,2)

308 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

310 
	#__®ways_šlše
 
__šlše


	)

315 #ià
__GNUC_PREREQ
 (4,3)

316 
	#__©Œibu‹_¬tificŸl__
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

318 
	#__©Œibu‹_¬tificŸl__


	)

321 #ifdeà
__GNUC__


326 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__GNUC_GNU_INLINE__


327 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

328 
	#__ex‹º_®ways_šlše
 \

329 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

331 
	#__ex‹º_šlše
 
__šlše


	)

332 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

335 
	#__ex‹º_šlše


	)

336 
	#__ex‹º_®ways_šlše


	)

341 #ià
__GNUC_PREREQ
 (4,3)

342 
	#__va_¬g_·ck
(è
	`__bužtš_va_¬g_·ck
 ()

	)

343 
	#__va_¬g_·ck_Ën
(è
	`__bužtš_va_¬g_·ck_Ën
 ()

	)

350 #ià!
__GNUC_PREREQ
 (2,8)

351 
	#__ex‹nsiÚ__


	)

355 #ià!
__GNUC_PREREQ
 (2,92)

356 
	#__»¡riù


	)

362 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


363 
	#__»¡riù_¬r
 
__»¡riù


	)

365 #ifdeà
__GNUC__


366 
	#__»¡riù_¬r


	)

368 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

369 
	#__»¡riù_¬r
 
»¡riù


	)

372 
	#__»¡riù_¬r


	)

377 #ià
__GNUC__
 >= 3

378 
	#__glibc_uÆik–y
(
cÚd
è
	`__bužtš_ex³ù
 ((cÚd), 0)

	)

379 
	#__glibc_lik–y
(
cÚd
è
	`__bužtš_ex³ù
 ((cÚd), 1)

	)

381 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

382 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

385 
	~<b™s/wÜdsize.h
>

387 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


388 
	#__LDBL_COMPAT
 1

	)

389 #ifdeà
__REDIRECT


390 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

391 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

392 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

393 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

394 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

395 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

396 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

397 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

398 
	#__LDBL_REDIR_DECL
(
Çme
) \

399 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

400 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

401 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

402 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

403 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

406 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


407 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

408 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

409 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

410 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

411 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

412 #ifdeà
__REDIRECT


413 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

414 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

415 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__bužtš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/asm-generic/int-ll64.h

8 #iâdeà
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__ASSEMBLY__


19 
__sigÃd__
 
	t__s8
;

20 
	t__u8
;

22 
__sigÃd__
 
	t__s16
;

23 
	t__u16
;

25 
__sigÃd__
 
	t__s32
;

26 
	t__u32
;

28 #ifdeà
__GNUC__


29 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

30 
__ex‹nsiÚ__
 
	t__u64
;

32 
__sigÃd__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm/posix_types_32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__k”Ãl_mode_t
;

11 
	#__k”Ãl_mode_t
 
__k”Ãl_mode_t


	)

13 
	t__k”Ãl_c_pid_t
;

14 
	#__k”Ãl_c_pid_t
 
__k”Ãl_c_pid_t


	)

16 
	t__k”Ãl_uid_t
;

17 
	t__k”Ãl_gid_t
;

18 
	#__k”Ãl_uid_t
 
__k”Ãl_uid_t


	)

20 
	t__k”Ãl_Þd_dev_t
;

21 
	#__k”Ãl_Þd_dev_t
 
__k”Ãl_Þd_dev_t


	)

23 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_64.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__k”Ãl_Þd_uid_t
;

11 
	t__k”Ãl_Þd_gid_t
;

12 
	#__k”Ãl_Þd_uid_t
 
__k”Ãl_Þd_uid_t


	)

14 
	t__k”Ãl_Þd_dev_t
;

15 
	#__k”Ãl_Þd_dev_t
 
__k”Ãl_Þd_dev_t


	)

17 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__k”Ãl_lÚg_t
;

14 
	t__k”Ãl_ulÚg_t
;

15 
	#__k”Ãl_lÚg_t
 
__k”Ãl_lÚg_t


	)

17 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm/swab.h

1 #iâdeà
_ASM_X86_SWAB_H


2 
	#_ASM_X86_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

7 
__šlše__
 
__u32
 
	$__¬ch_swab32
(
__u32
 
v®
)

9 
	`__asm__
("bsw­È%0" : "ô" (
v®
) : "0" (val));

10  
v®
;

11 
	}
}

12 
	#__¬ch_swab32
 
__¬ch_swab32


	)

14 
__šlše__
 
__u64
 
	$__¬ch_swab64
(
__u64
 
v®
)

16 #ifdeà
__i386__


19 
__u32
 
a
;

20 
__u32
 
b
;

21 } 
s
;

22 
__u64
 
u
;

23 } 
v
;

24 
v
.
u
 = 
v®
;

25 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

26 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

27 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

28  
v
.
u
;

30 
	`__asm__
("bsw­q %0" : "ô" (
v®
) : "0" (val));

31  
v®
;

33 
	}
}

34 
	#__¬ch_swab64
 
__¬ch_swab64


	)

	@/usr/include/bits/byteswap.h

19 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

35 
	~<b™s/by‹sw­-16.h
>

38 
	#__bsw­_cÚ¡ªt_32
(
x
) \

39 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

40 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

42 #ifdeà
__GNUC__


43 #ià
__GNUC_PREREQ
 (4, 3)

44 
__šlše
 

45 
	$__bsw­_32
 (
__bsx
)

47  
	`__bužtš_bsw­32
 (
__bsx
);

48 
	}
}

49 #–ià
__GNUC__
 >= 2

50 #ià
__WORDSIZE
 =ð64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

51 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

52 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

53 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

54 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

55 || 
defšed
 
	g__amdçm10__
)

58 
	#__bsw­_32
(
x
) \

59 (
__ex‹nsiÚ__
 \

60 ({ 
__v
, 
__x
 = (
x
); \

61 ià(
	`__bužtš_cÚ¡ªt_p
 (
__x
)) \

62 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

64 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

65 
__v
; }))

	)

67 
	#__bsw­_32
(
x
) \

68 (
__ex‹nsiÚ__
 \

69 ({ 
__v
, 
__x
 = (
x
); \

70 ià(
	`__bužtš_cÚ¡ªt_p
 (
__x
)) \

71 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

73 
	`__asm__
 ("rorw $8, %w0;" \

76 : "ô" (
__v
) \

77 : "0" (
__x
) \

79 
__v
; }))

	)

82 
	#__bsw­_32
(
x
) \

83 (
__ex‹nsiÚ__
 \

84 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

87 
__šlše
 

88 
	$__bsw­_32
 (
__bsx
)

90  
	`__bsw­_cÚ¡ªt_32
 (
__bsx
);

91 
	}
}

95 #ià
__GNUC_PREREQ
 (2, 0)

97 
	#__bsw­_cÚ¡ªt_64
(
x
) \

98 (
	`__ex‹nsiÚ__
 ((((
x
) & 0xff00000000000000ull) >> 56) \

99 | (((
x
) & 0x00ff000000000000ull) >> 40) \

100 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

101 | (((
x
) & 0x000000ff00000000ull) >> 8) \

102 | (((
x
) & 0x00000000ff000000ull) << 8) \

103 | (((
x
) & 0x0000000000ff0000ull) << 24) \

104 | (((
x
) & 0x000000000000ff00ull) << 40) \

105 | (((
x
è& 0x00000000000000ffuÎè<< 56)))

	)

107 #ià
__GNUC_PREREQ
 (4, 3)

108 
__šlše
 
__ušt64_t


109 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

111  
	`__bužtš_bsw­64
 (
__bsx
);

112 
	}
}

113 #–ià
__WORDSIZE
 == 64

114 
	#__bsw­_64
(
x
) \

115 (
__ex‹nsiÚ__
 \

116 ({ 
__ušt64_t
 
__v
, 
__x
 = (
x
); \

117 ià(
	`__bužtš_cÚ¡ªt_p
 (
__x
)) \

118 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

120 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

121 
__v
; }))

	)

123 
	#__bsw­_64
(
x
) \

124 (
__ex‹nsiÚ__
 \

125 ({ uniÚ { 
__ex‹nsiÚ__
 
__ušt64_t
 
__Î
; \

126 
__l
[2]; } 
__w
, 
__r
; \

127 ià(
	`__bužtš_cÚ¡ªt_p
 (
x
)) \

128 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

131 
__w
.
__Î
 = (
x
); \

132 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

133 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

135 
__r
.
__Î
; }))

	)

138 
	#__bsw­_cÚ¡ªt_64
(
x
) \

139 ((((
x
) & 0xff00000000000000ull) >> 56) \

140 | (((
x
) & 0x00ff000000000000ull) >> 40) \

141 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

142 | (((
x
) & 0x000000ff00000000ull) >> 8) \

143 | (((
x
) & 0x00000000ff000000ull) << 8) \

144 | (((
x
) & 0x0000000000ff0000ull) << 24) \

145 | (((
x
) & 0x000000000000ff00ull) << 40) \

146 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

148 
__šlše
 
__ušt64_t


149 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

151  
	`__bsw­_cÚ¡ªt_64
 (
__bsx
);

152 
	}
}

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/stdlib-bsearch.h

19 
__ex‹º_šlše
 *

20 
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

21 
__com·r_â_t
 
__com·r
)

23 
size_t
 
__l
, 
__u
, 
__idx
;

24 cÚ¡ *
__p
;

25 
__com·risÚ
;

27 
__l
 = 0;

28 
__u
 = 
__nmemb
;

29 
__l
 < 
__u
)

31 
__idx
 = (
__l
 + 
__u
) / 2;

32 
__p
 = (*è(((cÚ¡ *è
__ba£
è+ (
__idx
 * 
__size
));

33 
__com·risÚ
 = (*
__com·r
è(
__key
, 
__p
);

34 ià(
__com·risÚ
 < 0)

35 
__u
 = 
__idx
;

36 ià(
__com·risÚ
 > 0)

37 
__l
 = 
__idx
 + 1;

39  (*è
__p
;

42  
NULL
;

43 
	}
}

	@/usr/include/bits/stdlib-float.h

19 #iâdeà
_STDLIB_H


23 #ifdeà
__USE_EXTERN_INLINES


24 
__BEGIN_NAMESPACE_STD


25 
__ex‹º_šlše
 

26 
__NTH
 (
	$©of
 (cÚ¡ *
__ÅŒ
))

28  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

29 
	}
}

30 
	g__END_NAMESPACE_STD


	@/usr/include/bits/stdlib-ldbl.h

19 #iâdeà
_STDLIB_H


23 #ifdef 
__USE_ISOC99


24 
__BEGIN_NAMESPACE_C99


25 
	$__LDBL_REDIR1_DECL
 (
¡¹Þd
, 
¡¹od
)

26 
__END_NAMESPACE_C99


29 #ifdeà
__USE_GNU


30 
	$__LDBL_REDIR1_DECL
 (
¡¹Þd_l
, 
¡¹od_l
)

33 #ifdeà
__USE_MISC


34 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

35 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

36 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

38 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

19 #iâdeà
_STDLIB_H


23 *
	$__»®·th_chk
 (cÚ¡ *
__»¡riù
 
__Çme
,

24 *
__»¡riù
 
__»sÞved
,

25 
size_t
 
__»sÞvedËn
è
__THROW
 
__wur
;

26 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

27 (cÚ¡ *
__»¡riù
 
__Çme
,

28 *
__»¡riù
 
__»sÞved
), 
»®·th
è
__wur
;

29 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

30 (cÚ¡ *
__»¡riù
 
__Çme
,

31 *
__»¡riù
 
__»sÞved
,

32 
size_t
 
__»sÞvedËn
), 
__»®·th_chk
è
__wur


33 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

36 
__fÜtify_funùiÚ
 
__wur
 *

37 
	`__NTH
 (
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
, *__»¡riù 
__»sÞved
))

39 ià(
	`__bos
 (
__»sÞved
è!ð(
size_t
) -1)

41 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


42 ià(
	`__bos
 (
__»sÞved
è< 
PATH_MAX
)

43  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sÞved
, 
	`__bos
 (__resolved));

45  
	`__»®·th_chk
 (
__Çme
, 
__»sÞved
, 
	`__bos
 (__resolved));

48  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sÞved
);

49 
	}
}

52 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

53 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

54 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

55 
size_t
 
__buæ’
), 
±¢ame_r
)

56 
	`__nÚnuÎ
 ((2));

57 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

58 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

59 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

60 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

63 
__fÜtify_funùiÚ
 

64 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

66 ià(
	`__bos
 (
__buf
è!ð(
size_t
) -1)

68 ià(!
	`__bužtš_cÚ¡ªt_p
 (
__buæ’
))

69  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

70 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

71  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

73  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

74 
	}
}

77 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

78 
__THROW
 
__wur
;

79 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

80 
wùomb
è
__wur
;

82 
__fÜtify_funùiÚ
 
__wur
 

83 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

88 
	#__STDLIB_MB_LEN_MAX
 16

	)

89 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ð
__STDLIB_MB_LEN_MAX


92 ià(
	`__bos
 (
__s
è!ð(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

93  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

94  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

95 
	}
}

98 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

99 cÚ¡ *
__»¡riù
 
__¤c
,

100 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

101 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

102 (
wch¬_t
 *
__»¡riù
 
__d¡
,

103 cÚ¡ *
__»¡riù
 
__¤c
,

104 
size_t
 
__Ën
), 
mb¡owcs
);

105 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

106 (
wch¬_t
 *
__»¡riù
 
__d¡
,

107 cÚ¡ *
__»¡riù
 
__¤c
,

108 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

109 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

112 
__fÜtify_funùiÚ
 
size_t


113 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ *__»¡riù 
__¤c
,

114 
size_t
 
__Ën
))

116 ià(
	`__bos
 (
__d¡
è!ð(
size_t
) -1)

118 ià(!
	`__bužtš_cÚ¡ªt_p
 (
__Ën
))

119  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

120 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

122 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

123  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

124 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

126  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

127 
	}
}

130 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

131 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

132 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

133 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

134 (*
__»¡riù
 
__d¡
,

135 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

136 
size_t
 
__Ën
), 
wc¡ombs
);

137 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

138 (*
__»¡riù
 
__d¡
,

139 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

140 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

141 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

143 
__fÜtify_funùiÚ
 
size_t


144 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 *__»¡riù 
__¤c
,

145 
size_t
 
__Ën
))

147 ià(
	`__bos
 (
__d¡
è!ð(
size_t
) -1)

149 ià(!
	`__bužtš_cÚ¡ªt_p
 (
__Ën
))

150  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

151 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

152  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

154  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

155 
	}
}

	@/usr/include/bits/typesizes.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifdeà
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

75 #ifdeà
__x86_64__


79 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

82 
	#__INO_T_MATCHES_INO64_T
 1

	)

86 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/waitflags.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


25 
	#WNOHANG
 1

	)

26 
	#WUNTRACED
 2

	)

29 
	#WSTOPPED
 2

	)

30 
	#WEXITED
 4

	)

31 
	#WCONTINUED
 8

	)

32 
	#WNOWAIT
 0x01000000

	)

34 
	#__WNOTHREAD
 0x20000000

	)

36 
	#__WALL
 0x40000000

	)

37 
	#__WCLONE
 0x80000000

	)

40 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


41 #iâdeà
__ENUM_IDTYPE_T


42 
	#__ENUM_IDTYPE_T
 1

	)

46 #undeà
P_ALL


47 #undeà
P_PID


48 #undeà
P_PGID


52 
	mP_ALL
,

53 
	mP_PID
,

54 
	mP_PGID


55 } 
	tidty³_t
;

	@/usr/include/bits/waitstatus.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


28 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

31 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

34 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

37 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ð0)

	)

40 
	#__WIFSIGNALED
(
¡©us
) \

41 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

44 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ð0x7f)

	)

48 #ifdeà
WCONTINUED


49 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ð
__W_CONTINUED
)

	)

53 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

56 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

57 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

58 
	#__W_CONTINUED
 0xffff

	)

59 
	#__WCOREFLAG
 0x80

	)

62 #ifdef 
__USE_BSD


64 
	~<’dŸn.h
>

66 
	uwa™


68 
	mw_¡©us
;

71 #if 
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


72 
	m__w_‹rmsig
:7;

73 
	m__w_cÜedump
:1;

74 
	m__w_»tcode
:8;

77 #if 
__BYTE_ORDER
 =ð
__BIG_ENDIAN


79 
	m__w_»tcode
:8;

80 
	m__w_cÜedump
:1;

81 
	m__w_‹rmsig
:7;

83 } 
	m__wa™_‹rmš©ed
;

86 #if 
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


87 
	m__w_¡Ýv®
:8;

88 
	m__w_¡Ýsig
:8;

91 #if 
__BYTE_ORDER
 =ð
__BIG_ENDIAN


93 
	m__w_¡Ýsig
:8;

94 
	m__w_¡Ýv®
:8;

96 } 
	m__wa™_¡Ý³d
;

99 
	#w_‹rmsig
 
__wa™_‹rmš©ed
.
__w_‹rmsig


	)

100 
	#w_cÜedump
 
__wa™_‹rmš©ed
.
__w_cÜedump


	)

101 
	#w_»tcode
 
__wa™_‹rmš©ed
.
__w_»tcode


	)

102 
	#w_¡Ýsig
 
__wa™_¡Ý³d
.
__w_¡Ýsig


	)

103 
	#w_¡Ýv®
 
__wa™_¡Ý³d
.
__w_¡Ýv®


	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__
 && !defšed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifdeà
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_chæags


	)

11 
	#__¡ub_ç‰ach


	)

12 
	#__¡ub_fchæags


	)

13 
	#__¡ub_fd‘ach


	)

14 
	#__¡ub_g‰y


	)

15 
	#__¡ub_lchmod


	)

16 
	#__¡ub_»voke


	)

17 
	#__¡ub_£Žogš


	)

18 
	#__¡ub_sig»tuº


	)

19 
	#__¡ub_s¡k


	)

20 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£Žogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-x32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ü—‹_moduË


	)

13 
	#__¡ub_ç‰ach


	)

14 
	#__¡ub_fchæags


	)

15 
	#__¡ub_fd‘ach


	)

16 
	#__¡ub_g‘_k”Ãl_syms


	)

17 
	#__¡ub_g‘msg


	)

18 
	#__¡ub_g‰y


	)

19 
	#__¡ub_lchmod


	)

20 
	#__¡ub_nfs£rvùl


	)

21 
	#__¡ub_putmsg


	)

22 
	#__¡ub_qu”y_moduË


	)

23 
	#__¡ub_»voke


	)

24 
	#__¡ub_£Žogš


	)

25 
	#__¡ub_sig»tuº


	)

26 
	#__¡ub_s¡k


	)

27 
	#__¡ub_¡ty


	)

28 
	#__¡ub_u£lib


	)

	@/usr/include/sys/types.h

22 #iâdef 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 #ifdef 
__USE_BSD


32 #iâdeà
__u_ch¬_defšed


33 
__u_ch¬
 
	tu_ch¬
;

34 
__u_shÜt
 
	tu_shÜt
;

35 
__u_št
 
	tu_št
;

36 
__u_lÚg
 
	tu_lÚg
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¬_defšed


	)

44 
__loff_t
 
	tloff_t
;

46 #iâdeà
__šo_t_defšed


47 #iâdeà
__USE_FILE_OFFSET64


48 
__šo_t
 
	tšo_t
;

50 
__šo64_t
 
	tšo_t
;

52 
	#__šo_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


55 
__šo64_t
 
	tšo64_t
;

56 
	#__šo64_t_defšed


	)

59 #iâdeà
__dev_t_defšed


60 
__dev_t
 
	tdev_t
;

61 
	#__dev_t_defšed


	)

64 #iâdeà
__gid_t_defšed


65 
__gid_t
 
	tgid_t
;

66 
	#__gid_t_defšed


	)

69 #iâdeà
__mode_t_defšed


70 
__mode_t
 
	tmode_t
;

71 
	#__mode_t_defšed


	)

74 #iâdeà
__Æšk_t_defšed


75 
__Æšk_t
 
	tÆšk_t
;

76 
	#__Æšk_t_defšed


	)

79 #iâdeà
__uid_t_defšed


80 
__uid_t
 
	tuid_t
;

81 
	#__uid_t_defšed


	)

84 #iâdeà
__off_t_defšed


85 #iâdeà
__USE_FILE_OFFSET64


86 
__off_t
 
	toff_t
;

88 
__off64_t
 
	toff_t
;

90 
	#__off_t_defšed


	)

92 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


93 
__off64_t
 
	toff64_t
;

94 
	#__off64_t_defšed


	)

97 #iâdeà
__pid_t_defšed


98 
__pid_t
 
	tpid_t
;

99 
	#__pid_t_defšed


	)

102 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

103 && !
defšed
 
__id_t_defšed


104 
__id_t
 
	tid_t
;

105 
	#__id_t_defšed


	)

108 #iâdeà
__ssize_t_defšed


109 
__ssize_t
 
	tssize_t
;

110 
	#__ssize_t_defšed


	)

113 #ifdef 
__USE_BSD


114 #iâdeà
__daddr_t_defšed


115 
__daddr_t
 
	tdaddr_t
;

116 
__ÿddr_t
 
	tÿddr_t
;

117 
	#__daddr_t_defšed


	)

121 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


122 
__key_t
 
	tkey_t
;

123 
	#__key_t_defšed


	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#__Ãed_þock_t


	)

129 
	#__Ãed_time_t


	)

130 
	#__Ãed_tim”_t


	)

131 
	#__Ãed_þockid_t


	)

132 
	~<time.h
>

134 #ifdeà
__USE_XOPEN


135 #iâdeà
__u£cÚds_t_defšed


136 
__u£cÚds_t
 
	tu£cÚds_t
;

137 
	#__u£cÚds_t_defšed


	)

139 #iâdeà
__su£cÚds_t_defšed


140 
__su£cÚds_t
 
	tsu£cÚds_t
;

141 
	#__su£cÚds_t_defšed


	)

145 
	#__Ãed_size_t


	)

146 
	~<¡ddef.h
>

148 #ifdeà
__USE_MISC


150 
	tulÚg
;

151 
	tushÜt
;

152 
	tušt
;

157 #ià!
__GNUC_PREREQ
 (2, 7)

160 #iâdeà
__št8_t_defšed


161 
	#__št8_t_defšed


	)

162 
	tšt8_t
;

163 
	tšt16_t
;

164 
	tšt32_t
;

165 #ià
__WORDSIZE
 == 64

166 
	tšt64_t
;

168 
__ex‹nsiÚ__
 
	tšt64_t
;

173 
	tu_št8_t
;

174 
	tu_št16_t
;

175 
	tu_št32_t
;

176 #ià
__WORDSIZE
 == 64

177 
	tu_št64_t
;

179 
__ex‹nsiÚ__
 
	tu_št64_t
;

182 
	t»gi¡”_t
;

187 
	#__štN_t
(
N
, 
MODE
) \

188 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

189 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

190 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

192 #iâdeà
	t__št8_t_defšed


193 
	t__št8_t_defšed


	)

194 
	t__štN_t
 (8, 
	t__QI__
);

195 
__štN_t
 (16, 
__HI__
);

196 
__štN_t
 (32, 
__SI__
);

197 
__štN_t
 (64, 
__DI__
);

200 
__u_štN_t
 (8, 
__QI__
);

201 
__u_štN_t
 (16, 
__HI__
);

202 
__u_štN_t
 (32, 
__SI__
);

203 
__u_štN_t
 (64, 
__DI__
);

205 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

211 
	#__BIT_TYPES_DEFINED__
 1

	)

214 #ifdef 
__USE_BSD


216 
	~<’dŸn.h
>

219 
	~<sys/£Ëù.h
>

222 
	~<sys/sysmaüos.h
>

226 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

227 && !
defšed
 
__blksize_t_defšed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_defšed


	)

233 #iâdeà
__USE_FILE_OFFSET64


234 #iâdeà
__blkút_t_defšed


235 
__blkút_t
 
	tblkút_t
;

236 
	#__blkút_t_defšed


	)

238 #iâdeà
__fsblkút_t_defšed


239 
__fsblkút_t
 
	tfsblkút_t
;

240 
	#__fsblkút_t_defšed


	)

242 #iâdeà
__fsfžút_t_defšed


243 
__fsfžút_t
 
	tfsfžút_t
;

244 
	#__fsfžút_t_defšed


	)

247 #iâdeà
__blkút_t_defšed


248 
__blkút64_t
 
	tblkút_t
;

249 
	#__blkút_t_defšed


	)

251 #iâdeà
__fsblkút_t_defšed


252 
__fsblkút64_t
 
	tfsblkút_t
;

253 
	#__fsblkút_t_defšed


	)

255 #iâdeà
__fsfžút_t_defšed


256 
__fsfžút64_t
 
	tfsfžút_t
;

257 
	#__fsfžút_t_defšed


	)

261 #ifdeà
__USE_LARGEFILE64


262 
__blkút64_t
 
	tblkút64_t
;

263 
__fsblkút64_t
 
	tfsblkút64_t
;

264 
__fsfžút64_t
 
	tfsfžút64_t
;

269 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


270 
	~<b™s/±h»adty³s.h
>

273 
	g__END_DECLS


	@/usr/include/asm-generic/posix_types.h

1 #iâdeà
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__k”Ãl_lÚg_t


14 
	t__k”Ãl_lÚg_t
;

15 
	t__k”Ãl_ulÚg_t
;

18 #iâdeà
__k”Ãl_šo_t


19 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_šo_t
;

22 #iâdeà
__k”Ãl_mode_t


23 
	t__k”Ãl_mode_t
;

26 #iâdeà
__k”Ãl_pid_t


27 
	t__k”Ãl_pid_t
;

30 #iâdeà
__k”Ãl_c_pid_t


31 
	t__k”Ãl_c_pid_t
;

34 #iâdeà
__k”Ãl_uid_t


35 
	t__k”Ãl_uid_t
;

36 
	t__k”Ãl_gid_t
;

39 #iâdeà
__k”Ãl_su£cÚds_t


40 
__k”Ãl_lÚg_t
 
	t__k”Ãl_su£cÚds_t
;

43 #iâdeà
__k”Ãl_daddr_t


44 
	t__k”Ãl_daddr_t
;

47 #iâdeà
__k”Ãl_uid32_t


48 
	t__k”Ãl_uid32_t
;

49 
	t__k”Ãl_gid32_t
;

52 #iâdeà
__k”Ãl_Þd_uid_t


53 
__k”Ãl_uid_t
 
	t__k”Ãl_Þd_uid_t
;

54 
__k”Ãl_gid_t
 
	t__k”Ãl_Þd_gid_t
;

57 #iâdeà
__k”Ãl_Þd_dev_t


58 
	t__k”Ãl_Þd_dev_t
;

65 #iâdeà
__k”Ãl_size_t


66 #ià
__BITS_PER_LONG
 != 64

67 
	t__k”Ãl_size_t
;

68 
	t__k”Ãl_ssize_t
;

69 
	t__k”Ãl_±rdiff_t
;

71 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_size_t
;

72 
__k”Ãl_lÚg_t
 
	t__k”Ãl_ssize_t
;

73 
__k”Ãl_lÚg_t
 
	t__k”Ãl_±rdiff_t
;

77 #iâdeà
__k”Ãl_fsid_t


79 
	mv®
[2];

80 } 
	t__k”Ãl_fsid_t
;

86 
__k”Ãl_lÚg_t
 
	t__k”Ãl_off_t
;

87 
	t__k”Ãl_loff_t
;

88 
__k”Ãl_lÚg_t
 
	t__k”Ãl_time_t
;

89 
__k”Ãl_lÚg_t
 
	t__k”Ãl_þock_t
;

90 
	t__k”Ãl_tim”_t
;

91 
	t__k”Ãl_þockid_t
;

92 * 
	t__k”Ãl_ÿddr_t
;

93 
	t__k”Ãl_uid16_t
;

94 
	t__k”Ãl_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #iâdeà
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifdeà
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/bits/byteswap-16.h

19 #iâdeà
_BITS_BYTESWAP_H


23 #ifdeà
__GNUC__


24 #ià
__GNUC__
 >= 2

25 
	#__bsw­_16
(
x
) \

26 (
__ex‹nsiÚ__
 \

27 ({ 
__v
, 
__x
 = (è(
x
); \

28 ià(
	`__bužtš_cÚ¡ªt_p
 (
__x
)) \

29 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

31 
	`__asm__
 ("rorw $8, %w0" \

32 : "ô" (
__v
) \

33 : "0" (
__x
) \

35 
__v
; }))

	)

38 
	#__bsw­_16
(
x
) \

39 (
__ex‹nsiÚ__
 \

40 ({ 
__x
 = (è(
x
); \

41 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

44 
__šlše
 

45 
	$__bsw­_16
 (
__bsx
)

47  
	`__bsw­_cÚ¡ªt_16
 (
__bsx
);

48 
	}
}

	@/usr/include/bits/pthreadtypes.h

18 #iâdeà
_BITS_PTHREADTYPES_H


19 
	#_BITS_PTHREADTYPES_H
 1

	)

21 
	~<b™s/wÜdsize.h
>

23 #ifdeà
__x86_64__


24 #ià
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

26 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

27 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

29 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

30 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

31 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

32 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

33 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

35 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

37 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

38 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

39 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

40 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

41 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

42 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

43 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

46 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

47 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

48 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

49 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

50 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

51 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

52 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

53 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

54 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

60 
	t±h»ad_t
;

63 
	u±h»ad_©Œ_t


65 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

66 
	m__®ign
;

68 #iâdeà
__have_±h»ad_©Œ_t


69 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

70 
	#__have_±h»ad_©Œ_t
 1

	)

74 #ifdeà
__x86_64__


75 
	s__±h»ad_š‹º®_li¡


77 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

78 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

79 } 
	t__±h»ad_li¡_t
;

81 
	s__±h»ad_š‹º®_¦i¡


83 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

84 } 
	t__±h»ad_¦i¡_t
;

92 
	s__±h»ad_mu‹x_s


94 
	m__lock
;

95 
	m__couÁ
;

96 
	m__owÃr
;

97 #ifdeà
__x86_64__


98 
	m__nu£rs
;

102 
	m__kšd
;

103 #ifdeà
__x86_64__


104 
	m__¥šs
;

105 
	m__–isiÚ
;

106 
__±h»ad_li¡_t
 
	m__li¡
;

107 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

108 
	#__PTHREAD_MUTEX_HAVE_ELISION
 1

	)

110 
	m__nu£rs
;

111 
__ex‹nsiÚ__
 union

115 
	m__e¥šs
;

116 
	m__–isiÚ
;

117 
	#__¥šs
 
d
.
__e¥šs


	)

118 
	#__–isiÚ
 
d
.
__–isiÚ


	)

119 
	#__PTHREAD_MUTEX_HAVE_ELISION
 2

	)

120 } 
	md
;

121 
__±h»ad_¦i¡_t
 
	m__li¡
;

124 } 
	m__d©a
;

125 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

126 
	m__®ign
;

127 } 
	t±h»ad_mu‹x_t
;

131 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

132 
	m__®ign
;

133 } 
	t±h»ad_mu‹x©Œ_t
;

142 
	m__lock
;

143 
	m__fu‹x
;

144 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

145 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

146 
__ex‹nsiÚ__
 
	m__wok’_£q
;

147 *
	m__mu‹x
;

148 
	m__nwa™”s
;

149 
	m__brßdÿ¡_£q
;

150 } 
	m__d©a
;

151 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

152 
__ex‹nsiÚ__
 
	m__®ign
;

153 } 
	t±h»ad_cÚd_t
;

157 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

158 
	m__®ign
;

159 } 
	t±h»ad_cÚd©Œ_t
;

163 
	t±h»ad_key_t
;

167 
	t±h»ad_Úû_t
;

170 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


175 #ifdeà
__x86_64__


178 
	m__lock
;

179 
	m__Ä_»ad”s
;

180 
	m__»ad”s_wakeup
;

181 
	m__wr™”_wakeup
;

182 
	m__Ä_»ad”s_queued
;

183 
	m__Ä_wr™”s_queued
;

184 
	m__wr™”
;

185 
	m__sh¬ed
;

186 
	m__·d1
;

187 
	m__·d2
;

190 
	m__æags
;

191 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

192 } 
	m__d©a
;

196 
	m__lock
;

197 
	m__Ä_»ad”s
;

198 
	m__»ad”s_wakeup
;

199 
	m__wr™”_wakeup
;

200 
	m__Ä_»ad”s_queued
;

201 
	m__Ä_wr™”s_queued
;

204 
	m__æags
;

205 
	m__sh¬ed
;

206 
	m__·d1
;

207 
	m__·d2
;

208 
	m__wr™”
;

209 } 
	m__d©a
;

211 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

212 
	m__®ign
;

213 } 
	t±h»ad_rwlock_t
;

217 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

218 
	m__®ign
;

219 } 
	t±h»ad_rwlock©Œ_t
;

223 #ifdeà
__USE_XOPEN2K


225 vÞ©ž
	t±h»ad_¥šlock_t
;

232 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

233 
	m__®ign
;

234 } 
	t±h»ad_b¬r›r_t
;

238 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

239 
	m__®ign
;

240 } 
	t±h»ad_b¬r›¿‰r_t
;

244 #iâdeà
__x86_64__


246 
	#__þ—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/sys/select.h

21 #iâdeà
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	~<b™s/£Ëù.h
>

33 
	~<b™s/sig£t.h
>

35 #iâdeà
__sig£t_t_defšed


36 
	#__sig£t_t_defšed


	)

37 
__sig£t_t
 
	tsig£t_t
;

41 
	#__Ãed_time_t


	)

42 
	#__Ãed_time¥ec


	)

43 
	~<time.h
>

44 
	#__Ãed_timev®


	)

45 
	~<b™s/time.h
>

47 #iâdeà
__su£cÚds_t_defšed


48 
__su£cÚds_t
 
	tsu£cÚds_t
;

49 
	#__su£cÚds_t_defšed


	)

54 
	t__fd_mask
;

57 #undeà
__NFDBITS


59 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

60 
	#__FD_ELT
(
d
è((dè/ 
__NFDBITS
)

	)

61 
	#__FD_MASK
(
d
è((
__fd_mask
è1 << ((dè% 
__NFDBITS
))

	)

68 #ifdeà
__USE_XOPEN


69 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

70 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

72 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

75 } 
	tfd_£t
;

78 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

80 #ifdeà
__USE_MISC


82 
__fd_mask
 
	tfd_mask
;

85 
	#NFDBITS
 
__NFDBITS


	)

90 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

91 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

92 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

93 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

96 
__BEGIN_DECLS


106 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

107 
fd_£t
 *
__»¡riù
 
__wr™efds
,

108 
fd_£t
 *
__»¡riù
 
__exû±fds
,

109 
timev®
 *
__»¡riù
 
__timeout
);

111 #ifdeà
__USE_XOPEN2K


118 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

119 
fd_£t
 *
__»¡riù
 
__wr™efds
,

120 
fd_£t
 *
__»¡riù
 
__exû±fds
,

121 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

122 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

127 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__GNUC__


128 
	~<b™s/£Ëù2.h
>

131 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

19 #iâdeà
_SYS_SYSMACROS_H


20 
	#_SYS_SYSMACROS_H
 1

	)

22 
	~<ã©u»s.h
>

24 
__BEGIN_DECLS


26 
__ex‹nsiÚ__


27 
	$gnu_dev_majÜ
 (
__dev
)

28 
__THROW
 
__©Œibu‹_cÚ¡__
;

29 
__ex‹nsiÚ__


30 
	$gnu_dev_mšÜ
 (
__dev
)

31 
__THROW
 
__©Œibu‹_cÚ¡__
;

32 
__ex‹nsiÚ__


33 
	$gnu_dev_makedev
 (
__majÜ
,

34 
__mšÜ
)

35 
__THROW
 
__©Œibu‹_cÚ¡__
;

37 #ifdeà
__USE_EXTERN_INLINES


38 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

39 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

41  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

42 
	}
}

44 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

45 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

47  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

48 
	}
}

50 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

51 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

53  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

54 | (((è(
__mšÜ
 & ~0xff)) << 12)

55 | (((è(
__majÜ
 & ~0xfff)) << 32));

56 
	}
}

58 
	g__END_DECLS


61 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

62 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

63 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_þock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__þock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_þock_t
)

53 
	#__þock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__þock_t
 
	tþock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
þock_t
)

66 #undeà
__Ãed_þock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__þockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_þockid_t
)

86 
	#__þockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__þockid_t
 
	tþockid_t
;

94 #undeà
__þockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
þock_t
 
	$þock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ð0 && ((y—rè% 100 !ð0 || (y—rè% 400 =ð0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$þock_g‘»s
 (
þockid_t
 
__þock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$þock_g‘time
 (
þockid_t
 
__þock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$þock_£‰ime
 (
þockid_t
 
__þock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`þock_Çno¦“p
 (
þockid_t
 
__þock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$þock_g‘ýuþockid
 (
pid_t
 
__pid
, 
þockid_t
 *
__þock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
þockid_t
 
__þock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/asm-generic/bitsperlong.h

1 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #iâdeà
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@/usr/include/bits/select.h

18 #iâdeà
_SYS_SELECT_H


22 
	~<b™s/wÜdsize.h
>

25 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

27 #ià
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "¡osq"

	)

30 
	#__FD_ZERO_STOS
 "¡o¦"

	)

33 
	#__FD_ZERO
(
fd¥
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vÞ©že__
 ("þd;„•; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¬r
 = (
£t
); \

52 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |ð
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &ð~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)è!ð0)

	)

	@/usr/include/bits/select2.h

19 #iâdeà
_SYS_SELECT_H


24 
__fd–t_chk
 (
__d
);

25 
	$__fd–t_w¬n
 (
__d
)

26 
	`__w¬Ç‰r
 ("bit outside of fd_set selected");

27 #undeà
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__ex‹nsiÚ__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__bužtš_cÚ¡ªt_p
 (
__d
) \

32 ? (0 <ð
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fd–t_w¬n
 (
__d
)) \

35 : 
	`__fd–t_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/sigset.h

19 #iâdef 
_SIGSET_H_ty³s


20 
	#_SIGSET_H_ty³s
 1

	)

22 
	t__sig_©omic_t
;

26 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

29 
	m__v®
[
_SIGSET_NWORDS
];

30 } 
	t__sig£t_t
;

41 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


42 
	#_SIGSET_H_âs
 1

	)

44 #iâdeà
_EXTERN_INLINE


45 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

49 
	#__sigmask
(
sig
) \

50 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

53 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

55 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

56 
	#__sigem±y£t
(
£t
) \

57 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

58 
sig£t_t
 *
__£t
 = (
£t
); \

59 --
__út
 >ð0è
__£t
->
__v®
[__cnt] = 0; \

60 0; }))

	)

61 
	#__sigfžl£t
(
£t
) \

62 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

63 
sig£t_t
 *
__£t
 = (
£t
); \

64 --
__út
 >ð0è
__£t
->
__v®
[__cnt] = ~0UL; \

65 0; }))

	)

67 #ifdeà
__USE_GNU


71 
	#__sigi£m±y£t
(
£t
) \

72 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

73 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

74 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

75 !
__»t
 && --
__út
 >= 0) \

76 
__»t
 = 
__£t
->
__v®
[
__út
]; \

77 
__»t
 =ð0; }))

	)

78 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

79 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

80 
sig£t_t
 *
__de¡
 = (
de¡
); \

81 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

82 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

83 --
__út
 >= 0) \

84 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

85 & 
__right
->
__v®
[
__út
]); \

86 0; }))

	)

87 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

88 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

89 
sig£t_t
 *
__de¡
 = (
de¡
); \

90 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

91 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

92 --
__út
 >= 0) \

93 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

94 | 
__right
->
__v®
[
__út
]); \

95 0; }))

	)

102 
__sigismemb”
 (cÚ¡ 
__sig£t_t
 *, );

103 
__sigadd£t
 (
__sig£t_t
 *, );

104 
__sigd–£t
 (
__sig£t_t
 *, );

106 #ifdeà
__USE_EXTERN_INLINES


107 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

108 
_EXTERN_INLINE
 \

109 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

111 
__mask
 = 
	`__sigmask
 (
__sig
); \

112 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

113  
BODY
; \

114 }

	)

116 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
) ? 1 : 0, const)

117 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ð
__mask
), 0), )

118 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ð~
__mask
), 0), )

120 #undeà
__SIGSETFN


	@/usr/include/bits/time.h

23 #ià
defšed
 
__Ãed_timev®
 || defšed 
__USE_GNU


24 #iâdeà
_STRUCT_TIMEVAL


25 
	#_STRUCT_TIMEVAL
 1

	)

26 
	~<b™s/ty³s.h
>

30 
	stimev®


32 
__time_t
 
	mtv_£c
;

33 
__su£cÚds_t
 
	mtv_u£c
;

38 #iâdeà
__Ãed_timev®


39 #iâdeà
_BITS_TIME_H


40 
	#_BITS_TIME_H
 1

	)

48 
	#CLOCKS_PER_SEC
 1000000l

	)

50 #ià(!
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_POSIX
) \

51 && !
defšed
 
	g__USE_XOPEN2K


54 
	~<b™s/ty³s.h
>

55 
__syscÚf
 ();

56 
	#CLK_TCK
 ((
__þock_t
è
	`__syscÚf
 (2)è

	)

59 #ifdeà
__USE_POSIX199309


61 
	#CLOCK_REALTIME
 0

	)

63 
	#CLOCK_MONOTONIC
 1

	)

65 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

67 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

69 
	#CLOCK_MONOTONIC_RAW
 4

	)

71 
	#CLOCK_REALTIME_COARSE
 5

	)

73 
	#CLOCK_MONOTONIC_COARSE
 6

	)

75 
	#CLOCK_BOOTTIME
 7

	)

77 
	#CLOCK_REALTIME_ALARM
 8

	)

79 
	#CLOCK_BOOTTIME_ALARM
 9

	)

82 
	#TIMER_ABSTIME
 1

	)

85 #ifdeà
__USE_GNU


86 
	~<b™s/timex.h
>

88 
__BEGIN_DECLS


91 
	$þock_adjtime
 (
__þockid_t
 
__þock_id
, 
timex
 *
__utx
è
__THROW
;

93 
__END_DECLS


99 #undeà
__Ãed_timev®


	@/usr/include/bits/timex.h

18 #iâdef 
_BITS_TIMEX_H


19 
	#_BITS_TIMEX_H
 1

	)

21 
	~<b™s/ty³s.h
>

25 
	stimex


27 
	mmodes
;

28 
__sysÿÎ_¦Úg_t
 
	moff£t
;

29 
__sysÿÎ_¦Úg_t
 
	mäeq
;

30 
__sysÿÎ_¦Úg_t
 
	mmax”rÜ
;

31 
__sysÿÎ_¦Úg_t
 
	me¡”rÜ
;

32 
	m¡©us
;

33 
__sysÿÎ_¦Úg_t
 
	mcÚ¡ªt
;

34 
__sysÿÎ_¦Úg_t
 
	m´ecisiÚ
;

35 
__sysÿÎ_¦Úg_t
 
	mtÞ”ªû
;

36 
timev®
 
	mtime
;

37 
__sysÿÎ_¦Úg_t
 
	mtick
;

38 
__sysÿÎ_¦Úg_t
 
	mµsäeq
;

39 
__sysÿÎ_¦Úg_t
 
	mj™‹r
;

40 
	mshiá
;

41 
__sysÿÎ_¦Úg_t
 
	m¡abž
;

42 
__sysÿÎ_¦Úg_t
 
	mj™út
;

43 
__sysÿÎ_¦Úg_t
 
	mÿlút
;

44 
__sysÿÎ_¦Úg_t
 
	m”rút
;

45 
__sysÿÎ_¦Úg_t
 
	m¡bút
;

47 
	mi
;

56 
	#ADJ_OFFSET
 0x0001

	)

57 
	#ADJ_FREQUENCY
 0x0002

	)

58 
	#ADJ_MAXERROR
 0x0004

	)

59 
	#ADJ_ESTERROR
 0x0008

	)

60 
	#ADJ_STATUS
 0x0010

	)

61 
	#ADJ_TIMECONST
 0x0020

	)

62 
	#ADJ_TAI
 0x0080

	)

63 
	#ADJ_MICRO
 0x1000

	)

64 
	#ADJ_NANO
 0x2000

	)

65 
	#ADJ_TICK
 0x4000

	)

66 
	#ADJ_OFFSET_SINGLESHOT
 0x8001

	)

67 
	#ADJ_OFFSET_SS_READ
 0xa001

	)

70 
	#MOD_OFFSET
 
ADJ_OFFSET


	)

71 
	#MOD_FREQUENCY
 
ADJ_FREQUENCY


	)

72 
	#MOD_MAXERROR
 
ADJ_MAXERROR


	)

73 
	#MOD_ESTERROR
 
ADJ_ESTERROR


	)

74 
	#MOD_STATUS
 
ADJ_STATUS


	)

75 
	#MOD_TIMECONST
 
ADJ_TIMECONST


	)

76 
	#MOD_CLKB
 
ADJ_TICK


	)

77 
	#MOD_CLKA
 
ADJ_OFFSET_SINGLESHOT


	)

78 
	#MOD_TAI
 
ADJ_TAI


	)

79 
	#MOD_MICRO
 
ADJ_MICRO


	)

80 
	#MOD_NANO
 
ADJ_NANO


	)

84 
	#STA_PLL
 0x0001

	)

85 
	#STA_PPSFREQ
 0x0002

	)

86 
	#STA_PPSTIME
 0x0004

	)

87 
	#STA_FLL
 0x0008

	)

89 
	#STA_INS
 0x0010

	)

90 
	#STA_DEL
 0x0020

	)

91 
	#STA_UNSYNC
 0x0040

	)

92 
	#STA_FREQHOLD
 0x0080

	)

94 
	#STA_PPSSIGNAL
 0x0100

	)

95 
	#STA_PPSJITTER
 0x0200

	)

96 
	#STA_PPSWANDER
 0x0400

	)

97 
	#STA_PPSERROR
 0x0800

	)

99 
	#STA_CLOCKERR
 0x1000

	)

100 
	#STA_NANO
 0x2000

	)

101 
	#STA_MODE
 0x4000

	)

102 
	#STA_CLK
 0x8000

	)

105 
	#STA_RONLY
 (
STA_PPSSIGNAL
 | 
STA_PPSJITTER
 | 
STA_PPSWANDER
 | \

106 
STA_PPSERROR
 | 
STA_CLOCKERR
 | 
STA_NANO
 | 
STA_MODE
 | 
STA_CLK
)

	)

	@
1
.
1
/usr/include
78
2011
cache.c
config.c
dir.c
fat.h
fatent.c
file.c
inode.c
misc.c
namei_msdos.c
namei_vfat.c
nfs.c
/usr/include/linux/capability.h
/usr/include/linux/fs.h
/usr/include/linux/kernel.h
/usr/include/linux/msdos_fs.h
/usr/include/linux/string.h
/usr/include/linux/time.h
/usr/include/linux/uio.h
/usr/include/asm/byteorder.h
/usr/include/linux/ioctl.h
/usr/include/linux/limits.h
/usr/include/linux/magic.h
/usr/include/linux/sysinfo.h
/usr/include/linux/types.h
/usr/include/string.h
/usr/include/asm/ioctl.h
/usr/include/asm/types.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/features.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/posix_types.h
/usr/include/xlocale.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/bits/types.h
/usr/include/endian.h
/usr/include/gnu/stubs.h
/usr/include/linux/stddef.h
/usr/include/linux/swab.h
/usr/include/stdc-predef.h
/usr/include/stdlib.h
/usr/include/sys/cdefs.h
/usr/include/alloca.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm/swab.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/stdlib-bsearch.h
/usr/include/bits/stdlib-float.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/typesizes.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/gnu/stubs-x32.h
/usr/include/sys/types.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/bits/byteswap-16.h
/usr/include/bits/pthreadtypes.h
/usr/include/sys/select.h
/usr/include/sys/sysmacros.h
/usr/include/time.h
/usr/include/asm-generic/bitsperlong.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/sigset.h
/usr/include/bits/time.h
/usr/include/bits/timex.h
